{
  "timestamp": "2025-07-05T19-45-45-984Z",
  "originalPath": "/mnt/h/projetos/academia/public/index.html",
  "description": "ImplementaÃ§Ã£o inicial da arquitetura modular - Sistema de isolamento implementado",
  "content": "<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>ðŸ¥‹ Krav Maga Academy - Dashboard</title>\n    \n    <!-- ðŸ”Œ CARREGADOR DE MÃ“DULOS ISOLADOS -->\n    <script src=\"/js/module-loader.js\"></script>\n    \n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body {\n            font-family: 'Inter', system-ui, -apple-system, sans-serif;\n            background: #0A0E1A;\n            color: #E2E8F0;\n            margin: 0;\n            padding: 0;\n            min-height: 100vh;\n            overflow-x: hidden;\n        }\n        \n        /* UX-Enhanced Dashboard Layout */\n        .dashboard-container {\n            display: grid;\n            grid-template-areas: \n                \"header header header\"\n                \"sidebar main widgets\"\n                \"sidebar main widgets\";\n            grid-template-columns: 280px 1fr 320px;\n            grid-template-rows: 80px 1fr auto;\n            min-height: 100vh;\n            gap: 0;\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        \n        .dashboard-container.collapsed {\n            grid-template-columns: 80px 1fr 320px;\n        }\n        \n        .dashboard-container.mobile {\n            grid-template-areas: \n                \"header\"\n                \"main\"\n                \"widgets\";\n            grid-template-columns: 1fr;\n            grid-template-rows: 80px 1fr auto;\n        }\n        \n        /* UX-Enhanced Header */\n        .dashboard-header {\n            grid-area: header;\n            background: linear-gradient(135deg, #1E293B 0%, #334155 100%);\n            border-bottom: 1px solid rgba(148, 163, 184, 0.1);\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            padding: 0 2rem;\n            backdrop-filter: blur(20px);\n            z-index: 100;\n        }\n        \n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 1rem;\n        }\n        \n        .header-title {\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n            font-size: 1.25rem;\n            font-weight: 700;\n            color: #3B82F6;\n        }\n        \n        .header-ai-status {\n            background: linear-gradient(135deg, #10B981, #059669);\n            color: white;\n            padding: 0.5rem 1rem;\n            border-radius: 20px;\n            font-size: 0.75rem;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n        }\n        \n        .header-actions {\n            display: flex;\n            align-items: center;\n            gap: 1rem;\n        }\n        \n        .quick-action-btn {\n            background: rgba(59, 130, 246, 0.1);\n            border: 1px solid #3B82F6;\n            color: #3B82F6;\n            padding: 0.5rem 1rem;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            font-size: 0.875rem;\n            font-weight: 500;\n        }\n        \n        .quick-action-btn:hover {\n            background: #3B82F6;\n            color: white;\n            transform: translateY(-1px);\n        }\n        \n        /* UX-Enhanced Sidebar */\n        .dashboard-sidebar {\n            grid-area: sidebar;\n            background: linear-gradient(180deg, #1E293B 0%, #0F172A 100%);\n            border-right: 1px solid rgba(148, 163, 184, 0.1);\n            padding: 1.5rem 0;\n            overflow-y: auto;\n            transition: all 0.3s ease;\n        }\n        \n        .sidebar-section {\n            margin-bottom: 2rem;\n        }\n        \n        .sidebar-title {\n            color: #94A3B8;\n            font-size: 0.75rem;\n            font-weight: 600;\n            text-transform: uppercase;\n            letter-spacing: 0.05em;\n            padding: 0 1.5rem;\n            margin-bottom: 1rem;\n        }\n        \n        .logo {\n            padding: 0 2rem 2rem;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n            margin-bottom: 2rem;\n        }\n        \n        .logo h1 {\n            color: #3B82F6;\n            font-size: 1.5rem;\n            font-weight: 800;\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n        }\n        \n        /* UX-Enhanced Navigation */\n        .nav-menu {\n            list-style: none;\n            padding: 0;\n        }\n        \n        .nav-item {\n            margin-bottom: 0.25rem;\n        }\n        \n        .nav-link {\n            display: flex;\n            align-items: center;\n            gap: 0.75rem;\n            padding: 0.875rem 1.5rem;\n            color: #94A3B8;\n            text-decoration: none;\n            cursor: pointer;\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            border: none;\n            background: none;\n            width: 100%;\n            text-align: left;\n            font-weight: 500;\n            position: relative;\n            border-radius: 0 25px 25px 0;\n            margin-right: 1rem;\n        }\n        \n        .nav-link:before {\n            content: '';\n            position: absolute;\n            left: 0;\n            top: 0;\n            bottom: 0;\n            width: 3px;\n            background: transparent;\n            transition: all 0.3s ease;\n        }\n        \n        .nav-link:hover {\n            background: rgba(59, 130, 246, 0.1);\n            color: #3B82F6;\n            transform: translateX(8px);\n        }\n        \n        .nav-link:hover:before {\n            background: #3B82F6;\n        }\n        \n        .nav-link.active {\n            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));\n            color: #3B82F6;\n            transform: translateX(8px);\n        }\n        \n        .nav-link.active:before {\n            background: #3B82F6;\n        }\n        \n        .nav-link.active .nav-icon {\n            color: #3B82F6;\n        }\n        \n        /* AI Agent Integration Indicators */\n        .nav-link[data-ai-enabled=\"true\"]:after {\n            content: 'ðŸ¤–';\n            font-size: 0.75rem;\n            opacity: 0.7;\n            margin-left: auto;\n        }\n        \n        .nav-icon {\n            width: 20px;\n            text-align: center;\n            font-size: 1.1rem;\n        }\n        \n        /* UX-Enhanced Main Content Area */\n        .dashboard-main {\n            grid-area: main;\n            background: #0F172A;\n            padding: 2rem;\n            overflow-y: auto;\n            position: relative;\n        }\n        \n        .main-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            margin-bottom: 2rem;\n            padding-bottom: 1rem;\n            border-bottom: 1px solid rgba(148, 163, 184, 0.1);\n        }\n        \n        .main-title {\n            font-size: 2rem;\n            font-weight: 700;\n            color: #F8FAFC;\n            margin: 0;\n        }\n        \n        .main-subtitle {\n            color: #94A3B8;\n            margin-top: 0.5rem;\n            font-size: 1rem;\n        }\n        \n        .ai-insights-banner {\n            background: linear-gradient(135deg, #3B82F6, #1D4ED8);\n            border-radius: 12px;\n            padding: 1rem;\n            margin-bottom: 2rem;\n            color: white;\n            display: flex;\n            align-items: center;\n            gap: 1rem;\n        }\n        \n        .ai-insights-icon {\n            font-size: 1.5rem;\n        }\n        \n        .ai-insights-content h4 {\n            margin: 0 0 0.25rem 0;\n            font-weight: 600;\n        }\n        \n        .ai-insights-content p {\n            margin: 0;\n            opacity: 0.9;\n            font-size: 0.875rem;\n        }\n        \n        /* UX-Enhanced Widgets Sidebar */\n        .dashboard-widgets {\n            grid-area: widgets;\n            background: linear-gradient(180deg, #0F172A 0%, #1E293B 100%);\n            border-left: 1px solid rgba(148, 163, 184, 0.1);\n            padding: 2rem 1.5rem;\n            overflow-y: auto;\n        }\n        \n        .widget {\n            background: rgba(30, 41, 59, 0.5);\n            border: 1px solid rgba(148, 163, 184, 0.1);\n            border-radius: 16px;\n            padding: 1.5rem;\n            margin-bottom: 1.5rem;\n            backdrop-filter: blur(10px);\n            transition: all 0.3s ease;\n        }\n        \n        .widget:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);\n        }\n        \n        .widget-header {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            margin-bottom: 1rem;\n        }\n        \n        .widget-title {\n            font-size: 1rem;\n            font-weight: 600;\n            color: #F8FAFC;\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n        }\n        \n        .widget-action {\n            background: none;\n            border: none;\n            color: #94A3B8;\n            cursor: pointer;\n            padding: 0.25rem;\n            border-radius: 4px;\n            transition: all 0.2s ease;\n        }\n        \n        .widget-action:hover {\n            background: rgba(59, 130, 246, 0.1);\n            color: #3B82F6;\n        }\n        \n        /* Smart Badges */\n        .badge {\n            background: #EF4444;\n            color: white;\n            padding: 0.25rem 0.75rem;\n            border-radius: 20px;\n            font-size: 0.75rem;\n            font-weight: 600;\n            margin-left: auto;\n            display: inline-flex;\n            align-items: center;\n            gap: 0.25rem;\n        }\n        \n        .badge.success {\n            background: linear-gradient(135deg, #10B981, #059669);\n        }\n        \n        .badge.warning {\n            background: linear-gradient(135deg, #F59E0B, #D97706);\n        }\n        \n        .badge.info {\n            background: linear-gradient(135deg, #3B82F6, #2563EB);\n        }\n        \n        .badge.ai-powered {\n            background: linear-gradient(135deg, #8B5CF6, #7C3AED);\n            animation: pulse 2s infinite;\n        }\n        \n        @keyframes pulse {\n            0%, 100% { opacity: 1; }\n            50% { opacity: 0.8; }\n        }\n        \n        /* AI-Enhanced Cards and Components */\n        .smart-card {\n            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.6));\n            border: 1px solid rgba(148, 163, 184, 0.1);\n            border-radius: 16px;\n            padding: 1.5rem;\n            margin-bottom: 1.5rem;\n            position: relative;\n            overflow: hidden;\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        \n        .smart-card:hover {\n            transform: translateY(-4px);\n            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);\n            border-color: rgba(59, 130, 246, 0.3);\n        }\n        \n        .smart-card::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 2px;\n            background: linear-gradient(90deg, #3B82F6, #8B5CF6, #10B981);\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n        \n        .smart-card:hover::before {\n            opacity: 1;\n        }\n        \n        .metric-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 1.5rem;\n            margin-bottom: 2rem;\n        }\n        \n        .metric-card {\n            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.6));\n            border: 1px solid rgba(148, 163, 184, 0.1);\n            border-radius: 16px;\n            padding: 1.5rem;\n            text-align: center;\n            position: relative;\n            overflow: hidden;\n            transition: all 0.3s ease;\n        }\n        \n        .metric-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);\n        }\n        \n        .metric-value {\n            font-size: 2.5rem;\n            font-weight: 700;\n            color: #3B82F6;\n            margin-bottom: 0.5rem;\n            line-height: 1;\n        }\n        \n        .metric-label {\n            color: #94A3B8;\n            font-size: 0.875rem;\n            font-weight: 500;\n            text-transform: uppercase;\n            letter-spacing: 0.05em;\n        }\n        \n        .metric-trend {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 0.25rem;\n            margin-top: 0.5rem;\n            font-size: 0.75rem;\n            font-weight: 600;\n        }\n        \n        .metric-trend.positive {\n            color: #10B981;\n        }\n        \n        .metric-trend.negative {\n            color: #EF4444;\n        }\n        \n        /* AI Agent Status Widget */\n        .ai-agent-widget {\n            background: linear-gradient(145deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.05));\n            border: 1px solid rgba(139, 92, 246, 0.2);\n            border-radius: 16px;\n            padding: 1.5rem;\n            margin-bottom: 1.5rem;\n        }\n        \n        .ai-agent-header {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            margin-bottom: 1rem;\n        }\n        \n        .ai-agent-title {\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n            font-size: 1rem;\n            font-weight: 600;\n            color: #8B5CF6;\n        }\n        \n        .ai-agent-status {\n            background: linear-gradient(135deg, #10B981, #059669);\n            color: white;\n            padding: 0.25rem 0.75rem;\n            border-radius: 12px;\n            font-size: 0.75rem;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 0.25rem;\n        }\n        \n        .ai-agent-list {\n            display: flex;\n            flex-direction: column;\n            gap: 0.75rem;\n        }\n        \n        .ai-agent-item {\n            background: rgba(30, 41, 59, 0.3);\n            border-radius: 8px;\n            padding: 0.75rem;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n        \n        .ai-agent-info {\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n        }\n        \n        .ai-agent-name {\n            font-weight: 500;\n            color: #F8FAFC;\n            font-size: 0.875rem;\n        }\n        \n        .ai-agent-type {\n            color: #94A3B8;\n            font-size: 0.75rem;\n        }\n        \n        .ai-agent-indicator {\n            width: 8px;\n            height: 8px;\n            border-radius: 50%;\n            background: #10B981;\n            animation: pulse 2s infinite;\n        }\n        \n        /* Responsive Design */\n        @media (max-width: 1200px) {\n            .dashboard-container {\n                grid-template-columns: 280px 1fr;\n                grid-template-areas: \n                    \"header header\"\n                    \"sidebar main\";\n            }\n            \n            .dashboard-widgets {\n                display: none;\n            }\n        }\n        \n        @media (max-width: 768px) {\n            .dashboard-container {\n                grid-template-columns: 1fr;\n                grid-template-areas: \n                    \"header\"\n                    \"main\";\n            }\n            \n            .dashboard-sidebar {\n                position: fixed;\n                left: -280px;\n                top: 80px;\n                bottom: 0;\n                width: 280px;\n                z-index: 1000;\n                transition: left 0.3s ease;\n            }\n            \n            .dashboard-sidebar.open {\n                left: 0;\n            }\n            \n            .metric-grid {\n                grid-template-columns: 1fr;\n            }\n            \n            .dashboard-main {\n                padding: 1rem;\n            }\n        }\n        \n        .upload-tab {\n            padding: 0.75rem 1.5rem;\n            border: none;\n            background: rgba(55, 65, 81, 0.5);\n            color: #CBD5E1;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }\n        \n        .upload-tab:hover {\n            background: rgba(59, 130, 246, 0.2);\n            color: #F8FAFC;\n        }\n        \n        .upload-tab.active {\n            background: #3B82F6;\n            color: white;\n        }\n        \n        .main-content {\n            flex: 1;\n            padding: 2rem;\n            overflow-y: auto;\n        }\n        \n        .page-header {\n            margin-bottom: 2rem;\n        }\n        \n        .page-header h1 {\n            font-size: 2rem;\n            font-weight: 700;\n            color: #F8FAFC;\n            margin-bottom: 0.5rem;\n        }\n        \n        .page-header p {\n            color: #CBD5E1;\n            font-size: 1rem;\n        }\n        \n        .content-section {\n            display: none;\n        }\n        \n        .content-section.active {\n            display: block;\n        }\n        \n        .stats-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 1.5rem;\n            margin-bottom: 2rem;\n        }\n        \n        .stat-card {\n            background: rgba(255, 255, 255, 0.1);\n            backdrop-filter: blur(20px);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 20px;\n            padding: 2rem;\n            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n            transition: all 0.3s ease;\n            position: relative;\n        }\n        \n        .stat-card::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 4px;\n            background: linear-gradient(90deg, #3B82F6, #10B981);\n        }\n        \n        .stat-card:hover {\n            transform: translateY(-8px);\n            box-shadow: 0 35px 60px -12px rgba(0, 0, 0, 0.35);\n        }\n        \n        .stat-value {\n            font-size: 2.5rem;\n            font-weight: 800;\n            color: #F8FAFC;\n            margin-bottom: 0.5rem;\n        }\n        \n        .stat-label {\n            color: #CBD5E1;\n            font-size: 0.875rem;\n            font-weight: 500;\n        }\n        \n        .data-table {\n            background: rgba(255, 255, 255, 0.1);\n            backdrop-filter: blur(20px);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 20px;\n            padding: 2rem;\n            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n        }\n        \n        .table-header {\n            margin-bottom: 1.5rem;\n            padding-bottom: 1rem;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n        }\n        \n        .table-title {\n            font-size: 1.25rem;\n            font-weight: 600;\n            color: #F8FAFC;\n        }\n        \n        .students-table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .students-table th,\n        .students-table td {\n            padding: 1rem;\n            text-align: left;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n        \n        .students-table th {\n            background: rgba(59, 130, 246, 0.1);\n            color: #F8FAFC;\n            font-weight: 600;\n        }\n        \n        .students-table td {\n            color: #CBD5E1;\n        }\n        \n        .status-badge {\n            padding: 0.25rem 0.75rem;\n            border-radius: 20px;\n            font-size: 0.75rem;\n            font-weight: 600;\n        }\n        \n        .status-active {\n            background: rgba(16, 185, 129, 0.2);\n            color: #10B981;\n        }\n        \n        .status-inactive {\n            background: rgba(239, 68, 68, 0.2);\n            color: #EF4444;\n        }\n        \n        .empty-state {\n            text-align: center;\n            padding: 4rem 2rem;\n            color: #CBD5E1;\n        }\n        \n        .empty-icon {\n            font-size: 4rem;\n            margin-bottom: 1rem;\n        }\n        \n        .btn {\n            padding: 0.75rem 1.5rem;\n            border: none;\n            border-radius: 12px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            text-decoration: none;\n            display: inline-flex;\n            align-items: center;\n            gap: 0.5rem;\n            font-size: 0.875rem;\n        }\n        \n        .btn-primary {\n            background: linear-gradient(135deg, #3B82F6, #2563EB);\n            color: white;\n            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n        }\n        \n        .btn-primary:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);\n        }\n        \n        .btn-secondary {\n            background: rgba(255, 255, 255, 0.1);\n            color: #CBD5E1;\n            border: 1px solid rgba(255, 255, 255, 0.2);\n        }\n        \n        .btn-secondary:hover {\n            background: rgba(255, 255, 255, 0.15);\n            color: white;\n        }\n        \n        .btn-small {\n            padding: 0.5rem 1rem;\n            font-size: 0.75rem;\n        }\n        \n        .table-actions {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 1.5rem;\n        }\n        \n        .action-buttons {\n            display: flex;\n            gap: 0.5rem;\n        }\n        \n        .modal {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.8);\n            backdrop-filter: blur(10px);\n            z-index: 1000;\n            justify-content: center;\n            align-items: center;\n        }\n        \n        .modal.active {\n            display: flex;\n        }\n        \n        .modal-content {\n            background: rgba(15, 23, 42, 0.95);\n            backdrop-filter: blur(20px);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 20px;\n            padding: 2rem;\n            max-width: 500px;\n            width: 90%;\n            max-height: 80vh;\n            overflow-y: auto;\n        }\n        \n        .modal-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 2rem;\n            padding-bottom: 1rem;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n        }\n        \n        .modal-title {\n            font-size: 1.5rem;\n            font-weight: 700;\n            color: #F8FAFC;\n        }\n        \n        .close-btn {\n            background: none;\n            border: none;\n            color: #CBD5E1;\n            font-size: 1.5rem;\n            cursor: pointer;\n            padding: 0.5rem;\n            border-radius: 8px;\n        }\n        \n        .close-btn:hover {\n            background: rgba(255, 255, 255, 0.1);\n            color: white;\n        }\n        \n        .form-group {\n            margin-bottom: 1.5rem;\n        }\n        \n        .form-label {\n            display: block;\n            color: #F8FAFC;\n            font-weight: 600;\n            margin-bottom: 0.5rem;\n        }\n        \n        .form-input {\n            width: 100%;\n            padding: 0.75rem 1rem;\n            background: rgba(255, 255, 255, 0.1);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 8px;\n            color: #F8FAFC;\n            font-size: 1rem;\n        }\n        \n        .form-input:focus {\n            outline: none;\n            border-color: #3B82F6;\n            background: rgba(255, 255, 255, 0.15);\n        }\n        \n        .form-select {\n            width: 100%;\n            padding: 0.75rem 1rem;\n            background: rgba(255, 255, 255, 0.1);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 8px;\n            color: #F8FAFC;\n            font-size: 1rem;\n        }\n        \n        .form-select:focus {\n            outline: none;\n            border-color: #3B82F6;\n        }\n        \n        .form-actions {\n            display: flex;\n            gap: 1rem;\n            justify-content: flex-end;\n            padding-top: 1rem;\n            border-top: 1px solid rgba(255, 255, 255, 0.2);\n        }\n        \n        /* Student Modal Styles */\n        .large-modal {\n            max-width: 800px;\n            max-height: 90vh;\n            overflow-y: auto;\n        }\n        \n        .form-section {\n            margin-bottom: 2rem;\n            padding: 1.5rem;\n            background: rgba(255, 255, 255, 0.05);\n            border-radius: 12px;\n            border: 1px solid rgba(255, 255, 255, 0.1);\n        }\n        \n        .form-section h3 {\n            margin: 0 0 1rem 0;\n            color: #F8FAFC;\n            font-size: 1.1rem;\n            font-weight: 600;\n        }\n        \n        .form-row {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 1rem;\n            margin-bottom: 1rem;\n        }\n        \n        .form-group {\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .form-group.full-width {\n            grid-column: 1 / -1;\n        }\n        \n        .form-group label {\n            margin-bottom: 0.5rem;\n            color: #CBD5E1;\n            font-weight: 500;\n            font-size: 0.875rem;\n        }\n        \n        .form-group input,\n        .form-group select,\n        .form-group textarea {\n            padding: 0.75rem;\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 8px;\n            background: rgba(255, 255, 255, 0.05);\n            color: #F8FAFC;\n            font-size: 0.875rem;\n            transition: all 0.2s ease;\n        }\n        \n        .form-group input:focus,\n        .form-group select:focus,\n        .form-group textarea:focus {\n            outline: none;\n            border-color: #3B82F6;\n            background: rgba(59, 130, 246, 0.1);\n            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n        }\n        \n        .form-group input[readonly] {\n            background: rgba(255, 255, 255, 0.02);\n            color: #94A3B8;\n            cursor: not-allowed;\n        }\n        \n        .form-group select[multiple] {\n            min-height: 100px;\n        }\n        \n        .form-group textarea {\n            resize: vertical;\n            min-height: 80px;\n        }\n        \n        .modal-footer {\n            display: flex;\n            justify-content: flex-end;\n            gap: 1rem;\n            padding: 1.5rem;\n            border-top: 1px solid rgba(255, 255, 255, 0.1);\n            background: rgba(255, 255, 255, 0.02);\n        }\n        \n        /* Simple Student Table for Check-in */\n        .students-table-container {\n            background: rgba(30, 41, 59, 0.8);\n            border: 1px solid rgba(148, 163, 184, 0.1);\n            border-radius: 16px;\n            padding: 1.5rem;\n            margin-top: 1rem;\n            overflow-x: auto;\n        }\n        \n        .students-table {\n            width: 100%;\n            border-collapse: collapse;\n            font-size: 0.9rem;\n        }\n        \n        .students-table th,\n        .students-table td {\n            padding: 1rem 0.75rem;\n            text-align: left;\n            border-bottom: 1px solid rgba(148, 163, 184, 0.1);\n            white-space: nowrap;\n        }\n        \n        .students-table th {\n            background: rgba(59, 130, 246, 0.1);\n            color: #3B82F6;\n            font-weight: 600;\n            font-size: 0.875rem;\n            text-transform: uppercase;\n            letter-spacing: 0.05em;\n            position: sticky;\n            top: 0;\n            z-index: 10;\n        }\n        \n        .students-table td {\n            color: #E2E8F0;\n        }\n        \n        /* Enhanced Plan Management Animations */\n        @keyframes pulse {\n            0%, 100% { transform: scale(1); }\n            50% { transform: scale(1.02); }\n        }\n        \n        @keyframes glow {\n            0%, 100% { \n                box-shadow: 0 0 5px rgba(59, 130, 246, 0.3); \n                transform: scale(1);\n            }\n            50% { \n                box-shadow: 0 0 20px rgba(59, 130, 246, 0.6), 0 0 30px rgba(59, 130, 246, 0.4); \n                transform: scale(1.02);\n            }\n        }\n        \n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(10px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n        \n        @keyframes slideInUp {\n            from { opacity: 0; transform: translateY(30px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n        \n        /* Plan Card Hover Effects */\n        .plan-card-hover {\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        \n        .plan-card-hover:hover {\n            transform: translateY(-4px);\n            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n        }\n        \n        /* Enhanced Button Styles */\n        .btn-primary-gradient {\n            background: linear-gradient(135deg, #3B82F6, #2563EB);\n            transition: all 0.2s ease;\n        }\n        \n        .btn-primary-gradient:hover {\n            background: linear-gradient(135deg, #2563EB, #1D4ED8);\n            transform: translateY(-1px);\n            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);\n        }\n        \n        .btn-success-gradient {\n            background: linear-gradient(135deg, #10B981, #059669);\n            transition: all 0.2s ease;\n        }\n        \n        .btn-success-gradient:hover {\n            background: linear-gradient(135deg, #059669, #047857);\n            transform: translateY(-1px);\n            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);\n        }\n        \n        /* Loading States */\n        .loading-shimmer {\n            background: linear-gradient(90deg, \n                rgba(255, 255, 255, 0.1) 0%, \n                rgba(255, 255, 255, 0.2) 50%, \n                rgba(255, 255, 255, 0.1) 100%);\n            background-size: 200% 100%;\n            animation: shimmer 1.5s infinite;\n        }\n        \n        @keyframes shimmer {\n            0% { background-position: -200% 0; }\n            100% { background-position: 200% 0; }\n        }\n        \n        /* Plan Selection Visual Feedback */\n        .plan-selected {\n            border-color: #10B981 !important;\n            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));\n            transform: scale(1.02);\n            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);\n        }\n        \n        /* Responsive Grid Enhancements */\n        .plans-grid-responsive {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n            gap: 1.5rem;\n            padding: 1rem 0;\n        }\n        \n        @media (max-width: 768px) {\n            .plans-grid-responsive {\n                grid-template-columns: 1fr;\n                gap: 1rem;\n            }\n        }\n\n        .students-table tr:hover {\n            background: rgba(59, 130, 246, 0.05);\n        }\n        \n        .student-matricula {\n            font-family: 'Courier New', monospace;\n            background: rgba(59, 130, 246, 0.1);\n            color: #3B82F6;\n            padding: 0.25rem 0.5rem;\n            border-radius: 4px;\n            font-weight: 600;\n            font-size: 0.8rem;\n        }\n        \n        .student-cpf {\n            font-family: 'Courier New', monospace;\n            color: #94A3B8;\n            font-size: 0.85rem;\n        }\n        \n        .student-name-cell {\n            max-width: 200px;\n        }\n        \n        .student-name {\n            font-weight: 600;\n            color: #F8FAFC;\n            margin-bottom: 0.25rem;\n        }\n        \n        .student-email {\n            color: #94A3B8;\n            font-size: 0.8rem;\n        }\n        \n        .action-btn {\n            background: none;\n            border: 1px solid;\n            padding: 0.375rem 0.75rem;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 0.75rem;\n            font-weight: 500;\n            transition: all 0.2s ease;\n            margin-right: 0.5rem;\n        }\n        \n        .action-btn.checkin {\n            color: #10B981;\n            border-color: #10B981;\n        }\n        \n        .action-btn.checkin:hover {\n            background: #10B981;\n            color: white;\n        }\n        \n        .action-btn.view {\n            color: #3B82F6;\n            border-color: #3B82F6;\n        }\n        \n        .action-btn.view:hover {\n            background: #3B82F6;\n            color: white;\n        }\n        \n        .action-btn.edit {\n            color: #F59E0B;\n            border-color: #F59E0B;\n        }\n        \n        .action-btn.edit:hover {\n            background: #F59E0B;\n            color: white;\n        }\n        \n        .responsible-cell {\n            min-width: 150px;\n        }\n        \n        .responsible-name {\n            font-weight: 600;\n            color: #E2E8F0;\n            font-size: 0.875rem;\n        }\n        \n        .responsible-type {\n            font-size: 0.75rem;\n            color: #94A3B8;\n            margin-top: 0.25rem;\n        }\n        \n        /* Financial Module Styles */\n        .financial-tabs {\n            display: flex;\n            gap: 1rem;\n            border-bottom: 2px solid rgba(255, 255, 255, 0.1);\n            padding-bottom: 1rem;\n        }\n        \n        .financial-tab {\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            color: #CBD5E1;\n            padding: 0.75rem 1.5rem;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            font-weight: 500;\n        }\n        \n        .financial-tab:hover {\n            background: rgba(255, 255, 255, 0.1);\n            color: #E2E8F0;\n        }\n        \n        .financial-tab.active {\n            background: linear-gradient(135deg, #3B82F6, #10B981);\n            color: white;\n            border-color: transparent;\n        }\n        \n        .financial-tab-content {\n            display: none;\n        }\n        \n        .financial-tab-content.active {\n            display: block;\n        }\n        \n        .settings-section {\n            background: rgba(15, 23, 42, 0.6);\n            border-radius: 12px;\n            padding: 2rem;\n            border: 1px solid rgba(51, 65, 85, 0.8);\n        }\n        \n        .settings-section h3 {\n            color: #E2E8F0;\n            margin-bottom: 1.5rem;\n            font-size: 1.25rem;\n            font-weight: 600;\n        }\n        \n        /* Form checkbox styles */\n        .form-checkbox {\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n            cursor: pointer;\n            color: #E2E8F0;\n            font-size: 0.875rem;\n        }\n        \n        .form-checkbox input[type=\"checkbox\"] {\n            width: 18px;\n            height: 18px;\n            accent-color: #3B82F6;\n            cursor: pointer;\n        }\n        \n        .checkmark {\n            /* Custom checkbox styling if needed */\n        }\n        \n        /* Modern Students Grid */\n        .students-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));\n            gap: 1.5rem;\n            margin-top: 1rem;\n        }\n        \n        /* Simple Search Bar */\n        .simple-search {\n            background: rgba(30, 41, 59, 0.8);\n            border: 1px solid rgba(148, 163, 184, 0.1);\n            border-radius: 12px;\n            padding: 1rem;\n            margin-bottom: 1rem;\n            display: flex;\n            gap: 1rem;\n            align-items: center;\n            flex-wrap: wrap;\n        }\n        \n        .search-input {\n            flex: 1;\n            min-width: 300px;\n            background: rgba(15, 23, 42, 0.8);\n            border: 1px solid rgba(148, 163, 184, 0.2);\n            border-radius: 8px;\n            padding: 0.75rem 1rem;\n            color: #F8FAFC;\n            font-size: 1rem;\n            outline: none;\n            transition: all 0.2s ease;\n        }\n        \n        .search-input:focus {\n            border-color: #3B82F6;\n            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n        }\n        \n        .search-input::placeholder {\n            color: #94A3B8;\n        }\n        \n        .view-toggle {\n            display: flex;\n            background: rgba(15, 23, 42, 0.8);\n            border-radius: 8px;\n            padding: 0.25rem;\n            gap: 0.25rem;\n        }\n        \n        .view-toggle button {\n            background: none;\n            border: none;\n            color: #94A3B8;\n            padding: 0.5rem 0.75rem;\n            border-radius: 6px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            font-size: 0.875rem;\n        }\n        \n        .view-toggle button.active {\n            background: #3B82F6;\n            color: white;\n        }\n        \n        .student-card {\n            background: rgba(15, 23, 42, 0.9);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 16px;\n            padding: 1.5rem;\n            transition: all 0.3s ease;\n            position: relative;\n            overflow: hidden;\n            cursor: pointer;\n        }\n        \n        .student-card:hover {\n            transform: translateY(-4px);\n            border-color: rgba(59, 130, 246, 0.5);\n            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.2);\n        }\n\n        .student-card:hover::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 3px;\n            background: linear-gradient(90deg, #3B82F6, #10B981);\n            border-radius: 16px 16px 0 0;\n        }\n\n        .student-card:active {\n            transform: translateY(-2px) scale(0.98);\n            border-color: rgba(16, 185, 129, 0.8);\n            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.3);\n        }\n\n        .student-card:hover .click-hint {\n            opacity: 1;\n        }\n\n        /* Table row styling */\n        .student-table-row {\n            transition: all 0.3s ease;\n        }\n\n        .student-table-row:hover {\n            background: rgba(59, 130, 246, 0.05) !important;\n            border-left: 3px solid #3B82F6;\n            transform: translateX(2px);\n        }\n\n        .student-table-row:hover .table-click-hint {\n            opacity: 1;\n        }\n\n        .student-table-row:active {\n            background: rgba(16, 185, 129, 0.1) !important;\n            border-left: 3px solid #10B981;\n        }\n        \n        /* Prevent actions cell from triggering row events */\n        .actions-cell {\n            pointer-events: auto;\n        }\n        \n        .actions-cell button {\n            pointer-events: auto;\n        }\n        \n        .student-card-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            margin-bottom: 1rem;\n        }\n        \n        .student-avatar {\n            width: 60px;\n            height: 60px;\n            border-radius: 50%;\n            background: linear-gradient(135deg, #3B82F6, #10B981);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 1.5rem;\n            font-weight: bold;\n            color: white;\n            margin-right: 1rem;\n        }\n        \n        .student-info {\n            flex: 1;\n        }\n        \n        .student-name {\n            font-size: 1.2rem;\n            font-weight: 700;\n            color: #F8FAFC;\n            margin-bottom: 0.25rem;\n        }\n        \n        .student-matricula {\n            font-size: 0.875rem;\n            color: #3B82F6;\n            font-weight: 600;\n            margin-bottom: 0.5rem;\n        }\n        \n        .student-email {\n            font-size: 0.875rem;\n            color: #CBD5E1;\n            margin-bottom: 0.5rem;\n        }\n        \n        .student-status {\n            position: absolute;\n            top: 1rem;\n            right: 1rem;\n        }\n        \n        .student-stats {\n            display: grid;\n            grid-template-columns: 1fr 1fr 1fr;\n            gap: 1rem;\n            margin-top: 1rem;\n            padding-top: 1rem;\n            border-top: 1px solid rgba(255, 255, 255, 0.1);\n        }\n        \n        .student-stat {\n            text-align: center;\n        }\n        \n        .student-stat-value {\n            font-size: 1.1rem;\n            font-weight: 700;\n            color: #10B981;\n            display: block;\n        }\n        \n        .student-stat-label {\n            font-size: 0.75rem;\n            color: #94A3B8;\n            margin-top: 0.25rem;\n        }\n        \n        .student-actions {\n            margin-top: 1rem;\n            display: flex;\n            gap: 0.5rem;\n        }\n        \n        .btn-student {\n            flex: 1;\n            padding: 0.5rem 1rem;\n            border: none;\n            border-radius: 8px;\n            font-size: 0.875rem;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }\n        \n        .btn-student-primary {\n            background: linear-gradient(135deg, #3B82F6, #10B981);\n            color: white;\n        }\n        \n        .btn-student-primary:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n        }\n        \n        .btn-student-secondary {\n            background: rgba(255, 255, 255, 0.1);\n            color: #CBD5E1;\n            border: 1px solid rgba(255, 255, 255, 0.2);\n        }\n        \n        .btn-student-secondary:hover {\n            background: rgba(255, 255, 255, 0.2);\n            color: white;\n        }\n        \n        .loading-state, .empty-state {\n            grid-column: 1 / -1;\n        }\n\n        @media (max-width: 768px) {\n            body { flex-direction: column; }\n            .sidebar { width: 100%; height: auto; }\n            .main-content { padding: 1rem; }\n            .stats-grid { grid-template-columns: 1fr; }\n            \n            .large-modal {\n                max-width: 95vw;\n                margin: 1rem;\n            }\n            \n            .form-row {\n                grid-template-columns: 1fr;\n            }\n            \n            .modal-footer {\n                flex-direction: column-reverse;\n            }\n            \n            .students-grid {\n                grid-template-columns: 1fr;\n            }\n            \n            .student-stats {\n                grid-template-columns: 1fr;\n                gap: 0.5rem;\n            }\n        }\n        \n        /* ========================================\n           STUDENT TABLE EVENT HANDLING STYLES\n           ======================================== */\n        \n        /* Ensure action buttons are always clickable */\n        .actions-cell {\n            pointer-events: auto !important;\n            position: relative;\n            z-index: 10;\n        }\n        \n        .actions-cell .action-btn {\n            pointer-events: auto !important;\n            cursor: pointer !important;\n            z-index: 15;\n            position: relative;\n        }\n        \n        /* Student table row styling */\n        .student-table-row {\n            cursor: pointer;\n            transition: background-color 0.2s ease;\n        }\n        \n        .student-table-row:hover {\n            background-color: rgba(59, 130, 246, 0.05) !important;\n        }\n        \n        .student-table-row.row-selected {\n            background-color: rgba(16, 185, 129, 0.1) !important;\n        }\n        \n        /* Action button styling */\n        .action-btn {\n            background: rgba(59, 130, 246, 0.1);\n            border: 1px solid #3B82F6;\n            color: #3B82F6;\n            padding: 0.25rem 0.5rem;\n            border-radius: 4px;\n            font-size: 0.75rem;\n            margin: 0 0.25rem;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            pointer-events: auto;\n        }\n        \n        .action-btn:hover {\n            background: #3B82F6;\n            color: white;\n            transform: translateY(-1px);\n        }\n        \n        .action-btn.checkin {\n            border-color: #10B981;\n            color: #10B981;\n            background: rgba(16, 185, 129, 0.1);\n        }\n        \n        .action-btn.checkin:hover {\n            background: #10B981;\n            color: white;\n        }\n        \n        .action-btn.edit {\n            border-color: #F59E0B;\n            color: #F59E0B;\n            background: rgba(245, 158, 11, 0.1);\n        }\n        \n        .action-btn.edit:hover {\n            background: #F59E0B;\n            color: white;\n        }\n        \n        /* Prevent text selection on table rows */\n        .student-table-row {\n            user-select: none;\n            -webkit-user-select: none;\n            -moz-user-select: none;\n            -ms-user-select: none;\n        }\n        \n        /* Ensure proper event propagation */\n        .student-table-row * {\n            pointer-events: auto;\n        }\n        \n        .table-click-hint {\n            pointer-events: none !important;\n        }\n        \n        /* Plan Modal Tabs CSS */\n        .plan-tabs {\n            display: flex;\n            background: rgba(30, 41, 59, 0.6);\n            border-radius: 12px 12px 0 0;\n            padding: 0.5rem;\n            margin-bottom: 2rem;\n            border-bottom: 1px solid rgba(148, 163, 184, 0.2);\n        }\n        \n        .plan-tab {\n            flex: 1;\n            background: transparent;\n            border: none;\n            color: #94A3B8;\n            padding: 1rem 1.5rem;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            font-weight: 500;\n            text-align: center;\n            position: relative;\n        }\n        \n        .plan-tab:hover {\n            background: rgba(59, 130, 246, 0.1);\n            color: #E2E8F0;\n        }\n        \n        .plan-tab.active {\n            background: linear-gradient(135deg, #3B82F6, #1D4ED8);\n            color: white;\n            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n        }\n        \n        .plan-tab-content {\n            display: none;\n            animation: fadeIn 0.3s ease;\n        }\n        \n        .plan-tab-content.active {\n            display: block;\n        }\n        \n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(10px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n        \n        .tab-header {\n            text-align: center;\n            margin-bottom: 2rem;\n            padding-bottom: 1rem;\n            border-bottom: 1px solid rgba(148, 163, 184, 0.2);\n        }\n        \n        .tab-header h3 {\n            color: #3B82F6;\n            margin-bottom: 0.5rem;\n            font-size: 1.5rem;\n        }\n        \n        .tab-header p {\n            color: #94A3B8;\n            margin: 0;\n        }\n        \n        .form-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 1.5rem;\n            margin-bottom: 2rem;\n        }\n        \n        .form-group.full-width {\n            grid-column: 1 / -1;\n        }\n        \n        .form-hint {\n            color: #94A3B8;\n            font-size: 0.875rem;\n            margin-top: 0.5rem;\n            display: block;\n        }\n        \n        .tab-navigation {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-top: 2rem;\n            padding-top: 2rem;\n            border-top: 1px solid rgba(148, 163, 184, 0.2);\n        }\n        \n        .tab-navigation .btn {\n            min-width: 200px;\n        }\n        \n        /* Courses Selection Styles */\n        .courses-selection-container {\n            background: rgba(30, 41, 59, 0.4);\n            border-radius: 12px;\n            padding: 1.5rem;\n            margin-bottom: 2rem;\n        }\n        \n        .selection-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 1.5rem;\n            padding-bottom: 1rem;\n            border-bottom: 1px solid rgba(148, 163, 184, 0.2);\n        }\n        \n        .selection-stats {\n            display: flex;\n            gap: 1rem;\n        }\n        \n        .stat-badge {\n            background: rgba(59, 130, 246, 0.2);\n            color: #3B82F6;\n            padding: 0.5rem 1rem;\n            border-radius: 20px;\n            font-size: 0.875rem;\n            font-weight: 600;\n        }\n        \n        .selection-actions {\n            display: flex;\n            gap: 0.5rem;\n        }\n        \n        .btn-sm {\n            padding: 0.5rem 1rem;\n            font-size: 0.875rem;\n        }\n        \n        .btn-outline {\n            background: transparent;\n            border: 1px solid #3B82F6;\n            color: #3B82F6;\n        }\n        \n        .btn-outline:hover {\n            background: #3B82F6;\n            color: white;\n        }\n        \n        .courses-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n            gap: 1rem;\n        }\n        \n        .course-card {\n            background: rgba(51, 65, 85, 0.6);\n            border: 2px solid rgba(148, 163, 184, 0.2);\n            border-radius: 12px;\n            padding: 1.5rem;\n            cursor: pointer;\n            transition: all 0.3s ease;\n        }\n        \n        .course-card:hover {\n            border-color: #3B82F6;\n            background: rgba(59, 130, 246, 0.1);\n        }\n        \n        .course-card.selected {\n            border-color: #10B981;\n            background: rgba(16, 185, 129, 0.1);\n        }\n        \n        .course-card-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            margin-bottom: 1rem;\n        }\n        \n        .course-checkbox {\n            width: 20px;\n            height: 20px;\n            margin: 0;\n        }\n        \n        .extras-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 1rem;\n            margin-top: 1rem;\n        }\n        \n        .checkbox-label {\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n            color: #E2E8F0;\n            cursor: pointer;\n            padding: 0.5rem;\n            border-radius: 8px;\n            transition: background 0.2s ease;\n        }\n        \n        .checkbox-label:hover {\n            background: rgba(59, 130, 246, 0.1);\n        }\n        \n        .checkbox-label input[type=\"checkbox\"] {\n            margin: 0;\n        }\n        \n        /* Preview Styles */\n        .preview-container {\n            display: flex;\n            justify-content: center;\n            margin-bottom: 2rem;\n        }\n        \n        .preview-card {\n            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(29, 78, 216, 0.1));\n            border: 2px solid rgba(59, 130, 246, 0.3);\n            border-radius: 16px;\n            padding: 2rem;\n            max-width: 500px;\n            width: 100%;\n        }\n        \n        .preview-header {\n            text-align: center;\n            margin-bottom: 1.5rem;\n        }\n        \n        .preview-header h4 {\n            color: #3B82F6;\n            font-size: 1.5rem;\n            margin-bottom: 0.5rem;\n        }\n        \n        .preview-price {\n            font-size: 2rem;\n            font-weight: bold;\n            color: #10B981;\n        }\n        \n        .preview-body p {\n            color: #CBD5E1;\n            text-align: center;\n            margin-bottom: 1.5rem;\n        }\n        \n        .preview-details {\n            display: grid;\n            gap: 0.75rem;\n        }\n        \n        .detail-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 0.5rem 0;\n            border-bottom: 1px solid rgba(148, 163, 184, 0.2);\n        }\n        \n        .detail-label {\n            color: #94A3B8;\n            font-weight: 500;\n        }\n        \n        .detail-value {\n            color: #E2E8F0;\n            font-weight: 600;\n        }\n        \n        .btn-large {\n            padding: 1rem 2rem;\n            font-size: 1.1rem;\n            font-weight: 600;\n        }\n        \n        .loading-state {\n            text-align: center;\n            color: #94A3B8;\n            padding: 2rem;\n        }\n        \n        .spinner {\n            width: 40px;\n            height: 40px;\n            border: 4px solid rgba(148, 163, 184, 0.2);\n            border-top: 4px solid #3B82F6;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            margin: 0 auto 1rem;\n        }\n        \n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"dashboard-container\" id=\"dashboardContainer\">\n        <!-- Enhanced Header -->\n        <header class=\"dashboard-header\">\n            <div class=\"header-left\">\n                <div class=\"header-title\">\n                    <span>ðŸ¥‹</span>\n                    Krav Academy\n                </div>\n                <div class=\"header-ai-status\">\n                    <span>ðŸ¤–</span>\n                    5 Agentes Ativos\n                </div>\n            </div>\n            <div class=\"header-actions\">\n                <button class=\"quick-action-btn\" onclick=\"toggleSidebar()\">\n                    â˜° Menu\n                </button>\n            </div>\n        </header>\n\n        <!-- Enhanced Sidebar -->\n        <aside class=\"dashboard-sidebar\" id=\"dashboardSidebar\">\n            <div class=\"sidebar-section\">\n                <div class=\"sidebar-title\">GestÃ£o Principal</div>\n                <nav>\n                    <ul class=\"nav-menu\">\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link active\" data-page=\"dashboard\" data-ai-enabled=\"true\">\n                                <span class=\"nav-icon\">ðŸ“Š</span>\n                                Dashboard IA\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"students\" data-ai-enabled=\"true\">\n                                <span class=\"nav-icon\">ðŸ‘¥</span>\n                                Alunos\n                                <span class=\"badge info\" id=\"students-count\">0</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"courses\" data-ai-enabled=\"true\">\n                                <span class=\"nav-icon\">ðŸ“š</span>\n                                Cursos\n                                <span class=\"badge info\" style=\"font-size: 0.6rem;\">MÃ‰TODO</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"classes\" data-ai-enabled=\"true\">\n                                <span class=\"nav-icon\">ðŸ«</span>\n                                Turmas\n                                <span class=\"badge success\" id=\"classes-count\">0</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"quick-checkin\">\n                                <span class=\"nav-icon\">âš¡</span>\n                                Check-in RÃ¡pido\n                                <span class=\"badge warning\">NOVO</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"attendance\">\n                                <span class=\"nav-icon\">ðŸ“‹</span>\n                                FrequÃªncia\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"evaluations\" data-ai-enabled=\"true\">\n                                <span class=\"nav-icon\">ðŸ“</span>\n                                AvaliaÃ§Ãµes\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"progress\">\n                                <span class=\"nav-icon\">ðŸ“ˆ</span>\n                                Progresso\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"financial\" data-ai-enabled=\"false\">\n                                <span class=\"nav-icon\">ðŸ’°</span>\n                                GestÃ£o Financeira\n                                <span class=\"badge info\" id=\"financial-count\">0</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"financial-responsibles\" data-ai-enabled=\"false\">\n                                <span class=\"nav-icon\">ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦</span>\n                                ResponsÃ¡veis\n                                <span class=\"badge info\" id=\"responsibles-count\">0</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"payment-plans\" data-ai-enabled=\"false\">\n                                <span class=\"nav-icon\">ðŸ“„</span>\n                                Planos da Academia\n                                <span class=\"badge info\" id=\"plans-count\">0</span>\n                            </button>\n                        </li>\n                    </ul>\n                </nav>\n            </div>\n\n            <div class=\"sidebar-section\">\n                <div class=\"sidebar-title\">Infraestrutura</div>\n                <nav>\n                    <ul class=\"nav-menu\">\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"units\" data-ai-enabled=\"false\">\n                                <span class=\"nav-icon\">ðŸ¢</span>\n                                Unidades\n                                <span class=\"badge info\" id=\"units-count\">0</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"mats\" data-ai-enabled=\"false\">\n                                <span class=\"nav-icon\">ðŸ¥‹</span>\n                                Tatames\n                                <span class=\"badge info\" id=\"mats-count\">0</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"instructors\" data-ai-enabled=\"false\">\n                                <span class=\"nav-icon\">ðŸ‘¨â€ðŸ«</span>\n                                Professores\n                                <span class=\"badge info\" id=\"instructors-count\">0</span>\n                            </button>\n                        </li>\n                    </ul>\n                </nav>\n            </div>\n\n            <div class=\"sidebar-section\">\n                <div class=\"sidebar-title\">Agentes IA</div>\n                <nav>\n                    <ul class=\"nav-menu\">\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"course-creator\" data-ai-enabled=\"true\">\n                                <span class=\"nav-icon\">ðŸŽ“</span>\n                                Course Creator\n                                <span class=\"badge ai-powered\">AI</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"lesson-planner\" data-ai-enabled=\"true\">\n                                <span class=\"nav-icon\">ðŸ“‹</span>\n                                Lesson Planner\n                                <span class=\"badge ai-powered\">AI</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"technique-auditor\" data-ai-enabled=\"true\">\n                                <span class=\"nav-icon\">ðŸ”</span>\n                                Tech Auditor\n                                <span class=\"badge ai-powered\">AI</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"knowledge-base\" data-ai-enabled=\"true\">\n                                <span class=\"nav-icon\">ðŸ§ </span>\n                                Base RAG\n                                <span class=\"badge success\">RAG</span>\n                            </button>\n                        </li>\n                    </ul>\n                </nav>\n            </div>\n\n            <div class=\"sidebar-section\">\n                <div class=\"sidebar-title\">Ferramentas</div>\n                <nav>\n                    <ul class=\"nav-menu\">\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"student-portal\">\n                                <span class=\"nav-icon\">ðŸŽ¯</span>\n                                Portal do Aluno\n                                <span class=\"badge warning\">NOVO</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"public-checkin\">\n                                <span class=\"nav-icon\">ðŸ“Ÿ</span>\n                                Check-in Kiosk\n                                <span class=\"badge warning\">KIOSK</span>\n                            </button>\n                        </li>\n                        <li class=\"nav-item\">\n                            <button class=\"nav-link\" data-page=\"settings\">\n                                <span class=\"nav-icon\">âš™ï¸</span>\n                                ConfiguraÃ§Ãµes\n                            </button>\n                        </li>\n                    </ul>\n                </nav>\n            </div>\n        </aside>\n\n        <!-- Enhanced Main Content -->\n        <main class=\"dashboard-main\" id=\"dashboardMain\">\n            <!-- Dynamic Main Header -->\n            <div class=\"main-header\">\n                <div>\n                    <h1 class=\"main-title\" id=\"mainTitle\">Dashboard</h1>\n                    <p class=\"main-subtitle\" id=\"mainSubtitle\">Sistema de gestÃ£o da academia</p>\n                </div>\n            </div>\n\n            <!-- Content Sections Container -->\n            <div id=\"contentContainer\">\n                <!-- Dashboard -->\n                <div id=\"dashboard\" class=\"content-section active\">\n                    <!-- Enhanced Metrics Grid -->\n                    <div class=\"metric-grid\">\n                        <div class=\"metric-card\">\n                            <div class=\"metric-value\" id=\"total-students\">4</div>\n                            <div class=\"metric-label\">Total de Alunos</div>\n                            <div class=\"metric-trend positive\">\n                                <span>â†—</span> +2 este mÃªs\n                            </div>\n                        </div>\n                        <div class=\"metric-card\">\n                            <div class=\"metric-value\" id=\"active-students\">4</div>\n                            <div class=\"metric-label\">Alunos Ativos</div>\n                            <div class=\"metric-trend positive\">\n                                <span>â†—</span> 100% taxa\n                            </div>\n                        </div>\n                        <div class=\"metric-card\">\n                            <div class=\"metric-value\" id=\"attendance-rate\">85%</div>\n                            <div class=\"metric-label\">Taxa de FrequÃªncia</div>\n                            <div class=\"metric-trend positive\">\n                                <span>â†—</span> +5% vs mÃªs anterior\n                            </div>\n                        </div>\n                        <div class=\"metric-card\">\n                            <div class=\"metric-value\" id=\"current-lesson\">15/48</div>\n                            <div class=\"metric-label\">Progresso do Curso</div>\n                            <div class=\"metric-trend positive\">\n                                <span>â†—</span> 31% completo\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Activity Cards -->\n                    <div class=\"smart-card\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;\">\n                            <span>ðŸ“Š</span> Atividades Recentes\n                        </h3>\n                        <div style=\"color: #CBD5E1; line-height: 1.6;\">\n                            <p style=\"margin: 0.5rem 0;\">ðŸŽ¯ <strong>Aula 15 - Defesas BÃ¡sicas</strong> (Hoje)</p>\n                            <p style=\"margin: 0.5rem 0;\">ðŸ“ <strong>AvaliaÃ§Ã£o Maria Silva</strong> - 85.5% (Ontem)</p>\n                            <p style=\"margin: 0.5rem 0;\">ðŸ‘¤ <strong>Novo aluno: Carlos Rodrigues</strong> (2 dias atrÃ¡s)</p>\n                            <p style=\"margin: 0.5rem 0;\">ðŸ¥‹ <strong>TÃ©cnica dominada: Ana Oliveira</strong> - 5 tÃ©cnicas (3 dias atrÃ¡s)</p>\n                        </div>\n                    </div>\n                </div>\n        \n        <!-- Students -->\n        <div id=\"students\" class=\"content-section\">\n            <div class=\"page-header\">\n                <h1>ðŸ‘¥ GestÃ£o de Alunos</h1>\n                <p>Cadastro e acompanhamento completo dos alunos</p>\n            </div>\n\n            <!-- Quick Stats -->\n            <div class=\"stats-grid\" style=\"margin-bottom: 2rem;\">\n                <div class=\"stat-card\">\n                    <div class=\"stat-value\" id=\"totalStudents\">0</div>\n                    <div class=\"stat-label\">Total de Alunos</div>\n                </div>\n                <div class=\"stat-card\">\n                    <div class=\"stat-value\" id=\"activeStudents\">0</div>\n                    <div class=\"stat-label\">Ativos</div>\n                </div>\n                <div class=\"stat-card\">\n                    <div class=\"stat-value\" id=\"avgAttendance\">0%</div>\n                    <div class=\"stat-label\">FrequÃªncia MÃ©dia</div>\n                </div>\n                <div class=\"stat-card\">\n                    <div class=\"stat-value\" id=\"newThisMonth\">0</div>\n                    <div class=\"stat-label\">Novos Este MÃªs</div>\n                </div>\n            </div>\n\n            <!-- Simple Search Bar -->\n            <div class=\"simple-search\">\n                <input type=\"text\" \n                       id=\"studentSearch\" \n                       class=\"search-input\"\n                       placeholder=\"ðŸ” Buscar por nome, CPF, matrÃ­cula ou email...\" \n                       onkeyup=\"filterStudentsSimple()\"\n                       autocomplete=\"off\">\n                \n                <div class=\"view-toggle\">\n                    <button id=\"tableViewBtn\" class=\"active\" onclick=\"switchView('table')\">\n                        ðŸ“‹ Tabela\n                    </button>\n                    <button id=\"gridViewBtn\" onclick=\"switchView('grid')\">\n                        ðŸŽ¯ Cards\n                    </button>\n                </div>\n                \n                <button class=\"btn btn-primary\" onclick=\"openAddStudentModal()\">\n                    <span>âž•</span>\n                    Novo Aluno\n                </button>\n            </div>\n            \n            <!-- Students Views Container -->\n            <div id=\"studentsContainer\">\n                <!-- Table View for Easy Check-in -->\n                <div id=\"studentsTableView\" class=\"students-table-container\">\n                    <table class=\"students-table\">\n                        <thead>\n                            <tr>\n                                <th>MatrÃ­cula</th>\n                                <th>Nome</th>\n                                <th>CPF</th>\n                                <th>Categoria</th>\n                                <th>ResponsÃ¡vel Financeiro</th>\n                                <th>Status</th>\n                                <th>AÃ§Ãµes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"studentsTableBody\">\n                            <!-- Students will be loaded here -->\n                        </tbody>\n                    </table>\n                </div>\n\n                <!-- Grid View (Cards) -->\n                <div id=\"studentsGrid\" class=\"students-grid\" style=\"display: none;\">\n                    <!-- Students cards will be loaded here -->\n                </div>\n                <div id=\"studentsLoadingState\" class=\"loading-state\">\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“‹</div>\n                        <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Carregando alunos...</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7;\">Conectando com a base de dados</div>\n                    </div>\n                </div>\n                <div id=\"studentsEmptyState\" class=\"empty-state\" style=\"display: none;\">\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                        <div style=\"font-size: 3rem; margin-bottom: 1rem;\">ðŸŽ¯</div>\n                        <div style=\"font-size: 1.2rem; margin-bottom: 0.5rem;\">Nenhum aluno encontrado</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;\">Comece adicionando o primeiro aluno Ã  academia</div>\n                        <button class=\"btn btn-primary\" onclick=\"openAddStudentModal()\">\n                            <span>âž•</span>\n                            Adicionar Primeiro Aluno\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Student Details Modal -->\n        <div id=\"studentDetailsModal\" class=\"modal\" style=\"display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8);\">\n            <div class=\"modal-content\" style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); margin: 2% auto; padding: 0; border-radius: 16px; width: 95%; max-width: 1200px; max-height: 90vh; overflow-y: auto; border: 1px solid #334155;\">\n                <!-- Modal Header -->\n                <div style=\"background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%); padding: 1.5rem 2rem; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center;\">\n                    <div>\n                        <h2 style=\"margin: 0; color: white; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;\">\n                            <span>ðŸ‘¤</span>\n                            <span id=\"modalStudentName\">Detalhes do Aluno</span>\n                        </h2>\n                        <p style=\"margin: 0.5rem 0 0 0; color: rgba(255,255,255,0.8); font-size: 0.875rem;\" id=\"modalStudentId\">ID: -</p>\n                    </div>\n                    <button onclick=\"closeStudentModal()\" style=\"background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 1.5rem; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;\">\n                        âœ•\n                    </button>\n                </div>\n\n                <!-- Student Info Summary -->\n                <div style=\"padding: 1.5rem 2rem; background: rgba(59, 130, 246, 0.05); border-bottom: 1px solid #334155;\">\n                    <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;\">\n                        <div style=\"text-align: center;\">\n                            <div style=\"color: #3B82F6; font-size: 1.25rem; font-weight: bold;\" id=\"modalStudentStatus\">Ativo</div>\n                            <div style=\"color: #94A3B8; font-size: 0.875rem;\">Status</div>\n                        </div>\n                        <div style=\"text-align: center;\">\n                            <div style=\"color: #10B981; font-size: 1.25rem; font-weight: bold;\" id=\"modalStudentCategory\">ADULTO</div>\n                            <div style=\"color: #94A3B8; font-size: 0.875rem;\">Categoria</div>\n                        </div>\n                        <div style=\"text-align: center;\">\n                            <div style=\"color: #F59E0B; font-size: 1.25rem; font-weight: bold;\" id=\"modalStudentClasses\">2</div>\n                            <div style=\"color: #94A3B8; font-size: 0.875rem;\">Turmas</div>\n                        </div>\n                        <div style=\"text-align: center;\">\n                            <div style=\"color: #8B5CF6; font-size: 1.25rem; font-weight: bold;\" id=\"modalStudentAttendance\">85%</div>\n                            <div style=\"color: #94A3B8; font-size: 0.875rem;\">FrequÃªncia</div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Tabs Navigation -->\n                <div style=\"padding: 0 2rem; background: #1E293B; border-bottom: 1px solid #334155;\">\n                    <div style=\"display: flex; gap: 0.5rem;\">\n                        <button class=\"student-tab-btn active\" onclick=\"switchStudentTab('basic')\" data-tab=\"basic\" style=\"padding: 1rem 1.5rem; background: transparent; border: none; color: #3B82F6; border-bottom: 2px solid #3B82F6; font-weight: 600; cursor: pointer;\">\n                            ðŸ“‹ Dados BÃ¡sicos\n                        </button>\n                        <button class=\"student-tab-btn\" onclick=\"switchStudentTab('courses')\" data-tab=\"courses\" style=\"padding: 1rem 1.5rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 600; cursor: pointer;\">\n                            ðŸ“š Cursos\n                        </button>\n                        <button class=\"student-tab-btn\" onclick=\"switchStudentTab('classes')\" data-tab=\"classes\" style=\"padding: 1rem 1.5rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 600; cursor: pointer;\">\n                            ðŸ« Turmas\n                        </button>\n                        <button class=\"student-tab-btn\" onclick=\"switchStudentTab('progress')\" data-tab=\"progress\" style=\"padding: 1rem 1.5rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 600; cursor: pointer;\">\n                            ðŸ“ˆ Progresso\n                        </button>\n                        <button class=\"student-tab-btn\" onclick=\"switchStudentTab('financial')\" data-tab=\"financial\" style=\"padding: 1rem 1.5rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 600; cursor: pointer;\">\n                            ðŸ’° Financeiro\n                        </button>\n                        <button class=\"student-tab-btn\" onclick=\"switchStudentTab('attendance')\" data-tab=\"attendance\" style=\"padding: 1rem 1.5rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 600; cursor: pointer;\">\n                            ðŸ“Š FrequÃªncia\n                        </button>\n                        <button class=\"student-tab-btn\" onclick=\"switchStudentTab('history')\" data-tab=\"history\" style=\"padding: 1rem 1.5rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 600; cursor: pointer;\">\n                            ðŸ“œ HistÃ³rico\n                        </button>\n                    </div>\n                </div>\n\n                <!-- Tab Contents -->\n                <div style=\"padding: 2rem;\">\n                    <!-- Basic Data Tab -->\n                    <div id=\"student-tab-basic\" class=\"student-tab-content\">\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;\">\n                            <!-- Personal Information -->\n                            <div style=\"background: rgba(59, 130, 246, 0.05); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                                <h3 style=\"color: #3B82F6; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸ‘¤</span> InformaÃ§Ãµes Pessoais\n                                </h3>\n                                <div style=\"display: grid; gap: 0.75rem; color: #CBD5E1;\">\n                                    <div><strong>Nome Completo:</strong> <span id=\"modalFullName\">-</span></div>\n                                    <div><strong>CPF:</strong> <span id=\"modalCpf\">-</span></div>\n                                    <div><strong>Data de Nascimento:</strong> <span id=\"modalBirthDate\">-</span></div>\n                                    <div><strong>Idade:</strong> <span id=\"modalAge\">-</span></div>\n                                    <div><strong>GÃªnero:</strong> <span id=\"modalGender\">-</span></div>\n                                    <div><strong>Email:</strong> <span id=\"modalEmail\">-</span></div>\n                                    <div><strong>Telefone:</strong> <span id=\"modalPhone\">-</span></div>\n                                </div>\n                            </div>\n\n                            <!-- Address Information -->\n                            <div style=\"background: rgba(139, 92, 246, 0.05); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                                <h3 style=\"color: #8B5CF6; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸ“</span> EndereÃ§o\n                                </h3>\n                                <div style=\"display: grid; gap: 0.75rem; color: #CBD5E1;\">\n                                    <div><strong>CEP:</strong> <span id=\"modalPostalCode\">-</span></div>\n                                    <div><strong>EndereÃ§o:</strong> <span id=\"modalAddress\">-</span></div>\n                                    <div><strong>NÃºmero:</strong> <span id=\"modalAddressNumber\">-</span></div>\n                                    <div><strong>Bairro:</strong> <span id=\"modalNeighborhood\">-</span></div>\n                                    <div><strong>Cidade:</strong> <span id=\"modalCity\">-</span></div>\n                                    <div><strong>Estado:</strong> <span id=\"modalState\">-</span></div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Additional Information -->\n                        <div style=\"margin-top: 2rem; display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;\">\n                            <!-- Academic Information -->\n                            <div style=\"background: rgba(16, 185, 129, 0.05); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(16, 185, 129, 0.2);\">\n                                <h3 style=\"color: #10B981; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸŽ“</span> InformaÃ§Ãµes AcadÃªmicas\n                                </h3>\n                                <div style=\"display: grid; gap: 0.75rem; color: #CBD5E1;\">\n                                    <div><strong>MatrÃ­cula:</strong> <span id=\"modalRegistration\">-</span></div>\n                                    <div><strong>Data de MatrÃ­cula:</strong> <span id=\"modalEnrollmentDate\">-</span></div>\n                                    <div><strong>Categoria:</strong> <span id=\"modalStudentCategoryDetails\">-</span></div>\n                                    <div><strong>Status:</strong> <span id=\"modalStatusDetails\">-</span></div>\n                                    <div><strong>Necessidades Especiais:</strong> <span id=\"modalSpecialNeeds\">Nenhuma</span></div>\n                                </div>\n                            </div>\n\n                            <!-- Emergency Contact -->\n                            <div style=\"background: rgba(239, 68, 68, 0.05); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(239, 68, 68, 0.2);\">\n                                <h3 style=\"color: #EF4444; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸš¨</span> Contato de EmergÃªncia\n                                </h3>\n                                <div style=\"display: grid; gap: 0.75rem; color: #CBD5E1;\">\n                                    <div><strong>Nome:</strong> <span id=\"modalEmergencyName\">-</span></div>\n                                    <div><strong>Telefone:</strong> <span id=\"modalEmergencyPhone\">-</span></div>\n                                    <div><strong>Relacionamento:</strong> <span id=\"modalEmergencyRelation\">-</span></div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Other tabs content will be loaded dynamically -->\n                    <div id=\"student-tab-courses\" class=\"student-tab-content\" style=\"display: none;\">\n                        <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“š</div>\n                            <p>Carregando informaÃ§Ãµes de cursos...</p>\n                        </div>\n                    </div>\n\n                    <div id=\"student-tab-classes\" class=\"student-tab-content\" style=\"display: none;\">\n                        <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ«</div>\n                            <p>Carregando informaÃ§Ãµes de turmas...</p>\n                        </div>\n                    </div>\n\n                    <div id=\"student-tab-progress\" class=\"student-tab-content\" style=\"display: none;\">\n                        <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“ˆ</div>\n                            <p>Carregando progresso do aluno...</p>\n                        </div>\n                    </div>\n\n                    <div id=\"student-tab-financial\" class=\"student-tab-content\" style=\"display: none;\">\n                        <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ’°</div>\n                            <p>Carregando informaÃ§Ãµes financeiras...</p>\n                        </div>\n                    </div>\n\n                    <div id=\"student-tab-attendance\" class=\"student-tab-content\" style=\"display: none;\">\n                        <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“Š</div>\n                            <p>Carregando histÃ³rico de frequÃªncia...</p>\n                        </div>\n                    </div>\n\n                    <div id=\"student-tab-history\" class=\"student-tab-content\" style=\"display: none;\">\n                        <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“œ</div>\n                            <p>Carregando histÃ³rico do aluno...</p>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Modal Footer -->\n                <div style=\"padding: 1.5rem 2rem; background: #1E293B; border-radius: 0 0 16px 16px; border-top: 1px solid #334155; display: flex; justify-content: space-between; align-items: center;\">\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button class=\"btn btn-secondary\" onclick=\"editStudentInfo()\" style=\"padding: 0.75rem 1.5rem;\">\n                            <span>âœï¸</span> Editar\n                        </button>\n                        <button class=\"btn btn-success\" onclick=\"addStudentToClass()\" style=\"padding: 0.75rem 1.5rem;\">\n                            <span>âž•</span> Adicionar Ã  Turma\n                        </button>\n                    </div>\n                    <button class=\"btn btn-primary\" onclick=\"closeStudentModal()\" style=\"padding: 0.75rem 1.5rem;\">\n                        <span>âœ…</span> Fechar\n                    </button>\n                </div>\n            </div>\n        </div>\n\n        <!-- Student Edit Page (Dedicated) -->\n        <div id=\"student-edit-page\" class=\"content-section\" style=\"display: none;\">\n            <!-- Page Header -->\n            <div style=\"background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 16px; padding: 1.5rem 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                    <div style=\"display: flex; align-items: center; gap: 1rem;\">\n                        <button onclick=\"backToStudentsList()\" style=\"background: rgba(148, 163, 184, 0.1); border: 1px solid #94A3B8; color: #94A3B8; padding: 0.5rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 1.2rem;\">\n                            â†\n                        </button>\n                        <div style=\"display: flex; align-items: center; gap: 1rem;\">\n                            <div style=\"width: 50px; height: 50px; background: linear-gradient(135deg, #3B82F6, #1D4ED8); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;\">\n                                ðŸ‘¤\n                            </div>\n                            <div>\n                                <h2 style=\"color: #F8FAFC; margin: 0; font-size: 1.5rem;\" id=\"editPageStudentName\">Editando Aluno</h2>\n                                <div style=\"color: #94A3B8; font-size: 0.875rem; margin-top: 0.25rem;\">\n                                    <span id=\"editPageStudentId\">ID: -</span> â€¢ \n                                    <span id=\"editPageStudentCategory\">Categoria: -</span> â€¢ \n                                    <span style=\"color: #10B981;\">âœ… Dados sincronizados</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button onclick=\"cancelStudentEdit()\" style=\"background: rgba(239, 68, 68, 0.1); border: 1px solid #EF4444; color: #EF4444; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;\">\n                            âŒ Cancelar\n                        </button>\n                        <button onclick=\"saveStudentPage()\" style=\"background: linear-gradient(135deg, #10B981, #059669); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;\">\n                            ðŸ’¾ Salvar AlteraÃ§Ãµes\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Page Tabs -->\n            <div style=\"background: #1E293B; border-radius: 12px; margin-bottom: 2rem; border: 1px solid #334155;\">\n                <div style=\"display: flex; padding: 0.5rem; flex-wrap: wrap; gap: 0.5rem;\">\n                    <button class=\"page-tab-btn active\" onclick=\"switchPageTab('edit')\" data-page-tab=\"edit\" \n                            style=\"flex: 1; min-width: 140px; padding: 0.875rem; background: linear-gradient(135deg, #3B82F6, #1D4ED8); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.875rem;\">\n                        âœï¸ Editar Dados\n                    </button>\n                    <button class=\"page-tab-btn\" onclick=\"switchPageTab('ai-dashboard')\" data-page-tab=\"ai-dashboard\" \n                            style=\"flex: 1; min-width: 140px; padding: 0.875rem; background: transparent; color: #94A3B8; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; font-size: 0.875rem;\">\n                        ðŸ¤– Dashboard IA\n                    </button>\n                    <button class=\"page-tab-btn\" onclick=\"switchPageTab('plans')\" data-page-tab=\"plans\" \n                            style=\"flex: 1; min-width: 140px; padding: 0.875rem; background: transparent; color: #94A3B8; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; font-size: 0.875rem;\">\n                        ðŸ’³ Planos\n                    </button>\n                    <button class=\"page-tab-btn\" onclick=\"switchPageTab('classes')\" data-page-tab=\"classes\" \n                            style=\"flex: 1; min-width: 140px; padding: 0.875rem; background: transparent; color: #94A3B8; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; font-size: 0.875rem;\">\n                        ðŸ• Turmas\n                    </button>\n                    <button class=\"page-tab-btn\" onclick=\"switchPageTab('courses')\" data-page-tab=\"courses\" \n                            style=\"flex: 1; min-width: 140px; padding: 0.875rem; background: transparent; color: #94A3B8; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; font-size: 0.875rem;\">\n                        ðŸ“š Cursos\n                    </button>\n                    <button class=\"page-tab-btn\" onclick=\"switchPageTab('progress')\" data-page-tab=\"progress\" \n                            style=\"flex: 1; min-width: 140px; padding: 0.875rem; background: transparent; color: #94A3B8; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; font-size: 0.875rem;\">\n                        ðŸ“Š Progresso\n                    </button>\n                </div>\n            </div>\n\n            <!-- Main Content Area -->\n            <div style=\"display: grid; grid-template-columns: 300px 1fr; gap: 2rem;\">\n                <!-- Sidebar -->\n                <div id=\"editPageSidebar\" style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; height: fit-content; position: sticky; top: 2rem;\">\n                    <!-- Quick Stats -->\n                    <div style=\"margin-bottom: 2rem;\">\n                        <h4 style=\"color: #F8FAFC; margin: 0 0 1rem 0; font-size: 1rem;\">ðŸ“Š EstatÃ­sticas</h4>\n                        <div style=\"display: grid; gap: 1rem;\">\n                            <div style=\"background: rgba(139, 92, 246, 0.1); border-radius: 8px; padding: 1rem; text-align: center; border: 1px solid rgba(139, 92, 246, 0.3);\">\n                                <div style=\"color: #8B5CF6; font-size: 1.25rem; font-weight: bold;\" id=\"sidebarXP\">1,250</div>\n                                <div style=\"color: #CBD5E1; font-size: 0.75rem;\">XP Total</div>\n                            </div>\n                            <div style=\"background: rgba(16, 185, 129, 0.1); border-radius: 8px; padding: 1rem; text-align: center; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                                <div style=\"color: #10B981; font-size: 1.25rem; font-weight: bold;\" id=\"sidebarLevel\">Nv. 5</div>\n                                <div style=\"color: #CBD5E1; font-size: 0.75rem;\">GraduaÃ§Ã£o</div>\n                            </div>\n                            <div style=\"background: rgba(245, 158, 11, 0.1); border-radius: 8px; padding: 1rem; text-align: center; border: 1px solid rgba(245, 158, 11, 0.3);\">\n                                <div style=\"color: #F59E0B; font-size: 1.25rem; font-weight: bold;\" id=\"sidebarStreak\">7 dias</div>\n                                <div style=\"color: #CBD5E1; font-size: 0.75rem;\">SequÃªncia</div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Financial Status -->\n                    <div style=\"margin-bottom: 2rem;\">\n                        <h4 style=\"color: #F8FAFC; margin: 0 0 1rem 0; font-size: 1rem;\">ðŸ’° Financeiro</h4>\n                        <div id=\"sidebarFinancialStatus\" style=\"background: rgba(245, 158, 11, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(245, 158, 11, 0.3);\">\n                            <div style=\"color: #F59E0B; font-weight: bold; margin-bottom: 0.5rem;\">â³ Carregando...</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">Verificando status</div>\n                        </div>\n                    </div>\n\n                    <!-- Quick Actions -->\n                    <div>\n                        <h4 style=\"color: #F8FAFC; margin: 0 0 1rem 0; font-size: 1rem;\">âš¡ AÃ§Ãµes RÃ¡pidas</h4>\n                        <div style=\"display: grid; gap: 0.5rem;\">\n                            <button onclick=\"quickCheckinFromEdit()\" style=\"background: rgba(16, 185, 129, 0.1); border: 1px solid #10B981; color: #10B981; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-size: 0.875rem; width: 100%;\">\n                                âœ… Check-in RÃ¡pido\n                            </button>\n                            <button onclick=\"viewStudentProgress()\" style=\"background: rgba(139, 92, 246, 0.1); border: 1px solid #8B5CF6; color: #8B5CF6; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-size: 0.875rem; width: 100%;\">\n                                ðŸ“ˆ Ver Progresso\n                            </button>\n                            <button onclick=\"managePayments()\" style=\"background: rgba(245, 158, 11, 0.1); border: 1px solid #F59E0B; color: #F59E0B; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-size: 0.875rem; width: 100%;\">\n                                ðŸ’³ Pagamentos\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Main Content -->\n                <div id=\"editPageContent\" style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 2rem; border: 1px solid #334155; min-height: 600px;\">\n                    <!-- Edit Tab Content -->\n                    <div id=\"page-tab-edit\" class=\"page-tab-content\">\n                        <div style=\"margin-bottom: 2rem;\">\n                            <div style=\"display: flex; justify-content: between; align-items: center; margin-bottom: 1.5rem;\">\n                                <h3 style=\"color: #F8FAFC; margin: 0;\">âœï¸ FormulÃ¡rio de EdiÃ§Ã£o</h3>\n                                <div style=\"display: flex; gap: 1rem; align-items: center;\">\n                                    <div style=\"background: #1E293B; border-radius: 6px; height: 6px; width: 200px; overflow: hidden;\">\n                                        <div id=\"pageFormProgress\" style=\"background: linear-gradient(90deg, #3B82F6, #10B981); height: 100%; width: 65%; transition: width 0.3s ease;\"></div>\n                                    </div>\n                                    <span style=\"color: #94A3B8; font-size: 0.875rem;\">65% completo</span>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Form sections will be loaded here -->\n                        <div id=\"pageFormContainer\">\n                            <p style=\"color: #94A3B8; text-align: center; padding: 3rem;\">Carregando formulÃ¡rio...</p>\n                        </div>\n                    </div>\n\n                    <!-- Novas abas organizadas -->\n                    <!-- Dashboard IA Tab -->\n                    <div id=\"page-tab-ai-dashboard\" class=\"page-tab-content\" style=\"display: none;\">\n                        <h3 style=\"color: #F8FAFC; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                            ðŸ¤– Dashboard IA - Insights Inteligentes\n                            <div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.7rem; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                                IA ATIVA\n                            </div>\n                        </h3>\n                        <div id=\"aiDashboardContent\">\n                            <p style=\"color: #94A3B8; text-align: center; padding: 2rem;\">ðŸ§  Carregando anÃ¡lise IA do aluno...</p>\n                        </div>\n                    </div>\n\n                    <!-- Planos Tab -->\n                    <div id=\"page-tab-plans\" class=\"page-tab-content\" style=\"display: none;\">\n                        <h3 style=\"color: #F8FAFC; margin: 0 0 1.5rem 0;\">ðŸ’³ Planos de Pagamento</h3>\n                        <div id=\"plansContent\">\n                            <p style=\"color: #94A3B8; text-align: center; padding: 2rem;\">Carregando planos...</p>\n                        </div>\n                    </div>\n\n                    <!-- Classes Tab -->\n                    <div id=\"page-tab-classes\" class=\"page-tab-content\" style=\"display: none;\">\n                        <h3 style=\"color: #F8FAFC; margin: 0 0 1.5rem 0;\">ðŸ• Turmas e HorÃ¡rios</h3>\n                        <div id=\"classesContent\">\n                            <p style=\"color: #94A3B8; text-align: center; padding: 2rem;\">Carregando turmas...</p>\n                        </div>\n                    </div>\n\n                    <!-- Courses Tab -->\n                    <div id=\"page-tab-courses\" class=\"page-tab-content\" style=\"display: none;\">\n                        <h3 style=\"color: #F8FAFC; margin: 0 0 1.5rem 0;\">ðŸ“š Cursos e Progresso AcadÃªmico</h3>\n                        <div id=\"coursesContent\">\n                            <p style=\"color: #94A3B8; text-align: center; padding: 2rem;\">Carregando cursos...</p>\n                        </div>\n                    </div>\n\n                    <!-- Progress Tab -->\n                    <div id=\"page-tab-progress\" class=\"page-tab-content\" style=\"display: none;\">\n                        <h3 style=\"color: #F8FAFC; margin: 0 0 1.5rem 0;\">ðŸ“Š Progresso Detalhado</h3>\n                        <div id=\"progressContent\">\n                            <p style=\"color: #94A3B8; text-align: center; padding: 2rem;\">Carregando dados de progresso...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Quick Check-in Section -->\n        <div id=\"quick-checkin\" class=\"content-section\">\n            <!-- Simple Metrics -->\n            <div class=\"metric-grid\">\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\" id=\"total-students-checkin\">4</div>\n                    <div class=\"metric-label\">Total de Alunos</div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\" id=\"active-students-checkin\">4</div>\n                    <div class=\"metric-label\">Alunos Ativos</div>\n                </div>\n            </div>\n\n            <!-- Super Simple Search -->\n            <div class=\"simple-search\">\n                <input type=\"text\" \n                       id=\"checkinSearch\" \n                       class=\"search-input\"\n                       placeholder=\"ðŸ” Digite matrÃ­cula, nome ou CPF para check-in rÃ¡pido...\" \n                       onkeyup=\"searchForCheckin()\"\n                       onkeypress=\"handleCheckinEnter(event)\"\n                       autocomplete=\"off\"\n                       autofocus>\n                \n                <button class=\"btn btn-primary\" onclick=\"clearCheckinSearch()\">\n                    ðŸ§¹ Limpar\n                </button>\n            </div>\n\n            <!-- Quick Check-in Table -->\n            <div class=\"students-table-container\">\n                <div style=\"margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;\">\n                    <h3 style=\"color: #F8FAFC; margin: 0;\">âš¡ Check-in RÃ¡pido</h3>\n                    <div style=\"color: #94A3B8; font-size: 0.875rem;\">\n                        <span id=\"checkinResultsCount\">0</span> resultado(s)\n                    </div>\n                </div>\n                \n                <table class=\"students-table\">\n                    <thead>\n                        <tr>\n                            <th>MatrÃ­cula</th>\n                            <th>Nome</th>\n                            <th>CPF</th>\n                            <th>AÃ§Ã£o</th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"checkinTableBody\">\n                        <tr>\n                            <td colspan=\"4\" style=\"text-align: center; color: #94A3B8; padding: 2rem;\">\n                                Digite acima para buscar alunos e fazer check-in\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n\n        <!-- Student Edit/View Modal -->\n        <div id=\"studentModal\" class=\"modal\">\n            <div class=\"modal-content large-modal\">\n                <div class=\"modal-header\">\n                    <h2 id=\"studentModalTitle\">Detalhes do Aluno</h2>\n                    <span class=\"close\" onclick=\"closeStudentModal()\">&times;</span>\n                </div>\n                <div class=\"modal-body\">\n                    <form id=\"studentForm\">\n                        <input type=\"hidden\" id=\"studentId\" name=\"studentId\">\n                        <input type=\"hidden\" id=\"userId\" name=\"userId\">\n                        \n                        <!-- InformaÃ§Ãµes Pessoais -->\n                        <div class=\"form-section\">\n                            <h3>ðŸ“‹ InformaÃ§Ãµes Pessoais</h3>\n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label for=\"firstName\">Nome *</label>\n                                    <input type=\"text\" id=\"firstName\" name=\"firstName\" required>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"lastName\">Sobrenome *</label>\n                                    <input type=\"text\" id=\"lastName\" name=\"lastName\" required>\n                                </div>\n                            </div>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label for=\"email\">Email *</label>\n                                    <input type=\"email\" id=\"email\" name=\"email\" required>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"phone\">Telefone</label>\n                                    <input type=\"tel\" id=\"phone\" name=\"phone\">\n                                </div>\n                            </div>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label for=\"cpf\">CPF</label>\n                                    <input type=\"text\" id=\"cpf\" name=\"cpf\" placeholder=\"000.000.000-00\">\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"birthDate\">Data de Nascimento</label>\n                                    <input type=\"date\" id=\"birthDate\" name=\"birthDate\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- InformaÃ§Ãµes da Academia -->\n                        <div class=\"form-section\">\n                            <h3>ðŸ¥‹ InformaÃ§Ãµes da Academia</h3>\n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label for=\"category\">Categoria *</label>\n                                    <select id=\"category\" name=\"category\" required>\n                                        <option value=\"ADULT\">Adulto</option>\n                                        <option value=\"INICIANTE1\">Iniciante 1</option>\n                                        <option value=\"INICIANTE2\">Iniciante 2</option>\n                                        <option value=\"MASTER1\">Master 1</option>\n                                        <option value=\"MASTER2\">Master 2</option>\n                                        <option value=\"MASTER3\">Master 3</option>\n                                        <option value=\"HEROI1\">HerÃ³i 1</option>\n                                        <option value=\"HEROI2\">HerÃ³i 2</option>\n                                        <option value=\"HEROI3\">HerÃ³i 3</option>\n                                    </select>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"gender\">GÃªnero *</label>\n                                    <select id=\"gender\" name=\"gender\" required>\n                                        <option value=\"MASCULINO\">Masculino</option>\n                                        <option value=\"FEMININO\">Feminino</option>\n                                        <option value=\"OUTRO\">Outro</option>\n                                    </select>\n                                </div>\n                            </div>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label for=\"physicalCondition\">CondiÃ§Ã£o FÃ­sica</label>\n                                    <select id=\"physicalCondition\" name=\"physicalCondition\">\n                                        <option value=\"INICIANTE\">Iniciante</option>\n                                        <option value=\"BASICO\">BÃ¡sico</option>\n                                        <option value=\"INTERMEDIARIO\">IntermediÃ¡rio</option>\n                                        <option value=\"AVANCADO\">AvanÃ§ado</option>\n                                    </select>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"enrollmentDate\">Data de MatrÃ­cula</label>\n                                    <input type=\"date\" id=\"enrollmentDate\" name=\"enrollmentDate\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- InformaÃ§Ãµes MÃ©dicas -->\n                        <div class=\"form-section\">\n                            <h3>ðŸ¥ InformaÃ§Ãµes MÃ©dicas</h3>\n                            <div class=\"form-row\">\n                                <div class=\"form-group full-width\">\n                                    <label for=\"medicalConditions\">CondiÃ§Ãµes MÃ©dicas</label>\n                                    <textarea id=\"medicalConditions\" name=\"medicalConditions\" rows=\"3\" \n                                              placeholder=\"Alergias, medicamentos, limitaÃ§Ãµes fÃ­sicas, etc.\"></textarea>\n                                </div>\n                            </div>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label for=\"emergencyContact\">Contato de EmergÃªncia</label>\n                                    <input type=\"text\" id=\"emergencyContact\" name=\"emergencyContact\" \n                                           placeholder=\"Nome e telefone\">\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"specialNeeds\">Necessidades Especiais</label>\n                                    <select id=\"specialNeeds\" name=\"specialNeeds\" multiple>\n                                        <option value=\"TEA\">TEA (Autismo)</option>\n                                        <option value=\"TDAH\">TDAH</option>\n                                        <option value=\"MobilidadeReduzida\">Mobilidade Reduzida</option>\n                                        <option value=\"DeficienciaVisual\">DeficiÃªncia Visual</option>\n                                        <option value=\"DeficienciaAuditiva\">DeficiÃªncia Auditiva</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Status e Progresso -->\n                        <div class=\"form-section\" id=\"progressSection\">\n                            <h3>ðŸ“Š Status e Progresso</h3>\n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label for=\"totalXP\">XP Total</label>\n                                    <input type=\"number\" id=\"totalXP\" name=\"totalXP\" readonly>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"globalLevel\">NÃ­vel Global</label>\n                                    <input type=\"number\" id=\"globalLevel\" name=\"globalLevel\" readonly>\n                                </div>\n                            </div>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label for=\"currentStreak\">SequÃªncia Atual</label>\n                                    <input type=\"number\" id=\"currentStreak\" name=\"currentStreak\" readonly>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"lastCheckinDate\">Ãšltima PresenÃ§a</label>\n                                    <input type=\"datetime-local\" id=\"lastCheckinDate\" name=\"lastCheckinDate\" readonly>\n                                </div>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeStudentModal()\">\n                        Cancelar\n                    </button>\n                    <button type=\"button\" id=\"saveStudentBtn\" class=\"btn btn-primary\" onclick=\"saveStudent()\">\n                        ðŸ’¾ Salvar AlteraÃ§Ãµes\n                    </button>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Courses -->\n        <div id=\"courses\" class=\"content-section\">\n            <!-- Modern Page Header -->\n            <div class=\"page-header\" style=\"background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                    <div>\n                        <h1 style=\"margin: 0; font-size: 2rem; background: linear-gradient(135deg, #3B82F6, #8B5CF6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\">ðŸ“š Biblioteca de Cursos</h1>\n                        <p style=\"margin: 0.5rem 0 0 0; color: #94A3B8; font-size: 1.1rem;\">Metodologias pedagÃ³gicas, estrutura curricular e geraÃ§Ã£o com IA</p>\n                    </div>\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button class=\"btn btn-primary\" onclick=\"openRAGCourseCreator()\" style=\"background: linear-gradient(135deg, #059669, #10B981); border: none; padding: 0.75rem 1.5rem;\">\n                            <span>ðŸ¤–</span> Criar com IA\n                        </button>\n                        <button class=\"btn btn-secondary\" onclick=\"importCourseDocument()\" style=\"padding: 0.75rem 1.5rem;\">\n                            <span>ðŸ“Ž</span> Importar Documento\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Quick Stats -->\n                <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;\">\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #3B82F6;\" id=\"totalCoursesCount\">1</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Cursos Ativos</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #8B5CF6;\" id=\"totalLessonsCount\">48</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Planos de Aula</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #10B981;\" id=\"totalTechniquesCount\">42</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">TÃ©cnicas</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #F59E0B;\" id=\"courseProgressCount\">31%</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Progresso</div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Course Selection -->\n            <div class=\"data-table\" style=\"margin-bottom: 2rem;\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">ðŸ“š SeleÃ§Ã£o de Curso</div>\n                    <div class=\"table-actions\">\n                        <select id=\"courseSelector\" onchange=\"loadSelectedCourse()\" style=\"background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem 1rem; border-radius: 8px; min-width: 250px; margin-right: 1rem;\">\n                            <option value=\"faixa-branca\">Krav Maga Faixa Branca - Defesa Pessoal 1</option>\n                        </select>\n                        <button class=\"btn btn-secondary\" onclick=\"editCourseTemplate()\" style=\"margin-right: 0.5rem;\">\n                            <span>âœï¸</span> Editar Template\n                        </button>\n                        <button class=\"btn btn-success\" onclick=\"duplicateCourse()\" style=\"background: linear-gradient(135deg, #059669, #10B981);\">\n                            <span>ðŸ“‹</span> Duplicar\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Modern Tabs Navigation -->\n            <div class=\"tabs-container\" style=\"margin-bottom: 2rem;\">\n                <div class=\"tabs-nav\" style=\"display: flex; background: #1E293B; border-radius: 12px; padding: 0.5rem; border: 1px solid #374151; margin-bottom: 1rem;\">\n                    <button class=\"tab-btn active\" onclick=\"switchCourseTab('overview')\" data-tab=\"overview\" style=\"flex: 1; padding: 0.75rem 1rem; background: linear-gradient(135deg, #3B82F6, #1D4ED8); color: white; border: none; border-radius: 8px; font-weight: 600; transition: all 0.3s;\">\n                        ðŸ“Š VisÃ£o Geral\n                    </button>\n                    <button class=\"tab-btn\" onclick=\"switchCourseTab('details')\" data-tab=\"details\" style=\"flex: 1; padding: 0.75rem 1rem; background: transparent; color: #CBD5E1; border: none; border-radius: 8px; font-weight: 600; transition: all 0.3s;\">\n                        ðŸŽ¯ Detalhes\n                    </button>\n                    <button class=\"tab-btn\" onclick=\"switchCourseTab('lessons')\" data-tab=\"lessons\" style=\"flex: 1; padding: 0.75rem 1rem; background: transparent; color: #CBD5E1; border: none; border-radius: 8px; font-weight: 600; transition: all 0.3s;\">\n                        ðŸ“‹ Planos de Aula\n                    </button>\n                    <button class=\"tab-btn\" onclick=\"switchCourseTab('techniques')\" data-tab=\"techniques\" style=\"flex: 1; padding: 0.75rem 1rem; background: transparent; color: #CBD5E1; border: none; border-radius: 8px; font-weight: 600; transition: all 0.3s;\">\n                        ðŸ¥Š TÃ©cnicas\n                    </button>\n                    <button class=\"tab-btn\" onclick=\"switchCourseTab('evaluations')\" data-tab=\"evaluations\" style=\"flex: 1; padding: 0.75rem 1rem; background: transparent; color: #CBD5E1; border: none; border-radius: 8px; font-weight: 600; transition: all 0.3s;\">\n                        ðŸ† AvaliaÃ§Ãµes\n                    </button>\n                    <button class=\"tab-btn\" onclick=\"switchCourseTab('ai-rag')\" data-tab=\"ai-rag\" style=\"flex: 1; padding: 0.75rem 1rem; background: transparent; color: #CBD5E1; border: none; border-radius: 8px; font-weight: 600; transition: all 0.3s;\">\n                        ðŸŽ¯ Criar Curso\n                    </button>\n                </div>\n\n                <!-- Tab Content: Overview -->\n                <div id=\"tab-overview\" class=\"tab-content active\">\n                    <div style=\"display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;\">\n                        <!-- Main Course Info -->\n                        <div class=\"data-table\">\n                            <div class=\"table-header\">\n                                <div class=\"table-title\">ðŸ“š Krav Maga Faixa Branca - Defesa Pessoal 1</div>\n                                <div class=\"table-actions\">\n                                    <button class=\"btn btn-primary\" onclick=\"editCourseDetails()\">\n                                        <span>âœï¸</span> Editar\n                                    </button>\n                                </div>\n                            </div>\n                            <div style=\"padding: 2rem;\">\n                                <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;\">\n                                    <div>\n                                        <h4 style=\"color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;\">\n                                            ðŸŽ¯ <span>Objetivo Principal</span>\n                                        </h4>\n                                        <p style=\"color: #CBD5E1; line-height: 1.6;\">Capacitar adultos com tÃ©cnicas fundamentais de defesa pessoal, desenvolvendo habilidades prÃ¡ticas de proteÃ§Ã£o e autoconfianÃ§a atravÃ©s do sistema Krav Maga.</p>\n                                    </div>\n                                    <div>\n                                        <h4 style=\"color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;\">\n                                            ðŸ“Š <span>InformaÃ§Ãµes Gerais</span>\n                                        </h4>\n                                        <div style=\"color: #CBD5E1; line-height: 1.8;\">\n                                            <div><strong>ðŸ“‹ Estrutura:</strong> 48 aulas organizadas</div>\n                                            <div><strong>ðŸ“† AplicaÃ§Ã£o:</strong> FlexÃ­vel por turma</div>\n                                            <div><strong>ðŸ‘¥ PÃºblico:</strong> Adultos (18+ anos)</div>\n                                            <div><strong>ðŸ“ Modalidade:</strong> Presencial</div>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <!-- Course Structure -->\n                                <div style=\"background: rgba(59, 130, 246, 0.05); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;\">\n                                    <h4 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ—ï¸ Estrutura MetodolÃ³gica</h4>\n                                    <div style=\"display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; text-align: center; color: #CBD5E1; font-size: 0.875rem;\">\n                                        <div>\n                                            <div style=\"background: #10B981; padding: 0.5rem; border-radius: 6px; margin-bottom: 0.25rem;\">ðŸ“š</div>\n                                            <div>Fundamentos</div>\n                                            <div style=\"font-size: 0.75rem; color: #94A3B8;\">Aulas 1-10</div>\n                                        </div>\n                                        <div>\n                                            <div style=\"background: #3B82F6; padding: 0.5rem; border-radius: 6px; margin-bottom: 0.25rem;\">ðŸ‘Š</div>\n                                            <div>Golpes BÃ¡sicos</div>\n                                            <div style=\"font-size: 0.75rem; color: #94A3B8;\">Aulas 11-20</div>\n                                        </div>\n                                        <div>\n                                            <div style=\"background: #8B5CF6; padding: 0.5rem; border-radius: 6px; margin-bottom: 0.25rem;\">ðŸ›¡ï¸</div>\n                                            <div>Defesas BÃ¡sicas</div>\n                                            <div style=\"font-size: 0.75rem; color: #94A3B8;\">Aulas 21-30</div>\n                                        </div>\n                                        <div>\n                                            <div style=\"background: #F59E0B; padding: 0.5rem; border-radius: 6px; margin-bottom: 0.25rem;\">âš”ï¸</div>\n                                            <div>Defesas AvanÃ§adas</div>\n                                            <div style=\"font-size: 0.75rem; color: #94A3B8;\">Aulas 31-40</div>\n                                        </div>\n                                        <div>\n                                            <div style=\"background: #EF4444; padding: 0.5rem; border-radius: 6px; margin-bottom: 0.25rem;\">ðŸ”„</div>\n                                            <div>IntegraÃ§Ã£o</div>\n                                            <div style=\"font-size: 0.75rem; color: #94A3B8;\">Aulas 41-48</div>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <!-- Course Metrics -->\n                                <div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;\">\n                                    <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; text-align: center;\">\n                                        <div style=\"font-size: 1.5rem; color: #10B981; margin-bottom: 0.5rem;\">48</div>\n                                        <div style=\"color: #CBD5E1; font-size: 0.875rem;\">Planos de Aula</div>\n                                    </div>\n                                    <div style=\"background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; text-align: center;\">\n                                        <div style=\"font-size: 1.5rem; color: #F59E0B; margin-bottom: 0.5rem;\">42</div>\n                                        <div style=\"color: #CBD5E1; font-size: 0.875rem;\">TÃ©cnicas</div>\n                                    </div>\n                                    <div style=\"background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px; text-align: center;\">\n                                        <div style=\"font-size: 1.5rem; color: #8B5CF6; margin-bottom: 0.5rem;\">2</div>\n                                        <div style=\"color: #CBD5E1; font-size: 0.875rem;\">Turmas Ativas</div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Sidebar Info -->\n                        <div>\n                            <!-- Quick Actions -->\n                            <div class=\"data-table\" style=\"margin-bottom: 1rem;\">\n                                <div class=\"table-header\">\n                                    <div class=\"table-title\">âš¡ AÃ§Ãµes RÃ¡pidas</div>\n                                </div>\n                                <div style=\"padding: 1rem;\">\n                                    <div style=\"display: flex; flex-direction: column; gap: 0.75rem;\">\n                                        <button class=\"btn btn-primary\" onclick=\"openLessonPlanManager()\" style=\"width: 100%; justify-content: flex-start;\">\n                                            <span>ðŸ“‹</span> Gerenciar Planos de Aula\n                                        </button>\n                                        <button class=\"btn btn-secondary\" onclick=\"openTechniquesLibrary()\" style=\"width: 100%; justify-content: flex-start;\">\n                                            <span>ðŸ¥Š</span> Biblioteca de TÃ©cnicas\n                                        </button>\n                                        <button class=\"btn btn-success\" onclick=\"generateProgressReport()\" style=\"width: 100%; justify-content: flex-start;\">\n                                            <span>ðŸ“Š</span> RelatÃ³rio de Progresso\n                                        </button>\n                                        <button class=\"btn btn-warning\" onclick=\"openRAGInterface()\" style=\"width: 100%; justify-content: flex-start;\">\n                                            <span>ðŸ¤–</span> Interface IA/RAG\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <!-- Recent Activity -->\n                            <div class=\"data-table\">\n                                <div class=\"table-header\">\n                                    <div class=\"table-title\">ðŸ•’ Atividade Recente</div>\n                                </div>\n                                <div style=\"padding: 1rem;\">\n                                    <div style=\"display: flex; flex-direction: column; gap: 0.75rem; font-size: 0.875rem;\">\n                                        <div style=\"display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(59, 130, 246, 0.1); border-radius: 6px;\">\n                                            <span style=\"color: #3B82F6;\">ðŸ“‹</span>\n                                            <div style=\"color: #CBD5E1;\">\n                                                <div>Aula 15 concluÃ­da</div>\n                                                <div style=\"font-size: 0.75rem; color: #94A3B8;\">Hoje - 15:30</div>\n                                            </div>\n                                        </div>\n                                        <div style=\"display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 6px;\">\n                                            <span style=\"color: #10B981;\">âœ…</span>\n                                            <div style=\"color: #CBD5E1;\">\n                                                <div>AvaliaÃ§Ã£o Modular 2</div>\n                                                <div style=\"font-size: 0.75rem; color: #94A3B8;\">Ontem - 14:00</div>\n                                            </div>\n                                        </div>\n                                        <div style=\"display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: rgba(139, 92, 246, 0.1); border-radius: 6px;\">\n                                            <span style=\"color: #8B5CF6;\">ðŸ¥Š</span>\n                                            <div style=\"color: #CBD5E1;\">\n                                                <div>Nova tÃ©cnica adicionada</div>\n                                                <div style=\"font-size: 0.75rem; color: #94A3B8;\">2 dias atrÃ¡s</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Tab Content: Details -->\n                <div id=\"tab-details\" class=\"tab-content\" style=\"display: none;\">\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;\">\n                        <!-- Course Details -->\n                        <div class=\"data-table\">\n                            <div class=\"table-header\">\n                                <div class=\"table-title\">ðŸŽ¯ Detalhes do Curso</div>\n                            </div>\n                            <div style=\"padding: 2rem;\">\n                                <div style=\"margin-bottom: 2rem;\">\n                                    <h4 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“ DescriÃ§Ã£o Completa</h4>\n                                    <p style=\"color: #CBD5E1; line-height: 1.6; margin-bottom: 1rem;\">\n                                        O curso Krav Maga Faixa Branca foi desenvolvido especificamente para adultos iniciantes que desejam aprender tÃ©cnicas eficazes de defesa pessoal. Baseado no sistema militar israelense, o programa enfatiza simplicidade, efetividade e aplicaÃ§Ã£o prÃ¡tica em situaÃ§Ãµes reais.\n                                    </p>\n                                    <p style=\"color: #CBD5E1; line-height: 1.6;\">\n                                        Metodologia estruturada em 48 planos de aula sequenciais organizadas em 5 unidades progressivas, cobrindo 42 tÃ©cnicas fundamentais desde movimentos bÃ¡sicos atÃ© integraÃ§Ã£o completa de defesas e contra-ataques.\n                                    </p>\n                                </div>\n\n                                <div style=\"margin-bottom: 2rem;\">\n                                    <h4 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸŽ¯ Objetivos EspecÃ­ficos</h4>\n                                    <div style=\"color: #CBD5E1; line-height: 1.8;\">\n                                        <div style=\"display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;\">\n                                            <span style=\"color: #10B981;\">âœ“</span> Dominar 42 tÃ©cnicas fundamentais de Krav Maga\n                                        </div>\n                                        <div style=\"display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;\">\n                                            <span style=\"color: #10B981;\">âœ“</span> Desenvolver consciÃªncia situacional e tomada de decisÃ£o\n                                        </div>\n                                        <div style=\"display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;\">\n                                            <span style=\"color: #10B981;\">âœ“</span> Aumentar condicionamento fÃ­sico e coordenaÃ§Ã£o\n                                        </div>\n                                        <div style=\"display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;\">\n                                            <span style=\"color: #10B981;\">âœ“</span> Construir autoconfianÃ§a e controle emocional\n                                        </div>\n                                        <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                                            <span style=\"color: #10B981;\">âœ“</span> Aplicar tÃ©cnicas em cenÃ¡rios realÃ­sticos\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div>\n                                    <h4 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“š Metodologia</h4>\n                                    <div style=\"color: #CBD5E1; line-height: 1.6;\">\n                                        <p style=\"margin-bottom: 1rem;\"><strong>Estrutura da Aula (60 min):</strong></p>\n                                        <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;\">\n                                            <div style=\"display: grid; grid-template-columns: 1fr 3fr; gap: 1rem; margin-bottom: 0.5rem;\">\n                                                <span style=\"color: #3B82F6; font-weight: bold;\">5 min</span>\n                                                <span>Aquecimento articular e ativaÃ§Ã£o</span>\n                                            </div>\n                                            <div style=\"display: grid; grid-template-columns: 1fr 3fr; gap: 1rem; margin-bottom: 0.5rem;\">\n                                                <span style=\"color: #8B5CF6; font-weight: bold;\">35-40 min</span>\n                                                <span>RevisÃ£o, novas tÃ©cnicas e prÃ¡tica</span>\n                                            </div>\n                                            <div style=\"display: grid; grid-template-columns: 1fr 3fr; gap: 1rem; margin-bottom: 0.5rem;\">\n                                                <span style=\"color: #10B981; font-weight: bold;\">10-15 min</span>\n                                                <span>SimulaÃ§Ãµes e cenÃ¡rios prÃ¡ticos</span>\n                                            </div>\n                                            <div style=\"display: grid; grid-template-columns: 1fr 3fr; gap: 1rem;\">\n                                                <span style=\"color: #F59E0B; font-weight: bold;\">5 min</span>\n                                                <span>Relaxamento e feedback</span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Requirements & Schedule -->\n                        <div>\n                            <div class=\"data-table\" style=\"margin-bottom: 1rem;\">\n                                <div class=\"table-header\">\n                                    <div class=\"table-title\">ðŸ“‹ PrÃ©-requisitos & CertificaÃ§Ã£o</div>\n                                </div>\n                                <div style=\"padding: 1.5rem;\">\n                                    <div style=\"margin-bottom: 1.5rem;\">\n                                        <h4 style=\"color: #F8FAFC; margin-bottom: 1rem;\">âœ… PrÃ©-requisitos</h4>\n                                        <div style=\"color: #CBD5E1; line-height: 1.8;\">\n                                            <div>ðŸ”¸ Idade mÃ­nima: 18 anos</div>\n                                            <div>ðŸ”¸ Atestado mÃ©dico para atividade fÃ­sica</div>\n                                            <div>ðŸ”¸ Compromisso com frequÃªncia mÃ­nima de 75%</div>\n                                            <div>ðŸ”¸ Equipamentos: roupas confortÃ¡veis e tÃªnis</div>\n                                        </div>\n                                    </div>\n\n                                    <div>\n                                        <h4 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ† Requisitos de CertificaÃ§Ã£o</h4>\n                                        <div style=\"color: #CBD5E1; line-height: 1.8;\">\n                                            <div>ðŸ“Š FrequÃªncia mÃ­nima de 75% (36 aulas)</div>\n                                            <div>ðŸ“ ParticipaÃ§Ã£o em 5 avaliaÃ§Ãµes modulares</div>\n                                            <div>âœ… AprovaÃ§Ã£o no exame final prÃ¡tico</div>\n                                            <div>ðŸŽ¯ DemonstraÃ§Ã£o de 30+ tÃ©cnicas</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"data-table\">\n                                <div class=\"table-header\">\n                                    <div class=\"table-title\">ðŸŽ¯ AplicaÃ§Ã£o do Curso</div>\n                                </div>\n                                <div style=\"padding: 1.5rem;\">\n                                    <div style=\"margin-bottom: 1.5rem;\">\n                                        <h4 style=\"color: #3B82F6; margin-bottom: 1rem;\">ðŸ“š Modalidades de AplicaÃ§Ã£o</h4>\n                                        <div style=\"color: #CBD5E1; line-height: 1.8; background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px;\">\n                                            <div><strong>â±ï¸ DuraÃ§Ã£o Recomendada:</strong> 24 semanas (2 aulas/semana)</div>\n                                            <div><strong>ðŸ‘¥ Tamanho Ideal da Turma:</strong> 15-20 alunos</div>\n                                            <div><strong>ðŸ•°ï¸ DuraÃ§Ã£o da Aula:</strong> 60 minutos</div>\n                                            <div><strong>ðŸ“Š FrequÃªncia MÃ­nima:</strong> 75% das aulas</div>\n                                        </div>\n                                    </div>\n\n                                    <div>\n                                        <h4 style=\"color: #8B5CF6; margin-bottom: 1rem;\">ðŸƒ AdaptaÃ§Ãµes PossÃ­veis</h4>\n                                        <div style=\"color: #CBD5E1; line-height: 1.8; background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px;\">\n                                            <div><strong>âš¡ Intensivo:</strong> 12 semanas (4 aulas/semana)</div>\n                                            <div><strong>ðŸ• Extensivo:</strong> 48 semanas (1 aula/semana)</div>\n                                            <div><strong>ðŸŽ“ Corporativo:</strong> MÃ³dulos de 1-2 dias</div>\n                                            <div><strong>â™¿ Adaptado:</strong> Necessidades especiais</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Tab Content: Lessons (Table) -->\n                <div id=\"tab-lessons\" class=\"tab-content\" style=\"display: none;\">\n                    <div class=\"data-table\">\n                        <div class=\"table-header\">\n                            <div class=\"table-title\">ðŸ“‹ Planos de Aula Detalhados - 48 Aulas</div>\n                            <div class=\"table-actions\">\n                                <button class=\"btn btn-secondary\" onclick=\"exportLessonPlans()\">\n                                    <span>ðŸ“¤</span> Exportar\n                                </button>\n                                <button class=\"btn btn-primary\" onclick=\"editLessonPlan()\">\n                                    <span>âœï¸</span> Editar Aula\n                                </button>\n                            </div>\n                        </div>\n                        \n                        <!-- Lessons Filters -->\n                        <div style=\"padding: 1rem; background: rgba(59, 130, 246, 0.05); border-bottom: 1px solid #374151;\">\n                            <div style=\"display: flex; gap: 1rem; align-items: center;\">\n                                <select id=\"unitFilter\" onchange=\"filterLessonsByUnit()\" style=\"background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem; border-radius: 6px;\">\n                                    <option value=\"all\">Todas as Unidades</option>\n                                    <option value=\"1\">Unidade 1: Fundamentos</option>\n                                    <option value=\"2\">Unidade 2: Golpes BÃ¡sicos</option>\n                                    <option value=\"3\">Unidade 3: Defesas BÃ¡sicas</option>\n                                    <option value=\"4\">Unidade 4: Defesas AvanÃ§adas</option>\n                                    <option value=\"5\">Unidade 5: IntegraÃ§Ã£o</option>\n                                </select>\n                                <select id=\"statusFilter\" onchange=\"filterLessonsByStatus()\" style=\"background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem; border-radius: 6px;\">\n                                    <option value=\"all\">Todos os Status</option>\n                                    <option value=\"completed\">ConcluÃ­das</option>\n                                    <option value=\"current\">Atual</option>\n                                    <option value=\"upcoming\">PrÃ³ximas</option>\n                                </select>\n                                <input type=\"text\" id=\"searchLessons\" onkeyup=\"searchLessons()\" placeholder=\"Buscar por tÃ©cnica ou objetivo...\" style=\"background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem; border-radius: 6px; flex: 1;\">\n                            </div>\n                        </div>\n\n                        <!-- Lessons Table -->\n                        <div style=\"overflow-x: auto;\">\n                            <table style=\"width: 100%; border-collapse: collapse;\">\n                                <thead>\n                                    <tr style=\"background: #1E293B; border-bottom: 1px solid #374151;\">\n                                        <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600; min-width: 80px;\">Aula</th>\n                                        <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600; min-width: 100px;\">Status</th>\n                                        <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600; min-width: 150px;\">Unidade</th>\n                                        <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600; min-width: 200px;\">TÃ©cnicas Principais</th>\n                                        <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600; min-width: 200px;\">Objetivos</th>\n                                        <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600; min-width: 120px;\">SequÃªncia</th>\n                                        <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600; min-width: 100px;\">AÃ§Ãµes</th>\n                                    </tr>\n                                </thead>\n                                <tbody id=\"lessonsTableBody\">\n                                    <!-- Lessons data will be loaded here -->\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Tab Content: Techniques -->\n                <div id=\"tab-techniques\" class=\"tab-content\" style=\"display: none;\">\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;\">\n                        <!-- Techniques by Unit -->\n                        <div class=\"data-table\">\n                            <div class=\"table-header\">\n                                <div class=\"table-title\">ðŸ¥Š TÃ©cnicas por Unidade (42 Total)</div>\n                            </div>\n                            <div style=\"padding: 1rem;\" id=\"techniquesContainer\">\n                                <!-- Techniques will be loaded here -->\n                            </div>\n                        </div>\n\n                        <!-- Technique Details -->\n                        <div class=\"data-table\">\n                            <div class=\"table-header\">\n                                <div class=\"table-title\">ðŸŽ¯ Detalhes da TÃ©cnica</div>\n                            </div>\n                            <div style=\"padding: 1rem;\" id=\"techniqueDetails\">\n                                <div style=\"text-align: center; color: #6B7280; padding: 3rem;\">\n                                    <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ¥Š</div>\n                                    <p>Selecione uma tÃ©cnica para ver os detalhes</p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Tab Content: Evaluations -->\n                <div id=\"tab-evaluations\" class=\"tab-content\" style=\"display: none;\">\n                    <div class=\"data-table\">\n                        <div class=\"table-header\">\n                            <div class=\"table-title\">ðŸ† Sistema de AvaliaÃ§Ãµes Modulares</div>\n                        </div>\n                        <div style=\"padding: 2rem;\">\n                            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;\" id=\"evaluationsContainer\">\n                                <!-- Evaluations will be loaded here -->\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Tab Content: Course Creator -->\n                <div id=\"tab-ai-rag\" class=\"tab-content\" style=\"display: none;\">\n                    <div style=\"max-width: 800px; margin: 0 auto;\">\n                        <!-- Course Generator -->\n                        <div class=\"data-table\">\n                            <div class=\"table-header\">\n                                <div class=\"table-title\">ðŸŽ¯ Gerador Inteligente de Cursos</div>\n                                <div class=\"table-actions\">\n                                    <button class=\"btn btn-success\" onclick=\"openSimpleCourseCreator()\">\n                                        <span>âš¡</span> Curso RÃ¡pido\n                                    </button>\n                                    <button class=\"btn btn-secondary\" onclick=\"showAdvancedCourseForm()\">\n                                        <span>ðŸŽ›ï¸</span> AvanÃ§ado\n                                    </button>\n                                </div>\n                            </div>\n                            <div style=\"padding: 1.5rem;\">\n                                <!-- Simple Course Creator -->\n                                <div id=\"simpleCourseCreator\" style=\"background: rgba(16, 185, 129, 0.1); border-radius: 12px; padding: 2rem; margin-bottom: 1.5rem; border: 2px solid #10B981;\">\n                                    <h3 style=\"color: #10B981; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.25rem;\">\n                                        âš¡ CriaÃ§Ã£o RÃ¡pida de Curso\n                                    </h3>\n                                    <p style=\"color: #D1FAE5; margin-bottom: 1.5rem; line-height: 1.5;\">\n                                        Digite apenas o nome do curso e deixe a IA gerar automaticamente todo o conteÃºdo pedagÃ³gico com base em metodologias comprovadas.\n                                    </p>\n                                    \n                                    <div style=\"display: flex; flex-direction: column; gap: 1rem;\">\n                                        <div>\n                                            <input type=\"text\" id=\"quickCourseName\" placeholder=\"Ex: Krav Maga Faixa Amarela Adultos\" \n                                                   style=\"width: 100%; background: #1E293B; border: 1px solid #10B981; color: #F8FAFC; padding: 1rem; border-radius: 8px; font-size: 1rem;\"\n                                                   onkeypress=\"if(event.key==='Enter') createQuickCourse()\">\n                                        </div>\n                                        \n                                        <div style=\"display: flex; gap: 1rem; align-items: center;\">\n                                            <button onclick=\"createQuickCourse()\" class=\"btn btn-success\" style=\"flex: 1; padding: 0.875rem; font-size: 1rem;\">\n                                                <span>ðŸš€</span> Criar Curso Automaticamente\n                                            </button>\n                                            <button onclick=\"previewQuickCourse()\" class=\"btn btn-secondary\" style=\"padding: 0.875rem;\">\n                                                <span>ðŸ‘ï¸</span> Preview\n                                            </button>\n                                        </div>\n                                    </div>\n                                    \n                                    <!-- Preview Area -->\n                                    <div id=\"coursePreviewArea\" style=\"display: none; margin-top: 1.5rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid #3B82F6;\">\n                                        <h4 style=\"color: #3B82F6; margin: 0 0 1rem 0;\">ðŸ“‹ Preview do Curso</h4>\n                                        <div id=\"coursePreviewContent\"></div>\n                                        <div style=\"display: flex; gap: 1rem; margin-top: 1rem;\">\n                                            <button onclick=\"confirmCreateCourse()\" class=\"btn btn-success\">\n                                                <span>âœ…</span> Confirmar e Criar\n                                            </button>\n                                            <button onclick=\"editCourseDetails()\" class=\"btn btn-secondary\">\n                                                <span>âœï¸</span> Editar Detalhes\n                                            </button>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <form id=\"courseGeneratorForm\" onsubmit=\"generateCourseWithRAG(event)\" style=\"display: none;\">\n                                    <!-- Basic Information -->\n                                    <div style=\"background: rgba(59, 130, 246, 0.05); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;\">\n                                        <h4 style=\"color: #3B82F6; margin: 0 0 1rem 0;\">ðŸ“š InformaÃ§Ãµes BÃ¡sicas</h4>\n                                        \n                                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;\">\n                                            <div>\n                                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸ¥‹ Arte Marcial</label>\n                                                <select id=\"martialArtSelect\" required style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                                    <option value=\"\">Selecione a arte marcial</option>\n                                                    <option value=\"krav-maga\">Krav Maga</option>\n                                                    <option value=\"jiu-jitsu\">Jiu-Jitsu</option>\n                                                    <option value=\"boxe\">Boxe</option>\n                                                    <option value=\"muay-thai\">Muay Thai</option>\n                                                    <option value=\"karate\">KaratÃª</option>\n                                                    <option value=\"taekwondo\">Taekwondo</option>\n                                                    <option value=\"judo\">JudÃ´</option>\n                                                    <option value=\"mma\">MMA</option>\n                                                </select>\n                                            </div>\n                                            <div>\n                                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸŽ¯ NÃ­vel/Faixa</label>\n                                                <select id=\"courseLevelSelect\" required style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                                    <option value=\"\">Selecione o nÃ­vel</option>\n                                                    <option value=\"branca\">Faixa Branca (Iniciante)</option>\n                                                    <option value=\"amarela\">Faixa Amarela</option>\n                                                    <option value=\"laranja\">Faixa Laranja</option>\n                                                    <option value=\"verde\">Faixa Verde</option>\n                                                    <option value=\"azul\">Faixa Azul</option>\n                                                    <option value=\"marrom\">Faixa Marrom</option>\n                                                    <option value=\"preta\">Faixa Preta</option>\n                                                </select>\n                                            </div>\n                                        </div>\n\n                                        <div style=\"margin-bottom: 1rem;\">\n                                            <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸ“ Nome do Curso</label>\n                                            <input type=\"text\" id=\"courseName\" required placeholder=\"Ex: Krav Maga Faixa Amarela - Defesa Pessoal 2\" style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                        </div>\n\n                                        <div>\n                                            <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸ“„ DescriÃ§Ã£o do Curso</label>\n                                            <textarea id=\"courseDescription\" rows=\"3\" required placeholder=\"DescriÃ§Ã£o detalhada do curso, metodologia e diferenciais...\" style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px; resize: vertical;\"></textarea>\n                                        </div>\n                                    </div>\n\n                                    <!-- Target Audience -->\n                                    <div style=\"background: rgba(139, 92, 246, 0.05); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;\">\n                                        <h4 style=\"color: #8B5CF6; margin: 0 0 1rem 0;\">ðŸ‘¥ PÃºblico-Alvo e AdaptaÃ§Ãµes</h4>\n                                        \n                                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;\">\n                                            <div>\n                                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸŽ‚ Faixa EtÃ¡ria</label>\n                                                <select id=\"targetAudienceSelect\" required style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                                    <option value=\"\">Selecione a faixa etÃ¡ria</option>\n                                                    <option value=\"criancas\">CrianÃ§as (6-12 anos)</option>\n                                                    <option value=\"adolescentes\">Adolescentes (13-17 anos)</option>\n                                                    <option value=\"adultos\">Adultos (18+ anos)</option>\n                                                    <option value=\"seniors\">Seniors (60+ anos)</option>\n                                                    <option value=\"misto\">Todas as idades (adaptado)</option>\n                                                </select>\n                                            </div>\n                                            <div>\n                                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">âš§ GÃªnero</label>\n                                                <select id=\"genderTargetSelect\" style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                                    <option value=\"misto\">Misto (Homens e Mulheres)</option>\n                                                    <option value=\"feminino\">Exclusivo Feminino</option>\n                                                    <option value=\"masculino\">Exclusivo Masculino</option>\n                                                </select>\n                                            </div>\n                                        </div>\n\n                                        <div style=\"margin-bottom: 1rem;\">\n                                            <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸ¢ Contexto EspecÃ­fico</label>\n                                            <select id=\"contextSelect\" style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                                <option value=\"academia\">Academia/Escola Regular</option>\n                                                <option value=\"corporativo\">Treinamento Corporativo</option>\n                                                <option value=\"forÃ§as\">ForÃ§as Armadas/SeguranÃ§a</option>\n                                                <option value=\"terapeutico\">TerapÃªutico/ReabilitaÃ§Ã£o</option>\n                                                <option value=\"competicao\">PreparaÃ§Ã£o Competitiva</option>\n                                            </select>\n                                        </div>\n\n                                        <div>\n                                            <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">â™¿ AdaptaÃ§Ãµes Especiais</label>\n                                            <div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem;\">\n                                                <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                                    <input type=\"checkbox\" id=\"adaptTEA\" style=\"margin: 0;\">\n                                                    TEA (Autismo)\n                                                </label>\n                                                <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                                    <input type=\"checkbox\" id=\"adaptTDH\" style=\"margin: 0;\">\n                                                    TDAH/Hiperatividade\n                                                </label>\n                                                <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                                    <input type=\"checkbox\" id=\"adaptMobility\" style=\"margin: 0;\">\n                                                    Mobilidade Reduzida\n                                                </label>\n                                                <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                                    <input type=\"checkbox\" id=\"adaptVisual\" style=\"margin: 0;\">\n                                                    DeficiÃªncia Visual\n                                                </label>\n                                                <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                                    <input type=\"checkbox\" id=\"adaptAuditory\" style=\"margin: 0;\">\n                                                    DeficiÃªncia Auditiva\n                                                </label>\n                                                <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                                    <input type=\"checkbox\" id=\"adaptCardiac\" style=\"margin: 0;\">\n                                                    Cardiopatia\n                                                </label>\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    <!-- Course Structure -->\n                                    <div style=\"background: rgba(245, 158, 11, 0.05); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;\">\n                                        <h4 style=\"color: #F59E0B; margin: 0 0 1rem 0;\">ðŸ—ï¸ Estrutura do Curso</h4>\n                                        \n                                        <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;\">\n                                            <div>\n                                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">â±ï¸ DuraÃ§Ã£o (semanas)</label>\n                                                <input type=\"number\" id=\"courseDuration\" min=\"4\" max=\"52\" value=\"24\" required style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                            </div>\n                                            <div>\n                                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸ“š Total de Aulas</label>\n                                                <input type=\"number\" id=\"totalLessons\" min=\"8\" max=\"120\" value=\"48\" required style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                            </div>\n                                            <div>\n                                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸ• DuraÃ§Ã£o da Aula (min)</label>\n                                                <select id=\"lessonDuration\" style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                                    <option value=\"45\">45 minutos</option>\n                                                    <option value=\"60\" selected>60 minutos</option>\n                                                    <option value=\"90\">90 minutos</option>\n                                                    <option value=\"120\">120 minutos</option>\n                                                </select>\n                                            </div>\n                                        </div>\n\n                                        <div style=\"margin-bottom: 1rem;\">\n                                            <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸŽ¯ Objetivos EspecÃ­ficos</label>\n                                            <textarea id=\"courseObjectives\" rows=\"3\" required placeholder=\"Ex: Desenvolver defesa pessoal, melhorar condicionamento fÃ­sico, construir autoconfianÃ§a...\" style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px; resize: vertical;\"></textarea>\n                                        </div>\n\n                                        <div>\n                                            <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸ† CritÃ©rios de AvaliaÃ§Ã£o</label>\n                                            <textarea id=\"evaluationCriteria\" rows=\"2\" placeholder=\"Como o progresso serÃ¡ avaliado (tÃ©cnicas, testes prÃ¡ticos, frequÃªncia...)\" style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px; resize: vertical;\"></textarea>\n                                        </div>\n                                    </div>\n\n                                    <!-- Advanced Settings -->\n                                    <div style=\"background: rgba(16, 185, 129, 0.05); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;\">\n                                        <h4 style=\"color: #10B981; margin: 0 0 1rem 0;\">âš™ï¸ ConfiguraÃ§Ãµes AvanÃ§adas</h4>\n                                        \n                                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;\">\n                                            <div>\n                                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸ“Ž Documento Base (opcional)</label>\n                                                <input type=\"file\" id=\"courseDocument\" accept=\".pdf,.doc,.docx,.txt\" style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                                <div style=\"color: #94A3B8; font-size: 0.75rem; margin-top: 0.25rem;\">\n                                                    PDF, DOC ou TXT para orientar a IA\n                                                </div>\n                                            </div>\n                                            <div>\n                                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸŽ¨ Estilo de Ensino</label>\n                                                <select id=\"teachingStyle\" style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px;\">\n                                                    <option value=\"tradicional\">Tradicional/ClÃ¡ssico</option>\n                                                    <option value=\"moderno\">Moderno/Adaptado</option>\n                                                    <option value=\"ludico\">LÃºdico/Gamificado</option>\n                                                    <option value=\"intensivo\">Intensivo/Militar</option>\n                                                    <option value=\"terapeutico\">TerapÃªutico/Suave</option>\n                                                </select>\n                                            </div>\n                                        </div>\n\n                                        <div>\n                                            <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block; font-weight: 600;\">ðŸ’¡ InstruÃ§Ãµes Especiais para IA</label>\n                                            <textarea id=\"aiInstructions\" rows=\"2\" placeholder=\"OrientaÃ§Ãµes especÃ­ficas sobre como estruturar o curso, tÃ©cnicas prioritÃ¡rias, metodologias...\" style=\"width: 100%; background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.75rem; border-radius: 6px; resize: vertical;\"></textarea>\n                                        </div>\n                                    </div>\n\n                                    <!-- Action Buttons -->\n                                    <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;\">\n                                        <button type=\"submit\" class=\"btn btn-primary\" style=\"padding: 1rem;\">\n                                            <span>ðŸ¤–</span> Gerar com IA + RAG\n                                        </button>\n                                        <button type=\"button\" class=\"btn btn-secondary\" onclick=\"useExistingTemplate()\">\n                                            <span>ðŸ“‹</span> Usar Template\n                                        </button>\n                                        <button type=\"button\" class=\"btn btn-success\" onclick=\"previewCourse()\" style=\"background: linear-gradient(135deg, #059669, #10B981);\">\n                                            <span>ðŸ‘ï¸</span> Preview\n                                        </button>\n                                    </div>\n                                </form>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Emergency Contact -->\n            <div style=\"position: fixed; bottom: 20px; right: 20px; background: rgba(239, 68, 68, 0.9); color: white; padding: 1rem; border-radius: 8px; font-size: 0.875rem;\">\n                <div style=\"font-weight: bold;\">ðŸš¨ Problemas?</div>\n                <div>Procure a recepÃ§Ã£o</div>\n                <div>ðŸ“ž (11) 99999-9999</div>\n            </div>\n        </div>\n        \n        <!-- Classes (Turmas) -->\n        <div id=\"classes\" class=\"content-section\">\n            <!-- Modern Page Header -->\n            <div class=\"page-header\" style=\"background: linear-gradient(135deg, #059669 0%, #10B981 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                    <div>\n                        <h1 style=\"margin: 0; font-size: 2rem; background: linear-gradient(135deg, #FFFFFF, #F0FDF4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\">ðŸ« GestÃ£o de Turmas</h1>\n                        <p style=\"margin: 0.5rem 0 0 0; color: #D1FAE5; font-size: 1.1rem;\">Arte marcial com mÃºltiplos cursos/faixas em execuÃ§Ã£o simultÃ¢nea</p>\n                    </div>\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button class=\"btn btn-primary\" onclick=\"createNewClass()\" style=\"background: linear-gradient(135deg, #3B82F6, #1D4ED8); border: none; padding: 0.75rem 1.5rem;\">\n                            <span>âž•</span> Nova Turma\n                        </button>\n                        <button class=\"btn btn-secondary\" onclick=\"viewClassSchedule()\" style=\"padding: 0.75rem 1.5rem;\">\n                            <span>ðŸ“…</span> Cronograma\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Quick Stats -->\n                <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;\">\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #FFFFFF;\" id=\"totalClassesCount\">2</div>\n                        <div style=\"font-size: 0.875rem; color: #D1FAE5;\">Turmas Ativas</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #FFFFFF;\" id=\"totalEnrolledStudents\">6</div>\n                        <div style=\"font-size: 0.875rem; color: #D1FAE5;\">Alunos Total</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #FFFFFF;\" id=\"activeBelts\">3</div>\n                        <div style=\"font-size: 0.875rem; color: #D1FAE5;\">Cursos Ativos</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #FFFFFF;\" id=\"attendanceRate\">85%</div>\n                        <div style=\"font-size: 0.875rem; color: #D1FAE5;\">Taxa PresenÃ§a</div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Classes List -->\n            <div class=\"data-table\" style=\"margin-bottom: 2rem;\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">ðŸ« Turmas em Andamento</div>\n                    <div class=\"table-actions\">\n                        <select id=\"classStatusFilter\" onchange=\"filterClasses()\" style=\"background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem; border-radius: 8px; margin-right: 1rem;\">\n                            <option value=\"all\">Todas as Turmas</option>\n                            <option value=\"active\">Ativas</option>\n                            <option value=\"finished\">Finalizadas</option>\n                            <option value=\"paused\">Pausadas</option>\n                        </select>\n                        <button class=\"btn btn-primary\" onclick=\"createNewClass()\">\n                            <span>âž•</span> Nova Turma\n                        </button>\n                    </div>\n                </div>\n                \n                <div style=\"overflow-x: auto;\">\n                    <table style=\"width: 100%; border-collapse: collapse;\">\n                        <thead>\n                            <tr style=\"background: #1E293B; border-bottom: 1px solid #374151;\">\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Turma</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Arte Marcial</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">HorÃ¡rio</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Cursos Ativos</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Total Alunos</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Status</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">AÃ§Ãµes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"classesTableBody\">\n                            <tr style=\"border-bottom: 1px solid #374151;\">\n                                <td style=\"padding: 1rem; color: #F8FAFC; font-weight: 600;\">\n                                    <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                                        <span style=\"background: #059669; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;\">T1</span>\n                                        Turma 1\n                                    </div>\n                                </td>\n                                <td style=\"padding: 1rem; color: #CBD5E1;\">Krav Maga</td>\n                                <td style=\"padding: 1rem; color: #CBD5E1;\">\n                                    <div>Ter/Qui - 18:00h</div>\n                                    <div style=\"font-size: 0.75rem; color: #94A3B8;\">InÃ­cio: 01/06/2025</div>\n                                </td>\n                                <td style=\"padding: 1rem; color: #CBD5E1;\">\n                                    <div style=\"display: flex; flex-wrap: wrap; gap: 0.25rem;\">\n                                        <span style=\"background: #FFFFFF; color: #000; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600;\">ðŸ¥‹ Branca</span>\n                                        <span style=\"background: #FDE047; color: #000; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600;\">ðŸ¥‹ Amarela</span>\n                                    </div>\n                                </td>\n                                <td style=\"padding: 1rem; color: #CBD5E1;\">\n                                    <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                                        <span style=\"background: #3B82F6; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem;\">4/20</span>\n                                        alunos\n                                    </div>\n                                </td>\n                                <td style=\"padding: 1rem;\">\n                                    <span style=\"background: #059669; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">ðŸŸ¢ Ativa</span>\n                                </td>\n                                <td style=\"padding: 1rem;\">\n                                    <div style=\"display: flex; gap: 0.5rem;\">\n                                        <button onclick=\"viewClassDetails(1)\" class=\"btn btn-small btn-secondary\" style=\"padding: 0.25rem 0.5rem; font-size: 0.75rem;\">ðŸ‘ï¸ Ver</button>\n                                        <button onclick=\"manageClassSchedule(1)\" class=\"btn btn-small btn-primary\" style=\"padding: 0.25rem 0.5rem; font-size: 0.75rem;\">ðŸ“… Agenda</button>\n                                    </div>\n                                </td>\n                            </tr>\n                            <tr style=\"border-bottom: 1px solid #374151;\">\n                                <td style=\"padding: 1rem; color: #F8FAFC; font-weight: 600;\">\n                                    <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                                        <span style=\"background: #8B5CF6; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;\">T2</span>\n                                        Turma 2\n                                    </div>\n                                </td>\n                                <td style=\"padding: 1rem; color: #CBD5E1;\">Krav Maga</td>\n                                <td style=\"padding: 1rem; color: #CBD5E1;\">\n                                    <div>Seg/Qua - 19:00h</div>\n                                    <div style=\"font-size: 0.75rem; color: #94A3B8;\">InÃ­cio: 01/06/2025</div>\n                                </td>\n                                <td style=\"padding: 1rem; color: #CBD5E1;\">\n                                    <div style=\"display: flex; flex-wrap: wrap; gap: 0.25rem;\">\n                                        <span style=\"background: #FFFFFF; color: #000; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600;\">ðŸ¥‹ Branca</span>\n                                    </div>\n                                </td>\n                                <td style=\"padding: 1rem; color: #CBD5E1;\">\n                                    <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                                        <span style=\"background: #3B82F6; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem;\">2/20</span>\n                                        alunos\n                                    </div>\n                                </td>\n                                <td style=\"padding: 1rem;\">\n                                    <span style=\"background: #059669; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">ðŸŸ¢ Ativa</span>\n                                </td>\n                                <td style=\"padding: 1rem;\">\n                                    <div style=\"display: flex; gap: 0.5rem;\">\n                                        <button onclick=\"viewClassDetails(2)\" class=\"btn btn-small btn-secondary\" style=\"padding: 0.25rem 0.5rem; font-size: 0.75rem;\">ðŸ‘ï¸ Ver</button>\n                                        <button onclick=\"manageClassSchedule(2)\" class=\"btn btn-small btn-primary\" style=\"padding: 0.25rem 0.5rem; font-size: 0.75rem;\">ðŸ“… Agenda</button>\n                                    </div>\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            <!-- Today's Schedule -->\n            <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;\">\n                <div class=\"data-table\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">ðŸ“… Aulas de Hoje</div>\n                        <div class=\"table-actions\">\n                            <span style=\"color: #CBD5E1; font-size: 0.875rem;\">03/07/2025</span>\n                        </div>\n                    </div>\n                    <div style=\"padding: 1.5rem;\">\n                        <div style=\"display: flex; flex-direction: column; gap: 1rem;\">\n                            <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #3B82F6;\">\n                                <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                    <div style=\"color: #F8FAFC; font-weight: 600;\">Turma 1 - Krav Maga</div>\n                                    <span style=\"background: #3B82F6; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;\">18:00</span>\n                                </div>\n                                <div style=\"color: #CBD5E1; font-size: 0.875rem; margin-bottom: 0.75rem;\">\n                                    <div style=\"display: flex; flex-wrap: wrap; gap: 0.5rem;\">\n                                        <div style=\"background: rgba(255, 255, 255, 0.1); padding: 0.5rem; border-radius: 6px; flex: 1; min-width: 120px;\">\n                                            <div style=\"color: #FFFFFF; font-weight: 600; font-size: 0.75rem;\">ðŸ¤ Faixa Branca</div>\n                                            <div style=\"color: #D1FAE5; font-size: 0.7rem;\">Aula 16: Defesas vs Estrangulamento</div>\n                                        </div>\n                                        <div style=\"background: rgba(253, 224, 71, 0.2); padding: 0.5rem; border-radius: 6px; flex: 1; min-width: 120px;\">\n                                            <div style=\"color: #FDE047; font-weight: 600; font-size: 0.75rem;\">ðŸ’› Faixa Amarela</div>\n                                            <div style=\"color: #D1FAE5; font-size: 0.7rem;\">Aula 8: CombinaÃ§Ãµes de Golpes</div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div style=\"color: #94A3B8; font-size: 0.75rem;\">4 alunos confirmados (2 Branca + 2 Amarela)</div>\n                            </div>\n                            <div style=\"text-align: center; color: #6B7280; padding: 2rem;\">\n                                <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">ðŸ“…</div>\n                                <p>Apenas 1 aula agendada para hoje</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"data-table\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">ðŸ“Š EstatÃ­sticas Semanais</div>\n                    </div>\n                    <div style=\"padding: 1.5rem;\">\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;\">\n                            <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; text-align: center;\">\n                                <div style=\"font-size: 1.25rem; color: #10B981; margin-bottom: 0.5rem;\">87%</div>\n                                <div style=\"color: #CBD5E1; font-size: 0.875rem;\">FrequÃªncia Turma 1</div>\n                            </div>\n                            <div style=\"background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px; text-align: center;\">\n                                <div style=\"font-size: 1.25rem; color: #8B5CF6; margin-bottom: 0.5rem;\">83%</div>\n                                <div style=\"color: #CBD5E1; font-size: 0.875rem;\">FrequÃªncia Turma 2</div>\n                            </div>\n                        </div>\n                        \n                        <div style=\"margin-bottom: 1rem;\">\n                            <h4 style=\"color: #F8FAFC; margin-bottom: 0.5rem; font-size: 0.875rem;\">PrÃ³ximas AvaliaÃ§Ãµes por Faixa</h4>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem; line-height: 1.6;\">\n                                <div>â€¢ Faixa Branca: MÃ³dulo 2 (Semana 20)</div>\n                                <div>â€¢ Faixa Amarela: MÃ³dulo 1 (Semana 10)</div>\n                                <div>â€¢ Faixa Laranja: MÃ³dulo 3 (Semana 30)</div>\n                            </div>\n                        </div>\n                        \n                        <div>\n                            <h4 style=\"color: #F8FAFC; margin-bottom: 0.5rem; font-size: 0.875rem;\">Foco Semanal por Faixa</h4>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">\n                                <div style=\"background: rgba(255, 255, 255, 0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem;\">ðŸ¤ Branca: Defesas vs Estrangulamento</div>\n                                <div style=\"background: rgba(253, 224, 71, 0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem;\">ðŸ’› Amarela: CombinaÃ§Ãµes de Golpes</div>\n                                <div style=\"background: rgba(251, 146, 60, 0.1); padding: 0.5rem; border-radius: 4px;\">ðŸ§¡ Laranja: Defesas vs Armas</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Class Management Modals -->\n        <!-- Create/Edit Class Modal -->\n        <div id=\"classModal\" class=\"modal\" style=\"display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8);\">\n            <div class=\"modal-content\" style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); margin: 2% auto; padding: 0; border-radius: 16px; width: 95%; max-width: 800px; max-height: 90vh; overflow-y: auto; border: 1px solid #334155;\">\n                <!-- Modal Header -->\n                <div style=\"background: linear-gradient(135deg, #059669 0%, #10B981 100%); padding: 1.5rem 2rem; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center;\">\n                    <div>\n                        <h2 style=\"margin: 0; color: white; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;\">\n                            <span>ðŸ«</span>\n                            <span id=\"classModalTitle\">Nova Turma</span>\n                        </h2>\n                        <p style=\"margin: 0.5rem 0 0 0; color: rgba(255,255,255,0.8); font-size: 0.875rem;\">Configure horÃ¡rios, arte marcial e cursos inclusos</p>\n                    </div>\n                    <button onclick=\"closeClassModal()\" style=\"background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 1.5rem; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;\">\n                        âœ•\n                    </button>\n                </div>\n\n                <!-- Class Form -->\n                <form id=\"classForm\" style=\"padding: 2rem;\">\n                    <input type=\"hidden\" id=\"classId\">\n                    \n                    <!-- Basic Information -->\n                    <div class=\"form-section\" style=\"margin-bottom: 2rem;\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;\">\n                            <span>ðŸ“‹</span> InformaÃ§Ãµes BÃ¡sicas\n                        </h3>\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;\">\n                            <div class=\"form-group\">\n                                <label for=\"className\" style=\"display: block; margin-bottom: 0.5rem; color: #CBD5E1; font-weight: 600;\">Nome da Turma *</label>\n                                <input type=\"text\" id=\"className\" required style=\"width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC;\" placeholder=\"Ex: Turma 3\">\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"classMartialArt\" style=\"display: block; margin-bottom: 0.5rem; color: #CBD5E1; font-weight: 600;\">Arte Marcial *</label>\n                                <select id=\"classMartialArt\" required style=\"width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC;\">\n                                    <option value=\"\">Selecione a arte marcial</option>\n                                    <option value=\"KRAV_MAGA\">ðŸ¥Š Krav Maga</option>\n                                    <option value=\"JIU_JITSU\">ðŸ¥‹ Jiu-Jitsu</option>\n                                    <option value=\"BOXING\">ðŸ‘Š Boxe</option>\n                                    <option value=\"MUAY_THAI\">ðŸ¦µ Muay Thai</option>\n                                    <option value=\"KARATE\">ðŸ¥‹ KaratÃª</option>\n                                    <option value=\"TAEKWONDO\">ðŸ¦µ Taekwondo</option>\n                                </select>\n                            </div>\n                        </div>\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                            <div class=\"form-group\">\n                                <label for=\"classCapacity\" style=\"display: block; margin-bottom: 0.5rem; color: #CBD5E1; font-weight: 600;\">Capacidade MÃ¡xima</label>\n                                <input type=\"number\" id=\"classCapacity\" value=\"20\" min=\"5\" max=\"50\" style=\"width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC;\">\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"classInstructor\" style=\"display: block; margin-bottom: 0.5rem; color: #CBD5E1; font-weight: 600;\">Instrutor Principal</label>\n                                <input type=\"text\" id=\"classInstructor\" style=\"width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC;\" placeholder=\"Nome do instrutor\">\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Schedule Configuration -->\n                    <div class=\"form-section\" style=\"margin-bottom: 2rem;\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;\">\n                            <span>â°</span> ConfiguraÃ§Ã£o de HorÃ¡rios\n                        </h3>\n                        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 1rem;\">\n                            <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #3B82F6;\">\n                                <h4 style=\"color: #3B82F6; margin: 0 0 0.5rem 0; font-size: 0.875rem;\">Dias da Semana</h4>\n                                <div style=\"display: flex; flex-direction: column; gap: 0.5rem;\">\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                        <input type=\"checkbox\" id=\"classMon\" style=\"margin: 0;\">\n                                        Segunda\n                                    </label>\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                        <input type=\"checkbox\" id=\"classTue\" style=\"margin: 0;\">\n                                        TerÃ§a\n                                    </label>\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                        <input type=\"checkbox\" id=\"classWed\" style=\"margin: 0;\">\n                                        Quarta\n                                    </label>\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                        <input type=\"checkbox\" id=\"classThu\" style=\"margin: 0;\">\n                                        Quinta\n                                    </label>\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                        <input type=\"checkbox\" id=\"classFri\" style=\"margin: 0;\">\n                                        Sexta\n                                    </label>\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;\">\n                                        <input type=\"checkbox\" id=\"classSat\" style=\"margin: 0;\">\n                                        SÃ¡bado\n                                    </label>\n                                </div>\n                            </div>\n                            <div style=\"background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #F59E0B;\">\n                                <h4 style=\"color: #F59E0B; margin: 0 0 0.5rem 0; font-size: 0.875rem;\">HorÃ¡rio</h4>\n                                <div style=\"display: flex; flex-direction: column; gap: 0.5rem;\">\n                                    <label style=\"color: #CBD5E1; font-size: 0.875rem;\">InÃ­cio:</label>\n                                    <input type=\"time\" id=\"classStartTime\" value=\"18:00\" style=\"width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 6px; color: #F8FAFC;\">\n                                    <label style=\"color: #CBD5E1; font-size: 0.875rem;\">Fim:</label>\n                                    <input type=\"time\" id=\"classEndTime\" value=\"19:00\" style=\"width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 6px; color: #F8FAFC;\">\n                                </div>\n                            </div>\n                            <div style=\"background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #8B5CF6;\">\n                                <h4 style=\"color: #8B5CF6; margin: 0 0 0.5rem 0; font-size: 0.875rem;\">Data de InÃ­cio</h4>\n                                <input type=\"date\" id=\"classStartDate\" style=\"width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 6px; color: #F8FAFC; margin-bottom: 0.5rem;\">\n                                <label style=\"color: #CBD5E1; font-size: 0.875rem;\">DuraÃ§Ã£o (semanas):</label>\n                                <input type=\"number\" id=\"classDuration\" value=\"24\" min=\"4\" max=\"52\" style=\"width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 6px; color: #F8FAFC;\">\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Courses and Belts Included -->\n                    <div class=\"form-section\" style=\"margin-bottom: 2rem;\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;\">\n                            <span>ðŸ¥‹</span> Cursos/Faixas Inclusos na Turma\n                        </h3>\n                        <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #10B981; margin-bottom: 1rem;\">\n                            <h4 style=\"color: #10B981; margin: 0 0 0.5rem 0;\">ðŸ’¡ Conceito de Turma Multi-Faixa</h4>\n                            <p style=\"color: #D1FAE5; font-size: 0.875rem; margin: 0; line-height: 1.5;\">\n                                Uma turma pode ter alunos de diferentes faixas treinando simultaneamente. Cada faixa segue seu prÃ³prio cronograma de tÃ©cnicas, mas compartilha o mesmo horÃ¡rio e instrutor.\n                            </p>\n                        </div>\n                        <div id=\"includedCoursesContainer\" style=\"display: grid; gap: 1rem;\">\n                            <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #3B82F6;\">\n                                <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; margin-bottom: 0.5rem;\">\n                                    <input type=\"checkbox\" id=\"includeBranca\" checked>\n                                    <span style=\"font-weight: 600;\">ðŸ¤ Faixa Branca - Defesa Pessoal 1</span>\n                                </label>\n                                <div style=\"color: #94A3B8; font-size: 0.875rem; margin-left: 1.5rem;\">\n                                    48 aulas â€¢ TÃ©cnicas bÃ¡sicas de autodefesa â€¢ DuraÃ§Ã£o: 24 semanas\n                                </div>\n                            </div>\n                            <div style=\"background: rgba(253, 224, 71, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #FDE047;\">\n                                <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; margin-bottom: 0.5rem;\">\n                                    <input type=\"checkbox\" id=\"includeAmarela\">\n                                    <span style=\"font-weight: 600;\">ðŸ’› Faixa Amarela - CombinaÃ§Ãµes</span>\n                                </label>\n                                <div style=\"color: #94A3B8; font-size: 0.875rem; margin-left: 1.5rem;\">\n                                    36 aulas â€¢ CombinaÃ§Ãµes de golpes â€¢ DuraÃ§Ã£o: 18 semanas\n                                </div>\n                            </div>\n                            <div style=\"background: rgba(251, 146, 60, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #FB923C;\">\n                                <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; margin-bottom: 0.5rem;\">\n                                    <input type=\"checkbox\" id=\"includeLaranja\">\n                                    <span style=\"font-weight: 600;\">ðŸ§¡ Faixa Laranja - Defesas AvanÃ§adas</span>\n                                </label>\n                                <div style=\"color: #94A3B8; font-size: 0.875rem; margin-left: 1.5rem;\">\n                                    40 aulas â€¢ Defesas contra armas â€¢ DuraÃ§Ã£o: 20 semanas\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Form Actions -->\n                    <div style=\"display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #374151;\">\n                        <button type=\"button\" onclick=\"deleteClass()\" id=\"deleteClassBtn\" style=\"background: #DC2626; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; display: none;\">\n                            <span>ðŸ—‘ï¸</span> Deletar Turma\n                        </button>\n                        <div style=\"display: flex; gap: 1rem;\">\n                            <button type=\"button\" onclick=\"closeClassModal()\" style=\"background: #6B7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;\">\n                                Cancelar\n                            </button>\n                            <button type=\"submit\" style=\"background: linear-gradient(135deg, #059669, #10B981); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;\">\n                                <span>ðŸ’¾</span> Salvar Turma\n                            </button>\n                        </div>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n        <!-- Plan with Classes Modal -->\n        <div id=\"planClassesModal\" class=\"modal\" style=\"display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8);\">\n            <div class=\"modal-content\" style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); margin: 2% auto; padding: 0; border-radius: 16px; width: 95%; max-width: 700px; max-height: 90vh; overflow-y: auto; border: 1px solid #334155;\">\n                <!-- Modal Header -->\n                <div style=\"background: linear-gradient(135deg, #7C3AED 0%, #8B5CF6 100%); padding: 1.5rem 2rem; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center;\">\n                    <div>\n                        <h2 style=\"margin: 0; color: white; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;\">\n                            <span>ðŸ’Ž</span>\n                            <span>Plano Premium com Turmas Inclusas</span>\n                        </h2>\n                        <p style=\"margin: 0.5rem 0 0 0; color: rgba(255,255,255,0.8); font-size: 0.875rem;\">Configure quais turmas sÃ£o incluÃ­das automaticamente no plano</p>\n                    </div>\n                    <button onclick=\"closePlanClassesModal()\" style=\"background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 1.5rem; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;\">\n                        âœ•\n                    </button>\n                </div>\n\n                <!-- Plan Configuration -->\n                <div style=\"padding: 2rem;\">\n                    <form id=\"planClassesForm\">\n                        <input type=\"hidden\" id=\"planId\">\n                        \n                        <!-- Plan Basic Info -->\n                        <div style=\"background: rgba(139, 92, 246, 0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid #8B5CF6; margin-bottom: 2rem;\">\n                            <h3 style=\"color: #8B5CF6; margin: 0 0 1rem 0;\">ðŸ“‹ InformaÃ§Ãµes do Plano</h3>\n                            <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                                <div>\n                                    <label style=\"display: block; margin-bottom: 0.5rem; color: #CBD5E1; font-weight: 600;\">Nome do Plano *</label>\n                                    <input type=\"text\" id=\"planName\" required style=\"width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC;\" placeholder=\"Ex: Premium Multi-Turmas\">\n                                </div>\n                                <div>\n                                    <label style=\"display: block; margin-bottom: 0.5rem; color: #CBD5E1; font-weight: 600;\">PreÃ§o Mensal *</label>\n                                    <input type=\"number\" id=\"planPrice\" required step=\"0.01\" style=\"width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC;\" placeholder=\"R$ 200,00\">\n                                </div>\n                            </div>\n                            <div style=\"margin-top: 1rem;\">\n                                <label style=\"display: block; margin-bottom: 0.5rem; color: #CBD5E1; font-weight: 600;\">DescriÃ§Ã£o</label>\n                                <textarea id=\"planDescription\" rows=\"3\" style=\"width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC; resize: vertical;\" placeholder=\"Acesso ilimitado a mÃºltiplas turmas e faixas...\"></textarea>\n                            </div>\n                        </div>\n\n                        <!-- Included Classes Selection -->\n                        <div style=\"margin-bottom: 2rem;\">\n                            <h3 style=\"color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;\">\n                                <span>ðŸ«</span> Turmas IncluÃ­das no Plano\n                            </h3>\n                            <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #10B981; margin-bottom: 1rem;\">\n                                <h4 style=\"color: #10B981; margin: 0 0 0.5rem 0;\">ðŸ’¡ Auto-AtribuiÃ§Ã£o de Turmas</h4>\n                                <p style=\"color: #D1FAE5; font-size: 0.875rem; margin: 0; line-height: 1.5;\">\n                                    Quando um aluno receber este plano, serÃ¡ automaticamente inscrito nas turmas selecionadas abaixo. Turmas adicionais poderÃ£o ser incluÃ­das manualmente depois.\n                                </p>\n                            </div>\n                            \n                            <div id=\"availableClassesForPlan\" style=\"display: grid; gap: 1rem;\">\n                                <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #3B82F6;\">\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; margin-bottom: 0.5rem;\">\n                                        <input type=\"checkbox\" id=\"planIncludeClass1\" value=\"class1\">\n                                        <span style=\"font-weight: 600;\">ðŸ« Turma 1 - Krav Maga (Ter/Qui 18h)</span>\n                                    </label>\n                                    <div style=\"color: #94A3B8; font-size: 0.875rem; margin-left: 1.5rem;\">\n                                        Faixas: Branca, Amarela â€¢ 4 alunos ativos â€¢ Capacidade: 20\n                                    </div>\n                                </div>\n                                <div style=\"background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #8B5CF6;\">\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; margin-bottom: 0.5rem;\">\n                                        <input type=\"checkbox\" id=\"planIncludeClass2\" value=\"class2\">\n                                        <span style=\"font-weight: 600;\">ðŸ« Turma 2 - Krav Maga (Seg/Qua 19h)</span>\n                                    </label>\n                                    <div style=\"color: #94A3B8; font-size: 0.875rem; margin-left: 1.5rem;\">\n                                        Faixas: Branca, Laranja â€¢ 2 alunos ativos â€¢ Capacidade: 20\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Form Actions -->\n                        <div style=\"display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #374151;\">\n                            <div style=\"display: flex; gap: 1rem;\">\n                                <button type=\"button\" onclick=\"closePlanClassesModal()\" style=\"background: #6B7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;\">\n                                    Cancelar\n                                </button>\n                                <button type=\"submit\" style=\"background: linear-gradient(135deg, #7C3AED, #8B5CF6); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;\">\n                                    <span>ðŸ’Ž</span> Criar Plano Premium\n                                </button>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Evaluations -->\n        <div id=\"evaluations\" class=\"content-section\">\n            <div class=\"page-header\">\n                <h1>Sistema de AvaliaÃ§Ãµes</h1>\n                <p>AvaliaÃ§Ãµes e desempenho dos alunos</p>\n            </div>\n            \n            <div class=\"data-table\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">AvaliaÃ§Ãµes Registradas</div>\n                </div>\n                <div style=\"color: #CBD5E1;\">\n                    <p><strong>Maria Silva</strong></p>\n                    <p>â€¢ Aula 10: 85.5% de precisÃ£o</p>\n                    <p>â€¢ Status: AUTONOMIA</p>\n                    <p>â€¢ TÃ©cnicas avaliadas: 8</p>\n                    <br>\n                    <p><em>Outras avaliaÃ§Ãµes serÃ£o exibidas aqui conforme forem registradas.</em></p>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Progress -->\n        <div id=\"progress\" class=\"content-section\">\n            <div class=\"page-header\">\n                <h1>Progresso dos Alunos</h1>\n                <p>Acompanhamento de evoluÃ§Ã£o individual</p>\n            </div>\n            \n            <div class=\"data-table\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">Progresso Individual</div>\n                </div>\n                <div style=\"color: #CBD5E1;\">\n                    <p><strong>Ana Oliveira</strong></p>\n                    <p>â€¢ TÃ©cnicas dominadas: 5</p>\n                    <p>â€¢ Pontos acumulados: 65</p>\n                    <p>â€¢ Desafios completados: 2</p>\n                    <br>\n                    <p><em>Outros progressos serÃ£o exibidos conforme registrados.</em></p>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Financial Module -->\n        <div id=\"financial\" class=\"content-section\">\n            <div class=\"page-header\">\n                <h1>ðŸ’° GestÃ£o Financeira</h1>\n                <p>Controle de recebimentos, gastos, fluxo de caixa e relatÃ³rios financeiros</p>\n            </div>\n\n            <!-- Financial Overview Cards -->\n            <div class=\"metric-grid\" style=\"margin-bottom: 2rem;\">\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\" id=\"total-revenue\">R$ 0</div>\n                    <div class=\"metric-label\">Receita Total</div>\n                    <div class=\"metric-trend positive\">\n                        <span>â†—</span> +0% este mÃªs\n                    </div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\" id=\"active-subscriptions\">0</div>\n                    <div class=\"metric-label\">Assinaturas Ativas</div>\n                    <div class=\"metric-trend positive\">\n                        <span>â†—</span> 100% pagamento\n                    </div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\" id=\"pending-payments\">0</div>\n                    <div class=\"metric-label\">Pendentes</div>\n                    <div class=\"metric-trend neutral\">\n                        <span>â†’</span> 0 em atraso\n                    </div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\" id=\"total-plans\">0</div>\n                    <div class=\"metric-label\">Planos Ativos</div>\n                    <div class=\"metric-trend positive\">\n                        <span>â†—</span> DisponÃ­veis\n                    </div>\n                </div>\n            </div>\n\n            <!-- Financial Tabs -->\n            <div class=\"financial-tabs\" style=\"margin-bottom: 2rem;\">\n                <button class=\"financial-tab active\" onclick=\"switchFinancialTab('revenues')\">\n                    ðŸ’° Recebimentos\n                </button>\n                <button class=\"financial-tab\" onclick=\"switchFinancialTab('expenses')\">\n                    ðŸ’¸ Gastos\n                </button>\n                <button class=\"financial-tab\" onclick=\"switchFinancialTab('payments')\">\n                    ðŸ’³ Pagamentos\n                </button>\n                <button class=\"financial-tab\" onclick=\"switchFinancialTab('settings')\">\n                    âš™ï¸ ConfiguraÃ§Ãµes\n                </button>\n            </div>\n\n            <!-- Revenues Management -->\n            <div id=\"financial-revenues\" class=\"financial-tab-content active\">\n                <div class=\"data-table\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">ðŸ’° Controle de Recebimentos</div>\n                        <div class=\"table-actions\">\n                            <button class=\"btn btn-primary\" onclick=\"openAddRevenueModal()\">\n                                <span>âž•</span>\n                                Novo Recebimento\n                            </button>\n                        </div>\n                    </div>\n                    \n                    <table class=\"students-table\">\n                        <thead>\n                            <tr>\n                                <th>Data</th>\n                                <th>DescriÃ§Ã£o</th>\n                                <th>Categoria</th>\n                                <th>Aluno/Cliente</th>\n                                <th>Valor</th>\n                                <th>Status</th>\n                                <th>AÃ§Ãµes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"revenuesTableBody\">\n                            <tr>\n                                <td colspan=\"7\" style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                                    ðŸ’° MÃ³dulo de Recebimentos em desenvolvimento\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            <!-- Expenses Management -->\n            <div id=\"financial-expenses\" class=\"financial-tab-content\" style=\"display: none;\">\n                <div class=\"data-table\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">ðŸ’¸ Controle de Gastos</div>\n                        <div class=\"table-actions\">\n                            <button class=\"btn btn-primary\" onclick=\"openAddExpenseModal()\">\n                                <span>âž•</span>\n                                Novo Gasto\n                            </button>\n                        </div>\n                    </div>\n                    \n                    <table class=\"students-table\">\n                        <thead>\n                            <tr>\n                                <th>Categoria</th>\n                                <th>DescriÃ§Ã£o</th>\n                                <th>Valor</th>\n                                <th>PrÃ³ximo Vencimento</th>\n                                <th>Status</th>\n                                <th>AÃ§Ãµes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"expensesTableBody\">\n                            <tr>\n                                <td colspan=\"6\" style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                                    Nenhum gasto registrado\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            <!-- Payments Management -->\n            <div id=\"financial-payments\" class=\"financial-tab-content\" style=\"display: none;\">\n                <div class=\"data-table\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">ðŸ’³ Controle de Pagamentos</div>\n                    </div>\n                    \n                    <table class=\"students-table\">\n                        <thead>\n                            <tr>\n                                <th>Data</th>\n                                <th>Aluno</th>\n                                <th>Valor</th>\n                                <th>Status</th>\n                                <th>MÃ©todo</th>\n                                <th>AÃ§Ãµes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"paymentsTableBody\">\n                            <tr>\n                                <td colspan=\"6\" style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                                    Carregando pagamentos...\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            <!-- Financial Settings -->\n            <div id=\"financial-settings\" class=\"financial-tab-content\" style=\"display: none;\">\n                <div class=\"settings-section\">\n                    <h3>âš™ï¸ ConfiguraÃ§Ãµes Financeiras</h3>\n                    \n                    <div class=\"form-group\">\n                        <label>IntegraÃ§Ã£o de Pagamento</label>\n                        <select class=\"form-input\">\n                            <option value=\"asaas\">Asaas</option>\n                            <option value=\"stripe\">Stripe</option>\n                            <option value=\"pagseguro\">PagSeguro</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label>Dias para Vencimento</label>\n                        <input type=\"number\" class=\"form-input\" value=\"5\" min=\"1\" max=\"30\">\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label>Multa por Atraso (%)</label>\n                        <input type=\"number\" class=\"form-input\" value=\"2\" min=\"0\" max=\"10\" step=\"0.1\">\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label>Juros por Dia (%)</label>\n                        <input type=\"number\" class=\"form-input\" value=\"0.033\" min=\"0\" max=\"1\" step=\"0.001\">\n                    </div>\n                    \n                    <button class=\"btn btn-primary\">Salvar ConfiguraÃ§Ãµes</button>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Challenges -->\n        <div id=\"challenges\" class=\"content-section\">\n            <div class=\"page-header\">\n                <h1>Desafios Semanais</h1>\n                <p>Sistema de desafios e gamificaÃ§Ã£o</p>\n            </div>\n            \n            <div class=\"data-table\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">Desafios DisponÃ­veis</div>\n                </div>\n                <div style=\"color: #CBD5E1;\">\n                    <p>â€¢ 24 desafios catalogados</p>\n                    <p>â€¢ Adaptados por categoria e gÃªnero</p>\n                    <p>â€¢ Sistema de pontos integrado</p>\n                    <br>\n                    <p><em>Interface de desafios em desenvolvimento.</em></p>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Knowledge Base -->\n        <div id=\"knowledge-base\" class=\"content-section\">\n            <div class=\"page-header\">\n                <h1>ðŸ§  Base de Conhecimento</h1>\n                <p>MemÃ³ria central dos agentes IA - Upload de documentos, textos, links e vÃ­deos</p>\n            </div>\n            \n            <div style=\"display: grid; gap: 1.5rem;\">\n                <!-- Knowledge Base Stats -->\n                <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;\">\n                    <div style=\"background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #8B5CF6;\">\n                        <div style=\"color: #8B5CF6; font-weight: bold; margin-bottom: 0.5rem;\">ðŸ“š Documentos</div>\n                        <div style=\"color: #F8FAFC; font-size: 1.5rem; font-weight: bold;\" id=\"knowledgeStatsDocuments\">0</div>\n                    </div>\n                    <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #10B981;\">\n                        <div style=\"color: #10B981; font-weight: bold; margin-bottom: 0.5rem;\">ðŸ•°ï¸ Chunks RAG</div>\n                        <div style=\"color: #F8FAFC; font-size: 1.5rem; font-weight: bold;\" id=\"knowledgeStatsChunks\">0</div>\n                    </div>\n                    <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #3B82F6;\">\n                        <div style=\"color: #3B82F6; font-weight: bold; margin-bottom: 0.5rem;\">â±ï¸ Ãšltima IndexaÃ§Ã£o</div>\n                        <div style=\"color: #F8FAFC; font-size: 0.875rem;\" id=\"knowledgeStatsLastUpdate\">Nunca</div>\n                    </div>\n                    <div style=\"background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #F59E0B;\">\n                        <div style=\"color: #F59E0B; font-weight: bold; margin-bottom: 0.5rem;\">âš™ï¸ Status RAG</div>\n                        <div style=\"color: #F8FAFC; font-size: 0.875rem;\" id=\"knowledgeStatsStatus\">Vazio</div>\n                    </div>\n                </div>\n                \n                <!-- Action Buttons -->\n                <div style=\"display: flex; gap: 1rem; flex-wrap: wrap;\">\n                    <button class=\"btn btn-primary\" onclick=\"openKnowledgeUploader()\">\n                        <span>âž•</span> Adicionar ConteÃºdo\n                    </button>\n                    <button class=\"btn btn-success\" onclick=\"reindexKnowledgeBase()\">\n                        <span>âš¡</span> Reindexar Base\n                    </button>\n                    <button class=\"btn btn-info\" onclick=\"testRAGSystem()\">\n                        <span>ðŸ—ºï¸</span> Testar RAG\n                    </button>\n                    <button class=\"btn btn-secondary\" onclick=\"searchKnowledgeBase()\">\n                        <span>ðŸ”</span> Buscar\n                    </button>\n                </div>\n                \n                <!-- Knowledge Base Content -->\n                <div class=\"data-table\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">ConteÃºdo da Base de Conhecimento</div>\n                        <div style=\"display: flex; gap: 0.5rem; align-items: center;\">\n                            <input type=\"text\" id=\"knowledgeSearchInput\" placeholder=\"Buscar na base...\" style=\"padding: 0.5rem; border-radius: 4px; border: 1px solid #374151; background: #1F2937; color: #F8FAFC; width: 200px;\" onkeyup=\"if(event.key==='Enter') searchKnowledgeBase()\">\n                            <button class=\"btn btn-sm btn-primary\" onclick=\"searchKnowledgeBase()\">ðŸ”</button>\n                        </div>\n                    </div>\n                    <div id=\"knowledgeContentDisplay\" style=\"min-height: 300px;\">\n                        <div style=\"text-align: center; color: #9CA3AF; padding: 3rem;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“š</div>\n                            <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Base de Conhecimento Vazia</div>\n                            <div style=\"font-size: 0.9rem;\">Adicione documentos, textos, links ou vÃ­deos para comeÃ§ar</div>\n                            <div style=\"margin-top: 1rem;\">\n                                <button class=\"btn btn-primary\" onclick=\"openKnowledgeUploader()\">\n                                    âž• Adicionar Primeiro ConteÃºdo\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Financial Responsibles -->\n        <div id=\"financial-responsibles\" class=\"content-section\">\n            <div class=\"page-header\">\n                <h1>ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ ResponsÃ¡veis Financeiros</h1>\n                <p>GestÃ£o de responsÃ¡veis financeiros dos alunos</p>\n            </div>\n\n            <!-- Quick Stats -->\n            <div class=\"stats-grid\" style=\"margin-bottom: 2rem;\">\n                <div class=\"stat-card\">\n                    <div class=\"stat-value\" id=\"totalResponsibles\">0</div>\n                    <div class=\"stat-label\">Total de ResponsÃ¡veis</div>\n                </div>\n                <div class=\"stat-card\">\n                    <div class=\"stat-value\" id=\"activeResponsibles\">0</div>\n                    <div class=\"stat-label\">Ativos</div>\n                </div>\n                <div class=\"stat-card\">\n                    <div class=\"stat-value\" id=\"studentsWithResponsibles\">0</div>\n                    <div class=\"stat-label\">Alunos com ResponsÃ¡vel</div>\n                </div>\n                <div class=\"stat-card\">\n                    <div class=\"stat-value\" id=\"avgStudentsPerResponsible\">0</div>\n                    <div class=\"stat-label\">MÃ©dia p/ ResponsÃ¡vel</div>\n                </div>\n            </div>\n\n            <!-- Search and Actions -->\n            <div class=\"simple-search\">\n                <input type=\"text\" \n                       id=\"responsibleSearch\" \n                       class=\"search-input\"\n                       placeholder=\"ðŸ” Buscar por nome, CPF, email...\" \n                       onkeyup=\"filterResponsibles()\"\n                       autocomplete=\"off\">\n                \n                <button class=\"btn btn-primary\" onclick=\"openAddResponsibleModal()\">\n                    <span>âž•</span>\n                    Novo ResponsÃ¡vel\n                </button>\n            </div>\n            \n            <!-- Responsibles Table -->\n            <div class=\"data-table\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">Lista de ResponsÃ¡veis Financeiros</div>\n                </div>\n                <div class=\"responsibles-table-container\">\n                    <table class=\"students-table\">\n                        <thead>\n                            <tr>\n                                <th>Nome</th>\n                                <th>CPF/CNPJ</th>\n                                <th>Email</th>\n                                <th>Telefone</th>\n                                <th>RelaÃ§Ã£o</th>\n                                <th>Alunos</th>\n                                <th>AÃ§Ãµes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"responsiblesTableBody\">\n                            <!-- Responsibles will be loaded here -->\n                        </tbody>\n                    </table>\n                </div>\n                <div id=\"responsiblesLoadingState\" class=\"loading-state\">\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦</div>\n                        <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Carregando responsÃ¡veis...</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7;\">Conectando com a base de dados</div>\n                    </div>\n                </div>\n                <div id=\"responsiblesEmptyState\" class=\"empty-state\" style=\"display: none;\">\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                        <div style=\"font-size: 3rem; margin-bottom: 1rem;\">ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦</div>\n                        <div style=\"font-size: 1.2rem; margin-bottom: 0.5rem;\">Nenhum responsÃ¡vel encontrado</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;\">Comece adicionando o primeiro responsÃ¡vel financeiro</div>\n                        <button class=\"btn btn-primary\" onclick=\"openAddResponsibleModal()\">\n                            <span>âž•</span>\n                            Adicionar Primeiro ResponsÃ¡vel\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Payment Plans -->\n        <!-- Payment Plans Management -->\n        <div id=\"payment-plans\" class=\"content-section\">\n            <!-- Modern Page Header -->\n            <div class=\"page-header\" style=\"background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                    <div>\n                        <h1 style=\"margin: 0; font-size: 2rem; background: linear-gradient(135deg, #FFFFFF, #F3E8FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\">ðŸ“„ Planos da Academia</h1>\n                        <p style=\"margin: 0.5rem 0 0 0; color: #F3E8FF; font-size: 1.1rem;\">Gerencie os planos de curso oferecidos pela academia - valores, categorias e condiÃ§Ãµes</p>\n                    </div>\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button class=\"btn btn-primary\" onclick=\"openAddPlanModal()\" style=\"background: linear-gradient(135deg, #059669, #10B981); border: none; padding: 0.75rem 1.5rem;\">\n                            <span>âž•</span> Novo Plano\n                        </button>\n                        <button class=\"btn btn-secondary\" onclick=\"loadPaymentPlansList()\" style=\"padding: 0.75rem 1.5rem;\">\n                            <span>ðŸ”„</span> Atualizar\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Quick Stats -->\n                <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;\">\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #FFFFFF;\" id=\"totalPlansCount\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #F3E8FF;\">Total Planos</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #FFFFFF;\" id=\"activePlansCount\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #F3E8FF;\">Ativos</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #FFFFFF;\" id=\"avgPlanPrice\">R$ 0</div>\n                        <div style=\"font-size: 0.875rem; color: #F3E8FF;\">Valor MÃ©dio</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #FFFFFF;\" id=\"monthlyPlansCount\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #F3E8FF;\">Mensais</div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Search and Filters -->\n            <div class=\"data-controls\" style=\"display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center;\">\n                <div style=\"flex: 1; position: relative;\">\n                    <input type=\"text\" id=\"planSearchInput\" placeholder=\"ðŸ” Buscar planos...\" \n                           style=\"width: 100%; padding: 0.75rem 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 12px; color: #F8FAFC; font-size: 0.875rem;\"\n                           onkeyup=\"filterPlans()\">\n                </div>\n                <select id=\"categoryFilterSelect\" onchange=\"filterPlans()\" \n                        style=\"padding: 0.75rem 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC; font-size: 0.875rem;\">\n                    <option value=\"\">Todas Categorias</option>\n                    <option value=\"ADULT\">Adulto</option>\n                    <option value=\"CHILD\">Infantil</option>\n                    <option value=\"SENIOR\">Senior</option>\n                    <option value=\"FEMALE\">Feminino</option>\n                </select>\n                <select id=\"billingTypeFilter\" onchange=\"filterPlans()\" \n                        style=\"padding: 0.75rem 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC; font-size: 0.875rem;\">\n                    <option value=\"\">Todos Tipos</option>\n                    <option value=\"MONTHLY\">Mensal</option>\n                    <option value=\"QUARTERLY\">Trimestral</option>\n                    <option value=\"YEARLY\">Anual</option>\n                    <option value=\"CREDIT_CARD_INSTALLMENT\">CartÃ£o Parcelado</option>\n                </select>\n                <button class=\"btn btn-primary\" onclick=\"openAddPlanPage()\" style=\"background: linear-gradient(135deg, #8B5CF6, #EC4899); padding: 0.75rem 1.5rem;\">\n                    <span>âž•</span> Novo Plano\n                </button>\n            </div>\n\n            <!-- Plans Table -->\n            <div class=\"data-table\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">ðŸ“„ Planos de Curso da Academia</div>\n                    <div class=\"table-actions\">\n                        <span style=\"color: #CBD5E1; font-size: 0.875rem;\" id=\"plansCountText\">Carregando...</span>\n                    </div>\n                </div>\n                \n                <div style=\"overflow-x: auto;\">\n                    <table style=\"width: 100%; border-collapse: collapse;\">\n                        <thead>\n                            <tr style=\"background: #1E293B; border-bottom: 1px solid #374151;\">\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Plano</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Curso</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Categoria</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Valor</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Tipo</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Aulas/Semana</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">Status</th>\n                                <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;\">AÃ§Ãµes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"plansTableBody\">\n                            <!-- Plans will be loaded here -->\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            <!-- Loading State -->\n            <div id=\"plansLoadingState\" class=\"loading-state\">\n                <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                    <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“„</div>\n                    <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Carregando planos...</div>\n                    <div style=\"font-size: 0.9rem; opacity: 0.7;\">Conectando com a base de dados</div>\n                </div>\n            </div>\n\n            <!-- Empty State -->\n            <div id=\"plansEmptyState\" class=\"empty-state\" style=\"display: none;\">\n                <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                    <div style=\"font-size: 3rem; margin-bottom: 1rem;\">ðŸ“„</div>\n                    <div style=\"font-size: 1.2rem; margin-bottom: 0.5rem;\">Nenhum plano encontrado</div>\n                    <div style=\"font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;\">Comece criando o primeiro plano de pagamento</div>\n                    <button class=\"btn btn-primary\" onclick=\"openAddPlanPage()\">\n                        <span>âž•</span> Criar Primeiro Plano\n                    </button>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Plan Edit Page -->\n        <div id=\"plan-edit\" class=\"content-section\" style=\"display: none;\">\n            <div class=\"page-header\" style=\"background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                    <div>\n                        <h1 style=\"margin: 0; font-size: 2rem; background: linear-gradient(135deg, #FFFFFF, #F3E8FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\">âœï¸ Editar Plano</h1>\n                        <p style=\"margin: 0.5rem 0 0 0; color: #F3E8FF; font-size: 1.1rem;\" id=\"planEditSubtitle\">Edite as informaÃ§Ãµes do plano selecionado</p>\n                    </div>\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button class=\"btn btn-secondary\" onclick=\"backToPlans()\" style=\"padding: 0.75rem 1.5rem;\">\n                            <span>â†</span> Voltar\n                        </button>\n                        <button class=\"btn btn-primary\" onclick=\"savePlanChanges()\" style=\"background: linear-gradient(135deg, #059669, #10B981); border: none; padding: 0.75rem 1.5rem;\">\n                            <span>ðŸ’¾</span> Salvar\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Plan Edit Form with Tabs -->\n            <div class=\"form-container\" style=\"background: rgba(15, 23, 42, 0.6); border-radius: 16px; padding: 2rem; border: 1px solid rgba(51, 65, 85, 0.8);\">\n                \n                <!-- Tab Navigation -->\n                <div class=\"plan-tabs\" style=\"margin-bottom: 2rem;\">\n                    <button type=\"button\" class=\"plan-tab active\" onclick=\"switchPlanEditTab('basic')\" data-tab=\"basic\">\n                        ðŸ“‹ InformaÃ§Ãµes BÃ¡sicas\n                    </button>\n                    <button type=\"button\" class=\"plan-tab\" onclick=\"switchPlanEditTab('courses')\" data-tab=\"courses\">\n                        ðŸŽ“ Cursos Associados\n                    </button>\n                    <button type=\"button\" class=\"plan-tab\" onclick=\"switchPlanEditTab('advanced')\" data-tab=\"advanced\">\n                        âš™ï¸ ConfiguraÃ§Ãµes\n                    </button>\n                    <button type=\"button\" class=\"plan-tab\" onclick=\"switchPlanEditTab('preview')\" data-tab=\"preview\">\n                        ðŸ‘ï¸ Preview\n                    </button>\n                </div>\n\n                <form id=\"planEditForm\">\n                    <!-- Tab 1: Basic Information -->\n                    <div id=\"planEditTab-basic\" class=\"plan-tab-content active\">\n                        <div class=\"tab-header\" style=\"text-align: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(148, 163, 184, 0.2);\">\n                            <h3 style=\"color: #3B82F6; margin-bottom: 0.5rem; font-size: 1.5rem;\">ðŸ“‹ InformaÃ§Ãµes BÃ¡sicas do Plano</h3>\n                            <p style=\"color: #94A3B8; margin: 0;\">Configure os dados fundamentais do seu plano de pagamento</p>\n                        </div>\n                        \n                        <div class=\"form-grid\" style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;\">\n                            <div class=\"form-group\">\n                                <label class=\"form-label\">Nome do Plano *</label>\n                                <input type=\"text\" class=\"form-input\" id=\"editPlanName\" placeholder=\"Ex: Plano Premium Krav Maga\" required>\n                                <small class=\"form-hint\">ðŸ”„ SerÃ¡ gerado automaticamente baseado nos cursos selecionados</small>\n                            </div>\n                            \n                            <div class=\"form-group\">\n                                <label class=\"form-label\">Categoria *</label>\n                                <select class=\"form-select\" id=\"editPlanCategory\" required onchange=\"updatePlanEditPreview()\">\n                                    <option value=\"\">Selecione uma categoria...</option>\n                                    <option value=\"ADULT\">ðŸ‘¨ Adulto</option>\n                                    <option value=\"FEMALE\">ðŸ‘© Feminino</option>\n                                    <option value=\"SENIOR\">ðŸ‘´ Senior/Idoso</option>\n                                    <option value=\"CHILD\">ðŸ§’ Infantil/CrianÃ§a</option>\n                                    <option value=\"INICIANTE1\">ðŸ¥‰ Iniciante 1</option>\n                                    <option value=\"INICIANTE2\">ðŸ¥‰ Iniciante 2</option>\n                                    <option value=\"INICIANTE3\">ðŸ¥‰ Iniciante 3</option>\n                                    <option value=\"HEROI1\">ðŸ¥ˆ HerÃ³i 1</option>\n                                    <option value=\"HEROI2\">ðŸ¥ˆ HerÃ³i 2</option>\n                                    <option value=\"HEROI3\">ðŸ¥ˆ HerÃ³i 3</option>\n                                    <option value=\"MASTER_1\">ðŸ¥‡ Master 1</option>\n                                    <option value=\"MASTER_2\">ðŸ¥‡ Master 2</option>\n                                    <option value=\"MASTER_3\">ðŸ¥‡ Master 3</option>\n                                </select>\n                            </div>\n                            \n                            <div class=\"form-group\">\n                                <label class=\"form-label\">Valor do Plano *</label>\n                                <input type=\"number\" class=\"form-input\" id=\"editPlanPrice\" step=\"0.01\" placeholder=\"R$ 0,00\" required>\n                                <small class=\"form-hint\">ðŸ’° Insira o valor do plano conforme sua estratÃ©gia de preÃ§os</small>\n                            </div>\n                            \n                            <div class=\"form-group\">\n                                <label class=\"form-label\">Tipo de CobranÃ§a *</label>\n                                <select class=\"form-select\" id=\"editPlanBillingType\" required onchange=\"updatePlanEditPreview()\">\n                                    <option value=\"MONTHLY\">ðŸ’³ Mensal</option>\n                                    <option value=\"WEEKLY\">ðŸ“… Semanal</option>\n                                    <option value=\"QUARTERLY\">ðŸ“Š Trimestral</option>\n                                    <option value=\"YEARLY\">ðŸ—“ï¸ Anual</option>\n                                </select>\n                            </div>\n                        </div>\n                        \n                        <div class=\"form-group\" style=\"grid-column: 1 / -1;\">\n                            <label class=\"form-label\">DescriÃ§Ã£o do Plano</label>\n                            <textarea class=\"form-input\" id=\"editPlanDescription\" rows=\"3\" placeholder=\"DescriÃ§Ã£o detalhada dos benefÃ­cios e caracterÃ­sticas do plano...\"></textarea>\n                        </div>\n                        \n                        <div class=\"tab-navigation\" style=\"display: flex; justify-content: space-between; align-items: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(148, 163, 184, 0.2);\">\n                            <div></div>\n                            <button type=\"button\" class=\"btn btn-primary\" onclick=\"switchPlanEditTab('courses')\" style=\"min-width: 200px;\">\n                                PrÃ³ximo: Cursos Associados â†’\n                            </button>\n                        </div>\n                    </div>\n                    \n                    <!-- Tab 2: Associated Courses -->\n                    <div id=\"planEditTab-courses\" class=\"plan-tab-content\">\n                        <div class=\"tab-header\" style=\"text-align: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(148, 163, 184, 0.2);\">\n                            <h3 style=\"color: #3B82F6; margin-bottom: 0.5rem; font-size: 1.5rem;\">ðŸŽ“ Cursos Associados ao Plano</h3>\n                            <p style=\"color: #94A3B8; margin: 0;\">Selecione todos os cursos que estarÃ£o inclusos neste plano</p>\n                        </div>\n                        \n                        <div class=\"courses-selection-container\">\n                            <div class=\"selection-header\">\n                                <div class=\"selection-stats\">\n                                    <span class=\"stat-badge\" id=\"editCoursesSelectedCount\">0 cursos selecionados</span>\n                                    <span class=\"stat-badge\" id=\"editCoursesTotalCount\">0 cursos disponÃ­veis</span>\n                                </div>\n                                <div class=\"selection-actions\">\n                                    <button type=\"button\" class=\"btn btn-sm btn-outline\" onclick=\"selectAllEditCourses()\">Selecionar Todos</button>\n                                    <button type=\"button\" class=\"btn btn-sm btn-outline\" onclick=\"clearAllEditCourses()\">Limpar SeleÃ§Ã£o</button>\n                                </div>\n                            </div>\n                            \n                            <div class=\"courses-grid\" id=\"editCoursesGrid\">\n                                <!-- Courses will be loaded here dynamically -->\n                                <div class=\"loading-state\">\n                                    <div class=\"spinner\"></div>\n                                    <p>Carregando cursos disponÃ­veis...</p>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"tab-navigation\" style=\"display: flex; justify-content: space-between; align-items: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(148, 163, 184, 0.2);\">\n                            <button type=\"button\" class=\"btn btn-secondary\" onclick=\"switchPlanEditTab('basic')\" style=\"min-width: 200px;\">\n                                â† Voltar: InformaÃ§Ãµes BÃ¡sicas\n                            </button>\n                            <button type=\"button\" class=\"btn btn-primary\" onclick=\"switchPlanEditTab('advanced')\" style=\"min-width: 200px;\">\n                                PrÃ³ximo: ConfiguraÃ§Ãµes â†’\n                            </button>\n                        </div>\n                    </div>\n                    \n                    <!-- Tab 3: Advanced Configuration -->\n                    <div id=\"planEditTab-advanced\" class=\"plan-tab-content\">\n                        <div class=\"tab-header\" style=\"text-align: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(148, 163, 184, 0.2);\">\n                            <h3 style=\"color: #3B82F6; margin-bottom: 0.5rem; font-size: 1.5rem;\">âš™ï¸ ConfiguraÃ§Ãµes AvanÃ§adas</h3>\n                            <p style=\"color: #94A3B8; margin: 0;\">Configure recursos especiais e limitaÃ§Ãµes do plano</p>\n                        </div>\n                        \n                        <div class=\"form-grid\" style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;\">\n                            <div class=\"form-group\">\n                                <label class=\"form-label\">Aulas por Semana</label>\n                                <select class=\"form-select\" id=\"editPlanClassesPerWeek\">\n                                    <option value=\"1\">1 aula por semana</option>\n                                    <option value=\"2\" selected>2 aulas por semana</option>\n                                    <option value=\"3\">3 aulas por semana</option>\n                                    <option value=\"4\">4 aulas por semana</option>\n                                    <option value=\"5\">5 aulas por semana</option>\n                                    <option value=\"unlimited\">â™¾ï¸ Ilimitado</option>\n                                </select>\n                            </div>\n                            \n                            <div class=\"form-group\">\n                                <label class=\"form-label\">MÃ¡ximo de Aulas por MÃªs</label>\n                                <input type=\"number\" class=\"form-input\" id=\"editPlanMaxClasses\" min=\"1\" max=\"50\" placeholder=\"Ex: 8 aulas\">\n                                <small class=\"form-hint\">Deixe em branco para ilimitado</small>\n                            </div>\n                        </div>\n                        \n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Recursos Extras</label>\n                            <div class=\"extras-grid\">\n                                <label class=\"checkbox-label\">\n                                    <input type=\"checkbox\" id=\"editPlanPersonalTraining\"> \n                                    ðŸ’ª Personal Training\n                                </label>\n                                <label class=\"checkbox-label\">\n                                    <input type=\"checkbox\" id=\"editPlanNutrition\"> \n                                    ðŸ¥— Plano Nutricional\n                                </label>\n                                <label class=\"checkbox-label\">\n                                    <input type=\"checkbox\" id=\"editPlanAllModalities\"> \n                                    ðŸ¥‹ Todas Modalidades\n                                </label>\n                                <label class=\"checkbox-label\">\n                                    <input type=\"checkbox\" id=\"editPlanFreezeOption\"> \n                                    â„ï¸ Permite Congelar\n                                </label>\n                            </div>\n                        </div>\n                        \n                        <div class=\"tab-navigation\" style=\"display: flex; justify-content: space-between; align-items: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(148, 163, 184, 0.2);\">\n                            <button type=\"button\" class=\"btn btn-secondary\" onclick=\"switchPlanEditTab('courses')\" style=\"min-width: 200px;\">\n                                â† Voltar: Cursos Associados\n                            </button>\n                            <button type=\"button\" class=\"btn btn-primary\" onclick=\"switchPlanEditTab('preview')\" style=\"min-width: 200px;\">\n                                PrÃ³ximo: Preview â†’\n                            </button>\n                        </div>\n                    </div>\n                    \n                    <!-- Tab 4: Preview -->\n                    <div id=\"planEditTab-preview\" class=\"plan-tab-content\">\n                        <div class=\"tab-header\" style=\"text-align: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(148, 163, 184, 0.2);\">\n                            <h3 style=\"color: #3B82F6; margin-bottom: 0.5rem; font-size: 1.5rem;\">ðŸ‘ï¸ Preview do Plano</h3>\n                            <p style=\"color: #94A3B8; margin: 0;\">Visualize como o plano ficarÃ¡ antes de salvar</p>\n                        </div>\n                        \n                        <div id=\"editPlanPreview\" class=\"preview-container\">\n                            <div class=\"preview-card\">\n                                <div class=\"preview-header\">\n                                    <h4 id=\"editPreviewPlanName\">Nome do Plano</h4>\n                                    <div class=\"preview-price\" id=\"editPreviewPlanPrice\">R$ 0,00</div>\n                                </div>\n                                <div class=\"preview-body\">\n                                    <p id=\"editPreviewPlanDescription\">DescriÃ§Ã£o do plano</p>\n                                    <div class=\"preview-details\">\n                                        <div class=\"detail-item\">\n                                            <span class=\"detail-label\">Categoria:</span>\n                                            <span class=\"detail-value\" id=\"editPreviewCategory\">-</span>\n                                        </div>\n                                        <div class=\"detail-item\">\n                                            <span class=\"detail-label\">Tipo de CobranÃ§a:</span>\n                                            <span class=\"detail-value\" id=\"editPreviewBillingType\">-</span>\n                                        </div>\n                                        <div class=\"detail-item\">\n                                            <span class=\"detail-label\">Cursos Inclusos:</span>\n                                            <span class=\"detail-value\" id=\"editPreviewCourses\">-</span>\n                                        </div>\n                                        <div class=\"detail-item\">\n                                            <span class=\"detail-label\">Aulas por Semana:</span>\n                                            <span class=\"detail-value\" id=\"editPreviewClassesPerWeek\">-</span>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"tab-navigation\" style=\"display: flex; justify-content: space-between; align-items: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(148, 163, 184, 0.2);\">\n                            <button type=\"button\" class=\"btn btn-secondary\" onclick=\"switchPlanEditTab('advanced')\" style=\"min-width: 200px;\">\n                                â† Voltar: ConfiguraÃ§Ãµes\n                            </button>\n                            <button type=\"button\" class=\"btn btn-primary btn-large\" onclick=\"savePlanChanges()\" style=\"min-width: 200px;\">\n                                ðŸ’¾ Salvar Plano\n                            </button>\n                        </div>\n                    </div>\n                    \n                    <!-- Hidden legacy field for compatibility -->\n                    <select id=\"editPlanCourse\" multiple style=\"display: none;\"></select>\n                </form>\n            </div>\n        </div>\n        \n        <!-- Units Management -->\n        <div id=\"units\" class=\"content-section\">\n            <div class=\"page-header\" style=\"background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                    <div>\n                        <h1 style=\"margin: 0; font-size: 2rem; background: linear-gradient(135deg, #3B82F6, #8B5CF6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\">ðŸ¢ GestÃ£o de Unidades</h1>\n                        <p style=\"margin: 0.5rem 0 0 0; color: #94A3B8; font-size: 1.1rem;\">Administre locais, endereÃ§os e capacidades das unidades da academia</p>\n                    </div>\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button class=\"btn btn-primary\" onclick=\"openAddUnitModal()\" style=\"background: linear-gradient(135deg, #059669, #10B981); border: none; padding: 0.75rem 1.5rem;\">\n                            <span>âž•</span> Nova Unidade\n                        </button>\n                        <button class=\"btn btn-secondary\" onclick=\"loadUnits()\" style=\"padding: 0.75rem 1.5rem;\">\n                            <span>ðŸ”„</span> Atualizar\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Quick Stats -->\n                <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;\">\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #3B82F6;\" id=\"totalUnitsCount\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Unidades</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #8B5CF6;\" id=\"totalMatsCount\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Tatames</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #10B981;\" id=\"totalCapacityCount\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Capacidade Total</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #F59E0B;\" id=\"activeClassesCount\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Turmas Ativas</div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Units Table -->\n            <div class=\"data-table\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">ðŸ“‹ Lista de Unidades</div>\n                    <div class=\"table-actions\">\n                        <input type=\"text\" placeholder=\"ðŸ” Buscar unidade...\" \n                               style=\"background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem 1rem; border-radius: 8px; margin-right: 1rem;\" \n                               id=\"unitsSearchInput\" onkeyup=\"searchUnits()\">\n                        <button class=\"btn btn-secondary\" onclick=\"exportUnitsReport()\">\n                            ðŸ“Š RelatÃ³rio\n                        </button>\n                    </div>\n                </div>\n                <div class=\"table-container\">\n                    <table class=\"data-table-content\">\n                        <thead>\n                            <tr>\n                                <th>Nome</th>\n                                <th>EndereÃ§o</th>\n                                <th>Tatames</th>\n                                <th>Capacidade</th>\n                                <th>Turmas</th>\n                                <th>ResponsÃ¡vel</th>\n                                <th>Status</th>\n                                <th>AÃ§Ãµes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"unitsTableBody\">\n                            <!-- Units will be loaded here -->\n                        </tbody>\n                    </table>\n                </div>\n                <div id=\"unitsLoadingState\" class=\"loading-state\">\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ¢</div>\n                        <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Carregando unidades...</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7;\">Conectando com a base de dados</div>\n                    </div>\n                </div>\n                <div id=\"unitsEmptyState\" class=\"empty-state\" style=\"display: none;\">\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                        <div style=\"font-size: 3rem; margin-bottom: 1rem;\">ðŸ¢</div>\n                        <div style=\"font-size: 1.2rem; margin-bottom: 0.5rem;\">Nenhuma unidade encontrada</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;\">Comece cadastrando a primeira unidade da academia</div>\n                        <button class=\"btn btn-primary\" onclick=\"openAddUnitModal()\">\n                            <span>âž•</span>\n                            Criar Primeira Unidade\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Mats Management -->\n        <div id=\"mats\" class=\"content-section\">\n            <div class=\"page-header\" style=\"background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                    <div>\n                        <h1 style=\"margin: 0; font-size: 2rem; background: linear-gradient(135deg, #8B5CF6, #EC4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\">ðŸ¥‹ GestÃ£o de Tatames</h1>\n                        <p style=\"margin: 0.5rem 0 0 0; color: #94A3B8; font-size: 1.1rem;\">Administre espaÃ§os de treinamento, equipamentos e capacidades</p>\n                    </div>\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button class=\"btn btn-primary\" onclick=\"openAddMatModal()\" style=\"background: linear-gradient(135deg, #7C3AED, #8B5CF6); border: none; padding: 0.75rem 1.5rem;\">\n                            <span>âž•</span> Novo Tatame\n                        </button>\n                        <button class=\"btn btn-secondary\" onclick=\"loadMats()\" style=\"padding: 0.75rem 1.5rem;\">\n                            <span>ðŸ”„</span> Atualizar\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Quick Stats -->\n                <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;\">\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #8B5CF6;\" id=\"matsCount\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Total Tatames</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #10B981;\" id=\"matsCapacity\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Capacidade Total</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #3B82F6;\" id=\"matsInUse\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Em Uso</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #F59E0B;\" id=\"matsAvailable\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">DisponÃ­veis</div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Filter by Unit -->\n            <div style=\"background: #1E293B; border-radius: 12px; padding: 1rem; margin-bottom: 2rem; border: 1px solid #334155;\">\n                <div style=\"display: flex; gap: 1rem; align-items: center;\">\n                    <label style=\"color: #CBD5E1; font-weight: 600;\">Filtrar por Unidade:</label>\n                    <select id=\"unitFilter\" onchange=\"filterMatsByUnit()\" style=\"background: #0F172A; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem 1rem; border-radius: 8px; min-width: 200px;\">\n                        <option value=\"\">Todas as Unidades</option>\n                        <!-- Options will be loaded dynamically -->\n                    </select>\n                    <button class=\"btn btn-secondary\" onclick=\"clearMatFilters()\" style=\"padding: 0.5rem 1rem;\">\n                        <span>ðŸ§¹</span> Limpar Filtros\n                    </button>\n                </div>\n            </div>\n\n            <!-- Mats Table -->\n            <div class=\"data-table\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">ðŸ“‹ Lista de Tatames</div>\n                    <div class=\"table-actions\">\n                        <input type=\"text\" placeholder=\"ðŸ” Buscar tatame...\" \n                               style=\"background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem 1rem; border-radius: 8px; margin-right: 1rem;\" \n                               id=\"matsSearchInput\" onkeyup=\"searchMats()\">\n                        <button class=\"btn btn-secondary\" onclick=\"exportMatsReport()\">\n                            ðŸ“Š RelatÃ³rio\n                        </button>\n                    </div>\n                </div>\n                <div class=\"table-container\">\n                    <table class=\"data-table-content\">\n                        <thead>\n                            <tr>\n                                <th>Nome</th>\n                                <th>Unidade</th>\n                                <th>Capacidade</th>\n                                <th>DimensÃµes</th>\n                                <th>Equipamentos</th>\n                                <th>Turmas</th>\n                                <th>Status</th>\n                                <th>AÃ§Ãµes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"matsTableBody\">\n                            <!-- Mats will be loaded here -->\n                        </tbody>\n                    </table>\n                </div>\n                <div id=\"matsLoadingState\" class=\"loading-state\">\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ¥‹</div>\n                        <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Carregando tatames...</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7;\">Conectando com a base de dados</div>\n                    </div>\n                </div>\n                <div id=\"matsEmptyState\" class=\"empty-state\" style=\"display: none;\">\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                        <div style=\"font-size: 3rem; margin-bottom: 1rem;\">ðŸ¥‹</div>\n                        <div style=\"font-size: 1.2rem; margin-bottom: 0.5rem;\">Nenhum tatame encontrado</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;\">Comece cadastrando o primeiro tatame</div>\n                        <button class=\"btn btn-primary\" onclick=\"openAddMatModal()\">\n                            <span>âž•</span>\n                            Criar Primeiro Tatame\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Instructors Management -->\n        <div id=\"instructors\" class=\"content-section\">\n            <div class=\"page-header\" style=\"background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                    <div>\n                        <h1 style=\"margin: 0; font-size: 2rem; background: linear-gradient(135deg, #F59E0B, #EF4444); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\">ðŸ‘¨â€ðŸ« GestÃ£o de Professores</h1>\n                        <p style=\"margin: 0.5rem 0 0 0; color: #94A3B8; font-size: 1.1rem;\">Administre instrutores, especializaÃ§Ãµes e horÃ¡rios disponÃ­veis</p>\n                    </div>\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button class=\"btn btn-primary\" onclick=\"openAddInstructorModal()\" style=\"background: linear-gradient(135deg, #F59E0B, #EF4444); border: none; padding: 0.75rem 1.5rem;\">\n                            <span>âž•</span> Novo Professor\n                        </button>\n                        <button class=\"btn btn-secondary\" onclick=\"loadInstructors()\" style=\"padding: 0.75rem 1.5rem;\">\n                            <span>ðŸ”„</span> Atualizar\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Quick Stats -->\n                <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;\">\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #F59E0B;\" id=\"instructorsCount\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Professores</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #10B981;\" id=\"instructorsActive\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Ativos</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #3B82F6;\" id=\"instructorsWithClasses\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Com Turmas</div>\n                    </div>\n                    <div style=\"text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 12px;\">\n                        <div style=\"font-size: 1.5rem; font-weight: bold; color: #8B5CF6;\" id=\"avgExperience\">0</div>\n                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">Anos ExperiÃªncia</div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Instructors Table -->\n            <div class=\"data-table\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">ðŸ“‹ Lista de Professores</div>\n                    <div class=\"table-actions\">\n                        <input type=\"text\" placeholder=\"ðŸ” Buscar professor...\" \n                               style=\"background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem 1rem; border-radius: 8px; margin-right: 1rem;\" \n                               id=\"instructorsSearchInput\" onkeyup=\"searchInstructors()\">\n                        <button class=\"btn btn-secondary\" onclick=\"exportInstructorsReport()\">\n                            ðŸ“Š RelatÃ³rio\n                        </button>\n                    </div>\n                </div>\n                <div class=\"table-container\">\n                    <table class=\"data-table-content\">\n                        <thead>\n                            <tr>\n                                <th>Nome</th>\n                                <th>Email</th>\n                                <th>EspecializaÃ§Ãµes</th>\n                                <th>Artes Marciais</th>\n                                <th>ExperiÃªncia</th>\n                                <th>Turmas</th>\n                                <th>Valor/Hora</th>\n                                <th>Status</th>\n                                <th>AÃ§Ãµes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"instructorsTableBody\">\n                            <!-- Instructors will be loaded here -->\n                        </tbody>\n                    </table>\n                </div>\n                <div id=\"instructorsLoadingState\" class=\"loading-state\">\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ‘¨â€ðŸ«</div>\n                        <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Carregando professores...</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7;\">Conectando com a base de dados</div>\n                    </div>\n                </div>\n                <div id=\"instructorsEmptyState\" class=\"empty-state\" style=\"display: none;\">\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 3rem;\">\n                        <div style=\"font-size: 3rem; margin-bottom: 1rem;\">ðŸ‘¨â€ðŸ«</div>\n                        <div style=\"font-size: 1.2rem; margin-bottom: 0.5rem;\">Nenhum professor encontrado</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;\">Comece cadastrando o primeiro professor</div>\n                        <button class=\"btn btn-primary\" onclick=\"openAddInstructorModal()\">\n                            <span>âž•</span>\n                            Cadastrar Primeiro Professor\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Settings -->\n        <div id=\"settings\" class=\"content-section\">\n            <div class=\"page-header\">\n                <h1>ConfiguraÃ§Ãµes</h1>\n                <p>ConfiguraÃ§Ãµes gerais do sistema</p>\n            </div>\n            \n            <div class=\"data-table\">\n                <div class=\"table-header\">\n                    <div class=\"table-title\">Status do Sistema</div>\n                </div>\n                <div style=\"color: #CBD5E1;\">\n                    <p>â€¢ Banco de dados: âœ… Conectado</p>\n                    <p>â€¢ APIs: âœ… 27 endpoints funcionais</p>\n                    <p>â€¢ Frontend: âœ… Interface responsiva</p>\n                    <p>â€¢ Dados: âœ… 4 alunos, 42 tÃ©cnicas, 48 aulas</p>\n                </div>\n            </div>\n        </div>\n    </main>\n\n    <!-- Debug Button for Testing Modal -->\n    <div style=\"position: fixed; top: 10px; right: 10px; z-index: 9999;\">\n        <button onclick=\"openAddStudentModal()\" style=\"background: #10B981; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer;\">\n            ðŸ§ª TESTE MODAL\n        </button>\n    </div>\n\n    <!-- Add Student Modal -->\n    <div id=\"addStudentModal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h2 class=\"modal-title\">Adicionar Novo Aluno</h2>\n                <button class=\"close-btn\" onclick=\"closeModal('addStudentModal')\">&times;</button>\n            </div>\n            <form id=\"addStudentForm\">\n                <div class=\"form-group\">\n                    <label class=\"form-label\">Nome Completo</label>\n                    <input type=\"text\" class=\"form-input\" id=\"studentName\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label class=\"form-label\">Email</label>\n                    <input type=\"email\" class=\"form-input\" id=\"studentEmail\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label class=\"form-label\">Telefone</label>\n                    <input type=\"tel\" class=\"form-input\" id=\"studentPhone\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label class=\"form-label\">Data de Nascimento</label>\n                    <input type=\"date\" class=\"form-input\" id=\"studentBirthDate\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label class=\"form-label\">GÃªnero</label>\n                    <select class=\"form-select\" id=\"studentGender\" required>\n                        <option value=\"\">Selecione...</option>\n                        <option value=\"MASCULINO\">Masculino</option>\n                        <option value=\"FEMININO\">Feminino</option>\n                    </select>\n                </div>\n                <div class=\"form-group\">\n                    <label class=\"form-label\">Categoria</label>\n                    <select class=\"form-select\" id=\"studentCategory\" required onchange=\"updateStudentPlanPreview()\">\n                        <option value=\"\">Selecione...</option>\n                        <option value=\"ADULT\">Adulto</option>\n                        <option value=\"INICIANTE1\">Iniciante 1</option>\n                        <option value=\"INICIANTE2\">Iniciante 2</option>\n                        <option value=\"INTERMEDIARIO1\">IntermediÃ¡rio 1</option>\n                        <option value=\"INTERMEDIARIO2\">IntermediÃ¡rio 2</option>\n                        <option value=\"AVANCADO1\">AvanÃ§ado 1</option>\n                        <option value=\"AVANCADO2\">AvanÃ§ado 2</option>\n                        <option value=\"MASTER\">Master</option>\n                        <option value=\"INSTRUCTOR\">Instrutor</option>\n                    </select>\n                </div>\n                <div class=\"form-group\">\n                    <label class=\"form-label\">Turma</label>\n                    <select class=\"form-select\" id=\"studentClass\" required>\n                        <option value=\"\">Selecione uma turma...</option>\n                        <!-- Options will be loaded dynamically -->\n                    </select>\n                </div>\n                <div class=\"form-group\">\n                    <label class=\"form-label\">Plano de Pagamento</label>\n                    <select class=\"form-select\" id=\"studentBillingPlan\" onchange=\"updateStudentPlanPreview()\">\n                        <option value=\"\">Selecione um plano (opcional)</option>\n                        <!-- Options will be loaded dynamically -->\n                    </select>\n                    <small style=\"color: #94A3B8; margin-top: 0.5rem; display: block;\">\n                        Selecione um plano de pagamento ou deixe em branco para seleÃ§Ã£o automÃ¡tica\n                    </small>\n                </div>\n                <div class=\"form-group\">\n                    <label class=\"form-label\">Curso</label>\n                    <select class=\"form-select\" id=\"studentCourse\" onchange=\"updateStudentPlanPreview()\">\n                        <option value=\"\">Selecione um curso (opcional)</option>\n                        <!-- Options will be loaded dynamically -->\n                    </select>\n                </div>\n                <div class=\"form-group\">\n                    <label class=\"form-label\">ResponsÃ¡vel Financeiro</label>\n                    <select class=\"form-select\" id=\"studentFinancialResponsible\">\n                        <option value=\"\">Selecione um responsÃ¡vel (opcional)</option>\n                        <!-- Options will be loaded dynamically -->\n                    </select>\n                    <small style=\"color: #94A3B8; margin-top: 0.5rem; display: block;\">\n                        Selecione um responsÃ¡vel financeiro existente ou deixe em branco se o prÃ³prio aluno Ã© responsÃ¡vel\n                    </small>\n                </div>\n                \n                <!-- Intelligent Plan Preview -->\n                <div id=\"studentPlanPreview\" class=\"form-section\" style=\"display: none;\">\n                    <h3>ðŸ’° Plano AutomÃ¡tico</h3>\n                    <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #10B981;\">\n                        <div style=\"color: #10B981; font-weight: bold; margin-bottom: 0.5rem;\" id=\"previewStudentPlanName\">Nome do Plano</div>\n                        <div style=\"color: #F8FAFC; font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;\" id=\"previewStudentPlanPrice\">R$ 0,00</div>\n                        <div style=\"color: #CBD5E1; font-size: 0.9rem;\" id=\"previewStudentPlanDescription\">DescriÃ§Ã£o do plano</div>\n                        <div style=\"color: #94A3B8; font-size: 0.8rem; margin-top: 0.5rem;\">\n                            âœ… MatrÃ­cula automÃ¡tica no curso e plano serÃ¡ criada\n                        </div>\n                    </div>\n                </div>\n                <div class=\"form-actions\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeModal('addStudentModal')\">Cancelar</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Adicionar Aluno</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Edit Student Modal - Complete Version -->\n    <div id=\"editStudentModal\" class=\"modal\">\n        <div class=\"modal-content large-modal\">\n            <div class=\"modal-header\">\n                <h2 id=\"editStudentModalTitle\">Editar Aluno</h2>\n                <span class=\"close\" onclick=\"closeEditStudentModal()\">&times;</span>\n            </div>\n            <div class=\"modal-body\">\n                <!-- Student Summary Card -->\n                <div style=\"padding: 1.5rem 2rem; background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%); color: white;\">\n                    <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                        <div style=\"display: flex; align-items: center; gap: 1rem;\">\n                            <div style=\"width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;\">\n                                ðŸ‘¤\n                            </div>\n                            <div>\n                                <h3 style=\"margin: 0; font-size: 1.25rem;\" id=\"editStudentSummaryName\">Nome do Aluno</h3>\n                                <div style=\"display: flex; gap: 1rem; margin-top: 0.25rem; font-size: 0.875rem; opacity: 0.9;\">\n                                    <span id=\"editStudentSummaryId\">ID: -</span>\n                                    <span id=\"editStudentSummaryCategory\">Categoria: -</span>\n                                    <span id=\"editStudentSummaryStatus\">Status: Ativo</span>\n                                </div>\n                            </div>\n                        </div>\n                        <div style=\"text-align: right;\">\n                            <div style=\"background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.875rem;\">\n                                ðŸ’¾ Modificado hÃ¡ <span id=\"editStudentLastModified\">-</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Enhanced Tabs Navigation -->\n                <div style=\"padding: 0 2rem; background: #1E293B; border-bottom: 1px solid #334155;\">\n                    <div style=\"display: flex; gap: 0;\">\n                        <!-- Primary Tab (Edit) -->\n                        <button class=\"edit-tab-btn active primary\" onclick=\"switchEditTab('edit')\" data-tab=\"edit\" \n                                style=\"padding: 1rem 2rem; background: linear-gradient(135deg, #3B82F6, #1D4ED8); border: none; color: white; border-radius: 8px 8px 0 0; font-weight: 700; cursor: pointer; position: relative; z-index: 2; margin-right: 1rem;\">\n                            âœï¸ Editar Dados\n                        </button>\n                        <!-- Secondary Tabs (View) -->\n                        <div style=\"display: flex; gap: 0.25rem; align-items: end;\">\n                            <button class=\"edit-tab-btn secondary\" onclick=\"switchEditTab('overview')\" data-tab=\"overview\" \n                                    style=\"padding: 0.75rem 1.25rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 500; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;\">\n                                ðŸ“‹ VisÃ£o Geral\n                            </button>\n                            <button class=\"edit-tab-btn secondary\" onclick=\"switchEditTab('academic')\" data-tab=\"academic\" \n                                    style=\"padding: 0.75rem 1.25rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 500; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;\">\n                                ðŸŽ“ AcadÃªmico\n                            </button>\n                            <button class=\"edit-tab-btn secondary\" onclick=\"switchEditTab('financial')\" data-tab=\"financial\" \n                                    style=\"padding: 0.75rem 1.25rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 500; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;\">\n                                ðŸ’° Financeiro\n                            </button>\n                            <button class=\"edit-tab-btn secondary\" onclick=\"switchEditTab('progress')\" data-tab=\"progress\" \n                                    style=\"padding: 0.75rem 1.25rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 500; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;\">\n                                ðŸ“ˆ Progresso\n                            </button>\n                            <button class=\"edit-tab-btn secondary\" onclick=\"switchEditTab('activity')\" data-tab=\"activity\" \n                                    style=\"padding: 0.75rem 1.25rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 500; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;\">\n                                ðŸ“Š Atividades\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Tab Contents -->\n                <div style=\"padding: 2rem;\">\n                    <!-- Edit Tab -->\n                    <div id=\"edit-tab-edit\" class=\"edit-tab-content\">\n                        <!-- Progress Indicator -->\n                        <div style=\"background: #0F172A; padding: 1rem 2rem; margin: -2rem -2rem 2rem -2rem; border-bottom: 1px solid #334155;\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                <h3 style=\"color: #F8FAFC; margin: 0; font-size: 1.1rem;\">ðŸ“ Editando Perfil</h3>\n                                <div style=\"display: flex; gap: 1rem; align-items: center;\">\n                                    <div style=\"display: flex; gap: 0.5rem; align-items: center;\">\n                                        <div style=\"width: 8px; height: 8px; background: #10B981; border-radius: 50%;\"></div>\n                                        <span style=\"color: #10B981; font-size: 0.875rem;\">Dados salvos automaticamente</span>\n                                    </div>\n                                    <button type=\"button\" onclick=\"autoFillDemo()\" style=\"background: rgba(139, 92, 246, 0.1); border: 1px solid #8B5CF6; color: #8B5CF6; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; cursor: pointer;\">\n                                        ðŸŽ¯ Preencher Demo\n                                    </button>\n                                </div>\n                            </div>\n                            <div style=\"background: #1E293B; border-radius: 6px; height: 4px; overflow: hidden;\">\n                                <div id=\"editFormProgress\" style=\"background: linear-gradient(90deg, #3B82F6, #10B981); height: 100%; width: 20%; transition: width 0.3s ease;\"></div>\n                            </div>\n                        </div>\n\n                        <form id=\"editStudentForm\" onchange=\"updateFormProgress()\">\n                            <input type=\"hidden\" id=\"editStudentId\" name=\"editStudentId\">\n                            <input type=\"hidden\" id=\"editUserId\" name=\"editUserId\">\n                            \n                            <!-- Step 1: InformaÃ§Ãµes Pessoais -->\n                            <div class=\"form-section\" style=\"background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05)); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                                <div style=\"display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;\">\n                                    <div style=\"width: 32px; height: 32px; background: linear-gradient(135deg, #3B82F6, #1D4ED8); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;\">1</div>\n                                    <h3 style=\"color: #F8FAFC; margin: 0; font-size: 1.1rem;\">ðŸ‘¤ Dados Pessoais</h3>\n                                    <div style=\"flex: 1; height: 1px; background: linear-gradient(90deg, #3B82F6, transparent);\"></div>\n                                </div>\n                        <div class=\"form-row\">\n                            <div class=\"form-group\">\n                                <label for=\"editFirstName\">Nome *</label>\n                                <input type=\"text\" id=\"editFirstName\" name=\"editFirstName\" required>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"editLastName\">Sobrenome *</label>\n                                <input type=\"text\" id=\"editLastName\" name=\"editLastName\" required>\n                            </div>\n                        </div>\n                        \n                        <div class=\"form-row\">\n                            <div class=\"form-group\">\n                                <label for=\"editEmail\">Email *</label>\n                                <input type=\"email\" id=\"editEmail\" name=\"editEmail\" required>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"editPhone\">Telefone</label>\n                                <input type=\"tel\" id=\"editPhone\" name=\"editPhone\">\n                            </div>\n                        </div>\n                        \n                        <div class=\"form-row\">\n                            <div class=\"form-group\">\n                                <label for=\"editCpf\">CPF</label>\n                                <input type=\"text\" id=\"editCpf\" name=\"editCpf\" placeholder=\"000.000.000-00\">\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"editBirthDate\">Data de Nascimento</label>\n                                <input type=\"date\" id=\"editBirthDate\" name=\"editBirthDate\">\n                            </div>\n                        </div>\n                    </div>\n\n                            </div>\n\n                            <!-- Step 2: InformaÃ§Ãµes da Academia -->\n                            <div class=\"form-section\" style=\"background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(139, 92, 246, 0.05)); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(16, 185, 129, 0.2);\">\n                                <div style=\"display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;\">\n                                    <div style=\"width: 32px; height: 32px; background: linear-gradient(135deg, #10B981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;\">2</div>\n                                    <h3 style=\"color: #F8FAFC; margin: 0; font-size: 1.1rem;\">ðŸ¥‹ Academia</h3>\n                                    <div style=\"flex: 1; height: 1px; background: linear-gradient(90deg, #10B981, transparent);\"></div>\n                                </div>\n                        <div class=\"form-row\">\n                            <div class=\"form-group\">\n                                <label for=\"editCategory\">Categoria *</label>\n                                <select id=\"editCategory\" name=\"editCategory\" required>\n                                    <option value=\"ADULT\">Adulto</option>\n                                    <option value=\"INICIANTE1\">Iniciante 1</option>\n                                    <option value=\"INICIANTE2\">Iniciante 2</option>\n                                    <option value=\"MASTER1\">Master 1</option>\n                                    <option value=\"MASTER2\">Master 2</option>\n                                    <option value=\"MASTER3\">Master 3</option>\n                                    <option value=\"HEROI1\">HerÃ³i 1</option>\n                                    <option value=\"HEROI2\">HerÃ³i 2</option>\n                                    <option value=\"HEROI3\">HerÃ³i 3</option>\n                                </select>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"editGender\">GÃªnero *</label>\n                                <select id=\"editGender\" name=\"editGender\" required>\n                                    <option value=\"MASCULINO\">Masculino</option>\n                                    <option value=\"FEMININO\">Feminino</option>\n                                    <option value=\"OUTRO\">Outro</option>\n                                </select>\n                            </div>\n                        </div>\n                        \n                        <div class=\"form-row\">\n                            <div class=\"form-group\">\n                                <label for=\"editPhysicalCondition\">CondiÃ§Ã£o FÃ­sica</label>\n                                <select id=\"editPhysicalCondition\" name=\"editPhysicalCondition\">\n                                    <option value=\"INICIANTE\">Iniciante</option>\n                                    <option value=\"BASICO\">BÃ¡sico</option>\n                                    <option value=\"INTERMEDIARIO\">IntermediÃ¡rio</option>\n                                    <option value=\"AVANCADO\">AvanÃ§ado</option>\n                                </select>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"editEnrollmentDate\">Data de MatrÃ­cula</label>\n                                <input type=\"date\" id=\"editEnrollmentDate\" name=\"editEnrollmentDate\">\n                            </div>\n                        </div>\n                    </div>\n\n                            </div>\n\n                            <!-- Step 3: InformaÃ§Ãµes MÃ©dicas -->\n                            <div class=\"form-section\" style=\"background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(245, 158, 11, 0.05)); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(239, 68, 68, 0.2);\">\n                                <div style=\"display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;\">\n                                    <div style=\"width: 32px; height: 32px; background: linear-gradient(135deg, #EF4444, #DC2626); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;\">3</div>\n                                    <h3 style=\"color: #F8FAFC; margin: 0; font-size: 1.1rem;\">ðŸ¥ SaÃºde & EmergÃªncia</h3>\n                                    <div style=\"flex: 1; height: 1px; background: linear-gradient(90deg, #EF4444, transparent);\"></div>\n                                </div>\n                        <div class=\"form-row\">\n                            <div class=\"form-group full-width\">\n                                <label for=\"editMedicalConditions\">CondiÃ§Ãµes MÃ©dicas</label>\n                                <textarea id=\"editMedicalConditions\" name=\"editMedicalConditions\" rows=\"3\" \n                                          placeholder=\"Alergias, medicamentos, limitaÃ§Ãµes fÃ­sicas, etc.\"></textarea>\n                            </div>\n                        </div>\n                        \n                        <div class=\"form-row\">\n                            <div class=\"form-group\">\n                                <label for=\"editEmergencyContact\">Contato de EmergÃªncia</label>\n                                <input type=\"text\" id=\"editEmergencyContact\" name=\"editEmergencyContact\" \n                                       placeholder=\"Nome e telefone\">\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"editSpecialNeeds\">Necessidades Especiais</label>\n                                <select id=\"editSpecialNeeds\" name=\"editSpecialNeeds\" multiple>\n                                    <option value=\"TEA\">TEA (Autismo)</option>\n                                    <option value=\"TDAH\">TDAH</option>\n                                    <option value=\"MobilidadeReduzida\">Mobilidade Reduzida</option>\n                                    <option value=\"DeficienciaVisual\">DeficiÃªncia Visual</option>\n                                    <option value=\"DeficienciaAuditiva\">DeficiÃªncia Auditiva</option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                            </div>\n\n                            <!-- Step 4: Status e Progresso (Read-only) -->\n                            <div class=\"form-section\" id=\"editProgressSection\" style=\"background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(99, 102, 241, 0.05)); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                                <div style=\"display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;\">\n                                    <div style=\"width: 32px; height: 32px; background: linear-gradient(135deg, #8B5CF6, #7C3AED); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;\">4</div>\n                                    <h3 style=\"color: #F8FAFC; margin: 0; font-size: 1.1rem;\">ðŸ“Š EstatÃ­sticas (Somente Leitura)</h3>\n                                    <div style=\"flex: 1; height: 1px; background: linear-gradient(90deg, #8B5CF6, transparent);\"></div>\n                                </div>\n                        <div class=\"form-row\">\n                            <div class=\"form-group\">\n                                <label for=\"editTotalXP\">XP Total</label>\n                                <input type=\"number\" id=\"editTotalXP\" name=\"editTotalXP\" readonly>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"editGlobalLevel\">NÃ­vel Global</label>\n                                <input type=\"number\" id=\"editGlobalLevel\" name=\"editGlobalLevel\" readonly>\n                            </div>\n                        </div>\n                        \n                        <div class=\"form-row\">\n                            <div class=\"form-group\">\n                                <label for=\"editCurrentStreak\">SequÃªncia Atual</label>\n                                <input type=\"number\" id=\"editCurrentStreak\" name=\"editCurrentStreak\" readonly>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"editLastCheckinDate\">Ãšltima PresenÃ§a</label>\n                                <input type=\"datetime-local\" id=\"editLastCheckinDate\" name=\"editLastCheckinDate\" readonly>\n                            </div>\n                        </div>\n                        </form>\n                    </div>\n\n                        </form>\n                    </div>\n\n                    <!-- Overview Tab -->\n                    <div id=\"edit-tab-overview\" class=\"edit-tab-content\" style=\"display: none;\">\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;\">\n                            <!-- Personal Summary -->\n                            <div style=\"background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                                <h4 style=\"color: #3B82F6; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸ‘¤</span> InformaÃ§Ãµes Pessoais\n                                </h4>\n                                <div style=\"display: grid; gap: 0.75rem; color: #CBD5E1;\">\n                                    <div><strong>Nome:</strong> <span id=\"overviewFullName\">-</span></div>\n                                    <div><strong>Email:</strong> <span id=\"overviewEmail\">-</span></div>\n                                    <div><strong>Telefone:</strong> <span id=\"overviewPhone\">-</span></div>\n                                    <div><strong>CPF:</strong> <span id=\"overviewCpf\">-</span></div>\n                                </div>\n                            </div>\n\n                            <!-- Academy Summary -->\n                            <div style=\"background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(139, 92, 246, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(16, 185, 129, 0.2);\">\n                                <h4 style=\"color: #10B981; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸ¥‹</span> Status Academia\n                                </h4>\n                                <div style=\"display: grid; gap: 0.75rem; color: #CBD5E1;\">\n                                    <div><strong>Categoria:</strong> <span id=\"overviewCategory\">-</span></div>\n                                    <div><strong>Status:</strong> <span id=\"overviewStatus\">-</span></div>\n                                    <div><strong>MatrÃ­cula:</strong> <span id=\"overviewEnrollment\">-</span></div>\n                                    <div><strong>CondiÃ§Ã£o FÃ­sica:</strong> <span id=\"overviewPhysical\">-</span></div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Academic Tab -->\n                    <div id=\"edit-tab-academic\" class=\"edit-tab-content\" style=\"display: none;\">\n                        <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸŽ“</div>\n                            <p>Carregando informaÃ§Ãµes acadÃªmicas...</p>\n                        </div>\n                    </div>\n\n                    <div id=\"edit-tab-classes\" class=\"edit-tab-content\" style=\"display: none;\">\n                        <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ«</div>\n                            <p>Carregando informaÃ§Ãµes de turmas...</p>\n                        </div>\n                    </div>\n\n                    <!-- Progress Tab -->\n                    <div id=\"edit-tab-progress\" class=\"edit-tab-content\" style=\"display: none;\">\n                        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;\">\n                            <!-- XP Stats -->\n                            <div style=\"background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(99, 102, 241, 0.1)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(139, 92, 246, 0.3); text-align: center;\">\n                                <div style=\"font-size: 2rem; margin-bottom: 0.5rem;\">â­</div>\n                                <div style=\"color: #8B5CF6; font-size: 1.5rem; font-weight: bold;\" id=\"progressXP\">1,250</div>\n                                <div style=\"color: #CBD5E1; font-size: 0.875rem;\">XP Total</div>\n                            </div>\n                            <!-- Level -->\n                            <div style=\"background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(16, 185, 129, 0.3); text-align: center;\">\n                                <div style=\"font-size: 2rem; margin-bottom: 0.5rem;\">ðŸ†</div>\n                                <div style=\"color: #10B981; font-size: 1.5rem; font-weight: bold;\" id=\"progressLevel\">NÃ­vel 5</div>\n                                <div style=\"color: #CBD5E1; font-size: 0.875rem;\">GraduaÃ§Ã£o</div>\n                            </div>\n                            <!-- Streak -->\n                            <div style=\"background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(245, 158, 11, 0.3); text-align: center;\">\n                                <div style=\"font-size: 2rem; margin-bottom: 0.5rem;\">ðŸ”¥</div>\n                                <div style=\"color: #F59E0B; font-size: 1.5rem; font-weight: bold;\" id=\"progressStreak\">7 dias</div>\n                                <div style=\"color: #CBD5E1; font-size: 0.875rem;\">SequÃªncia</div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Financial Tab -->\n                    <div id=\"edit-tab-financial\" class=\"edit-tab-content\" style=\"display: none;\">\n                        <!-- Current Plan Section -->\n                        <div style=\"margin-bottom: 2rem;\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;\">\n                                <h3 style=\"color: #F8FAFC; margin: 0; font-size: 1.25rem;\">ðŸ“‹ Plano Atual</h3>\n                                <button class=\"btn btn-primary btn-sm\" onclick=\"openEditStudentPlan()\" style=\"padding: 0.5rem 1rem;\">\n                                    âœï¸ Editar Plano\n                                </button>\n                            </div>\n                            \n                            <div id=\"currentPlanContainer\" style=\"background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(29, 78, 216, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                                <div class=\"loading-state\">\n                                    <div style=\"text-align: center; color: #94A3B8;\">\n                                        <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">ðŸ“„</div>\n                                        <p>Carregando informaÃ§Ãµes do plano...</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;\">\n                            <!-- Payment Status -->\n                            <div style=\"background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(5, 150, 105, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(16, 185, 129, 0.2);\">\n                                <h4 style=\"color: #10B981; margin: 0 0 1rem 0;\">ðŸ’³ Status Pagamento</h4>\n                                <div id=\"paymentStatusContainer\" style=\"color: #CBD5E1;\">\n                                    <div class=\"loading-state\">\n                                        <div style=\"text-align: center; color: #94A3B8;\">\n                                            <p>Carregando status...</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <!-- Payment History -->\n                            <div style=\"background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(124, 58, 237, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                                <h4 style=\"color: #8B5CF6; margin: 0 0 1rem 0;\">ðŸ“Š HistÃ³rico de Pagamentos</h4>\n                                <div id=\"paymentHistoryContainer\" style=\"color: #CBD5E1; font-size: 0.875rem;\">\n                                    <div class=\"loading-state\">\n                                        <div style=\"text-align: center; color: #94A3B8;\">\n                                            <p>Carregando histÃ³rico...</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <!-- Available Plans for Upgrade -->\n                        <div style=\"margin-top: 2rem;\">\n                            <h3 style=\"color: #F8FAFC; margin: 0 0 1rem 0; font-size: 1.25rem;\">ðŸš€ Planos DisponÃ­veis para Upgrade</h3>\n                            <div id=\"availablePlansContainer\" style=\"background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(217, 119, 6, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(245, 158, 11, 0.2);\">\n                                <div class=\"loading-state\">\n                                    <div style=\"text-align: center; color: #94A3B8;\">\n                                        <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">â¬†ï¸</div>\n                                        <p>Carregando planos disponÃ­veis...</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Activity Tab -->\n                    <div id=\"edit-tab-activity\" class=\"edit-tab-content\" style=\"display: none;\">\n                        <div style=\"background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(29, 78, 216, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                            <h4 style=\"color: #3B82F6; margin: 0 0 1rem 0;\">ðŸ“Š FrequÃªncia Recente</h4>\n                            <div style=\"color: #CBD5E1;\">\n                                <div style=\"display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #374151;\">\n                                    <span>02/07/2025 - Aula 15</span>\n                                    <span style=\"color: #10B981;\">âœ… Presente</span>\n                                </div>\n                                <div style=\"display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #374151;\">\n                                    <span>27/06/2025 - Aula 14</span>\n                                    <span style=\"color: #10B981;\">âœ… Presente</span>\n                                </div>\n                                <div style=\"display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #374151;\">\n                                    <span>25/06/2025 - Aula 13</span>\n                                    <span style=\"color: #EF4444;\">âŒ Ausente</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"modal-footer\">\n                <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeEditStudentModal()\">\n                    Cancelar\n                </button>\n                <button type=\"button\" id=\"saveEditStudentBtn\" class=\"btn btn-primary\" onclick=\"saveEditStudent()\">\n                    ðŸ’¾ Salvar AlteraÃ§Ãµes\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <!-- Add Financial Responsible Modal -->\n    <div id=\"addResponsibleModal\" class=\"modal\">\n        <div class=\"modal-content large-modal\">\n            <div class=\"modal-header\">\n                <h2 class=\"modal-title\">Novo ResponsÃ¡vel Financeiro</h2>\n                <button class=\"close-btn\" onclick=\"closeModal('addResponsibleModal')\">&times;</button>\n            </div>\n            <form id=\"addResponsibleForm\">\n                <div class=\"form-section\">\n                    <h3>Dados Pessoais</h3>\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Nome Completo *</label>\n                            <input type=\"text\" class=\"form-input\" id=\"responsibleName\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">CPF/CNPJ *</label>\n                            <input type=\"text\" class=\"form-input\" id=\"responsibleCpfCnpj\" required placeholder=\"000.000.000-00\">\n                        </div>\n                    </div>\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Email *</label>\n                            <input type=\"email\" class=\"form-input\" id=\"responsibleEmail\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Telefone</label>\n                            <input type=\"tel\" class=\"form-input\" id=\"responsiblePhone\" placeholder=\"(11) 99999-9999\">\n                        </div>\n                    </div>\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Data de Nascimento</label>\n                            <input type=\"date\" class=\"form-input\" id=\"responsibleBirthDate\">\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Tipo de RelaÃ§Ã£o</label>\n                            <select class=\"form-select\" id=\"responsibleRelationType\">\n                                <option value=\"\">Selecione...</option>\n                                <option value=\"PARENT\">Pai/MÃ£e</option>\n                                <option value=\"GUARDIAN\">ResponsÃ¡vel Legal</option>\n                                <option value=\"SPOUSE\">CÃ´njuge</option>\n                                <option value=\"RELATIVE\">Familiar</option>\n                                <option value=\"OTHER\">Outro</option>\n                            </select>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"form-section\">\n                    <h3>EndereÃ§o</h3>\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">EndereÃ§o</label>\n                            <input type=\"text\" class=\"form-input\" id=\"responsibleAddress\" placeholder=\"Rua, Avenida, etc.\">\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">NÃºmero</label>\n                            <input type=\"text\" class=\"form-input\" id=\"responsibleAddressNumber\" placeholder=\"123\">\n                        </div>\n                    </div>\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Complemento</label>\n                            <input type=\"text\" class=\"form-input\" id=\"responsibleComplement\" placeholder=\"Apto, Bloco, etc.\">\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Bairro</label>\n                            <input type=\"text\" class=\"form-input\" id=\"responsibleNeighborhood\">\n                        </div>\n                    </div>\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Cidade</label>\n                            <input type=\"text\" class=\"form-input\" id=\"responsibleCity\">\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Estado</label>\n                            <select class=\"form-select\" id=\"responsibleState\">\n                                <option value=\"\">Selecione...</option>\n                                <option value=\"SP\">SÃ£o Paulo</option>\n                                <option value=\"RJ\">Rio de Janeiro</option>\n                                <option value=\"MG\">Minas Gerais</option>\n                                <option value=\"ES\">EspÃ­rito Santo</option>\n                                <option value=\"SC\">Santa Catarina</option>\n                                <option value=\"PR\">ParanÃ¡</option>\n                                <option value=\"RS\">Rio Grande do Sul</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">CEP</label>\n                            <input type=\"text\" class=\"form-input\" id=\"responsibleZipCode\" placeholder=\"00000-000\">\n                        </div>\n                        <div class=\"form-group\"></div>\n                    </div>\n                </div>\n\n                <div class=\"form-actions\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeModal('addResponsibleModal')\">Cancelar</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Adicionar ResponsÃ¡vel</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Edit Financial Responsible Modal -->\n    <div id=\"editResponsibleModal\" class=\"modal\">\n        <div class=\"modal-content large-modal\">\n            <div class=\"modal-header\">\n                <h2 class=\"modal-title\">Editar ResponsÃ¡vel Financeiro</h2>\n                <button class=\"close-btn\" onclick=\"closeModal('editResponsibleModal')\">&times;</button>\n            </div>\n            <form id=\"editResponsibleForm\">\n                <input type=\"hidden\" id=\"editResponsibleId\">\n                <div class=\"form-section\">\n                    <h3>Dados Pessoais</h3>\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Nome Completo *</label>\n                            <input type=\"text\" class=\"form-input\" id=\"editResponsibleName\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">CPF/CNPJ *</label>\n                            <input type=\"text\" class=\"form-input\" id=\"editResponsibleCpfCnpj\" required readonly>\n                        </div>\n                    </div>\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Email *</label>\n                            <input type=\"email\" class=\"form-input\" id=\"editResponsibleEmail\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Telefone</label>\n                            <input type=\"tel\" class=\"form-input\" id=\"editResponsiblePhone\">\n                        </div>\n                    </div>\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Data de Nascimento</label>\n                            <input type=\"date\" class=\"form-input\" id=\"editResponsibleBirthDate\">\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Tipo de RelaÃ§Ã£o</label>\n                            <select class=\"form-select\" id=\"editResponsibleRelationType\">\n                                <option value=\"\">Selecione...</option>\n                                <option value=\"PARENT\">Pai/MÃ£e</option>\n                                <option value=\"GUARDIAN\">ResponsÃ¡vel Legal</option>\n                                <option value=\"SPOUSE\">CÃ´njuge</option>\n                                <option value=\"RELATIVE\">Familiar</option>\n                                <option value=\"OTHER\">Outro</option>\n                            </select>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"form-actions\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeModal('editResponsibleModal')\">Cancelar</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Salvar AlteraÃ§Ãµes</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Modern Plan Creation Modal with Tabs -->\n    <div id=\"addPlanModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 900px; max-height: 90vh; overflow-y: auto;\">\n            <div class=\"modal-header\">\n                <h2 class=\"modal-title\">âœ¨ Criar Novo Plano de Pagamento</h2>\n                <button class=\"close-btn\" onclick=\"closeModal('addPlanModal')\">&times;</button>\n            </div>\n            \n            <!-- Tab Navigation -->\n            <div class=\"plan-tabs\">\n                <button type=\"button\" class=\"plan-tab active\" onclick=\"switchPlanTab('basic')\" data-tab=\"basic\">\n                    ðŸ“‹ InformaÃ§Ãµes BÃ¡sicas\n                </button>\n                <button type=\"button\" class=\"plan-tab\" onclick=\"switchPlanTab('courses')\" data-tab=\"courses\">\n                    ðŸŽ“ Cursos Associados\n                </button>\n                <button type=\"button\" class=\"plan-tab\" onclick=\"switchPlanTab('advanced')\" data-tab=\"advanced\">\n                    âš™ï¸ ConfiguraÃ§Ãµes\n                </button>\n                <button type=\"button\" class=\"plan-tab\" onclick=\"switchPlanTab('preview')\" data-tab=\"preview\">\n                    ðŸ‘ï¸ Preview\n                </button>\n            </div>\n            \n            <form id=\"addPlanForm\">\n                <!-- Tab 1: Basic Information -->\n                <div id=\"planTab-basic\" class=\"plan-tab-content active\">\n                    <div class=\"tab-header\">\n                        <h3>ðŸ“‹ InformaÃ§Ãµes BÃ¡sicas do Plano</h3>\n                        <p>Configure os dados fundamentais do seu plano de pagamento</p>\n                    </div>\n                    \n                    <div class=\"form-grid\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Nome do Plano *</label>\n                            <input type=\"text\" class=\"form-input\" id=\"planName\" placeholder=\"Ex: Plano Premium Krav Maga\" required>\n                            <small class=\"form-hint\">ðŸ”„ SerÃ¡ gerado automaticamente baseado nos cursos selecionados</small>\n                        </div>\n                        \n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Categoria *</label>\n                            <select class=\"form-select\" id=\"planCategory\" required onchange=\"updatePlanPreview()\">\n                                <option value=\"\">Selecione uma categoria...</option>\n                                <option value=\"ADULT\">ðŸ‘¨ Adulto</option>\n                                <option value=\"FEMALE\">ðŸ‘© Feminino</option>\n                                <option value=\"SENIOR\">ðŸ‘´ Senior/Idoso</option>\n                                <option value=\"CHILD\">ðŸ§’ Infantil/CrianÃ§a</option>\n                                <option value=\"INICIANTE1\">ðŸ¥‰ Iniciante 1</option>\n                                <option value=\"INICIANTE2\">ðŸ¥‰ Iniciante 2</option>\n                                <option value=\"INICIANTE3\">ðŸ¥‰ Iniciante 3</option>\n                                <option value=\"HEROI1\">ðŸ¥ˆ HerÃ³i 1</option>\n                                <option value=\"HEROI2\">ðŸ¥ˆ HerÃ³i 2</option>\n                                <option value=\"HEROI3\">ðŸ¥ˆ HerÃ³i 3</option>\n                                <option value=\"MASTER_1\">ðŸ¥‡ Master 1</option>\n                                <option value=\"MASTER_2\">ðŸ¥‡ Master 2</option>\n                                <option value=\"MASTER_3\">ðŸ¥‡ Master 3</option>\n                            </select>\n                        </div>\n                        \n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Valor do Plano *</label>\n                            <input type=\"number\" class=\"form-input\" id=\"planCustomPrice\" step=\"0.01\" placeholder=\"R$ 0,00\" required>\n                            <small class=\"form-hint\">ðŸ’° Insira o valor do plano conforme sua estratÃ©gia de preÃ§os</small>\n                        </div>\n                        \n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Tipo de CobranÃ§a *</label>\n                            <select class=\"form-select\" id=\"planBillingType\" required onchange=\"updatePlanPreview()\">\n                                <option value=\"MONTHLY\">ðŸ’³ Mensal</option>\n                                <option value=\"WEEKLY\">ðŸ“… Semanal</option>\n                                <option value=\"QUARTERLY\">ðŸ“Š Trimestral</option>\n                                <option value=\"YEARLY\">ðŸ—“ï¸ Anual</option>\n                            </select>\n                        </div>\n                    </div>\n                    \n                    <div class=\"form-group full-width\">\n                        <label class=\"form-label\">DescriÃ§Ã£o do Plano</label>\n                        <textarea class=\"form-input\" id=\"planDescription\" rows=\"3\" placeholder=\"DescriÃ§Ã£o detalhada dos benefÃ­cios e caracterÃ­sticas do plano...\"></textarea>\n                    </div>\n                    \n                    <div class=\"tab-navigation\">\n                        <button type=\"button\" class=\"btn btn-primary\" onclick=\"switchPlanTab('courses')\">\n                            PrÃ³ximo: Cursos Associados â†’\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Tab 2: Associated Courses -->\n                <div id=\"planTab-courses\" class=\"plan-tab-content\">\n                    <div class=\"tab-header\">\n                        <h3>ðŸŽ“ Cursos Associados ao Plano</h3>\n                        <p>Selecione todos os cursos que estarÃ£o inclusos neste plano</p>\n                    </div>\n                    \n                    <div class=\"courses-selection-container\">\n                        <div class=\"selection-header\">\n                            <div class=\"selection-stats\">\n                                <span class=\"stat-badge\" id=\"coursesSelectedCount\">0 cursos selecionados</span>\n                                <span class=\"stat-badge\" id=\"coursesTotalCount\">0 cursos disponÃ­veis</span>\n                            </div>\n                            <div class=\"selection-actions\">\n                                <button type=\"button\" class=\"btn btn-sm btn-outline\" onclick=\"selectAllCourses()\">Selecionar Todos</button>\n                                <button type=\"button\" class=\"btn btn-sm btn-outline\" onclick=\"clearAllCourses()\">Limpar SeleÃ§Ã£o</button>\n                            </div>\n                        </div>\n                        \n                        <div class=\"courses-grid\" id=\"coursesGrid\">\n                            <!-- Courses will be loaded here dynamically -->\n                            <div class=\"loading-state\">\n                                <div class=\"spinner\"></div>\n                                <p>Carregando cursos disponÃ­veis...</p>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"tab-navigation\">\n                        <button type=\"button\" class=\"btn btn-secondary\" onclick=\"switchPlanTab('basic')\">\n                            â† Voltar: InformaÃ§Ãµes BÃ¡sicas\n                        </button>\n                        <button type=\"button\" class=\"btn btn-primary\" onclick=\"switchPlanTab('advanced')\">\n                            PrÃ³ximo: ConfiguraÃ§Ãµes â†’\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Tab 3: Advanced Configuration -->\n                <div id=\"planTab-advanced\" class=\"plan-tab-content\">\n                    <div class=\"tab-header\">\n                        <h3>âš™ï¸ ConfiguraÃ§Ãµes AvanÃ§adas</h3>\n                        <p>Configure recursos especiais e limitaÃ§Ãµes do plano</p>\n                    </div>\n                    \n                    <div class=\"form-grid\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Aulas por Semana</label>\n                            <select class=\"form-select\" id=\"planClassesPerWeek\">\n                                <option value=\"1\">1 aula por semana</option>\n                                <option value=\"2\" selected>2 aulas por semana</option>\n                                <option value=\"3\">3 aulas por semana</option>\n                                <option value=\"4\">4 aulas por semana</option>\n                                <option value=\"5\">5 aulas por semana</option>\n                                <option value=\"unlimited\">â™¾ï¸ Ilimitado</option>\n                            </select>\n                        </div>\n                        \n                        <div class=\"form-group\">\n                            <label class=\"form-label\">MÃ¡ximo de Aulas por MÃªs</label>\n                            <input type=\"number\" class=\"form-input\" id=\"planMaxClasses\" min=\"1\" max=\"50\" placeholder=\"Ex: 8 aulas\">\n                            <small class=\"form-hint\">Deixe em branco para ilimitado</small>\n                        </div>\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Recursos Extras</label>\n                        <div class=\"extras-grid\">\n                            <label class=\"checkbox-label\">\n                                <input type=\"checkbox\" id=\"planPersonalTraining\"> \n                                ðŸ’ª Personal Training\n                            </label>\n                            <label class=\"checkbox-label\">\n                                <input type=\"checkbox\" id=\"planNutrition\"> \n                                ðŸ¥— Plano Nutricional\n                            </label>\n                            <label class=\"checkbox-label\">\n                                <input type=\"checkbox\" id=\"planAllModalities\"> \n                                ðŸ¥‹ Todas Modalidades\n                            </label>\n                            <label class=\"checkbox-label\">\n                                <input type=\"checkbox\" id=\"planFreezeOption\"> \n                                â„ï¸ Permite Congelar\n                            </label>\n                        </div>\n                    </div>\n                    \n                    <div class=\"tab-navigation\">\n                        <button type=\"button\" class=\"btn btn-secondary\" onclick=\"switchPlanTab('courses')\">\n                            â† Voltar: Cursos Associados\n                        </button>\n                        <button type=\"button\" class=\"btn btn-primary\" onclick=\"switchPlanTab('preview')\">\n                            PrÃ³ximo: Preview â†’\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Tab 4: Preview -->\n                <div id=\"planTab-preview\" class=\"plan-tab-content\">\n                    <div class=\"tab-header\">\n                        <h3>ðŸ‘ï¸ Preview do Plano</h3>\n                        <p>Visualize como o plano ficarÃ¡ antes de criar</p>\n                    </div>\n                    \n                    <div id=\"planPreview\" class=\"preview-container\">\n                        <div class=\"preview-card\">\n                            <div class=\"preview-header\">\n                                <h4 id=\"previewPlanName\">Nome do Plano</h4>\n                                <div class=\"preview-price\" id=\"previewPlanPrice\">R$ 0,00</div>\n                            </div>\n                            <div class=\"preview-body\">\n                                <p id=\"previewPlanDescription\">DescriÃ§Ã£o do plano</p>\n                                <div class=\"preview-details\">\n                                    <div class=\"detail-item\">\n                                        <span class=\"detail-label\">Categoria:</span>\n                                        <span class=\"detail-value\" id=\"previewCategory\">-</span>\n                                    </div>\n                                    <div class=\"detail-item\">\n                                        <span class=\"detail-label\">Tipo de CobranÃ§a:</span>\n                                        <span class=\"detail-value\" id=\"previewBillingType\">-</span>\n                                    </div>\n                                    <div class=\"detail-item\">\n                                        <span class=\"detail-label\">Cursos Inclusos:</span>\n                                        <span class=\"detail-value\" id=\"previewCourses\">-</span>\n                                    </div>\n                                    <div class=\"detail-item\">\n                                        <span class=\"detail-label\">Aulas por Semana:</span>\n                                        <span class=\"detail-value\" id=\"previewClassesPerWeek\">-</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"tab-navigation\">\n                        <button type=\"button\" class=\"btn btn-secondary\" onclick=\"switchPlanTab('advanced')\">\n                            â† Voltar: ConfiguraÃ§Ãµes\n                        </button>\n                        <button type=\"submit\" class=\"btn btn-primary btn-large\">\n                            âœ¨ Criar Plano\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Hidden legacy field for compatibility -->\n                <select id=\"planCourse\" multiple style=\"display: none;\"></select>\n            </form>\n        </div>\n    </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Add Course Modal -->\n    <div id=\"addCourseModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 800px;\">\n            <div class=\"modal-header\">\n                <h2 class=\"modal-title\">Novo Curso</h2>\n                <button class=\"close-btn\" onclick=\"closeModal('addCourseModal')\">&times;</button>\n            </div>\n            <form id=\"addCourseForm\">\n                <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Nome do Curso</label>\n                        <input type=\"text\" class=\"form-input\" id=\"courseName\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Categoria</label>\n                        <select class=\"form-select\" id=\"courseCategory\" required>\n                            <option value=\"ADULT\">Adulto</option>\n                            <option value=\"INICIANTE1\">Iniciante 1</option>\n                            <option value=\"INICIANTE2\">Iniciante 2</option>\n                            <option value=\"INICIANTE3\">Iniciante 3</option>\n                            <option value=\"HEROI1\">HerÃ³i 1</option>\n                            <option value=\"HEROI2\">HerÃ³i 2</option>\n                            <option value=\"HEROI3\">HerÃ³i 3</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">DescriÃ§Ã£o</label>\n                    <textarea class=\"form-input\" id=\"courseDescription\" rows=\"3\"></textarea>\n                </div>\n                \n                <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;\">\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">NÃ­vel</label>\n                        <select class=\"form-select\" id=\"courseLevel\" required>\n                            <option value=\"BEGINNER\">Iniciante</option>\n                            <option value=\"INTERMEDIATE\">IntermediÃ¡rio</option>\n                            <option value=\"ADVANCED\">AvanÃ§ado</option>\n                            <option value=\"EXPERT\">Especialista</option>\n                        </select>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Total de Aulas</label>\n                        <input type=\"number\" class=\"form-input\" id=\"courseTotalClasses\" min=\"1\" max=\"100\" value=\"48\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Aulas por Semana</label>\n                        <input type=\"number\" class=\"form-input\" id=\"courseClassesPerWeek\" min=\"1\" max=\"7\" value=\"2\" required>\n                    </div>\n                </div>\n                \n                <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;\">\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">DuraÃ§Ã£o (semanas)</label>\n                        <input type=\"number\" class=\"form-input\" id=\"courseDuration\" min=\"1\" max=\"52\" value=\"24\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Idade MÃ­nima</label>\n                        <input type=\"number\" class=\"form-input\" id=\"courseMinAge\" min=\"5\" max=\"100\" value=\"16\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Idade MÃ¡xima</label>\n                        <input type=\"number\" class=\"form-input\" id=\"courseMaxAge\" min=\"5\" max=\"100\">\n                    </div>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Objetivos do Curso (um por linha)</label>\n                    <textarea class=\"form-input\" id=\"courseObjectives\" rows=\"4\" \n                        placeholder=\"Ex: Desenvolver tÃ©cnicas bÃ¡sicas de defesa pessoal&#10;Melhorar condicionamento fÃ­sico&#10;Aumentar autoconfianÃ§a\"></textarea>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Requisitos (um por linha)</label>\n                    <textarea class=\"form-input\" id=\"courseRequirements\" rows=\"3\" \n                        placeholder=\"Ex: Atestado mÃ©dico&#10;Termo de responsabilidade&#10;Uniforme adequado\"></textarea>\n                </div>\n                \n                <div class=\"form-actions\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeModal('addCourseModal')\">Cancelar</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Criar Curso</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Edit Course Modal -->\n    <div id=\"editCourseModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 800px;\">\n            <div class=\"modal-header\">\n                <h2 class=\"modal-title\">Editar Curso</h2>\n                <button class=\"close-btn\" onclick=\"closeModal('editCourseModal')\">&times;</button>\n            </div>\n            <form id=\"editCourseForm\">\n                <input type=\"hidden\" id=\"editCourseId\">\n                <!-- Same fields as add course, but with edit prefix -->\n                <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Nome do Curso</label>\n                        <input type=\"text\" class=\"form-input\" id=\"editCourseName\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Categoria</label>\n                        <select class=\"form-select\" id=\"editCourseCategory\" required>\n                            <option value=\"ADULT\">Adulto</option>\n                            <option value=\"INICIANTE1\">Iniciante 1</option>\n                            <option value=\"INICIANTE2\">Iniciante 2</option>\n                            <option value=\"INICIANTE3\">Iniciante 3</option>\n                            <option value=\"HEROI1\">HerÃ³i 1</option>\n                            <option value=\"HEROI2\">HerÃ³i 2</option>\n                            <option value=\"HEROI3\">HerÃ³i 3</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">DescriÃ§Ã£o</label>\n                    <textarea class=\"form-input\" id=\"editCourseDescription\" rows=\"3\"></textarea>\n                </div>\n                \n                <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;\">\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">NÃ­vel</label>\n                        <select class=\"form-select\" id=\"editCourseLevel\" required>\n                            <option value=\"BEGINNER\">Iniciante</option>\n                            <option value=\"INTERMEDIATE\">IntermediÃ¡rio</option>\n                            <option value=\"ADVANCED\">AvanÃ§ado</option>\n                            <option value=\"EXPERT\">Especialista</option>\n                        </select>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Total de Aulas</label>\n                        <input type=\"number\" class=\"form-input\" id=\"editCourseTotalClasses\" min=\"1\" max=\"100\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Aulas por Semana</label>\n                        <input type=\"number\" class=\"form-input\" id=\"editCourseClassesPerWeek\" min=\"1\" max=\"7\" required>\n                    </div>\n                </div>\n                \n                <div class=\"form-actions\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeModal('editCourseModal')\">Cancelar</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Salvar AlteraÃ§Ãµes</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n\n    <!-- Add Subscription Modal -->\n    <div id=\"addSubscriptionModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 600px;\">\n            <div class=\"modal-header\">\n                <h2 class=\"modal-title\">Nova Assinatura</h2>\n                <button class=\"close-btn\" onclick=\"closeModal('addSubscriptionModal')\">&times;</button>\n            </div>\n            <form id=\"addSubscriptionForm\">\n                <div class=\"form-group\">\n                    <label class=\"form-label\">Aluno</label>\n                    <select class=\"form-select\" id=\"subscriptionStudent\" required>\n                        <option value=\"\">Selecione um aluno...</option>\n                        <!-- Options will be loaded dynamically -->\n                    </select>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Plano</label>\n                    <select class=\"form-select\" id=\"subscriptionPlan\" required>\n                        <option value=\"\">Selecione um plano...</option>\n                        <!-- Options will be loaded dynamically -->\n                    </select>\n                </div>\n                \n                <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Data de InÃ­cio</label>\n                        <input type=\"date\" class=\"form-input\" id=\"subscriptionStartDate\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">PreÃ§o Personalizado (opcional)</label>\n                        <input type=\"number\" class=\"form-input\" id=\"subscriptionCustomPrice\" placeholder=\"Deixe vazio para usar preÃ§o do plano\" step=\"0.01\" min=\"0\">\n                    </div>\n                </div>\n                \n                <div class=\"form-actions\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeModal('addSubscriptionModal')\">Cancelar</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Criar Assinatura</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Lesson Plan Modal -->\n    <div id=\"lessonPlanModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 700px;\">\n            <div class=\"modal-header\">\n                <h2 class=\"modal-title\">Plano de Aula</h2>\n                <button class=\"close-btn\" onclick=\"closeModal('lessonPlanModal')\">&times;</button>\n            </div>\n            <form id=\"lessonPlanForm\">\n                <input type=\"hidden\" id=\"lessonCourseId\">\n                <input type=\"hidden\" id=\"lessonNumber\">\n                \n                <div style=\"display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;\">\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">TÃ­tulo da Aula</label>\n                        <input type=\"text\" class=\"form-input\" id=\"lessonTitle\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">DuraÃ§Ã£o (min)</label>\n                        <input type=\"number\" class=\"form-input\" id=\"lessonDuration\" min=\"30\" max=\"180\" value=\"60\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Dificuldade</label>\n                        <select class=\"form-select\" id=\"lessonDifficulty\" required>\n                            <option value=\"BEGINNER\">Iniciante</option>\n                            <option value=\"INTERMEDIATE\">IntermediÃ¡rio</option>\n                            <option value=\"ADVANCED\">AvanÃ§ado</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Objetivos da Aula</label>\n                    <textarea class=\"form-input\" id=\"lessonObjectives\" rows=\"2\" \n                        placeholder=\"Ex: Aprender tÃ©cnica de soco direto, Praticar defesa contra estrangulamento\"></textarea>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Aquecimento (10-15 min)</label>\n                    <textarea class=\"form-input\" id=\"lessonWarmUp\" rows=\"3\" \n                        placeholder=\"Ex: Corrida leve, alongamento dinÃ¢mico, exercÃ­cios articulares\"></textarea>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">ConteÃºdo Principal (30-40 min)</label>\n                    <textarea class=\"form-input\" id=\"lessonMainContent\" rows=\"4\" \n                        placeholder=\"Ex: DemonstraÃ§Ã£o da tÃ©cnica, prÃ¡tica em pares, aplicaÃ§Ã£o em situaÃ§Ãµes simuladas\"></textarea>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Desaquecimento (5-10 min)</label>\n                    <textarea class=\"form-input\" id=\"lessonCoolDown\" rows=\"2\" \n                        placeholder=\"Ex: Alongamento estÃ¡tico, respiraÃ§Ã£o, relaxamento\"></textarea>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Equipamentos NecessÃ¡rios</label>\n                    <input type=\"text\" class=\"form-input\" id=\"lessonEquipment\" \n                        placeholder=\"Ex: Paos, luvas, colchonetes (separar por vÃ­rgula)\">\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">AdaptaÃ§Ãµes para Necessidades Especiais</label>\n                    <textarea class=\"form-input\" id=\"lessonAdaptations\" rows=\"2\" \n                        placeholder=\"Ex: ExercÃ­cios modificados para pessoas com mobilidade reduzida\"></textarea>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">ObservaÃ§Ãµes e Notas</label>\n                    <textarea class=\"form-input\" id=\"lessonNotes\" rows=\"2\" \n                        placeholder=\"Ex: Enfatizar seguranÃ§a, atenÃ§Ã£o especial ao alinhamento corporal\"></textarea>\n                </div>\n                \n                <div class=\"form-actions\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeModal('lessonPlanModal')\">Cancelar</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Salvar Plano</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Lesson Feedback Modal -->\n    <div id=\"lessonFeedbackModal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h2 class=\"modal-title\">Feedback PÃ³s-Aula</h2>\n                <button class=\"close-btn\" onclick=\"closeModal('lessonFeedbackModal')\">&times;</button>\n            </div>\n            <form id=\"lessonFeedbackForm\">\n                <input type=\"hidden\" id=\"feedbackCourseId\">\n                <input type=\"hidden\" id=\"feedbackLessonNumber\">\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Como foi a aula? (Geral)</label>\n                    <textarea class=\"form-input\" id=\"feedbackGeneral\" rows=\"3\" \n                        placeholder=\"Ex: Aula correu bem, alunos participativos, tÃ©cnica foi bem assimilada\"></textarea>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Dificuldades Observadas</label>\n                    <textarea class=\"form-input\" id=\"feedbackDifficulties\" rows=\"3\" \n                        placeholder=\"Ex: Alguns alunos tiveram dificuldade com o movimento de quadril\"></textarea>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Melhorias para PrÃ³xima Aula</label>\n                    <textarea class=\"form-input\" id=\"feedbackImprovements\" rows=\"3\" \n                        placeholder=\"Ex: Revisar tÃ©cnica bÃ¡sica, dar mais tempo para prÃ¡tica individual\"></textarea>\n                </div>\n                \n                <div class=\"form-group\">\n                    <label class=\"form-label\">Alunos Presentes</label>\n                    <input type=\"number\" class=\"form-input\" id=\"feedbackStudentsPresent\" min=\"0\">\n                </div>\n                \n                <div class=\"form-actions\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeModal('lessonFeedbackModal')\">Cancelar</button>\n                    <button type=\"submit\" class=\"btn btn-primary\">Salvar Feedback</button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <script>\n        // ==========================================\n        // GLOBAL VARIABLES\n        // ==========================================\n        \n        // Knowledge Base System\n        let knowledgeBase = [];\n        let ragChunks = [];\n        let uploadedDocuments = [];\n        let currentUploadTab = 'documents';\n        \n        // ==========================================\n        // KNOWLEDGE BASE PERSISTENCE FUNCTIONS\n        // ==========================================\n        \n        // Save knowledge base to localStorage\n        function saveKnowledgeBaseToStorage() {\n            try {\n                localStorage.setItem('academiaKnowledgeBase', JSON.stringify(knowledgeBase));\n                localStorage.setItem('academiaRAGChunks', JSON.stringify(ragChunks));\n                console.log('ðŸ’¾ Base de conhecimento salva no localStorage');\n            } catch (error) {\n                console.error('âŒ Erro ao salvar base de conhecimento:', error);\n            }\n        }\n        \n        // Load knowledge base from localStorage\n        function loadKnowledgeBaseFromStorage() {\n            try {\n                const storedKnowledgeBase = localStorage.getItem('academiaKnowledgeBase');\n                const storedRAGChunks = localStorage.getItem('academiaRAGChunks');\n                \n                if (storedKnowledgeBase) {\n                    knowledgeBase = JSON.parse(storedKnowledgeBase);\n                    console.log('ðŸ“š Base de conhecimento carregada do localStorage:', knowledgeBase.length, 'itens');\n                }\n                \n                if (storedRAGChunks) {\n                    ragChunks = JSON.parse(storedRAGChunks);\n                    console.log('ðŸ§  Chunks RAG carregados do localStorage:', ragChunks.length, 'chunks');\n                } else if (knowledgeBase.length > 0) {\n                    // Regenerate chunks if knowledge base exists but chunks don't\n                    generateRAGChunks();\n                }\n                \n                return knowledgeBase.length > 0;\n            } catch (error) {\n                console.error('âŒ Erro ao carregar base de conhecimento:', error);\n                return false;\n            }\n        }\n        \n        // Clear knowledge base from localStorage\n        function clearKnowledgeBaseStorage() {\n            try {\n                localStorage.removeItem('academiaKnowledgeBase');\n                localStorage.removeItem('academiaRAGChunks');\n                knowledgeBase = [];\n                ragChunks = [];\n                console.log('ðŸ—‘ï¸ Base de conhecimento limpa do localStorage');\n            } catch (error) {\n                console.error('âŒ Erro ao limpar base de conhecimento:', error);\n            }\n        }\n        \n        // Define essential functions immediately\n        window.openKnowledgeUploader = function() {\n            console.log('ðŸ“š Abrindo base de conhecimento...');\n            try {\n                openDocumentUploader();\n            } catch (error) {\n                console.error('âŒ Erro ao abrir document uploader:', error);\n                alert('Erro ao abrir o modal de upload. Verifique o console.');\n            }\n        };\n        \n        window.testRAGSystem = function() {\n            console.log('ðŸ—ºï¸ Abrindo teste RAG...');\n            document.getElementById('ragTestModal').classList.add('active');\n        };\n        \n        window.reindexKnowledgeBase = function() {\n            console.log('âš¡ Reindexando base...');\n            try {\n                if (typeof generateRAGChunks === 'function') {\n                    generateRAGChunks();\n                }\n                if (typeof updateKnowledgeBaseStats === 'function') {\n                    updateKnowledgeBaseStats();\n                }\n                if (typeof showToast === 'function') {\n                    showToast('Base reindexada!', 'success');\n                }\n            } catch (error) {\n                console.error('âŒ Erro ao reindexar:', error);\n            }\n        };\n        \n        window.searchKnowledgeBase = function() {\n            console.log('ðŸ” Buscando...');\n            try {\n                const query = document.getElementById('knowledgeSearchInput')?.value.trim();\n                if (query && typeof searchKnowledgeContentInMain === 'function') {\n                    searchKnowledgeContentInMain(query);\n                } else if (typeof displayKnowledgeContentInMain === 'function') {\n                    displayKnowledgeContentInMain();\n                }\n            } catch (error) {\n                console.error('âŒ Erro na busca:', error);\n            }\n        };\n        \n        // Global variables for student editing\n        let currentEditingStudentId = null;\n        let currentEditingStudent = null;\n\n        // Dedicated student edit page function (uses full page) - MOVED TO TOP\n        async function openStudentEditPage(studentId) {\n            try {\n                console.log('ðŸ”„ Abrindo pÃ¡gina de ediÃ§Ã£o do aluno:', studentId);\n                console.log('ðŸ” Debug: studentId recebido:', studentId, typeof studentId);\n                \n                if (!studentId) {\n                    throw new Error('ID do estudante nÃ£o fornecido');\n                }\n                \n                currentEditingStudentId = studentId;\n\n                // Find student in existing data first\n                let student = null;\n                console.log('ðŸ” Debug: Verificando allStudents:', typeof allStudents, allStudents ? allStudents.length : 'undefined');\n                \n                if (typeof allStudents !== 'undefined' && allStudents) {\n                    student = allStudents.find(s => s.id === studentId);\n                    console.log('ðŸ” Debug: Estudante encontrado em allStudents:', !!student);\n                }\n                \n                if (!student) {\n                    console.log('ðŸ” Debug: Buscando estudante via API...');\n                    // Fallback: fetch from API\n                    const response = await fetch(`/api/students`);\n                    const data = await response.json();\n                    \n                    console.log('ðŸ” Debug: Resposta da API:', data.success, data.data ? data.data.length : 'sem dados');\n                    \n                    if (!data.success) {\n                        throw new Error(data.message || 'Erro ao carregar dados do estudante');\n                    }\n                    \n                    student = data.data.find(s => s.id === studentId);\n                    console.log('ðŸ” Debug: Estudante encontrado na API:', !!student);\n                }\n\n                if (!student) {\n                    throw new Error('Estudante nÃ£o encontrado com ID: ' + studentId);\n                }\n\n                console.log('âœ… Debug: Estudante carregado:', student.user?.firstName, student.user?.lastName);\n                currentEditingStudent = student;\n                \n                // Check if elements exist before manipulating them\n                const studentsSection = document.getElementById('students');\n                const editPageSection = document.getElementById('student-edit-page');\n                \n                console.log('ðŸ” Debug: Elementos DOM encontrados:', !!studentsSection, !!editPageSection);\n                \n                if (!studentsSection || !editPageSection) {\n                    throw new Error('Elementos da pÃ¡gina nÃ£o encontrados');\n                }\n                \n                // Hide students list and show edit page\n                studentsSection.style.display = 'none';\n                editPageSection.style.display = 'block';\n                \n                console.log('âœ… Debug: Tela de ediÃ§Ã£o exibida');\n                \n                // Update page header with student info\n                try {\n                    updateEditPageHeader(student);\n                    console.log('âœ… Debug: Header atualizado');\n                } catch (headerError) {\n                    console.error('âŒ Erro no header:', headerError);\n                }\n                \n                // Load the edit form\n                try {\n                    loadEditPageForm(student);\n                    console.log('âœ… Debug: FormulÃ¡rio carregado');\n                } catch (formError) {\n                    console.error('âŒ Erro no formulÃ¡rio:', formError);\n                }\n                \n                // Update sidebar with student stats\n                try {\n                    updateEditPageSidebar(student);\n                    console.log('âœ… Debug: Sidebar atualizado');\n                } catch (sidebarError) {\n                    console.error('âŒ Erro no sidebar:', sidebarError);\n                }\n                \n                // Set active tab to edit\n                try {\n                    switchPageTab('edit');\n                    console.log('âœ… Debug: Tab ativado');\n                } catch (tabError) {\n                    console.error('âŒ Erro no tab:', tabError);\n                }\n                \n                console.log('âœ… PÃ¡gina de ediÃ§Ã£o carregada com sucesso');\n                \n            } catch (error) {\n                console.error('âŒ Erro ao abrir pÃ¡gina de ediÃ§Ã£o:', error);\n                alert(`Erro ao abrir ediÃ§Ã£o: ${error.message}`); // Usando alert para garantir que vemos o erro\n            }\n        }\n\n        // Update edit page header with student information\n        function updateEditPageHeader(student) {\n            const user = student.user || {};\n            const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim() || 'Aluno sem nome';\n            const studentId = student.id;\n            const category = student.category || 'N/A';\n            \n            document.getElementById('editPageStudentName').textContent = fullName;\n            document.getElementById('editPageStudentId').textContent = `ID: ${studentId}`;\n            document.getElementById('editPageStudentCategory').textContent = `Categoria: ${category}`;\n        }\n\n        // Load form in the edit page\n        function loadEditPageForm(student) {\n            const formContainer = document.getElementById('pageFormContainer');\n            \n            // Create form HTML with all student fields\n            formContainer.innerHTML = `\n                <form id=\"editPageStudentForm\" style=\"display: grid; gap: 2rem;\">\n                    <!-- Personal Information Section -->\n                    <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;\">\n                        <h4 style=\"color: #F8FAFC; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                            ðŸ‘¤ InformaÃ§Ãµes Pessoais\n                        </h4>\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                            <div class=\"form-group\">\n                                <label for=\"pageFirstName\" style=\"color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;\">Nome</label>\n                                <input type=\"text\" id=\"pageFirstName\" value=\"${student.user?.firstName || ''}\" \n                                       style=\"width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;\" required>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"pageLastName\" style=\"color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;\">Sobrenome</label>\n                                <input type=\"text\" id=\"pageLastName\" value=\"${student.user?.lastName || ''}\" \n                                       style=\"width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;\" required>\n                            </div>\n                        </div>\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;\">\n                            <div class=\"form-group\">\n                                <label for=\"pageEmail\" style=\"color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;\">Email</label>\n                                <input type=\"email\" id=\"pageEmail\" value=\"${student.user?.email || ''}\" \n                                       style=\"width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;\" required>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"pagePhone\" style=\"color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;\">Telefone</label>\n                                <input type=\"tel\" id=\"pagePhone\" value=\"${student.user?.phone || ''}\" \n                                       style=\"width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;\">\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Academic Information Section -->\n                    <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;\">\n                        <h4 style=\"color: #F8FAFC; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                            ðŸ¥‹ InformaÃ§Ãµes AcadÃªmicas\n                        </h4>\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                            <div class=\"form-group\">\n                                <label for=\"pageCategory\" style=\"color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;\">Categoria</label>\n                                <select id=\"pageCategory\" style=\"width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;\">\n                                    <option value=\"ADULT\" ${student.category === 'ADULT' ? 'selected' : ''}>Adulto</option>\n                                    <option value=\"CHILD\" ${student.category === 'CHILD' ? 'selected' : ''}>CrianÃ§a</option>\n                                    <option value=\"INICIANTE1\" ${student.category === 'INICIANTE1' ? 'selected' : ''}>Iniciante 1</option>\n                                    <option value=\"INICIANTE2\" ${student.category === 'INICIANTE2' ? 'selected' : ''}>Iniciante 2</option>\n                                </select>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"pageGender\" style=\"color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;\">GÃªnero</label>\n                                <select id=\"pageGender\" style=\"width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;\">\n                                    <option value=\"MASCULINO\" ${student.gender === 'MASCULINO' ? 'selected' : ''}>Masculino</option>\n                                    <option value=\"FEMININO\" ${student.gender === 'FEMININO' ? 'selected' : ''}>Feminino</option>\n                                    <option value=\"OUTRO\" ${student.gender === 'OUTRO' ? 'selected' : ''}>Outro</option>\n                                </select>\n                            </div>\n                        </div>\n                        <div style=\"margin-top: 1rem;\">\n                            <label for=\"pagePhysicalCondition\" style=\"color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;\">CondiÃ§Ã£o FÃ­sica</label>\n                            <select id=\"pagePhysicalCondition\" style=\"width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;\">\n                                <option value=\"INICIANTE\" ${student.physicalCondition === 'INICIANTE' ? 'selected' : ''}>Iniciante</option>\n                                <option value=\"INTERMEDIARIO\" ${student.physicalCondition === 'INTERMEDIARIO' ? 'selected' : ''}>IntermediÃ¡rio</option>\n                                <option value=\"AVANCADO\" ${student.physicalCondition === 'AVANCADO' ? 'selected' : ''}>AvanÃ§ado</option>\n                            </select>\n                        </div>\n                    </div>\n\n                    <!-- Additional Information Section -->\n                    <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;\">\n                        <h4 style=\"color: #F8FAFC; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                            ðŸ“‹ InformaÃ§Ãµes Adicionais\n                        </h4>\n                        <div style=\"display: grid; gap: 1rem;\">\n                            <div class=\"form-group\">\n                                <label for=\"pageEmergencyContact\" style=\"color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;\">Contato de EmergÃªncia</label>\n                                <input type=\"text\" id=\"pageEmergencyContact\" value=\"${student.emergencyContact || ''}\" \n                                       style=\"width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;\">\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"pageMedicalConditions\" style=\"color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;\">CondiÃ§Ãµes MÃ©dicas</label>\n                                <textarea id=\"pageMedicalConditions\" rows=\"3\" \n                                          style=\"width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC; resize: vertical;\">${student.medicalConditions || ''}</textarea>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Hidden fields -->\n                    <input type=\"hidden\" id=\"pageStudentId\" value=\"${student.id}\">\n                    <input type=\"hidden\" id=\"pageUserId\" value=\"${student.userId}\">\n                </form>\n            `;\n\n            // Add real-time form validation\n            const inputs = formContainer.querySelectorAll('input, select, textarea');\n            inputs.forEach(input => {\n                input.addEventListener('input', updatePageFormProgress);\n            });\n\n            updatePageFormProgress();\n        }\n\n        // Update sidebar with student stats\n        function updateEditPageSidebar(student) {\n            document.getElementById('sidebarXP').textContent = student.totalXP || '0';\n            document.getElementById('sidebarLevel').textContent = `Nv. ${student.globalLevel || '1'}`;\n            document.getElementById('sidebarStreak').textContent = `${student.currentStreak || '0'} dias`;\n        }\n\n        // Switch between page tabs\n        function switchPageTab(tabName) {\n            // Hide all tab contents\n            document.querySelectorAll('.page-tab-content').forEach(tab => {\n                tab.style.display = 'none';\n            });\n\n            // Remove active class from all tab buttons\n            document.querySelectorAll('.page-tab-btn').forEach(btn => {\n                btn.classList.remove('active');\n                btn.style.background = 'transparent';\n                btn.style.color = '#94A3B8';\n            });\n\n            // Show selected tab content\n            const selectedTab = document.getElementById(`page-tab-${tabName}`);\n            if (selectedTab) {\n                selectedTab.style.display = 'block';\n            }\n\n            // Add active class to selected tab button\n            const selectedBtn = document.querySelector(`[data-page-tab=\"${tabName}\"]`);\n            if (selectedBtn) {\n                selectedBtn.classList.add('active');\n                selectedBtn.style.background = 'linear-gradient(135deg, #3B82F6, #1D4ED8)';\n                selectedBtn.style.color = 'white';\n            }\n\n            // Load specific tab content\n            loadPageTabContent(tabName);\n        }\n\n        // Load content for specific tab\n        function loadPageTabContent(tabName) {\n            if (!currentEditingStudent) return;\n\n            switch (tabName) {\n                case 'ai-dashboard':\n                    loadAIDashboardContent();\n                    break;\n                case 'plans':\n                    loadPlansTabContent();\n                    break;\n                case 'classes':\n                    loadClassesTabContent();\n                    break;\n                case 'courses':\n                    loadCoursesTabContent();\n                    break;\n                case 'progress':\n                    loadProgressTabContent();\n                    break;\n                default:\n                    // Edit tab is already loaded\n                    break;\n            }\n        }\n\n        // Update form progress\n        function updatePageFormProgress() {\n            const form = document.getElementById('editPageStudentForm');\n            if (!form) return;\n\n            const inputs = form.querySelectorAll('input[required], select[required]');\n            let completed = 0;\n            \n            inputs.forEach(input => {\n                if (input.value && input.value.trim() !== '') {\n                    completed++;\n                }\n            });\n            \n            const progress = Math.round((completed / inputs.length) * 100);\n            const progressBar = document.getElementById('pageFormProgress');\n            if (progressBar) {\n                progressBar.style.width = `${progress}%`;\n            }\n        }\n\n        // Tab content loading functions - placeholder implementations\n        function loadAIDashboardContent() {\n            const content = document.getElementById('page-tab-ai-dashboard');\n            if (content) {\n                content.innerHTML = `\n                    <div style=\"text-align: center; padding: 2rem; color: #94A3B8;\">\n                        ðŸ¤– Dashboard IA em desenvolvimento\n                    </div>\n                `;\n            }\n        }\n\n        async function loadPlansTabContent() {\n            const content = document.getElementById('page-tab-plans');\n            if (!content) return;\n            \n            // ðŸ”’ USAR MÃ“DULO ISOLADO SE DISPONÃVEL\n            if (window.ModuleLoader && window.ModuleLoader.isModuleLoaded('PlansManager')) {\n                try {\n                    console.log('ðŸ”Œ Usando mÃ³dulo PlansManager isolado');\n                    \n                    // Criar container para o mÃ³dulo\n                    content.innerHTML = '<div id=\"isolatedPlansContainer\"></div>';\n                    \n                    // Inicializar e carregar dados\n                    const plansManager = window.PlansManager.init(currentEditingStudentId);\n                    await plansManager.loadPlansData();\n                    \n                    // Renderizar interface isolada\n                    const success = plansManager.renderPlansInterface('isolatedPlansContainer');\n                    \n                    if (success) {\n                        console.log('âœ… Interface de planos carregada via mÃ³dulo isolado');\n                        if (window.showToast) {\n                            window.showToast('ðŸ“¦ Usando interface modular protegida', 'info');\n                        }\n                        return; // Sai da funÃ§Ã£o, usa mÃ³dulo isolado\n                    }\n                } catch (error) {\n                    console.warn('âš ï¸ MÃ³dulo isolado falhou, usando fallback:', error);\n                }\n            }\n            \n            // ðŸ”„ FALLBACK PARA SISTEMA ORIGINAL\n            // Show loading state\n            content.innerHTML = `\n                <div style=\"display: flex; align-items: center; justify-content: center; padding: 3rem; color: #94A3B8;\">\n                    <div style=\"text-align: center;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ”„</div>\n                        <div>Carregando planos e assinaturas...</div>\n                    </div>\n                </div>\n            `;\n            \n            if (!currentEditingStudentId) {\n                content.innerHTML = `\n                    <div style=\"text-align: center; padding: 3rem; color: #EF4444;\">\n                        <div style=\"font-size: 3rem; margin-bottom: 1rem;\">âŒ</div>\n                        <div style=\"font-weight: 600;\">Erro: ID do aluno nÃ£o encontrado</div>\n                    </div>\n                `;\n                return;\n            }\n\n            try {\n                // Load available billing plans first - try multiple routes\n                console.log('ðŸ“¡ Fetching billing plans...');\n                let plansData = null;\n                let availablePlans = [];\n                \n                // Try financial route first, then fallback to billing-plans, then mock data\n                try {\n                    const financialResponse = await fetch('/api/financial/plans');\n                    if (financialResponse.ok) {\n                        plansData = await financialResponse.json();\n                        console.log('ðŸ“Š Financial plans response:', plansData);\n                        availablePlans = plansData.success ? plansData.data.filter(plan => plan.isActive) : [];\n                    } else {\n                        throw new Error('Financial route not available');\n                    }\n                } catch (error) {\n                    console.log('âš ï¸ Financial route failed, trying billing-plans...');\n                    try {\n                        const billingResponse = await fetch('/api/billing-plans');\n                        if (billingResponse.ok) {\n                            plansData = await billingResponse.json();\n                            console.log('ðŸ“Š Billing plans response:', plansData);\n                            availablePlans = plansData.success ? plansData.data.filter(plan => plan.isActive) : [];\n                        } else {\n                            throw new Error('Billing route not available');\n                        }\n                    } catch (billingError) {\n                        console.log('âš ï¸ Both routes failed, using comprehensive mock data...');\n                        // Use comprehensive mock data as fallback\n                        availablePlans = [\n                            {\n                                id: 'plan-1',\n                                name: 'Plano BÃ¡sico Adulto',\n                                description: 'Ideal para iniciantes - 2 aulas por semana com tÃ©cnicas fundamentais',\n                                category: 'ADULT',\n                                price: '150.00',\n                                billingType: 'MONTHLY',\n                                classesPerWeek: 2,\n                                maxClasses: 8,\n                                hasPersonalTraining: false,\n                                hasNutrition: false,\n                                allowFreeze: true,\n                                isActive: true,\n                                features: ['Aulas em grupo', 'Material didÃ¡tico', 'Suporte tÃ©cnico']\n                            },\n                            {\n                                id: 'plan-2',\n                                name: 'Plano Premium Adulto',\n                                description: 'Acesso ilimitado com benefÃ­cios extras e personal training',\n                                category: 'ADULT',\n                                price: '280.00',\n                                billingType: 'MONTHLY',\n                                classesPerWeek: 0,\n                                maxClasses: null,\n                                hasPersonalTraining: true,\n                                hasNutrition: true,\n                                allowFreeze: true,\n                                isActive: true,\n                                features: ['Aulas ilimitadas', 'Personal training', 'Consultoria nutricional', 'Acesso VIP']\n                            },\n                            {\n                                id: 'plan-3',\n                                name: 'Plano Infantil',\n                                description: 'Krav Maga Kids - 2 aulas por semana com foco lÃºdico e educativo',\n                                category: 'CHILD',\n                                price: '120.00',\n                                billingType: 'MONTHLY',\n                                classesPerWeek: 2,\n                                maxClasses: 8,\n                                hasPersonalTraining: false,\n                                hasNutrition: false,\n                                allowFreeze: true,\n                                isActive: true,\n                                features: ['MÃ©todo lÃºdico', 'Acompanhamento parental', 'Certificado de progresso']\n                            },\n                            {\n                                id: 'plan-4',\n                                name: 'Plano Feminino Especializado',\n                                description: 'Turmas exclusivamente femininas com foco em defesa pessoal',\n                                category: 'FEMALE',\n                                price: '170.00',\n                                billingType: 'MONTHLY',\n                                classesPerWeek: 3,\n                                maxClasses: 12,\n                                hasPersonalTraining: false,\n                                hasNutrition: false,\n                                allowFreeze: true,\n                                isActive: true,\n                                features: ['HorÃ¡rios exclusivos', 'Instrutora especializada', 'Workshops de autodefesa']\n                            },\n                            {\n                                id: 'plan-5',\n                                name: 'Plano Senior Adaptado',\n                                description: 'Treinamento adaptado para terceira idade com foco em mobilidade',\n                                category: 'SENIOR',\n                                price: '130.00',\n                                billingType: 'MONTHLY',\n                                classesPerWeek: 2,\n                                maxClasses: 8,\n                                hasPersonalTraining: false,\n                                hasNutrition: true,\n                                allowFreeze: true,\n                                isActive: true,\n                                features: ['Baixo impacto', 'Acompanhamento mÃ©dico', 'ExercÃ­cios adaptados']\n                            },\n                            {\n                                id: 'plan-6',\n                                name: 'Plano Anual Premium',\n                                description: 'Desconto especial para pagamento anual - 12 meses de acesso completo',\n                                category: 'ADULT',\n                                price: '1800.00',\n                                billingType: 'YEARLY',\n                                classesPerWeek: 0,\n                                maxClasses: null,\n                                hasPersonalTraining: true,\n                                hasNutrition: true,\n                                allowFreeze: true,\n                                isActive: true,\n                                features: ['Desconto de 20%', 'Acesso ilimitado', 'Personal training', 'Consultoria completa']\n                            },\n                            {\n                                id: 'plan-7',\n                                name: 'Plano Trimestral Intensivo',\n                                description: '3 meses de treinamento intensivo com resultados acelerados',\n                                category: 'ADULT',\n                                price: '450.00',\n                                billingType: 'QUARTERLY',\n                                classesPerWeek: 4,\n                                maxClasses: 48,\n                                hasPersonalTraining: false,\n                                hasNutrition: true,\n                                allowFreeze: false,\n                                isActive: true,\n                                features: ['4x por semana', 'Plano nutricional', 'AvaliaÃ§Ã£o mensal']\n                            },\n                            {\n                                id: 'plan-8',\n                                name: 'Plano Familiar',\n                                description: 'Desconto especial para famÃ­lias - atÃ© 4 membros',\n                                category: 'ADULT',\n                                price: '400.00',\n                                billingType: 'MONTHLY',\n                                classesPerWeek: 3,\n                                maxClasses: 48,\n                                hasPersonalTraining: false,\n                                hasNutrition: false,\n                                allowFreeze: true,\n                                isActive: true,\n                                features: ['AtÃ© 4 pessoas', 'HorÃ¡rios flexÃ­veis', 'Desconto familiar']\n                            },\n                            {\n                                id: 'plan-9',\n                                name: 'Plano VIP Master',\n                                description: 'ExperiÃªncia completa com todos os benefÃ­cios e exclusividades',\n                                category: 'ADULT',\n                                price: '500.00',\n                                billingType: 'MONTHLY',\n                                classesPerWeek: 0,\n                                maxClasses: null,\n                                hasPersonalTraining: true,\n                                hasNutrition: true,\n                                allowFreeze: true,\n                                isActive: true,\n                                features: ['Acesso VIP', 'Personal 2x/semana', 'Nutricionista', 'Prioridade mÃ¡xima']\n                            },\n                            {\n                                id: 'plan-10',\n                                name: 'Plano Corporativo',\n                                description: 'Para empresas - treinamento de equipes com desconto especial',\n                                category: 'ADULT',\n                                price: '800.00',\n                                billingType: 'MONTHLY',\n                                classesPerWeek: 5,\n                                maxClasses: null,\n                                hasPersonalTraining: false,\n                                hasNutrition: false,\n                                allowFreeze: true,\n                                isActive: true,\n                                features: ['AtÃ© 10 pessoas', 'HorÃ¡rio corporativo', 'RelatÃ³rios de progresso']\n                            }\n                        ];\n                    }\n                }\n                \n                // Try to load student subscription data (may not exist)\n                let currentPlan = null;\n                let hasActiveSubscription = false;\n                \n                try {\n                    const subscriptionResponse = await fetch(`/api/students/${currentEditingStudentId}/subscription`);\n                    if (subscriptionResponse.ok) {\n                        const subscriptionData = await subscriptionResponse.json();\n                        if (subscriptionData.success && subscriptionData.data) {\n                            currentPlan = subscriptionData.data.plan;\n                            hasActiveSubscription = true;\n                        }\n                    }\n                } catch (subscriptionError) {\n                    console.log('Nenhuma assinatura encontrada para o aluno (isso Ã© normal)');\n                }\n                \n                content.innerHTML = `\n                    <div style=\"display: grid; gap: 2rem; max-width: 1000px; margin: 0 auto;\">\n                        \n                        <!-- Header with Quick Actions -->\n                        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;\">\n                            <h3 style=\"color: #F8FAFC; margin: 0; display: flex; align-items: center; gap: 0.75rem;\">\n                                <span style=\"font-size: 1.5rem;\">ðŸ“‹</span>\n                                GestÃ£o de Planos\n                            </h3>\n                            <div style=\"display: flex; gap: 0.75rem;\">\n                                ${!hasActiveSubscription ? `\n                                    <button onclick=\"showQuickPlanSelector()\" \n                                            style=\"background: linear-gradient(135deg, #10B981, #059669); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);\">\n                                        ðŸš€ Assinar Plano Agora\n                                    </button>\n                                ` : `\n                                    <button onclick=\"showPlanChangeOptions()\" \n                                            style=\"background: #3B82F6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;\">\n                                        ðŸ”„ Trocar Plano\n                                    </button>\n                                    <button onclick=\"showPlanCancellation()\" \n                                            style=\"background: rgba(239, 68, 68, 0.1); color: #EF4444; border: 1px solid #EF4444; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;\">\n                                        âœ‹ Cancelar Plano\n                                    </button>\n                                `}\n                            </div>\n                        </div>\n\n                        <!-- Current Plan Status -->\n                        <div style=\"background: linear-gradient(135deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.8)); border-radius: 16px; padding: 2rem; border: 1px solid ${hasActiveSubscription ? '#10B981' : '#EF4444'}; position: relative; overflow: hidden;\">\n                            ${hasActiveSubscription ? `\n                                <!-- Active Plan Display -->\n                                <div style=\"position: absolute; top: 1rem; right: 1rem;\">\n                                    <span style=\"background: linear-gradient(135deg, #10B981, #059669); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.875rem; font-weight: 600; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);\">\n                                        âœ… ATIVO\n                                    </span>\n                                </div>\n                                <div style=\"margin-bottom: 1.5rem;\">\n                                    <h4 style=\"color: #10B981; margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: 700;\">\n                                        ${currentPlan.name || 'Plano sem nome'}\n                                    </h4>\n                                    <p style=\"color: #94A3B8; margin: 0; font-size: 1rem;\">\n                                        ${currentPlan.description || 'Sem descriÃ§Ã£o disponÃ­vel'}\n                                    </p>\n                                </div>\n                                \n                                <div style=\"display: grid; grid-template-columns: 1fr auto; gap: 2rem; align-items: center;\">\n                                    <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;\">\n                                        <div style=\"background: rgba(16, 185, 129, 0.1); border-radius: 12px; padding: 1rem; border: 1px solid rgba(16, 185, 129, 0.2);\">\n                                            <div style=\"color: #10B981; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;\">ðŸ’³ VALOR MENSAL</div>\n                                            <div style=\"color: #F8FAFC; font-size: 1.5rem; font-weight: bold;\">R$ ${(parseFloat(currentPlan.price) || 0).toFixed(2)}</div>\n                                        </div>\n                                        <div style=\"background: rgba(59, 130, 246, 0.1); border-radius: 12px; padding: 1rem; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                                            <div style=\"color: #3B82F6; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;\">ðŸŽ¯ CATEGORIA</div>\n                                            <div style=\"color: #F8FAFC; font-size: 1.125rem; font-weight: 600;\">${currentPlan.category || currentPlan.targetCategory || 'N/A'}</div>\n                                        </div>\n                                        <div style=\"background: rgba(245, 158, 11, 0.1); border-radius: 12px; padding: 1rem; border: 1px solid rgba(245, 158, 11, 0.2);\">\n                                            <div style=\"color: #F59E0B; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;\">ðŸ“… AULAS/SEMANA</div>\n                                            <div style=\"color: #F8FAFC; font-size: 1.125rem; font-weight: 600;\">${currentPlan.classesPerWeek || 'Ilimitado'}</div>\n                                        </div>\n                                    </div>\n                                    \n                                    <div style=\"text-align: center;\">\n                                        <button onclick=\"showPlanDetails('${currentPlan.id}')\" \n                                                style=\"background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; color: #3B82F6; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; margin-bottom: 0.5rem; width: 100%;\">\n                                            ðŸ“„ Ver Detalhes\n                                        </button>\n                                        <br>\n                                        <button onclick=\"showPlanChangeOptions()\" \n                                                style=\"background: #3B82F6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; width: 100%;\">\n                                            ðŸ”„ Trocar Plano\n                                        </button>\n                                    </div>\n                                </div>\n                            ` : `\n                                <!-- No Plan State -->\n                                <div style=\"text-align: center; padding: 2rem;\">\n                                    <div style=\"font-size: 4rem; margin-bottom: 1rem;\">âš ï¸</div>\n                                    <h4 style=\"color: #EF4444; margin: 0 0 1rem 0; font-size: 1.5rem; font-weight: 700;\">\n                                        Nenhum Plano Ativo\n                                    </h4>\n                                    <p style=\"color: #94A3B8; margin: 0 0 2rem 0; font-size: 1.125rem;\">\n                                        Este aluno nÃ£o possui um plano de pagamento ativo. Para liberar o acesso Ã s aulas, Ã© necessÃ¡rio assinar um plano.\n                                    </p>\n                                    <button onclick=\"showQuickPlanSelector()\" \n                                            style=\"background: linear-gradient(135deg, #10B981, #059669); color: white; border: none; padding: 1rem 2rem; border-radius: 12px; font-size: 1.125rem; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);\">\n                                        ðŸš€ Assinar Plano Agora\n                                    </button>\n                                </div>\n                            `}\n                        </div>\n\n                        <!-- Complete Plans Showcase (visible when no plan) -->\n                        ${!hasActiveSubscription ? `\n                            <div id=\"quickPlanSelector\" style=\"background: rgba(15, 23, 42, 0.5); border-radius: 16px; padding: 2rem; border: 1px solid #334155;\">\n                                <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;\">\n                                    <h4 style=\"color: #F8FAFC; margin: 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 0.75rem;\">\n                                        âš¡ Escolha seu Plano Ideal\n                                        <span style=\"background: #EF4444; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem;\">URGENTE</span>\n                                    </h4>\n                                    <div style=\"display: flex; gap: 0.75rem; align-items: center;\">\n                                        <span style=\"color: #94A3B8; font-size: 0.875rem;\">${availablePlans.length} planos disponÃ­veis</span>\n                                        <select id=\"planTypeFilter\" onchange=\"filterPlansByType()\" style=\"background: #1E293B; border: 1px solid #475569; color: #F8FAFC; padding: 0.5rem; border-radius: 6px; font-size: 0.875rem;\">\n                                            <option value=\"\">Todos os tipos</option>\n                                            <option value=\"MONTHLY\">Mensais</option>\n                                            <option value=\"QUARTERLY\">Trimestrais</option>\n                                            <option value=\"YEARLY\">Anuais</option>\n                                        </select>\n                                    </div>\n                                </div>\n                                \n                                <!-- Plans organized by category -->\n                                <div style=\"display: grid; gap: 2rem;\">\n                                    \n                                    <!-- Popular Plans Section -->\n                                    <div>\n                                        <h5 style=\"color: #10B981; margin: 0 0 1rem 0; font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;\">\n                                            ðŸ”¥ Mais Populares\n                                        </h5>\n                                        <div class=\"plans-grid\" style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem;\">\n                                            ${availablePlans.filter(plan => ['plan-2', 'plan-1', 'plan-9'].includes(plan.id)).map(plan => `\n                                                <div class=\"plan-card-enhanced\" data-category=\"${plan.category}\" data-billing=\"${plan.billingType}\" \n                                                     style=\"background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9)); \n                                                            border: 2px solid #10B981; border-radius: 16px; padding: 1.5rem; cursor: pointer; \n                                                            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden;\" \n                                                     onclick=\"selectPlanQuickly('${plan.id}')\" \n                                                     onmouseover=\"this.style.borderColor='#059669'; this.style.transform='translateY(-6px)'; this.style.boxShadow='0 20px 40px rgba(16, 185, 129, 0.3)'\" \n                                                     onmouseout=\"this.style.borderColor='#10B981'; this.style.transform='translateY(0)'; this.style.boxShadow='none'\">\n                                            \n                                                    <!-- Popular badge -->\n                                                    <div style=\"position: absolute; top: -1px; right: -1px; background: linear-gradient(135deg, #F59E0B, #D97706); \n                                                                color: white; padding: 0.5rem 1rem; border-radius: 0 16px 0 16px; font-size: 0.75rem; font-weight: 600;\">\n                                                        ${plan.id === 'plan-2' ? 'ðŸ‘‘ PREMIUM' : plan.id === 'plan-9' ? 'ðŸ’Ž VIP' : 'ðŸ”¥ POPULAR'}\n                                                    </div>\n                                                    \n                                                    <div style=\"margin-bottom: 1.5rem;\">\n                                                        <h5 style=\"color: #F8FAFC; margin: 0 0 0.5rem 0; font-size: 1.25rem; font-weight: 700;\">\n                                                            ${plan.name}\n                                                        </h5>\n                                                        <p style=\"color: #94A3B8; margin: 0 0 1rem 0; font-size: 0.875rem; line-height: 1.4;\">\n                                                            ${plan.description}\n                                                        </p>\n                                                    </div>\n                                                    \n                                                    <div style=\"display: grid; grid-template-columns: 1fr auto; gap: 1.5rem; align-items: center; margin-bottom: 1.5rem;\">\n                                                        <div style=\"display: grid; gap: 0.75rem;\">\n                                                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                                                <span style=\"color: #94A3B8; font-size: 0.875rem;\">ðŸ“Š Categoria:</span>\n                                                                <span style=\"background: rgba(59, 130, 246, 0.2); color: #3B82F6; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600;\">\n                                                                    ${plan.category}\n                                                                </span>\n                                                            </div>\n                                                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                                                <span style=\"color: #94A3B8; font-size: 0.875rem;\">ðŸ“… Aulas/semana:</span>\n                                                                <span style=\"color: #F8FAFC; font-weight: 600; font-size: 0.875rem;\">\n                                                                    ${plan.classesPerWeek === 0 ? 'Ilimitado' : plan.classesPerWeek + 'x'}\n                                                                </span>\n                                                            </div>\n                                                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                                                <span style=\"color: #94A3B8; font-size: 0.875rem;\">ðŸ’³ CobranÃ§a:</span>\n                                                                <span style=\"color: #F8FAFC; font-weight: 600; font-size: 0.875rem;\">\n                                                                    ${plan.billingType === 'MONTHLY' ? 'Mensal' : \n                                                                      plan.billingType === 'QUARTERLY' ? 'Trimestral' : \n                                                                      plan.billingType === 'YEARLY' ? 'Anual' : plan.billingType}\n                                                                </span>\n                                                            </div>\n                                                        </div>\n                                                        \n                                                        <div style=\"text-align: center;\">\n                                                            <div style=\"color: #10B981; font-size: 2rem; font-weight: bold; margin-bottom: 0.25rem;\">\n                                                                R$ ${(parseFloat(plan.price)).toFixed(0)}\n                                                            </div>\n                                                            <div style=\"color: #94A3B8; font-size: 0.75rem;\">\n                                                                /${plan.billingType === 'MONTHLY' ? 'mÃªs' : \n                                                                  plan.billingType === 'QUARTERLY' ? 'trim' : \n                                                                  plan.billingType === 'YEARLY' ? 'ano' : 'perÃ­odo'}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    \n                                                    <!-- Features -->\n                                                    ${plan.features && plan.features.length > 0 ? `\n                                                        <div style=\"margin-bottom: 1.5rem;\">\n                                                            <div style=\"color: #F8FAFC; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.75rem;\">âœ¨ Incluso:</div>\n                                                            <div style=\"display: grid; gap: 0.5rem;\">\n                                                                ${plan.features.slice(0, 3).map(feature => `\n                                                                    <div style=\"color: #94A3B8; font-size: 0.875rem; display: flex; align-items: center; gap: 0.5rem;\">\n                                                                        <span style=\"color: #10B981;\">âœ“</span> ${feature}\n                                                                    </div>\n                                                                `).join('')}\n                                                                ${plan.features.length > 3 ? `\n                                                                    <div style=\"color: #3B82F6; font-size: 0.875rem; font-weight: 600;\">\n                                                                        +${plan.features.length - 3} benefÃ­cios adicionais\n                                                                    </div>\n                                                                ` : ''}\n                                                            </div>\n                                                        </div>\n                                                    ` : ''}\n                                                    \n                                                    <!-- Special badges -->\n                                                    <div style=\"display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap;\">\n                                                        ${plan.hasPersonalTraining ? '<span style=\"background: rgba(16, 185, 129, 0.2); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">ðŸƒâ€â™‚ï¸ Personal</span>' : ''}\n                                                        ${plan.hasNutrition ? '<span style=\"background: rgba(245, 158, 11, 0.2); color: #F59E0B; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">ðŸ¥— NutriÃ§Ã£o</span>' : ''}\n                                                        ${plan.allowFreeze ? '<span style=\"background: rgba(59, 130, 246, 0.2); color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">â„ï¸ Congelamento</span>' : ''}\n                                                    </div>\n                                                    \n                                                    <button style=\"background: linear-gradient(135deg, #10B981, #059669); color: white; border: none; \n                                                                   padding: 1rem; border-radius: 12px; width: 100%; font-weight: 700; font-size: 1rem;\n                                                                   cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);\"\n                                                            onmouseover=\"this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(16, 185, 129, 0.4)'\"\n                                                            onmouseout=\"this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.3)'\">\n                                                        ðŸš€ Assinar Agora\n                                                    </button>\n                                                </div>\n                                            `).join('')}\n                                        </div>\n                                    </div>\n                                    \n                                    <!-- All Other Plans Section -->\n                                    <div>\n                                        <h5 style=\"color: #3B82F6; margin: 0 0 1rem 0; font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;\">\n                                            ðŸ“‹ Todos os Planos (${availablePlans.length})\n                                        </h5>\n                                        <div class=\"all-plans-grid\" style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;\">\n                                            ${availablePlans.map(plan => `\n                                                <div class=\"plan-card-compact\" data-category=\"${plan.category}\" data-billing=\"${plan.billingType}\" \n                                                     style=\"background: rgba(30, 41, 59, 0.6); border: 1px solid #475569; border-radius: 12px; \n                                                            padding: 1.25rem; cursor: pointer; transition: all 0.3s;\" \n                                                     onclick=\"selectPlanQuickly('${plan.id}')\" \n                                                     onmouseover=\"this.style.borderColor='#3B82F6'; this.style.transform='translateY(-2px)'\" \n                                                     onmouseout=\"this.style.borderColor='#475569'; this.style.transform='translateY(0)'\">\n                                                    \n                                                    <div style=\"display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;\">\n                                                        <div style=\"flex: 1;\">\n                                                            <h6 style=\"color: #F8FAFC; margin: 0 0 0.5rem 0; font-size: 1rem; font-weight: 600;\">\n                                                                ${plan.name}\n                                                            </h6>\n                                                            <div style=\"color: #94A3B8; font-size: 0.875rem; line-height: 1.3; margin-bottom: 0.75rem;\">\n                                                                ${plan.description.substring(0, 80)}${plan.description.length > 80 ? '...' : ''}\n                                                            </div>\n                                                        </div>\n                                                        <div style=\"text-align: right; margin-left: 1rem;\">\n                                                            <div style=\"color: #10B981; font-size: 1.25rem; font-weight: bold;\">\n                                                                R$ ${(parseFloat(plan.price)).toFixed(0)}\n                                                            </div>\n                                                            <div style=\"color: #94A3B8; font-size: 0.75rem;\">\n                                                                /${plan.billingType === 'MONTHLY' ? 'mÃªs' : \n                                                                  plan.billingType === 'QUARTERLY' ? 'trim' : \n                                                                  plan.billingType === 'YEARLY' ? 'ano' : 'perÃ­odo'}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    \n                                                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem; font-size: 0.875rem;\">\n                                                        <div style=\"display: flex; justify-content: space-between;\">\n                                                            <span style=\"color: #94A3B8;\">Categoria:</span>\n                                                            <span style=\"color: #F8FAFC; font-weight: 600;\">${plan.category}</span>\n                                                        </div>\n                                                        <div style=\"display: flex; justify-content: space-between;\">\n                                                            <span style=\"color: #94A3B8;\">Aulas:</span>\n                                                            <span style=\"color: #F8FAFC; font-weight: 600;\">\n                                                                ${plan.classesPerWeek === 0 ? 'Ilimitado' : plan.classesPerWeek + 'x/sem'}\n                                                            </span>\n                                                        </div>\n                                                    </div>\n                                                    \n                                                    <!-- Compact badges -->\n                                                    <div style=\"display: flex; gap: 0.25rem; margin-bottom: 1rem; flex-wrap: wrap;\">\n                                                        ${plan.hasPersonalTraining ? '<span style=\"background: rgba(16, 185, 129, 0.2); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 8px; font-size: 0.75rem;\">Personal</span>' : ''}\n                                                        ${plan.hasNutrition ? '<span style=\"background: rgba(245, 158, 11, 0.2); color: #F59E0B; padding: 0.25rem 0.5rem; border-radius: 8px; font-size: 0.75rem;\">NutriÃ§Ã£o</span>' : ''}\n                                                        ${plan.allowFreeze ? '<span style=\"background: rgba(59, 130, 246, 0.2); color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 8px; font-size: 0.75rem;\">Congelamento</span>' : ''}\n                                                    </div>\n                                                    \n                                                    <button style=\"background: #3B82F6; color: white; border: none; padding: 0.75rem; \n                                                                   border-radius: 8px; width: 100%; font-weight: 600; font-size: 0.875rem;\n                                                                   cursor: pointer; transition: all 0.2s;\" \n                                                            onmouseover=\"this.style.background='#2563EB'\"\n                                                            onmouseout=\"this.style.background='#3B82F6'\">\n                                                        Selecionar Plano\n                                                    </button>\n                                                </div>\n                                            `).join('')}\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        ` : ''}\n                            </div>\n                        ` : ''}\n\n                        <!-- All Plans Section (collapsible) -->\n                        <div id=\"allPlansSection\" style=\"background: rgba(15, 23, 42, 0.5); border-radius: 16px; padding: 2rem; border: 1px solid #334155; ${!hasActiveSubscription ? 'display: none;' : ''}\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;\">\n                                <h4 style=\"color: #F8FAFC; margin: 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 0.75rem;\">\n                                    ðŸ“‹ Todos os Planos DisponÃ­veis\n                                </h4>\n                                <div style=\"display: flex; gap: 0.75rem;\">\n                                    <select id=\"planCategoryFilter\" onchange=\"filterPlansByCategory()\" style=\"background: #1E293B; border: 1px solid #475569; color: #F8FAFC; padding: 0.5rem; border-radius: 6px;\">\n                                        <option value=\"\">Todas as categorias</option>\n                                        <option value=\"ADULT\">Adulto</option>\n                                        <option value=\"CHILD\">Infantil</option>\n                                        <option value=\"SENIOR\">Senior</option>\n                                        <option value=\"FEMALE\">Feminino</option>\n                                    </select>\n                                    <select id=\"planBillingTypeFilter\" onchange=\"filterPlansByType()\" style=\"background: #1E293B; border: 1px solid #475569; color: #F8FAFC; padding: 0.5rem; border-radius: 6px;\">\n                                        <option value=\"\">Todos os tipos</option>\n                                        <option value=\"MONTHLY\">Mensal</option>\n                                        <option value=\"QUARTERLY\">Trimestral</option>\n                                        <option value=\"YEARLY\">Anual</option>\n                                        <option value=\"CREDIT_CARD_INSTALLMENT\">Parcelado</option>\n                                        <option value=\"RECURRING\">Recorrente</option>\n                                    </select>\n                                    <button onclick=\"toggleAllPlansView()\" \n                                            style=\"background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; color: #3B82F6; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;\">\n                                        ${hasActiveSubscription ? 'ðŸ“Š Expandir' : 'ðŸ“ Recolher'}\n                                    </button>\n                                </div>\n                            </div>\n                            \n                            <div id=\"plansGrid\" style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem;\">\n                                ${availablePlans.map(plan => `\n                                    <div class=\"plan-card\" data-category=\"${plan.category || ''}\" data-billing=\"${plan.billingType || plan.billingCycle || ''}\"\n                                         style=\"background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8)); \n                                                border: 2px solid ${currentPlan && currentPlan.id === plan.id ? '#10B981' : '#475569'}; \n                                                border-radius: 12px; padding: 1.5rem; transition: all 0.3s; position: relative;\">\n                                        \n                                        ${currentPlan && currentPlan.id === plan.id ? `\n                                            <div style=\"position: absolute; top: -1px; right: -1px; background: linear-gradient(135deg, #10B981, #059669); color: white; padding: 0.5rem 1rem; border-radius: 0 12px 0 12px; font-size: 0.75rem; font-weight: 600;\">\n                                                âœ… PLANO ATUAL\n                                            </div>\n                                        ` : ''}\n                                        \n                                        <div style=\"margin-bottom: 1.5rem;\">\n                                            <h5 style=\"color: #F8FAFC; margin: 0 0 0.5rem 0; font-size: 1.125rem; font-weight: 600;\">\n                                                ${plan.name || 'Plano sem nome'}\n                                            </h5>\n                                            <p style=\"color: #94A3B8; margin: 0; font-size: 0.875rem; line-height: 1.4;\">\n                                                ${plan.description || 'Sem descriÃ§Ã£o disponÃ­vel'}\n                                            </p>\n                                        </div>\n                                        \n                                        <div style=\"display: grid; grid-template-columns: 1fr auto; gap: 1rem; align-items: center; margin-bottom: 1.5rem;\">\n                                            <div style=\"display: grid; gap: 0.75rem;\">\n                                                <div style=\"display: flex; justify-content: space-between;\">\n                                                    <span style=\"color: #94A3B8; font-size: 0.875rem;\">Categoria:</span>\n                                                    <span style=\"color: #F8FAFC; font-weight: 600; font-size: 0.875rem;\">${plan.category || 'N/A'}</span>\n                                                </div>\n                                                <div style=\"display: flex; justify-content: space-between;\">\n                                                    <span style=\"color: #94A3B8; font-size: 0.875rem;\">Aulas/semana:</span>\n                                                    <span style=\"color: #F8FAFC; font-weight: 600; font-size: 0.875rem;\">${plan.classesPerWeek || 'Ilimitado'}</span>\n                                                </div>\n                                                <div style=\"display: flex; justify-content: space-between;\">\n                                                    <span style=\"color: #94A3B8; font-size: 0.875rem;\">DuraÃ§Ã£o:</span>\n                                                    <span style=\"color: #F8FAFC; font-weight: 600; font-size: 0.875rem;\">${\n                                                        (plan.billingType || plan.billingCycle) === 'MONTHLY' ? 'Mensal' : \n                                                        (plan.billingType || plan.billingCycle) === 'QUARTERLY' ? 'Trimestral' : \n                                                        (plan.billingType || plan.billingCycle) === 'YEARLY' ? 'Anual' : \n                                                        (plan.billingType || plan.billingCycle) === 'CREDIT_CARD_INSTALLMENT' ? 'Parcelado' :\n                                                        (plan.billingType || plan.billingCycle) === 'RECURRING' ? 'Recorrente' : 'N/A'\n                                                    }</span>\n                                                </div>\n                                            </div>\n                                            \n                                            <div style=\"text-align: right;\">\n                                                <div style=\"color: #10B981; font-size: 1.5rem; font-weight: bold; margin-bottom: 0.25rem;\">\n                                                    R$ ${(parseFloat(plan.price) || 0).toFixed(2)}\n                                                </div>\n                                                <div style=\"color: #94A3B8; font-size: 0.75rem;\">por mÃªs</div>\n                                            </div>\n                                        </div>\n                                        \n                                        <div style=\"display: flex; gap: 0.75rem;\">\n                                            ${!(currentPlan && currentPlan.id === plan.id) ? `\n                                                <button onclick=\"switchToPlan('${plan.id}')\" \n                                                        style=\"background: linear-gradient(135deg, #3B82F6, #2563EB); color: white; border: none; padding: 0.75rem; border-radius: 8px; flex: 1; font-weight: 600; cursor: pointer; transition: all 0.2s;\">\n                                                    ${hasActiveSubscription ? 'ðŸ”„ Trocar para Este' : 'ðŸš€ Assinar Plano'}\n                                                </button>\n                                            ` : `\n                                                <button style=\"background: rgba(16, 185, 129, 0.1); border: 1px solid #10B981; color: #10B981; padding: 0.75rem; border-radius: 8px; flex: 1; font-weight: 600; cursor: not-allowed;\">\n                                                    âœ… Plano Ativo\n                                                </button>\n                                            `}\n                                            <button onclick=\"showPlanDetails('${plan.id}')\" \n                                                    style=\"background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; color: #3B82F6; padding: 0.75rem; border-radius: 8px; cursor: pointer; transition: all 0.2s;\">\n                                                ðŸ“„\n                                            </button>\n                                        </div>\n                                    </div>\n                                `).join('')}\n                            </div>\n                            \n                            ${availablePlans.length === 0 ? `\n                                <div style=\"text-align: center; padding: 3rem; color: #94A3B8;\">\n                                    <div style=\"font-size: 3rem; margin-bottom: 1rem;\">ðŸ“‹</div>\n                                    <div style=\"font-size: 1.125rem; font-weight: 600;\">Nenhum plano disponÃ­vel</div>\n                                    <div style=\"font-size: 0.875rem; margin-top: 0.5rem;\">Entre em contato com a administraÃ§Ã£o para mais informaÃ§Ãµes</div>\n                                </div>\n                            ` : ''}\n                        </div>\n\n                        <!-- Payment History Section -->\n                        <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 16px; padding: 2rem; border: 1px solid #334155;\">\n                            <h4 style=\"color: #F8FAFC; margin: 0 0 1.5rem 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 0.75rem;\">\n                                ðŸ’° HistÃ³rico de Pagamentos\n                                <span style=\"background: rgba(245, 158, 11, 0.1); color: #F59E0B; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem;\">EM BREVE</span>\n                            </h4>\n                            <div style=\"background: rgba(30, 41, 59, 0.5); border-radius: 12px; padding: 2rem; text-align: center;\">\n                                <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“Š</div>\n                                <div style=\"color: #94A3B8; font-size: 1rem;\">\n                                    HistÃ³rico de pagamentos em desenvolvimento\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `;\n\n            } catch (error) {\n                console.error('Erro ao carregar dados dos planos:', error);\n                content.innerHTML = `\n                    <div style=\"text-align: center; padding: 3rem; color: #EF4444;\">\n                        <div style=\"font-size: 3rem; margin-bottom: 1rem;\">âŒ</div>\n                        <div style=\"font-weight: 600;\">Erro ao carregar dados dos planos</div>\n                        <div style=\"font-size: 0.875rem; margin-top: 0.5rem; color: #94A3B8;\">${error.message}</div>\n                        <button onclick=\"loadPlansTabContent()\" style=\"background: #3B82F6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; margin-top: 1rem; cursor: pointer;\">\n                            ðŸ”„ Tentar Novamente\n                        </button>\n                    </div>\n                `;\n            }\n        }\n\n        // ==========================================\n        // UX FUNCTIONS FOR ENHANCED PLAN MANAGEMENT\n        // ==========================================\n        \n        // Quick plan selector for users without plans\n        function showQuickPlanSelector() {\n            const selector = document.getElementById('quickPlanSelector');\n            if (selector) {\n                selector.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                selector.style.animation = 'pulse 1s ease-in-out';\n            }\n        }\n        \n        // Select plan quickly (one-click subscription)\n        async function selectPlanQuickly(planId) {\n            if (!currentEditingStudentId) {\n                showToast('Erro: ID do aluno nÃ£o encontrado', 'error');\n                return;\n            }\n            \n            try {\n                const confirmation = confirm('ðŸš€ Deseja assinar este plano para o aluno?');\n                if (!confirmation) return;\n                \n                showToast('â³ Processando assinatura...', 'info');\n                \n                // Create subscription (this would call the existing switchToPlan function)\n                await switchToPlan(planId);\n                \n                // Reload the tab to show the new subscription\n                setTimeout(() => {\n                    loadPlansTabContent();\n                    showToast('âœ… Plano assinado com sucesso!', 'success');\n                }, 1000);\n                \n            } catch (error) {\n                console.error('Erro ao assinar plano rapidamente:', error);\n                showToast('âŒ Erro ao assinar plano: ' + error.message, 'error');\n            }\n        }\n        \n        // Show plan change options for users with active plans\n        function showPlanChangeOptions() {\n            const allPlansSection = document.getElementById('allPlansSection');\n            if (allPlansSection) {\n                allPlansSection.style.display = 'block';\n                allPlansSection.scrollIntoView({ behavior: 'smooth', block: 'start' });\n                \n                // Highlight available plans\n                const planCards = allPlansSection.querySelectorAll('.plan-card');\n                planCards.forEach(card => {\n                    if (!card.querySelector('[style*=\"PLANO ATUAL\"]')) {\n                        card.style.animation = 'glow 2s ease-in-out';\n                        setTimeout(() => {\n                            card.style.animation = '';\n                        }, 2000);\n                    }\n                });\n            }\n            \n            showToast('ðŸ’¡ Selecione um novo plano abaixo para trocar', 'info');\n        }\n        \n        // Show plan cancellation options\n        function showPlanCancellation() {\n            const confirmation = confirm(`âš ï¸ CANCELAR PLANO\n                \nTem certeza que deseja cancelar o plano atual do aluno?\n\nâš ï¸ ATENÃ‡ÃƒO:\nâ€¢ O aluno perderÃ¡ acesso Ã s aulas\nâ€¢ A assinatura serÃ¡ encerrada imediatamente\nâ€¢ Esta aÃ§Ã£o nÃ£o pode ser desfeita\n\nConfirma o cancelamento?`);\n            \n            if (confirmation) {\n                cancelStudentPlan();\n            }\n        }\n        \n        // Cancel student plan\n        async function cancelStudentPlan() {\n            if (!currentEditingStudentId) {\n                showToast('Erro: ID do aluno nÃ£o encontrado', 'error');\n                return;\n            }\n            \n            try {\n                showToast('â³ Cancelando plano...', 'info');\n                \n                // Call API to cancel subscription (placeholder - implement actual API)\n                const response = await fetch(`/api/students/${currentEditingStudentId}/subscription`, {\n                    method: 'DELETE',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                });\n                \n                if (response.ok) {\n                    showToast('âœ… Plano cancelado com sucesso', 'success');\n                    // Reload the tab to reflect changes\n                    setTimeout(() => {\n                        loadPlansTabContent();\n                    }, 1000);\n                } else {\n                    throw new Error('Falha ao cancelar plano');\n                }\n                \n            } catch (error) {\n                console.error('Erro ao cancelar plano:', error);\n                showToast('âŒ Funcionalidade de cancelamento em desenvolvimento', 'info');\n            }\n        }\n        \n        // Show all plans (expand the collapsed section)\n        function showAllPlans() {\n            const allPlansSection = document.getElementById('allPlansSection');\n            if (allPlansSection) {\n                allPlansSection.style.display = 'block';\n                allPlansSection.scrollIntoView({ behavior: 'smooth', block: 'start' });\n            }\n        }\n        \n        // Toggle all plans view\n        function toggleAllPlansView() {\n            const allPlansSection = document.getElementById('allPlansSection');\n            const button = event.target;\n            \n            if (allPlansSection.style.display === 'none') {\n                allPlansSection.style.display = 'block';\n                button.textContent = 'ðŸ“ Recolher';\n                allPlansSection.scrollIntoView({ behavior: 'smooth', block: 'start' });\n            } else {\n                allPlansSection.style.display = 'none';\n                button.textContent = 'ðŸ“Š Expandir';\n            }\n        }\n        \n        // Filter plans by category\n        function filterPlansByCategory() {\n            const filter = document.getElementById('planCategoryFilter').value;\n            const planCards = document.querySelectorAll('.plan-card');\n            \n            planCards.forEach(card => {\n                const category = card.getAttribute('data-category');\n                if (!filter || category === filter) {\n                    card.style.display = 'block';\n                    card.style.animation = 'fadeIn 0.3s ease-in-out';\n                } else {\n                    card.style.display = 'none';\n                }\n            });\n            \n            // Show message if no plans match filter\n            const visibleCards = Array.from(planCards).filter(card => card.style.display !== 'none');\n            const plansGrid = document.getElementById('plansGrid');\n            \n            if (visibleCards.length === 0) {\n                if (!document.getElementById('noPlansMessage')) {\n                    const message = document.createElement('div');\n                    message.id = 'noPlansMessage';\n                    message.style.cssText = 'grid-column: 1 / -1; text-align: center; padding: 2rem; color: #94A3B8;';\n                    message.innerHTML = `\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ”</div>\n                        <div>Nenhum plano encontrado para a categoria selecionada</div>\n                    `;\n                    plansGrid.appendChild(message);\n                }\n            } else {\n                const existingMessage = document.getElementById('noPlansMessage');\n                if (existingMessage) {\n                    existingMessage.remove();\n                }\n            }\n        }\n        \n        // Filter plans by billing type (added for comprehensive filtering)\n        function filterPlansByType() {\n            const filter = document.getElementById('planBillingTypeFilter')?.value;\n            if (!filter) return;\n            \n            const planCards = document.querySelectorAll('.plan-card, .plan-card-compact');\n            \n            planCards.forEach(card => {\n                const billingType = card.getAttribute('data-billing');\n                if (!filter || billingType === filter || filter === 'ALL') {\n                    card.style.display = 'block';\n                    card.style.animation = 'fadeIn 0.3s ease-in-out';\n                } else {\n                    card.style.display = 'none';\n                }\n            });\n            \n            // Update count of visible plans\n            const visibleCards = Array.from(planCards).filter(card => card.style.display !== 'none');\n            console.log(`Filtered plans by type ${filter}: ${visibleCards.length} visible`);\n            \n            // Show message if no plans match filter\n            const plansGrid = document.getElementById('plansGrid');\n            if (plansGrid) {\n                if (visibleCards.length === 0) {\n                    if (!document.getElementById('noPlansMessage')) {\n                        const message = document.createElement('div');\n                        message.id = 'noPlansMessage';\n                        message.style.cssText = 'grid-column: 1 / -1; text-align: center; padding: 2rem; color: #94A3B8;';\n                        message.innerHTML = `\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ’³</div>\n                            <div>Nenhum plano encontrado para o tipo de cobranÃ§a selecionado</div>\n                        `;\n                        plansGrid.appendChild(message);\n                    }\n                } else {\n                    const existingMessage = document.getElementById('noPlansMessage');\n                    if (existingMessage) {\n                        existingMessage.remove();\n                    }\n                }\n            }\n            \n            showToast(`ðŸ’¡ Filtro aplicado: ${visibleCards.length} planos encontrados`, 'info');\n        }\n        \n        // Show plan details (modal or expanded view)\n        function showPlanDetails(planId) {\n            // For now, show a detailed alert - can be enhanced to a modal later\n            showToast('ðŸ’¡ Funcionalidade de detalhes do plano em desenvolvimento', 'info');\n            console.log('Showing details for plan:', planId);\n        }\n\n        function loadClassesTabContent() {\n            const content = document.getElementById('page-tab-classes');\n            if (content) {\n                content.innerHTML = `\n                    <div style=\"text-align: center; padding: 2rem; color: #94A3B8;\">\n                        ðŸ¥‹ Turmas e horÃ¡rios em desenvolvimento\n                    </div>\n                `;\n            }\n        }\n\n        function loadCoursesTabContent() {\n            const content = document.getElementById('page-tab-courses');\n            if (content) {\n                content.innerHTML = `\n                    <div style=\"text-align: center; padding: 2rem; color: #94A3B8;\">\n                        ðŸ“š Cursos e progresso em desenvolvimento\n                    </div>\n                `;\n            }\n        }\n\n        function loadProgressTabContent() {\n            const content = document.getElementById('page-tab-progress');\n            if (content) {\n                content.innerHTML = `\n                    <div style=\"text-align: center; padding: 2rem; color: #94A3B8;\">\n                        ðŸ“ˆ Progresso e conquistas em desenvolvimento\n                    </div>\n                `;\n            }\n        }\n\n        // Functions for plan management\n        async function createNewSubscription() {\n            if (!currentEditingStudentId) {\n                alert('Erro: ID do aluno nÃ£o encontrado');\n                return;\n            }\n            \n            // Simple implementation - could be expanded to show plan selection modal\n            const planId = prompt('Digite o ID do plano para criar nova assinatura:');\n            if (!planId) return;\n            \n            try {\n                const response = await fetch('/api/financial/subscriptions', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        studentId: currentEditingStudentId,\n                        planId: planId,\n                        status: 'ACTIVE',\n                        isActive: true\n                    })\n                });\n                \n                const result = await response.json();\n                \n                if (result.success) {\n                    alert('Assinatura criada com sucesso!');\n                    // Reload the plans tab to show updated data\n                    loadPlansTabContent();\n                } else {\n                    alert(`Erro ao criar assinatura: ${result.message}`);\n                }\n            } catch (error) {\n                console.error('Erro ao criar assinatura:', error);\n                alert(`Erro ao criar assinatura: ${error.message}`);\n            }\n        }\n        \n        async function switchToPlan(planId) {\n            if (!currentEditingStudentId) {\n                showToast('âŒ Erro: ID do aluno nÃ£o encontrado', 'error');\n                return;\n            }\n            \n            console.log('ðŸ”„ Switching to plan:', planId, 'for student:', currentEditingStudentId);\n            \n            try {\n                showToast('â³ Processando assinatura do plano...', 'info');\n                \n                // Create or update subscription - try multiple endpoints\n                let response;\n                try {\n                    // Try financial subscription route first\n                    response = await fetch('/api/financial/subscriptions', {\n                        method: 'POST',\n                        headers: {\n                            'Content-Type': 'application/json'\n                        },\n                        body: JSON.stringify({\n                            studentId: currentEditingStudentId,\n                            planId: planId\n                        })\n                    });\n                    \n                    if (!response.ok) {\n                        throw new Error('Financial route not available');\n                    }\n                } catch (error) {\n                    console.log('âš ï¸ Financial subscription route failed, trying student route...');\n                    // Fallback to student subscription route\n                    response = await fetch(`/api/students/${currentEditingStudentId}/subscription`, {\n                        method: 'PUT',\n                        headers: {\n                            'Content-Type': 'application/json'\n                        },\n                        body: JSON.stringify({\n                            planId: planId\n                        })\n                    });\n                }\n                \n                const result = await response.json();\n                console.log('ðŸ“Š Subscription result:', result);\n                \n                if (result.success) {\n                    showToast('âœ… Plano assinado com sucesso!', 'success');\n                    // Reload the plans tab to show updated data\n                    setTimeout(() => {\n                        loadPlansTabContent();\n                    }, 1000);\n                } else {\n                    throw new Error(result.message || 'Falha ao criar assinatura');\n                }\n            } catch (error) {\n                console.error('Erro ao trocar plano:', error);\n                showToast('âŒ Erro ao trocar plano: ' + error.message, 'error');\n            }\n        }\n\n        // Navigation system\n        document.addEventListener('DOMContentLoaded', function() {\n            console.log('ðŸš€ Dashboard carregado com sucesso!');\n            \n            // Setup navigation\n            const navButtons = document.querySelectorAll('.nav-link');\n            navButtons.forEach(button => {\n                button.addEventListener('click', function() {\n                    const page = this.getAttribute('data-page');\n                    showSection(page);\n                });\n            });\n            \n            // Load initial data\n            loadData();\n        });\n        \n        function showSection(pageName) {\n            console.log('ðŸ“„ Navegando para:', pageName);\n            \n            // Hide all sections\n            document.querySelectorAll('.content-section').forEach(section => {\n                section.classList.remove('active');\n            });\n            \n            // Remove active from all buttons\n            document.querySelectorAll('.nav-link').forEach(button => {\n                button.classList.remove('active');\n            });\n            \n            // Show target section\n            const targetSection = document.getElementById(pageName);\n            if (targetSection) {\n                targetSection.classList.add('active');\n                console.log('âœ… SeÃ§Ã£o ativa:', pageName);\n            } else {\n                console.error('âŒ SeÃ§Ã£o nÃ£o encontrada:', pageName);\n            }\n            \n            // Activate current button\n            const activeButton = document.querySelector(`[data-page=\"${pageName}\"]`);\n            if (activeButton) {\n                activeButton.classList.add('active');\n            }\n\n            // Load data for specific sections\n            console.log('ðŸ” Checking page data loading for:', pageName);\n            if (pageName === 'course-management') {\n                loadCourses();\n            } else if (pageName === 'attendance') {\n                loadAttendanceList();\n            } else if (pageName === 'students') {\n                loadStudents();\n            } else if (pageName === 'student-portal') {\n                // Reset student portal to login screen\n                document.getElementById('studentLoginSection').style.display = 'block';\n                document.getElementById('studentDashboard').style.display = 'none';\n                currentStudent = null;\n            } else if (pageName === 'public-checkin') {\n                loadPublicCheckin();\n            } else if (pageName === 'payment-plans') {\n                console.log('ðŸ“„ Loading payment plans page...');\n                loadPaymentPlansList();\n            } else if (pageName === 'financial-responsibles') {\n                console.log('ðŸ‘¥ Loading financial responsibles page...');\n                loadFinancialResponsiblesList();\n            }\n        }\n        \n        function loadData() {\n            console.log('ðŸ“Š Carregando dados...');\n            \n            // Students count will be updated by real API data\n            \n            // Try to load real data from API\n            fetch('/api/students')\n                .then(response => response.json())\n                .then(data => {\n                    if (data.success && data.data.length > 0) {\n                        const total = data.data.length;\n                        const active = data.data.filter(s => s.user && s.user.isActive).length;\n                        \n                        document.getElementById('total-students').textContent = total;\n                        document.getElementById('active-students').textContent = active;\n                        document.getElementById('students-count').textContent = total;\n                        \n                        console.log('âœ… Dados dos alunos atualizados:', total, 'total,', active, 'ativos');\n                    }\n                })\n                .catch(error => {\n                    console.log('âš ï¸ Usando dados padrÃ£o - API nÃ£o disponÃ­vel');\n                });\n        }\n        \n        // Test functions\n        window.testNavigation = function(page) {\n            showSection(page || 'students');\n        };\n        \n        console.log('ðŸŽ¯ Sistema pronto! Teste: testNavigation(\"students\")');\n        \n        // Payment plans loading function\n        async function loadPaymentPlansList() {\n            console.log('ðŸ”„ Loading payment plans list...');\n            try {\n                const loadingElement = document.getElementById('plansLoadingState');\n                const emptyElement = document.getElementById('plansEmptyState');\n                \n                if (loadingElement) loadingElement.style.display = 'block';\n                if (emptyElement) emptyElement.style.display = 'none';\n                \n                console.log('ðŸ“¡ Fetching billing plans from API...');\n                const response = await fetch('/api/billing-plans');\n                const result = await response.json();\n                \n                console.log('ðŸ“Š API Response:', result);\n                \n                if (result.success) {\n                    allPlans = result.data || [];\n                    console.log('ðŸ“‹ Plans loaded:', allPlans.length, 'plans');\n                    \n                    updatePaymentPlansTable(allPlans);\n                    updatePlansStats(allPlans);\n                    \n                    if (allPlans.length === 0) {\n                        if (loadingElement) loadingElement.style.display = 'none';\n                        if (emptyElement) emptyElement.style.display = 'block';\n                        console.log('âš ï¸ No plans found - showing empty state');\n                    } else {\n                        if (loadingElement) loadingElement.style.display = 'none';\n                        console.log('âœ… Plans table updated successfully');\n                    }\n                } else {\n                    throw new Error(result.message || 'Failed to load plans');\n                }\n            } catch (error) {\n                console.error('Erro ao carregar planos:', error);\n                \n                // Initialize allPlans as empty array to prevent undefined errors\n                allPlans = [];\n                updatePaymentPlansTable(allPlans);\n                updatePlansStats(allPlans);\n                \n                const loadingElement = document.getElementById('plansLoadingState');\n                if (loadingElement) {\n                    loadingElement.innerHTML = `\n                        <div style=\"text-align: center; color: #EF4444; padding: 3rem;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">âš ï¸</div>\n                            <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Erro ao carregar planos</div>\n                            <div style=\"font-size: 0.9rem; opacity: 0.7;\">${error.message}</div>\n                        </div>\n                    `;\n                }\n            }\n        }\n        \n        // Global variables for payment plans\n        let allPlans = [];\n        let allCourses = [];\n        \n        // Update payment plans table\n        function updatePaymentPlansTable(plans) {\n            console.log('ðŸ”„ Updating payment plans table with', plans?.length, 'plans');\n            const tbody = document.getElementById('plansTableBody');\n            \n            if (!tbody) {\n                console.error('âŒ plansTableBody element not found in DOM');\n                return;\n            }\n            \n            if (!plans || !Array.isArray(plans)) {\n                console.warn('âš ï¸ Plans data is undefined or not an array:', plans);\n                tbody.innerHTML = '<tr><td colspan=\"7\" style=\"text-align: center; color: #94A3B8; padding: 2rem;\">Nenhum plano encontrado</td></tr>';\n                return;\n            }\n            \n            console.log('ðŸ“‹ Processing', plans.length, 'plans for table');\n            \n            tbody.innerHTML = plans.map(plan => {\n                const courseName = (allCourses && Array.isArray(allCourses)) \n                    ? allCourses.find(c => c.id === plan.courseId)?.name || 'Geral'\n                    : 'Geral';\n                \n                return `\n                <tr ondblclick=\"openPlanEditPage('${plan.id}')\" style=\"cursor: pointer;\">\n                    <td>\n                        <div class=\"student-name\">${plan.name || 'Plano sem nome'}</div>\n                        <div style=\"font-size: 0.8rem; color: #94A3B8;\">${plan.description || ''}</div>\n                    </td>\n                    <td>\n                        <span class=\"student-email\">${courseName}</span>\n                    </td>\n                    <td>\n                        <span class=\"badge ${plan.category === 'ADULT' ? 'success' : 'info'}\">\n                            ${plan.category || 'N/A'}\n                        </span>\n                    </td>\n                    <td>\n                        <span class=\"metric-value\" style=\"color: #10B981; font-weight: bold;\">\n                            R$ ${(parseFloat(plan.price) || 0).toFixed(2)}\n                        </span>\n                    </td>\n                    <td>\n                        <span class=\"badge ${plan.billingType === 'MONTHLY' ? 'info' : 'warning'}\">\n                            ${plan.billingType === 'MONTHLY' ? 'Mensal' : plan.billingType || 'N/A'}\n                        </span>\n                    </td>\n                    <td>\n                        <span class=\"badge info\">${plan.activeSubscriptions || 0}</span>\n                    </td>\n                    <td>\n                        <span class=\"badge ${plan.isActive ? 'success' : 'danger'}\">\n                            ${plan.isActive ? 'Ativo' : 'Inativo'}\n                        </span>\n                    </td>\n                    <td>\n                        <div class=\"action-buttons\">\n                            <button class=\"action-btn edit\" onclick=\"editPlan('${plan.id}')\" title=\"Editar\">\n                                âœï¸\n                            </button>\n                            <button class=\"action-btn delete\" onclick=\"deletePlan('${plan.id}')\" title=\"Excluir\">\n                                ðŸ—‘ï¸\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n                `;\n            }).join('');\n            \n            console.log('âœ… Table HTML updated. Rows in tbody:', tbody.children.length);\n        }\n        \n        // Update plans stats\n        function updatePlansStats(plans) {\n            if (!plans || !Array.isArray(plans)) return;\n            \n            const totalPlans = plans.length;\n            const activePlans = plans.filter(p => p.isActive).length;\n            const averagePrice = plans.length > 0 ? \n                plans.reduce((sum, plan) => sum + (parseFloat(plan.price) || 0), 0) / plans.length : 0;\n            const monthlyPlans = plans.filter(p => p.billingType === 'MONTHLY').length;\n            \n            // Update stat cards if they exist\n            const totalElement = document.getElementById('total-plans-stat');\n            const activeElement = document.getElementById('active-plans-stat');\n            const avgPriceElement = document.getElementById('avg-price-stat');\n            const monthlyElement = document.getElementById('monthly-plans-stat');\n            \n            if (totalElement) totalElement.textContent = totalPlans;\n            if (activeElement) activeElement.textContent = activePlans;\n            if (avgPriceElement) avgPriceElement.textContent = `R$ ${averagePrice.toFixed(2)}`;\n            if (monthlyElement) monthlyElement.textContent = monthlyPlans;\n            \n            // Update plans count badge\n            const plansCountElement = document.getElementById('plans-count');\n            if (plansCountElement) plansCountElement.textContent = totalPlans;\n        }\n        \n        // Modal functions\n        // Global variable to store financial responsibles\n        let financialResponsibles = [];\n\n        // Load financial responsibles\n        async function loadFinancialResponsibles() {\n            try {\n                const response = await fetch('/api/financial-responsibles');\n                const data = await response.json();\n                \n                if (data.success) {\n                    financialResponsibles = data.data;\n                    updateFinancialResponsiblesOptions();\n                } else {\n                    console.error('Erro ao carregar responsÃ¡veis financeiros:', data.message);\n                }\n            } catch (error) {\n                console.error('Erro ao carregar responsÃ¡veis financeiros:', error);\n            }\n        }\n\n        // Update both select elements with financial responsibles\n        function updateFinancialResponsiblesOptions() {\n            const addSelect = document.getElementById('studentFinancialResponsible');\n            const editSelect = document.getElementById('editStudentFinancialResponsible');\n            \n            const optionsHTML = '<option value=\"\">Selecione um responsÃ¡vel (opcional)</option>' +\n                financialResponsibles.map(responsible => \n                    `<option value=\"${responsible.id}\">${responsible.name} - ${responsible.relationshipType || 'NÃ£o informado'}</option>`\n                ).join('');\n            \n            if (addSelect) addSelect.innerHTML = optionsHTML;\n            if (editSelect) editSelect.innerHTML = optionsHTML;\n        }\n\n        // Load billing plans dynamically\n        async function loadBillingPlans() {\n            try {\n                console.log('ðŸ“‹ Carregando planos de pagamento...');\n                const response = await fetch('/api/billing-plans');\n                \n                if (!response.ok) {\n                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n                }\n                \n                const data = await response.json();\n                \n                if (data.success && data.data) {\n                    console.log('ðŸ“‹ Planos de pagamento carregados:', data.data.length);\n                    // Store plans for later use in plan preview\n                    window.billingPlans = data.data;\n                    updateBillingPlansOptions();\n                } else {\n                    console.log('ðŸ“‹ Nenhum plano de pagamento encontrado ou erro na API');\n                    window.billingPlans = [];\n                    updateBillingPlansOptions();\n                }\n            } catch (error) {\n                console.error('âŒ Erro ao carregar planos de pagamento:', error.message);\n                window.billingPlans = [];\n                updateBillingPlansOptions();\n                // Don't throw - just log and continue\n            }\n        }\n\n        // Update billing plans select options\n        function updateBillingPlansOptions() {\n            const billingPlanSelect = document.getElementById('studentBillingPlan');\n            \n            if (!billingPlanSelect) return;\n            \n            let optionsHTML = '<option value=\"\">Selecione um plano (opcional)</option>';\n            \n            if (window.billingPlans && window.billingPlans.length > 0) {\n                optionsHTML += window.billingPlans.map(plan => {\n                    const courseName = plan.course?.name || 'Curso nÃ£o especificado';\n                    const price = plan.price ? `R$ ${plan.price.toFixed(2)}` : 'PreÃ§o nÃ£o definido';\n                    const category = plan.category || 'Categoria geral';\n                    \n                    return `<option value=\"${plan.id}\">${plan.name} - ${price} (${category}) - ${courseName}</option>`;\n                }).join('');\n            }\n            \n            billingPlanSelect.innerHTML = optionsHTML;\n        }\n\n        function openAddStudentModal() {\n            console.log('ðŸ”„ Iniciando abertura do modal...');\n            \n            try {\n                // ALWAYS open modal first - this is the critical part\n                const modal = document.getElementById('addStudentModal');\n                console.log('ðŸ” Modal encontrado:', modal ? 'SIM' : 'NÃƒO');\n                \n                if (modal) {\n                    console.log('ðŸ“ Classes atuais do modal:', modal.className);\n                    modal.classList.add('active');\n                    console.log('âœ… Classe \"active\" adicionada');\n                    console.log('ðŸ“ Classes apÃ³s adiÃ§Ã£o:', modal.className);\n                    \n                    // Load data after modal is open - don't block modal opening\n                    console.log('ðŸ“Š Iniciando carregamento de dados...');\n                    loadDataForStudentModal();\n                } else {\n                    console.error('âŒ Modal addStudentModal nÃ£o encontrado no DOM');\n                    alert('Erro: Modal nÃ£o encontrado no DOM');\n                    return;\n                }\n            } catch (error) {\n                console.error('âŒ Erro crÃ­tico ao abrir modal:', error);\n                alert('Erro crÃ­tico: ' + error.message);\n            }\n        }\n        \n        // Separate function to load data without blocking modal\n        async function loadDataForStudentModal() {\n            console.log('ðŸ“Š Carregando dados do formulÃ¡rio...');\n            \n            // Load billing plans first (planos reais)\n            loadBillingPlans().catch(error => {\n                console.error('âŒ Erro ao carregar planos:', error);\n            });\n            \n            // Load courses second (cursos reais)  \n            loadCoursesForModal().catch(error => {\n                console.error('âŒ Erro ao carregar cursos:', error);\n            });\n            \n            // Load classes third (turmas reais)\n            loadClassesForModal().catch(error => {\n                console.error('âŒ Erro ao carregar turmas:', error);\n            });\n            \n            // Load responsibles last\n            loadFinancialResponsibles().catch(error => {\n                console.error('âŒ Erro ao carregar responsÃ¡veis:', error);\n            });\n            \n            console.log('âœ… Carregamento de dados iniciado');\n        }\n\n        // Load classes dynamically for the modal\n        async function loadClassesForModal() {\n            try {\n                const response = await fetch('/api/classes');\n                const data = await response.json();\n                \n                const classSelect = document.getElementById('studentClass');\n                if (data.success && data.data && data.data.length > 0) {\n                    let optionsHTML = '<option value=\"\">Selecione uma turma...</option>';\n                    data.data.forEach(classItem => {\n                        const instructor = classItem.instructor ? \n                            `${classItem.instructor.user.firstName} ${classItem.instructor.user.lastName}` : \n                            'Professor nÃ£o definido';\n                        const schedule = classItem.schedule || \n                            (classItem.startTime ? `${classItem.startTime}` : 'HorÃ¡rio nÃ£o definido');\n                        const capacity = classItem.mat?.capacity || classItem.maxStudents || 'N/A';\n                        const currentStudents = classItem._count?.studentCourses || 0;\n                        \n                        optionsHTML += `<option value=\"${classItem.id}\">${classItem.name} - ${schedule} (${instructor}) - ${currentStudents}/${capacity} alunos</option>`;\n                    });\n                    classSelect.innerHTML = optionsHTML;\n                } else {\n                    classSelect.innerHTML = '<option value=\"\">Nenhuma turma disponÃ­vel</option>';\n                }\n            } catch (error) {\n                console.error('Erro ao carregar turmas:', error);\n                const classSelect = document.getElementById('studentClass');\n                classSelect.innerHTML = '<option value=\"\">Erro ao carregar turmas</option>';\n            }\n        }\n\n        // Load courses dynamically for the modal\n        async function loadCoursesForModal() {\n            try {\n                const response = await fetch('/api/courses');\n                const data = await response.json();\n                \n                const courseSelect = document.getElementById('studentCourse');\n                if (data.success && data.data && data.data.length > 0) {\n                    let optionsHTML = '<option value=\"\">Selecione um curso (opcional)</option>';\n                    data.data.forEach(course => {\n                        const martialArt = course.martialArt?.name || 'Arte marcial nÃ£o definida';\n                        const classCount = course._count?.classes || 0;\n                        const studentCount = course._count?.studentCourses || 0;\n                        const planCount = course.billingPlans?.length || 0;\n                        \n                        optionsHTML += `<option value=\"${course.id}\">${course.name} (${martialArt}) - ${classCount} turmas, ${studentCount} alunos, ${planCount} planos</option>`;\n                    });\n                    courseSelect.innerHTML = optionsHTML;\n                } else {\n                    courseSelect.innerHTML = '<option value=\"\">Nenhum curso disponÃ­vel</option>';\n                }\n            } catch (error) {\n                console.error('Erro ao carregar cursos:', error);\n                const courseSelect = document.getElementById('studentCourse');\n                courseSelect.innerHTML = '<option value=\"\">Erro ao carregar cursos</option>';\n            }\n        }\n        \n        // Function called by edit button in table\n        async function openEditStudentModal(studentId) {\n            // Redirect to dedicated page instead of modal\n            console.log('ðŸ”„ Redirecionando openEditStudentModal para tela completa:', studentId);\n            await openStudentEditPage(studentId);\n        }\n\n        function closeEditStudentModal() {\n            document.getElementById('editStudentModal').classList.remove('active');\n            // Clear form\n            document.getElementById('editStudentForm').reset();\n        }\n\n        async function saveEditStudent() {\n            const studentId = document.getElementById('editStudentId').value;\n            const formData = {\n                firstName: document.getElementById('editFirstName').value,\n                lastName: document.getElementById('editLastName').value,\n                email: document.getElementById('editEmail').value,\n                phone: document.getElementById('editPhone').value,\n                cpf: document.getElementById('editCpf').value,\n                birthDate: document.getElementById('editBirthDate').value,\n                category: document.getElementById('editCategory').value,\n                gender: document.getElementById('editGender').value,\n                physicalCondition: document.getElementById('editPhysicalCondition').value,\n                enrollmentDate: document.getElementById('editEnrollmentDate').value,\n                medicalConditions: document.getElementById('editMedicalConditions').value,\n                emergencyContact: document.getElementById('editEmergencyContact').value,\n                specialNeeds: Array.from(document.getElementById('editSpecialNeeds').selectedOptions).map(option => option.value)\n            };\n            \n            try {\n                const response = await fetch(`/api/students/${studentId}`, {\n                    method: 'PUT',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(formData)\n                });\n                \n                const result = await response.json();\n                \n                if (result.success) {\n                    showToast('Aluno atualizado com sucesso!', 'success');\n                    closeEditStudentModal();\n                    loadData(); // Reload students data\n                } else {\n                    throw new Error(result.message || 'Erro ao atualizar aluno');\n                }\n            } catch (error) {\n                console.error('Erro:', error);\n                showToast('Erro ao atualizar aluno: ' + error.message, 'error');\n            }\n        }\n\n        function editStudent(studentId) {\n            // Redirect to dedicated page instead of modal\n            console.log('ðŸ”„ Redirecionando editStudent para tela completa:', studentId);\n            openStudentEditPage(studentId);\n        }\n        \n        function closeModal(modalId) {\n            document.getElementById(modalId).classList.remove('active');\n        }\n        \n        // Form submissions\n        document.getElementById('addStudentForm').addEventListener('submit', function(e) {\n            e.preventDefault();\n            \n            const formData = {\n                firstName: document.getElementById('studentName').value.split(' ')[0],\n                lastName: document.getElementById('studentName').value.split(' ').slice(1).join(' '),\n                email: document.getElementById('studentEmail').value,\n                phone: document.getElementById('studentPhone').value,\n                birthDate: document.getElementById('studentBirthDate').value,\n                gender: document.getElementById('studentGender').value,\n                category: document.getElementById('studentCategory').value,\n                billingPlanId: document.getElementById('studentBillingPlan').value || null, // Billing plan selection\n                courseId: document.getElementById('studentCourse').value || null, // For intelligent enrollment\n                classId: document.getElementById('studentClass').value,\n                financialResponsibleId: document.getElementById('studentFinancialResponsible').value || null\n            };\n            \n            console.log('Adicionando aluno:', formData);\n            \n            // In a real app, make API call here\n            fetch('/api/students', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(formData)\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    let message = 'Aluno adicionado com sucesso!';\n                    \n                    // Check if intelligent enrollment was used\n                    if (data.data.automaticEnrollment && data.data.automaticEnrollment.courseId) {\n                        if (data.data.automaticEnrollment.subscriptionCreated) {\n                            message += '\\n\\nâœ… MatrÃ­cula Inteligente:\\nâ€¢ Curso selecionado automaticamente\\nâ€¢ Plano de pagamento criado\\nâ€¢ Assinatura ativada';\n                        } else {\n                            message += '\\n\\nâš ï¸ MatrÃ­cula Inteligente:\\nâ€¢ Curso selecionado\\nâ€¢ Plano criado (verificar assinatura)';\n                        }\n                    }\n                    \n                    showToast(message.replace(/\\n/g, ' '), 'success');\n                    closeModal('addStudentModal');\n                    // Reload students data\n                    if (typeof loadStudents === 'function') {\n                        loadStudents();\n                    }\n                } else {\n                    showToast('Erro ao adicionar aluno: ' + (data.message || 'Erro desconhecido'), 'error');\n                }\n            })\n            .catch(error => {\n                console.error('Erro:', error);\n                alert('Erro ao conectar com o servidor');\n            });\n        });\n        \n        document.getElementById('editStudentForm').addEventListener('submit', function(e) {\n            e.preventDefault();\n            \n            const studentId = document.getElementById('editStudentId').value;\n            const formData = {\n                name: document.getElementById('editStudentName').value,\n                email: document.getElementById('editStudentEmail').value,\n                phone: document.getElementById('editStudentPhone').value,\n                birthDate: document.getElementById('editStudentBirthDate').value,\n                gender: document.getElementById('editStudentGender').value,\n                category: document.getElementById('editStudentCategory').value,\n                classId: document.getElementById('editStudentClass').value,\n                financialResponsibleId: document.getElementById('editStudentFinancialResponsible').value || null\n            };\n            \n            console.log('Editando aluno ID:', studentId, formData);\n            \n            // In a real app, make API call here\n            fetch(`/api/students/${studentId}`, {\n                method: 'PUT',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(formData)\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    alert('Aluno atualizado com sucesso!');\n                    closeModal('editStudentModal');\n                    // Reload students data\n                    loadData();\n                } else {\n                    alert('Erro ao atualizar aluno: ' + (data.message || 'Erro desconhecido'));\n                }\n            })\n            .catch(error => {\n                console.error('Erro:', error);\n                alert('Erro ao conectar com o servidor');\n            });\n        });\n        \n        // ========================================\n        // COURSE MANAGEMENT FUNCTIONS\n        // ========================================\n        \n        // Load courses data when navigating to course management\n        function loadCourses() {\n            console.log('ðŸ“š Carregando cursos...');\n            \n            fetch('/api/courses')\n                .then(response => response.json())\n                .then(data => {\n                    if (data.success && Array.isArray(data.data)) {\n                        updateCoursesTable(data.data);\n                    } else {\n                        // Show empty state\n                        updateCoursesTable([]);\n                    }\n                })\n                .catch(error => {\n                    console.error('Erro ao carregar cursos:', error);\n                    // Show empty state on error\n                    updateCoursesTable([]);\n                });\n        }\n        \n        function updateCoursesTable(courses) {\n            const tbody = document.getElementById('courses-table-body');\n            \n            if (courses.length === 0) {\n                tbody.innerHTML = `\n                    <tr>\n                        <td colspan=\"7\" style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                            Nenhum curso cadastrado. Clique em \"Novo Curso\" para comeÃ§ar.\n                        </td>\n                    </tr>\n                `;\n                return;\n            }\n            \n            tbody.innerHTML = courses.map(course => `\n                <tr>\n                    <td>${course.name}</td>\n                    <td>${course.category}</td>\n                    <td>${course.level}</td>\n                    <td>${course.totalClasses}</td>\n                    <td>${course.stats.totalEnrollments}</td>\n                    <td>\n                        <span class=\"status-badge ${course.isActive ? 'status-active' : 'status-inactive'}\">\n                            ${course.isActive ? 'Ativo' : 'Inativo'}\n                        </span>\n                    </td>\n                    <td>\n                        <div class=\"action-buttons\">\n                            <button class=\"btn btn-secondary btn-small\" onclick=\"editCourse('${course.id}')\">\n                                âœï¸ Editar\n                            </button>\n                            <button class=\"btn btn-secondary btn-small\" onclick=\"showLessonPlans('${course.id}', '${course.name}')\">\n                                ðŸ“– Aulas\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `).join('');\n        }\n        \n        // Course modal functions\n        function openAddCourseModal() {\n            document.getElementById('addCourseModal').classList.add('active');\n        }\n        \n        function editCourse(courseId) {\n            // Load course data and open edit modal\n            fetch(`/api/courses/${courseId}`)\n                .then(response => response.json())\n                .then(data => {\n                    if (data.success) {\n                        const course = data.data;\n                        document.getElementById('editCourseId').value = course.id;\n                        document.getElementById('editCourseName').value = course.name;\n                        document.getElementById('editCourseDescription').value = course.description || '';\n                        document.getElementById('editCourseCategory').value = course.category;\n                        document.getElementById('editCourseLevel').value = course.level;\n                        document.getElementById('editCourseTotalClasses').value = course.totalClasses;\n                        document.getElementById('editCourseClassesPerWeek').value = course.classesPerWeek;\n                        \n                        document.getElementById('editCourseModal').classList.add('active');\n                    }\n                })\n                .catch(error => {\n                    console.error('Erro:', error);\n                    alert('Erro ao carregar dados do curso');\n                });\n        }\n        \n        // Lesson plans functions\n        function showLessonPlans(courseId, courseName) {\n            document.getElementById('current-course-name').textContent = courseName;\n            document.getElementById('lesson-plans-section').style.display = 'block';\n            \n            // Load lesson plans\n            fetch(`/api/courses-management/${courseId}/lesson-plans`)\n                .then(response => response.json())\n                .then(data => {\n                    if (data.success) {\n                        updateLessonPlansTable(data.data, courseId);\n                    }\n                })\n                .catch(error => {\n                    console.error('Erro:', error);\n                });\n        }\n        \n        function hideLessonPlans() {\n            document.getElementById('lesson-plans-section').style.display = 'none';\n        }\n        \n        function updateLessonPlansTable(lessonPlans, courseId) {\n            const tbody = document.getElementById('lesson-plans-table-body');\n            \n            if (lessonPlans.length === 0) {\n                tbody.innerHTML = `\n                    <tr>\n                        <td colspan=\"6\" style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                            Nenhum plano de aula criado. \n                            <button class=\"btn btn-primary btn-small\" onclick=\"openLessonPlanModal('${courseId}', 1)\">\n                                Criar Primeira Aula\n                            </button>\n                        </td>\n                    </tr>\n                `;\n                return;\n            }\n            \n            tbody.innerHTML = lessonPlans.map(plan => `\n                <tr>\n                    <td>${plan.lessonNumber}</td>\n                    <td>${plan.title}</td>\n                    <td>${plan.duration} min</td>\n                    <td>${plan.difficulty}</td>\n                    <td>\n                        <button class=\"btn btn-secondary btn-small\" onclick=\"openFeedbackModal('${courseId}', ${plan.lessonNumber})\">\n                            ðŸ’¬ Feedback\n                        </button>\n                    </td>\n                    <td>\n                        <div class=\"action-buttons\">\n                            <button class=\"btn btn-secondary btn-small\" onclick=\"openLessonPlanModal('${courseId}', ${plan.lessonNumber})\">\n                                âœï¸ Editar\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `).join('');\n        }\n        \n        function openLessonPlanModal(courseId, lessonNumber) {\n            document.getElementById('lessonCourseId').value = courseId;\n            document.getElementById('lessonNumber').value = lessonNumber;\n            \n            // If editing existing lesson plan, load data\n            if (lessonNumber > 1) {\n                // Load existing lesson plan data (simplified for demo)\n                document.getElementById('lessonTitle').value = `Aula ${lessonNumber}`;\n            } else {\n                // Clear form for new lesson\n                document.getElementById('lessonPlanForm').reset();\n                document.getElementById('lessonCourseId').value = courseId;\n                document.getElementById('lessonNumber').value = lessonNumber;\n            }\n            \n            document.getElementById('lessonPlanModal').classList.add('active');\n        }\n        \n        function openFeedbackModal(courseId, lessonNumber) {\n            document.getElementById('feedbackCourseId').value = courseId;\n            document.getElementById('feedbackLessonNumber').value = lessonNumber;\n            document.getElementById('lessonFeedbackModal').classList.add('active');\n        }\n        \n        // Form submissions\n        document.getElementById('addCourseForm').addEventListener('submit', function(e) {\n            e.preventDefault();\n            \n            const formData = {\n                name: document.getElementById('courseName').value,\n                description: document.getElementById('courseDescription').value,\n                category: document.getElementById('courseCategory').value,\n                level: document.getElementById('courseLevel').value,\n                totalClasses: document.getElementById('courseTotalClasses').value,\n                classesPerWeek: document.getElementById('courseClassesPerWeek').value,\n                duration: document.getElementById('courseDuration').value,\n                minAge: document.getElementById('courseMinAge').value,\n                maxAge: document.getElementById('courseMaxAge').value,\n                objectives: document.getElementById('courseObjectives').value.split('\\\\n').filter(obj => obj.trim()),\n                requirements: document.getElementById('courseRequirements').value.split('\\\\n').filter(req => req.trim())\n            };\n            \n            fetch('/api/courses-management', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(formData)\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    alert('Curso criado com sucesso!');\n                    closeModal('addCourseModal');\n                    loadCourses();\n                } else {\n                    alert('Erro ao criar curso: ' + (data.message || 'Erro desconhecido'));\n                }\n            })\n            .catch(error => {\n                console.error('Erro:', error);\n                alert('Erro ao conectar com o servidor');\n            });\n        });\n        \n        document.getElementById('editCourseForm').addEventListener('submit', function(e) {\n            e.preventDefault();\n            \n            const courseId = document.getElementById('editCourseId').value;\n            const formData = {\n                name: document.getElementById('editCourseName').value,\n                description: document.getElementById('editCourseDescription').value,\n                category: document.getElementById('editCourseCategory').value,\n                level: document.getElementById('editCourseLevel').value,\n                totalClasses: document.getElementById('editCourseTotalClasses').value,\n                classesPerWeek: document.getElementById('editCourseClassesPerWeek').value\n            };\n            \n            fetch(`/api/courses-management/${courseId}`, {\n                method: 'PUT',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(formData)\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    alert('Curso atualizado com sucesso!');\n                    closeModal('editCourseModal');\n                    loadCourses();\n                } else {\n                    alert('Erro ao atualizar curso: ' + (data.message || 'Erro desconhecido'));\n                }\n            })\n            .catch(error => {\n                console.error('Erro:', error);\n                alert('Erro ao conectar com o servidor');\n            });\n        });\n        \n        document.getElementById('lessonPlanForm').addEventListener('submit', function(e) {\n            e.preventDefault();\n            \n            const courseId = document.getElementById('lessonCourseId').value;\n            const formData = {\n                lessonNumber: document.getElementById('lessonNumber').value,\n                title: document.getElementById('lessonTitle').value,\n                objectives: document.getElementById('lessonObjectives').value.split('\\\\n').filter(obj => obj.trim()),\n                warmUp: document.getElementById('lessonWarmUp').value,\n                mainContent: document.getElementById('lessonMainContent').value,\n                coolDown: document.getElementById('lessonCoolDown').value,\n                equipment: document.getElementById('lessonEquipment').value.split(',').map(eq => eq.trim()).filter(eq => eq),\n                duration: document.getElementById('lessonDuration').value,\n                difficulty: document.getElementById('lessonDifficulty').value,\n                adaptations: document.getElementById('lessonAdaptations').value,\n                notes: document.getElementById('lessonNotes').value\n            };\n            \n            fetch(`/api/courses-management/${courseId}/lesson-plans`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(formData)\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    alert('Plano de aula salvo com sucesso!');\n                    closeModal('lessonPlanModal');\n                    // Reload lesson plans\n                    showLessonPlans(courseId, document.getElementById('current-course-name').textContent);\n                } else {\n                    alert('Erro ao salvar plano: ' + (data.message || 'Erro desconhecido'));\n                }\n            })\n            .catch(error => {\n                console.error('Erro:', error);\n                alert('Erro ao conectar com o servidor');\n            });\n        });\n        \n        document.getElementById('lessonFeedbackForm').addEventListener('submit', function(e) {\n            e.preventDefault();\n            \n            const formData = {\n                courseId: document.getElementById('feedbackCourseId').value,\n                lessonNumber: document.getElementById('feedbackLessonNumber').value,\n                feedback: document.getElementById('feedbackGeneral').value,\n                studentsPresent: document.getElementById('feedbackStudentsPresent').value,\n                improvements: document.getElementById('feedbackImprovements').value,\n                nextClassAdjustments: document.getElementById('feedbackImprovements').value\n            };\n            \n            fetch('/api/lesson-feedback', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(formData)\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    alert('Feedback registrado com sucesso!');\n                    closeModal('lessonFeedbackModal');\n                } else {\n                    alert('Erro ao registrar feedback: ' + (data.message || 'Erro desconhecido'));\n                }\n            })\n            .catch(error => {\n                console.error('Erro:', error);\n                alert('Erro ao conectar com o servidor');\n            });\n        });\n        \n        // ==========================================\n        // STUDENTS MANAGEMENT FUNCTIONS\n        // ==========================================\n        \n        // Global students data storage\n        let allStudents = [];\n        let filteredStudents = [];\n        let currentView = 'table'; // 'table' or 'grid'\n\n        // Generate simple matricula\n        function generateMatricula(studentId, index) {\n            // Simple format: just the index number (1, 2, 3, etc.)\n            return index ? index.toString() : '1';\n        }\n\n        // Enhanced student loading with matricula generation\n        async function loadStudents() {\n            console.log('ðŸ‘¥ Carregando estudantes...');\n            \n            // Show loading state (safe version)\n            try {\n                showStudentsLoadingState();\n            } catch (e) {\n                console.log('âš ï¸ showStudentsLoadingState failed:', e);\n            }\n            \n            try {\n                const response = await fetch('/api/students');\n                const data = await response.json();\n                \n                if (data.success && data.data) {\n                    console.log(`âœ… ${data.data.length} estudantes carregados`);\n                    \n                    // Use students data directly (API already provides matricula)\n                    allStudents = data.data;\n                    filteredStudents = [...allStudents];\n                    updateStudentsStats();\n                    updateStudentsDisplay();\n                    \n                    // Setup event delegation after table is rendered (PERMANENT FIX)\n                    setTimeout(() => {\n                        setupStudentTableEventDelegation();\n                    }, 100);\n                } else {\n                    console.error('âŒ Erro ao carregar estudantes:', data.message || 'Resposta sem dados');\n                    console.error('âŒ Resposta completa:', data);\n                    allStudents = [];\n                    filteredStudents = [];\n                    showStudentsEmptyState();\n                }\n            } catch (error) {\n                console.error('âŒ Erro de conexÃ£o ao carregar estudantes:', error);\n                allStudents = [];\n                filteredStudents = [];\n                showStudentsEmptyState();\n            }\n            \n            // Setup event delegation after loading students (PERMANENT FIX)\n            setTimeout(() => {\n                setupStudentTableEventDelegation();\n            }, 100);\n        }\n\n        // Switch between table and grid view\n        function switchView(viewType) {\n            currentView = viewType;\n            \n            // Update button states\n            document.getElementById('tableViewBtn').classList.toggle('active', viewType === 'table');\n            document.getElementById('gridViewBtn').classList.toggle('active', viewType === 'grid');\n            \n            // Show/hide views\n            document.getElementById('studentsTableView').style.display = viewType === 'table' ? 'block' : 'none';\n            document.getElementById('studentsGrid').style.display = viewType === 'grid' ? 'grid' : 'none';\n            \n            // Update display\n            updateStudentsDisplay();\n        }\n\n        // Enhanced search that works with CPF, name, matricula and email\n        function filterStudentsSimple() {\n            const searchTerm = document.getElementById('studentSearch').value.toLowerCase().trim();\n            \n            if (!searchTerm) {\n                filteredStudents = [...allStudents];\n            } else {\n                filteredStudents = allStudents.filter(student => {\n                    const user = student.user || {};\n                    const fullName = `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase();\n                    const email = (user.email || '').toLowerCase();\n                    const cpf = (user.cpf || '').replace(/\\D/g, ''); // Remove non-digits\n                    const matricula = (student.matricula || '').toLowerCase();\n                    const searchCpf = searchTerm.replace(/\\D/g, ''); // Remove non-digits from search\n                    \n                    return (\n                        fullName.includes(searchTerm) ||\n                        email.includes(searchTerm) ||\n                        matricula.includes(searchTerm) ||\n                        (searchCpf && cpf.includes(searchCpf))\n                    );\n                });\n            }\n            \n            updateStudentsDisplay();\n        }\n\n        // Update students display based on current view\n        function updateStudentsDisplay() {\n            if (currentView === 'table') {\n                updateStudentsTable();\n                // Re-setup event delegation after table update (PERMANENT FIX)\n                setTimeout(() => {\n                    setupStudentTableEventDelegation();\n                }, 50);\n            } else {\n                updateStudentsGrid();\n            }\n        }\n\n        // ========================================\n        // STUDENT TABLE EVENT DELEGATION SYSTEM\n        // ========================================\n        \n        // Set up permanent event delegation for student table\n        function setupStudentTableEventDelegation() {\n            const tableBody = document.getElementById('studentsTableBody');\n            if (!tableBody) {\n                console.warn('ðŸš¨ Student table body not found for event delegation setup');\n                return;\n            }\n            \n            // Remove existing listeners to prevent duplicates\n            tableBody.removeEventListener('click', handleStudentTableClick);\n            tableBody.removeEventListener('dblclick', handleStudentTableDoubleClick);\n            \n            // Add event listeners with delegation\n            tableBody.addEventListener('click', handleStudentTableClick);\n            tableBody.addEventListener('dblclick', handleStudentTableDoubleClick);\n            \n            console.log('âœ… Student table event delegation setup complete');\n        }\n        \n        // Handle all clicks in student table\n        function handleStudentTableClick(event) {\n            const target = event.target;\n            const studentRow = target.closest('tr.student-table-row');\n            \n            if (!studentRow) return;\n            \n            // Handle action buttons\n            if (target.dataset.action === 'checkin') {\n                event.stopPropagation();\n                quickCheckinFixed(target.dataset.studentId);\n                return;\n            }\n            \n            if (target.dataset.action === 'edit') {\n                event.stopPropagation();\n                openStudentEditPage(target.dataset.studentId);\n                return;\n            }\n            \n            // Handle row click (but not on action buttons)\n            if (!target.closest('.actions-cell')) {\n                // Single click on row - could add selection here if needed\n                studentRow.classList.add('row-selected');\n                setTimeout(() => {\n                    studentRow.classList.remove('row-selected');\n                }, 200);\n            }\n        }\n        \n        // Handle double-clicks in student table\n        function handleStudentTableDoubleClick(event) {\n            const target = event.target;\n            const studentRow = target.closest('tr.student-table-row');\n            \n            if (!studentRow) return;\n            \n            // Don't trigger on action buttons\n            if (target.closest('.actions-cell')) return;\n            \n            event.preventDefault();\n            event.stopPropagation();\n            \n            const studentId = studentRow.dataset.studentId;\n            if (studentId) {\n                console.log('ðŸ–±ï¸ Double-click detected for student:', studentId);\n                openStudentEditPage(studentId);\n            }\n        }\n        \n        // Fixed quick check-in function (prevents conflicts)\n        function quickCheckinFixed(studentId) {\n            if (!studentId) {\n                console.error('âŒ Student ID not provided for check-in');\n                return;\n            }\n            \n            const student = allStudents.find(s => s.id === studentId);\n            if (!student) {\n                alert('âŒ Aluno nÃ£o encontrado!');\n                return;\n            }\n            \n            const user = student.user || {};\n            const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();\n            const matricula = student.matricula || generateMatricula(student.id, 1);\n            \n            // Show confirmation\n            const confirmed = confirm(`âœ… Confirmar check-in para:\\n\\nðŸ“‹ MatrÃ­cula: ${matricula}\\nðŸ‘¤ Nome: ${fullName}\\n\\nProsseguir?`);\n            \n            if (confirmed) {\n                console.log('âœ… Quick check-in confirmed for:', fullName);\n                alert(`âœ… Check-in realizado com sucesso!\\n\\nðŸ‘¤ ${fullName}\\nðŸ“‹ ${matricula}\\nâ° ${new Date().toLocaleTimeString()}`);\n                \n                // Here you would implement the actual check-in API call\n                // For now, just show success feedback\n            }\n        }\n\n        // Update table view with event delegation\n        function updateStudentsTable() {\n            const tableBody = document.getElementById('studentsTableBody');\n            const tableView = document.getElementById('studentsTableView');\n            const loadingState = document.getElementById('studentsLoadingState');\n            const emptyState = document.getElementById('studentsEmptyState');\n            \n            if (filteredStudents.length === 0) {\n                tableView.style.display = 'none';\n                loadingState.style.display = 'none';\n                emptyState.style.display = 'block';\n                return;\n            }\n            \n            loadingState.style.display = 'none';\n            emptyState.style.display = 'none';\n            tableView.style.display = 'block';\n            \n            tableBody.innerHTML = filteredStudents.map(student => {\n                const user = student.user || {};\n                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();\n                const email = user.email || 'N/A';\n                const cpf = user.cpf || 'N/A';\n                const formattedCpf = cpf !== 'N/A' ? formatCPF(cpf) : 'N/A';\n                const category = student.category || 'ADULT';\n                const status = student.isActive ? 'Ativo' : 'Inativo';\n                const statusClass = student.isActive ? 'success' : 'inactive';\n                const matricula = student.matricula || generateMatricula(student.id, 1);\n                const financialResponsible = student.financialResponsible;\n                const responsibleDisplay = financialResponsible \n                    ? `<div class=\"responsible-name\">${financialResponsible.name}</div><div class=\"responsible-type\">${financialResponsible.relationshipType || 'NÃ£o informado'}</div>`\n                    : '<span style=\"color: #94A3B8;\">PrÃ³prio aluno</span>';\n                \n                return `\n                    <tr class=\"student-table-row\" data-student-id=\"${student.id}\" style=\"cursor: pointer; position: relative;\">\n                        <td>\n                            <span class=\"student-matricula\">${matricula}</span>\n                        </td>\n                        <td class=\"student-name-cell\">\n                            <div class=\"student-name\">${fullName}</div>\n                            <div class=\"student-email\">${email}</div>\n                        </td>\n                        <td>\n                            <span class=\"student-cpf\">${formattedCpf}</span>\n                        </td>\n                        <td>${category}</td>\n                        <td class=\"responsible-cell\">\n                            ${responsibleDisplay}\n                        </td>\n                        <td>\n                            <span class=\"badge ${statusClass}\">${status}</span>\n                        </td>\n                        <td class=\"actions-cell\">\n                            <button class=\"action-btn checkin\" data-action=\"checkin\" data-student-id=\"${student.id}\" title=\"Check-in RÃ¡pido\">\n                                âœ… Check-in\n                            </button>\n                            <button class=\"action-btn edit\" data-action=\"edit\" data-student-id=\"${student.id}\" title=\"Editar Aluno\">\n                                âœï¸ Editar\n                            </button>\n                            <div class=\"table-click-hint\" style=\"position: absolute; bottom: 4px; right: 4px; font-size: 0.65rem; color: #10B981; opacity: 0; transition: opacity 0.3s ease; background: rgba(16, 185, 129, 0.1); padding: 0.2rem 0.4rem; border-radius: 4px; border: 1px solid rgba(16, 185, 129, 0.3); pointer-events: none; white-space: nowrap;\">\n                                ðŸ“ Editar aluno\n                            </div>\n                        </td>\n                    </tr>\n                `;\n            }).join('');\n            \n            // Setup event delegation after updating table\n            setTimeout(() => {\n                setupStudentTableEventDelegation();\n            }, 50);\n        }\n\n        // Format CPF for display\n        function formatCPF(cpf) {\n            if (!cpf || cpf === 'N/A') return 'N/A';\n            \n            // Remove all non-digits\n            const cleanCpf = cpf.replace(/\\D/g, '');\n            \n            // Format as XXX.XXX.XXX-XX\n            if (cleanCpf.length === 11) {\n                return cleanCpf.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\n            }\n            \n            return cpf; // Return original if not 11 digits\n        }\n\n        // Quick check-in function - COMMENTED OUT TO PREVENT CONFLICTS\n        // Use quickCheckinFixed instead\n        function quickCheckin_DEPRECATED(studentId) {\n            const student = allStudents.find(s => s.id === studentId);\n            if (!student) {\n                alert('Aluno nÃ£o encontrado!');\n                return;\n            }\n            \n            const user = student.user || {};\n            const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();\n            const matricula = student.matricula || generateMatricula(student.id, 1);\n            \n            // Show confirmation\n            const confirmed = confirm(`Confirmar check-in para:\\n\\nMatrÃ­cula: ${matricula}\\nNome: ${fullName}\\n\\nProsseguir?`);\n            \n            if (confirmed) {\n                // Here you would call the check-in API\n                console.log('ðŸŽ¯ Check-in confirmado para:', fullName, `(${matricula})`);\n                \n                // Show success feedback\n                const btn = event.target;\n                const originalText = btn.innerHTML;\n                btn.innerHTML = 'âœ… Feito!';\n                btn.style.background = '#10B981';\n                btn.style.color = 'white';\n                btn.disabled = true;\n                \n                // Reset button after 2 seconds\n                setTimeout(() => {\n                    btn.innerHTML = originalText;\n                    btn.style.background = '';\n                    btn.style.color = '#10B981';\n                    btn.disabled = false;\n                }, 2000);\n                \n                // You can add actual API call here:\n                // performCheckin(studentId);\n            }\n        }\n\n        // Legacy function for grid view compatibility\n        function filterStudents() {\n            filterStudentsSimple();\n        }\n\n        // ==========================================\n        // QUICK CHECK-IN FUNCTIONS\n        // ==========================================\n\n        let checkinResults = [];\n\n        // Search for check-in with smart matching\n        function searchForCheckin() {\n            const searchTerm = document.getElementById('checkinSearch').value.toLowerCase().trim();\n            \n            if (!searchTerm) {\n                checkinResults = [];\n                updateCheckinTable();\n                return;\n            }\n\n            // Minimum 2 characters to search\n            if (searchTerm.length < 2) {\n                checkinResults = [];\n                updateCheckinTable();\n                return;\n            }\n\n            checkinResults = allStudents.filter(student => {\n                const user = student.user || {};\n                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase();\n                const email = (user.email || '').toLowerCase();\n                const cpf = (user.cpf || '').replace(/\\D/g, '');\n                const matricula = (student.matricula || '').toLowerCase();\n                const searchCpf = searchTerm.replace(/\\D/g, '');\n                \n                return (\n                    fullName.includes(searchTerm) ||\n                    email.includes(searchTerm) ||\n                    matricula.includes(searchTerm) ||\n                    (searchCpf && cpf.includes(searchCpf))\n                );\n            }).slice(0, 10); // Limit to 10 results for performance\n\n            updateCheckinTable();\n        }\n\n        // Handle Enter key for instant check-in\n        function handleCheckinEnter(event) {\n            if (event.key === 'Enter') {\n                event.preventDefault();\n                \n                // If only one result, do instant check-in\n                if (checkinResults.length === 1) {\n                    quickCheckin(checkinResults[0].id);\n                    clearCheckinSearch();\n                }\n            }\n        }\n\n        // Clear check-in search\n        function clearCheckinSearch() {\n            document.getElementById('checkinSearch').value = '';\n            checkinResults = [];\n            updateCheckinTable();\n            document.getElementById('checkinSearch').focus();\n        }\n\n        // Update check-in table\n        function updateCheckinTable() {\n            const tableBody = document.getElementById('checkinTableBody');\n            const resultsCount = document.getElementById('checkinResultsCount');\n            \n            resultsCount.textContent = checkinResults.length;\n\n            if (checkinResults.length === 0) {\n                tableBody.innerHTML = `\n                    <tr>\n                        <td colspan=\"4\" style=\"text-align: center; color: #94A3B8; padding: 2rem;\">\n                            ${document.getElementById('checkinSearch').value.trim() ? 'Nenhum aluno encontrado' : 'Digite acima para buscar alunos e fazer check-in'}\n                        </td>\n                    </tr>\n                `;\n                return;\n            }\n\n            tableBody.innerHTML = checkinResults.map(student => {\n                const user = student.user || {};\n                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();\n                const cpf = user.cpf || 'N/A';\n                const formattedCpf = cpf !== 'N/A' ? formatCPF(cpf) : 'N/A';\n                const matricula = student.matricula || generateMatricula(student.id, 1);\n                \n                return `\n                    <tr style=\"background: ${checkinResults.length === 1 ? 'rgba(59, 130, 246, 0.1)' : 'transparent'};\">\n                        <td>\n                            <span class=\"student-matricula\">${matricula}</span>\n                        </td>\n                        <td class=\"student-name-cell\">\n                            <div class=\"student-name\">${fullName}</div>\n                        </td>\n                        <td>\n                            <span class=\"student-cpf\">${formattedCpf}</span>\n                        </td>\n                        <td>\n                            <button class=\"action-btn checkin\" \n                                    onclick=\"quickCheckin('${student.id}')\" \n                                    title=\"Check-in RÃ¡pido\"\n                                    style=\"font-weight: 600;\">\n                                âš¡ CHECK-IN\n                            </button>\n                        </td>\n                    </tr>\n                `;\n            }).join('');\n        }\n\n        // DUPLICATE FUNCTION - This should be removed and use quickCheckinFixed instead\n        // Simple quick check-in\n        function quickCheckin(studentId) {\n            const student = allStudents.find(s => s.id === studentId);\n            if (!student) {\n                alert('âŒ Aluno nÃ£o encontrado!');\n                return;\n            }\n            \n            const user = student.user || {};\n            const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();\n            const matricula = student.matricula || generateMatricula(student.id, 1);\n            \n            // Simple confirmation\n            const now = new Date();\n            const timeString = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });\n            \n            const confirmed = confirm(`Confirmar check-in?\\n\\n${fullName} (${matricula})\\n${timeString}`);\n            \n            if (confirmed) {\n                console.log('âœ… Check-in confirmado:', fullName, matricula, timeString);\n                \n                // Simple visual feedback\n                const btn = event.target;\n                btn.innerHTML = 'âœ… Feito!';\n                btn.style.background = '#10B981';\n                btn.style.color = 'white';\n                btn.disabled = true;\n                \n                // Auto-clear search after check-in\n                setTimeout(() => {\n                    clearCheckinSearch();\n                    showToast(`âœ… Check-in: ${fullName} (${matricula})`, 'success');\n                }, 1000);\n                \n                // Here you would call the actual check-in API:\n                // performActualCheckin(studentId, now);\n            }\n        }\n\n        // Show toast notification\n        function showToast(message, type = 'info') {\n            const toast = document.createElement('div');\n            toast.style.cssText = `\n                position: fixed;\n                top: 2rem;\n                right: 2rem;\n                padding: 1rem 1.5rem;\n                border-radius: 12px;\n                color: white;\n                font-weight: 600;\n                z-index: 10000;\n                transform: translateX(100%);\n                transition: transform 0.3s ease;\n                max-width: 400px;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n                ${type === 'success' ? 'background: linear-gradient(135deg, #10B981, #059669);' : ''}\n                ${type === 'error' ? 'background: linear-gradient(135deg, #EF4444, #DC2626);' : ''}\n                ${type === 'info' ? 'background: linear-gradient(135deg, #3B82F6, #2563EB);' : ''}\n            `;\n            toast.textContent = message;\n            \n            document.body.appendChild(toast);\n            \n            // Animate in\n            setTimeout(() => {\n                toast.style.transform = 'translateX(0)';\n            }, 100);\n            \n            // Auto remove\n            setTimeout(() => {\n                toast.style.transform = 'translateX(100%)';\n                setTimeout(() => {\n                    if (document.body.contains(toast)) {\n                        document.body.removeChild(toast);\n                    }\n                }, 300);\n            }, 4000);\n        }\n        \n        function showStudentsLoadingState() {\n            document.getElementById('studentsLoadingState').style.display = 'block';\n            document.getElementById('studentsGrid').style.display = 'none';\n            document.getElementById('studentsEmptyState').style.display = 'none';\n        }\n        \n        function showStudentsEmptyState() {\n            document.getElementById('studentsLoadingState').style.display = 'none';\n            document.getElementById('studentsGrid').style.display = 'none';\n            document.getElementById('studentsEmptyState').style.display = 'block';\n        }\n        \n        function updateStudentsStats() {\n            const total = allStudents.length;\n            const active = allStudents.filter(s => s.isActive).length;\n            const avgAttendance = allStudents.length > 0 \n                ? Math.round(allStudents.reduce((sum, s) => sum + (s.attendanceRate || 0), 0) / allStudents.length)\n                : 0;\n            const thisMonth = allStudents.filter(s => {\n                const enrollDate = new Date(s.enrollmentDate);\n                const now = new Date();\n                return enrollDate.getMonth() === now.getMonth() && enrollDate.getFullYear() === now.getFullYear();\n            }).length;\n            \n            document.getElementById('totalStudents').textContent = total;\n            document.getElementById('activeStudents').textContent = active;\n            document.getElementById('avgAttendance').textContent = `${avgAttendance}%`;\n            document.getElementById('newThisMonth').textContent = thisMonth;\n        }\n        \n        function updateStudentsGrid() {\n            const grid = document.getElementById('studentsGrid');\n            const loadingState = document.getElementById('studentsLoadingState');\n            const emptyState = document.getElementById('studentsEmptyState');\n            \n            if (filteredStudents.length === 0) {\n                grid.style.display = 'none';\n                loadingState.style.display = 'none';\n                emptyState.style.display = 'block';\n                return;\n            }\n            \n            loadingState.style.display = 'none';\n            emptyState.style.display = 'none';\n            grid.style.display = 'grid';\n            \n            grid.innerHTML = filteredStudents.map(student => {\n                const user = student.user || {};\n                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();\n                const email = user.email || 'N/A';\n                const phone = user.phone || 'N/A';\n                const category = student.category || 'ADULT';\n                const status = student.isActive ? 'Ativo' : 'Inativo';\n                const statusClass = student.isActive ? 'status-active' : 'status-inactive';\n                const matricula = student.matricula || `KMA${String(student.id).padStart(4, '0')}`;\n                const attendanceRate = student.attendanceRate || 0;\n                const avatar = fullName ? fullName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase() : '??';\n                \n                return `\n                    <div class=\"student-card\" onclick=\"openStudentEditPage('${student.id}')\" style=\"cursor: pointer;\">\n                        <div class=\"student-status\">\n                            <span class=\"status-badge ${statusClass}\">${status}</span>\n                        </div>\n                        \n                        <div class=\"student-card-header\">\n                            <div style=\"display: flex; align-items: center;\">\n                                <div class=\"student-avatar\">${avatar}</div>\n                                <div class=\"student-info\">\n                                    <div class=\"student-name\">${fullName}</div>\n                                    <div class=\"student-matricula\">ðŸ“‹ ${matricula}</div>\n                                    <div class=\"student-email\">ðŸ“§ ${email}</div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"student-stats\">\n                            <div class=\"student-stat\">\n                                <span class=\"student-stat-value\">${attendanceRate}%</span>\n                                <div class=\"student-stat-label\">FrequÃªncia</div>\n                            </div>\n                            <div class=\"student-stat\">\n                                <span class=\"student-stat-value\">${category}</span>\n                                <div class=\"student-stat-label\">Categoria</div>\n                            </div>\n                            <div class=\"student-stat\">\n                                <span class=\"student-stat-value\">${phone !== 'N/A' ? 'ðŸ“±' : 'âŒ'}</span>\n                                <div class=\"student-stat-label\">Contato</div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"student-actions\" onclick=\"event.stopPropagation()\">\n                            <button class=\"btn-student btn-student-primary\" onclick=\"openStudentEditPage('${student.id}')\">\n                                âœï¸ Editar Dados\n                            </button>\n                        </div>\n                        \n                        <!-- Hint de clique direto -->\n                        <div class=\"click-hint\" style=\"position: absolute; bottom: 8px; right: 12px; font-size: 0.7rem; color: #10B981; opacity: 0; transition: opacity 0.3s ease; background: rgba(16, 185, 129, 0.1); padding: 0.25rem 0.5rem; border-radius: 6px; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                            ðŸ“ Editar aluno\n                        </div>\n                    </div>\n                `;\n            }).join('');\n        }\n        \n        function filterStudents() {\n            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();\n            const categoryFilter = document.getElementById('categoryFilter').value;\n            const statusFilter = document.getElementById('statusFilter').value;\n            \n            filteredStudents = allStudents.filter(student => {\n                const user = student.user || {};\n                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase();\n                const email = (user.email || '').toLowerCase();\n                const matricula = (student.matricula || `KMA${String(student.id).padStart(4, '0')}`).toLowerCase();\n                \n                // Search filter\n                const matchesSearch = !searchTerm || \n                    fullName.includes(searchTerm) || \n                    email.includes(searchTerm) || \n                    matricula.includes(searchTerm);\n                \n                // Category filter\n                const matchesCategory = !categoryFilter || student.category === categoryFilter;\n                \n                // Status filter\n                const matchesStatus = !statusFilter || String(student.isActive) === statusFilter;\n                \n                return matchesSearch && matchesCategory && matchesStatus;\n            });\n            \n            updateStudentsGrid();\n        }\n        \n        // Modern unified view/edit functions\n        async function openStudentDetails(studentId) {\n            console.log('ðŸ‘ï¸ Redirecionando detalhes para ediÃ§Ã£o:', studentId);\n            openStudentEditPage(studentId);\n        }\n        \n        async function openStudentEdit(studentId) {\n            console.log('âœï¸ Editando estudante:', studentId);\n            openStudentEditPage(studentId);\n        }\n        \n        async function viewStudent(studentId) {\n            openStudentEditPage(studentId);\n        }\n        \n        async function editStudent(studentId) {\n            openStudentEditPage(studentId);\n        }\n        \n        async function openStudentModal(studentId, mode = 'edit') {\n            try {\n                // Fetch student data\n                const response = await fetch(`/api/students`);\n                const data = await response.json();\n                \n                if (!data.success) {\n                    throw new Error(data.message || 'Erro ao carregar dados do estudante');\n                }\n                \n                // Find the specific student\n                const student = data.data.find(s => s.id === studentId);\n                if (!student) {\n                    throw new Error('Estudante nÃ£o encontrado');\n                }\n                \n                // Set modal title and mode\n                const isViewMode = mode === 'view';\n                document.getElementById('studentModalTitle').textContent = \n                    isViewMode ? 'Visualizar Aluno' : 'Editar Aluno';\n                \n                // Show/hide save button\n                const saveBtn = document.getElementById('saveStudentBtn');\n                saveBtn.style.display = isViewMode ? 'none' : 'block';\n                \n                // Populate form with student data\n                populateStudentForm(student, isViewMode);\n                \n                // Show modal\n                document.getElementById('studentModal').classList.add('active');\n                \n            } catch (error) {\n                console.error('âŒ Erro ao abrir modal do estudante:', error);\n                alert(`Erro: ${error.message}`);\n            }\n        }\n        \n        function populateStudentForm(student, readonly = false) {\n            const user = student.user || {};\n            \n            // Set form values\n            document.getElementById('studentId').value = student.id || '';\n            document.getElementById('userId').value = student.userId || '';\n            document.getElementById('firstName').value = user.firstName || '';\n            document.getElementById('lastName').value = user.lastName || '';\n            document.getElementById('email').value = user.email || '';\n            document.getElementById('phone').value = user.phone || '';\n            document.getElementById('cpf').value = user.cpf || '';\n            document.getElementById('category').value = student.category || 'ADULT';\n            document.getElementById('gender').value = student.gender || 'MASCULINO';\n            document.getElementById('physicalCondition').value = student.physicalCondition || 'INICIANTE';\n            document.getElementById('medicalConditions').value = student.medicalConditions || '';\n            document.getElementById('emergencyContact').value = student.emergencyContact || '';\n            document.getElementById('totalXP').value = student.totalXP || 0;\n            document.getElementById('globalLevel').value = student.globalLevel || 1;\n            document.getElementById('currentStreak').value = student.currentStreak || 0;\n            \n            // Format dates\n            if (student.enrollmentDate) {\n                const enrollDate = new Date(student.enrollmentDate).toISOString().split('T')[0];\n                document.getElementById('enrollmentDate').value = enrollDate;\n            }\n            \n            if (student.lastCheckinDate) {\n                const checkinDate = new Date(student.lastCheckinDate).toISOString().slice(0, 16);\n                document.getElementById('lastCheckinDate').value = checkinDate;\n            }\n            \n            // Handle special needs (array)\n            const specialNeedsSelect = document.getElementById('specialNeeds');\n            if (student.specialNeeds && Array.isArray(student.specialNeeds)) {\n                Array.from(specialNeedsSelect.options).forEach(option => {\n                    option.selected = student.specialNeeds.includes(option.value);\n                });\n            }\n            \n            // Set readonly mode if viewing\n            if (readonly) {\n                const inputs = document.querySelectorAll('#studentForm input, #studentForm select, #studentForm textarea');\n                inputs.forEach(input => {\n                    if (!input.hasAttribute('readonly')) {\n                        input.setAttribute('readonly', true);\n                        input.style.background = 'rgba(255, 255, 255, 0.02)';\n                        input.style.color = '#94A3B8';\n                        input.style.cursor = 'not-allowed';\n                    }\n                });\n            } else {\n                // Remove readonly from editable fields\n                const inputs = document.querySelectorAll('#studentForm input:not([name=\"totalXP\"]):not([name=\"globalLevel\"]):not([name=\"currentStreak\"]):not([name=\"lastCheckinDate\"]), #studentForm select:not([multiple]), #studentForm textarea');\n                inputs.forEach(input => {\n                    input.removeAttribute('readonly');\n                    input.style.background = 'rgba(255, 255, 255, 0.05)';\n                    input.style.color = '#F8FAFC';\n                    input.style.cursor = 'text';\n                });\n            }\n        }\n        \n        function closeStudentModal() {\n            document.getElementById('studentModal').classList.remove('active');\n            // Clear form\n            document.getElementById('studentForm').reset();\n        }\n        \n        async function saveStudent() {\n            const saveBtn = document.getElementById('saveStudentBtn');\n            const originalText = saveBtn.innerHTML;\n            \n            try {\n                // Show loading state\n                saveBtn.innerHTML = 'â³ Salvando...';\n                saveBtn.disabled = true;\n                \n                const studentId = document.getElementById('studentId').value;\n                const userId = document.getElementById('userId').value;\n                \n                if (!studentId || !userId) {\n                    throw new Error('ID do estudante nÃ£o encontrado');\n                }\n                \n                // Collect form data with enhanced validation\n                const formData = {\n                    // User data (supported by API)\n                    firstName: document.getElementById('firstName').value.trim(),\n                    lastName: document.getElementById('lastName').value.trim(),\n                    email: document.getElementById('email').value.trim(),\n                    phone: document.getElementById('phone').value.trim(),\n                    \n                    // Student data (supported by API)\n                    category: document.getElementById('category').value,\n                    gender: document.getElementById('gender').value,\n                    physicalCondition: document.getElementById('physicalCondition').value,\n                    emergencyContact: document.getElementById('emergencyContact').value.trim(),\n                    medicalConditions: document.getElementById('medicalConditions').value.trim(),\n                    isActive: true\n                };\n                \n                // Enhanced validation\n                if (!formData.firstName || !formData.lastName || !formData.email) {\n                    throw new Error('Nome, sobrenome e email sÃ£o obrigatÃ³rios');\n                }\n                \n                if (formData.email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n                    throw new Error('Email deve ter um formato vÃ¡lido');\n                }\n                \n                console.log('ðŸ“¤ Enviando dados do estudante:', formData);\n                \n                // Update student via API\n                const response = await fetch(`/api/students/${studentId}`, {\n                    method: 'PUT',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(formData)\n                });\n                \n                const result = await response.json();\n                \n                if (!response.ok) {\n                    throw new Error(result.message || `Erro ${response.status}: ${response.statusText}`);\n                }\n                \n                if (!result.success) {\n                    throw new Error(result.message || 'Erro ao atualizar dados');\n                }\n                \n                console.log('âœ… Estudante atualizado com sucesso:', result);\n                \n                // Show success feedback\n                saveBtn.innerHTML = 'âœ… Salvo!';\n                saveBtn.style.background = '#10B981';\n                \n                // Close modal and reload students\n                setTimeout(() => {\n                    closeStudentModal();\n                    loadStudents();\n                    showNotification('Dados do aluno atualizados com sucesso! ðŸŽ‰', 'success');\n                }, 1000);\n                \n            } catch (error) {\n                console.error('âŒ Erro ao salvar estudante:', error);\n                \n                // Show error feedback\n                saveBtn.innerHTML = 'âŒ Erro';\n                saveBtn.style.background = '#EF4444';\n                \n                showNotification(`Erro ao salvar: ${error.message}`, 'error');\n                \n                // Restore button after error\n                setTimeout(() => {\n                    saveBtn.innerHTML = originalText;\n                    saveBtn.style.background = '';\n                    saveBtn.disabled = false;\n                }, 2000);\n            }\n        }\n        \n        function showNotification(message, type = 'info') {\n            // Create notification element\n            const notification = document.createElement('div');\n            notification.style.cssText = `\n                position: fixed;\n                top: 2rem;\n                right: 2rem;\n                padding: 1rem 1.5rem;\n                border-radius: 8px;\n                color: white;\n                font-weight: 600;\n                z-index: 10000;\n                transform: translateX(100%);\n                transition: transform 0.3s ease;\n                ${type === 'success' ? 'background: #10B981;' : ''}\n                ${type === 'error' ? 'background: #EF4444;' : ''}\n                ${type === 'info' ? 'background: #3B82F6;' : ''}\n            `;\n            notification.textContent = message;\n            \n            document.body.appendChild(notification);\n            \n            // Animate in\n            setTimeout(() => {\n                notification.style.transform = 'translateX(0)';\n            }, 100);\n            \n            // Auto remove\n            setTimeout(() => {\n                notification.style.transform = 'translateX(100%)';\n                setTimeout(() => {\n                    document.body.removeChild(notification);\n                }, 300);\n            }, 3000);\n        }\n        \n        // Function consolidation: All section loading is now handled in the main showSection function above\n\n        // Students data will be loaded when navigating to the students section\n\n        // ==========================================\n        // ATTENDANCE CAPTURE FUNCTIONALITY\n        // ==========================================\n\n        // Global variables for attendance\n        const currentClassId = '2e47c8b1-5d4c-4a9b-8f3e-1b2c3d4e5f60'; // Turma 1\n        const currentLessonNumber = 15;\n        let selectedStudentId = null;\n\n        // Load attendance list with interactive checkboxes\n        async function loadAttendanceList() {\n            try {\n                document.getElementById('attendanceList').innerHTML = `\n                    <div class=\"loading-message\" style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                        <span style=\"font-size: 1.5rem; margin-bottom: 0.5rem; display: block;\">ðŸ“‹</span>\n                        Carregando lista de presenÃ§a...\n                    </div>\n                `;\n\n                const studentsResponse = await fetch(`/api/students`);\n                const studentsResult = await studentsResponse.json();\n\n                const attendanceResponse = await fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance`);\n                const attendanceResult = await attendanceResponse.json();\n\n                if (studentsResult.success && attendanceResult.success) {\n                    displayAttendanceList(studentsResult.data, attendanceResult.data);\n                    updateAttendanceStats(studentsResult.data, attendanceResult.data);\n                } else {\n                    throw new Error('Failed to load attendance data');\n                }\n            } catch (error) {\n                console.error('Erro ao carregar lista de presenÃ§a:', error);\n                document.getElementById('attendanceList').innerHTML = `\n                    <div style=\"text-align: center; color: #EF4444; padding: 2rem;\">\n                        <span style=\"font-size: 1.5rem; margin-bottom: 0.5rem; display: block;\">âš ï¸</span>\n                        Erro ao carregar lista de presenÃ§a\n                    </div>\n                `;\n            }\n        }\n\n        // Display attendance list with interactive cards\n        function displayAttendanceList(students, attendanceRecords) {\n            const attendanceMap = {};\n            attendanceRecords.forEach(record => {\n                attendanceMap[record.studentId] = record;\n            });\n\n            const html = `\n                <div class=\"attendance-grid\" style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;\">\n                    ${students.map(enrollment => {\n                        const student = enrollment?.student;\n                        if (!student || !student.id) {\n                            console.warn('Invalid student data in enrollment:', enrollment);\n                            return '';\n                        }\n                        const attendance = attendanceMap[student.id];\n                        const isPresent = attendance ? attendance.present : false;\n                        const isLate = attendance ? attendance.arrived_late : false;\n                        const leftEarly = attendance ? attendance.left_early : false;\n                        \n                        // Safe access to user data\n                        const user = student.user || {};\n                        const firstName = user.firstName || 'N';\n                        const lastName = user.lastName || 'A';\n                        const email = user.email || 'sem-email@exemplo.com';\n                        const initials = firstName.charAt(0) + lastName.charAt(0);\n                        \n                        return `\n                            <div class=\"attendance-card\" style=\"background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1);\">\n                                <div style=\"display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;\">\n                                    <div style=\"width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #3B82F6, #10B981); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;\">\n                                        ${initials}\n                                    </div>\n                                    <div>\n                                        <div style=\"font-weight: 600; color: white;\">${firstName} ${lastName}</div>\n                                        <div style=\"font-size: 0.875rem; color: #CBD5E1;\">${email}</div>\n                                    </div>\n                                </div>\n                                \n                                <div style=\"display: flex; flex-direction: column; gap: 0.5rem;\">\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; cursor: pointer;\">\n                                        <input type=\"checkbox\" ${isPresent ? 'checked' : ''} \n                                               onchange=\"toggleAttendance('${student.id}', 'present', this.checked)\"\n                                               style=\"width: 18px; height: 18px;\">\n                                        <span style=\"color: white;\">Presente</span>\n                                        ${isPresent ? '<span style=\"color: #10B981; margin-left: auto;\">âœ…</span>' : ''}\n                                    </label>\n\n                                    ${isPresent ? `\n                                        <label style=\"display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-left: 1rem;\">\n                                            <input type=\"checkbox\" ${isLate ? 'checked' : ''} \n                                                   onchange=\"toggleAttendance('${student.id}', 'arrived_late', this.checked)\"\n                                                   style=\"width: 16px; height: 16px;\">\n                                            <span style=\"color: #CBD5E1; font-size: 0.875rem;\">Chegou atrasado</span>\n                                        </label>\n                                        \n                                        <label style=\"display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-left: 1rem;\">\n                                            <input type=\"checkbox\" ${leftEarly ? 'checked' : ''} \n                                                   onchange=\"toggleAttendance('${student.id}', 'left_early', this.checked)\"\n                                                   style=\"width: 16px; height: 16px;\">\n                                            <span style=\"color: #CBD5E1; font-size: 0.875rem;\">Saiu mais cedo</span>\n                                        </label>\n                                    ` : ''}\n                                </div>\n                            </div>\n                        `;\n                    }).join('')}\n                </div>\n            `;\n            \n            document.getElementById('attendanceList').innerHTML = html;\n        }\n\n        // Toggle individual attendance\n        async function toggleAttendance(studentId, field, value) {\n            try {\n                const attendanceData = {\n                    studentId: studentId,\n                    classId: currentClassId,\n                    courseId: '750273f9-7508-4fbf-affb-8efe189f2875', // Krav Maga course ID\n                    lessonNumber: currentLessonNumber,\n                    date: new Date().toISOString()\n                };\n\n                if (field === 'present') {\n                    attendanceData.present = value;\n                    attendanceData.arrived_late = false;\n                    attendanceData.left_early = false;\n                } else {\n                    // Get current attendance status first\n                    const currentAttendance = await fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance`);\n                    const currentResult = await currentAttendance.json();\n                    const studentAttendance = currentResult.data.find(a => a.studentId === studentId);\n                    \n                    attendanceData.present = studentAttendance ? studentAttendance.present : true;\n                    attendanceData[field] = value;\n                }\n\n                const response = await fetch('/api/attendance', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(attendanceData)\n                });\n\n                const result = await response.json();\n                \n                if (result.success) {\n                    console.log('âœ… PresenÃ§a atualizada:', result.data);\n                    showToast('PresenÃ§a atualizada com sucesso!');\n                    // Reload attendance list after short delay\n                    setTimeout(loadAttendanceList, 500);\n                } else {\n                    throw new Error(result.message || 'Failed to update attendance');\n                }\n            } catch (error) {\n                console.error('Erro ao atualizar presenÃ§a:', error);\n                showToast('Erro ao atualizar presenÃ§a', 'error');\n            }\n        }\n\n        // Mark all students present\n        async function markAllPresent() {\n            try {\n                const studentsResponse = await fetch(`/api/students`);\n                const studentsResult = await studentsResponse.json();\n\n                if (!studentsResult.success) {\n                    throw new Error('Failed to load students');\n                }\n\n                const studentsData = studentsResult.data.map(enrollment => ({\n                    studentId: enrollment.student.id,\n                    present: true,\n                    arrived_late: false,\n                    left_early: false\n                }));\n\n                const response = await fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance/bulk`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        students: studentsData,\n                        courseId: '750273f9-7508-4fbf-affb-8efe189f2875',\n                        date: new Date().toISOString()\n                    })\n                });\n\n                const result = await response.json();\n                \n                if (result.success) {\n                    console.log('âœ… Todos os alunos marcados como presentes');\n                    showToast('Todos os alunos marcados como presentes!');\n                    loadAttendanceList();\n                } else {\n                    throw new Error(result.message || 'Failed to mark all present');\n                }\n            } catch (error) {\n                console.error('Erro ao marcar todos presentes:', error);\n                showToast('Erro ao marcar todos presentes', 'error');\n            }\n        }\n\n        // Update attendance statistics\n        function updateAttendanceStats(students, attendanceRecords) {\n            const totalStudents = students.length;\n            const presentStudents = attendanceRecords.filter(record => record.present).length;\n            const absentStudents = totalStudents - presentStudents;\n            const attendanceRate = totalStudents > 0 ? Math.round((presentStudents / totalStudents) * 100) : 0;\n\n            document.getElementById('attendanceRate').textContent = attendanceRate + '%';\n            document.getElementById('presentCount').textContent = presentStudents;\n            document.getElementById('absentCount').textContent = absentStudents;\n        }\n\n        // ==========================================\n        // QR CODE FUNCTIONALITY\n        // ==========================================\n\n        function showQRScanner() {\n            const qrCamera = document.getElementById('qrCamera');\n            const qrSection = document.getElementById('qrSection');\n            \n            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n                qrCamera.style.display = 'block';\n                qrCamera.innerHTML = `\n                    <div style=\"background: rgba(0,0,0,0.8); padding: 1rem; border-radius: 8px;\">\n                        <video id=\"qrVideo\" width=\"300\" height=\"200\" style=\"border-radius: 8px;\"></video>\n                        <div style=\"margin-top: 1rem;\">\n                            <button onclick=\"stopQRScanner()\" style=\"background: #EF4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;\">\n                                Parar Scanner\n                            </button>\n                        </div>\n                        <div id=\"qrResult\" style=\"margin-top: 1rem; color: #10B981;\"></div>\n                    </div>\n                `;\n                \n                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })\n                    .then(stream => {\n                        const video = document.getElementById('qrVideo');\n                        video.srcObject = stream;\n                        video.play();\n                        showToast('Scanner QR ativado! Aponte para o cÃ³digo QR');\n                    })\n                    .catch(err => {\n                        showToast('Erro ao acessar cÃ¢mera: ' + err.message, 'error');\n                    });\n            } else {\n                showToast('CÃ¢mera nÃ£o disponÃ­vel neste dispositivo', 'error');\n            }\n        }\n\n        function stopQRScanner() {\n            const video = document.getElementById('qrVideo');\n            if (video && video.srcObject) {\n                video.srcObject.getTracks().forEach(track => track.stop());\n            }\n            document.getElementById('qrCamera').style.display = 'none';\n            showToast('Scanner QR desativado');\n        }\n\n        function generateClassQR() {\n            const qrDisplay = document.getElementById('qrDisplay');\n            qrDisplay.style.display = 'block';\n            qrDisplay.innerHTML = `\n                <div style=\"background: white; padding: 2rem; border-radius: 8px; display: inline-block;\">\n                    <div style=\"width: 200px; height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border: 2px dashed #ccc; color: #666;\">\n                        QR Code<br>Aula ${currentLessonNumber}\n                    </div>\n                    <div style=\"text-align: center; margin-top: 1rem; color: #333; font-weight: bold;\">\n                        Aula ${currentLessonNumber} - Turma 1<br>\n                        <small>Escaneie para marcar presenÃ§a</small>\n                    </div>\n                </div>\n            `;\n            showToast('QR Code da aula gerado!');\n        }\n\n        // ==========================================\n        // GPS LOCATION FUNCTIONALITY\n        // ==========================================\n\n        function captureByLocation() {\n            const locationResult = document.getElementById('locationResult');\n            \n            if (navigator.geolocation) {\n                locationResult.innerHTML = '<p style=\"color: #F59E0B;\">ðŸ“ Obtendo localizaÃ§Ã£o...</p>';\n                \n                navigator.geolocation.getCurrentPosition(\n                    position => {\n                        const lat = position.coords.latitude;\n                        const lng = position.coords.longitude;\n                        \n                        // Coordenadas fictÃ­cias da academia (exemplo)\n                        const academyLat = -23.5505;\n                        const academyLng = -46.6333;\n                        \n                        const distance = calculateDistance(lat, lng, academyLat, academyLng);\n                        \n                        if (distance < 0.1) { // Dentro de 100m\n                            locationResult.innerHTML = `\n                                <p style=\"color: #10B981;\">âœ… LocalizaÃ§Ã£o confirmada!</p>\n                                <p style=\"color: #CBD5E1;\">VocÃª estÃ¡ na academia (${distance.toFixed(3)}km)</p>\n                                <button onclick=\"markPresentByLocation()\" style=\"background: #10B981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; margin-top: 0.5rem;\">\n                                    Marcar PresenÃ§a\n                                </button>\n                            `;\n                        } else {\n                            locationResult.innerHTML = `\n                                <p style=\"color: #EF4444;\">âŒ LocalizaÃ§Ã£o invÃ¡lida</p>\n                                <p style=\"color: #CBD5E1;\">VocÃª estÃ¡ a ${distance.toFixed(2)}km da academia</p>\n                            `;\n                        }\n                    },\n                    error => {\n                        locationResult.innerHTML = `<p style=\"color: #EF4444;\">âŒ Erro ao obter localizaÃ§Ã£o: ${error.message}</p>`;\n                    }\n                );\n            } else {\n                locationResult.innerHTML = '<p style=\"color: #EF4444;\">âŒ GeolocalizaÃ§Ã£o nÃ£o suportada</p>';\n            }\n        }\n\n        function calculateDistance(lat1, lng1, lat2, lng2) {\n            const R = 6371; // Raio da Terra em km\n            const dLat = (lat2 - lat1) * Math.PI / 180;\n            const dLng = (lng2 - lng1) * Math.PI / 180;\n            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n                      Math.sin(dLng/2) * Math.sin(dLng/2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n            return R * c;\n        }\n\n        function markPresentByLocation() {\n            // Implementar marcaÃ§Ã£o por localizaÃ§Ã£o\n            showToast('Funcionalidade em desenvolvimento');\n        }\n\n        // ==========================================\n        // SEARCH FUNCTIONALITY\n        // ==========================================\n\n        // Using the global allStudents variable declared above\n\n        async function loadAllStudents() {\n            try {\n                const response = await fetch(`/api/students`);\n                const result = await response.json();\n                if (result.success) {\n                    allStudents = result.data;\n                }\n            } catch (error) {\n                console.error('Erro ao carregar alunos:', error);\n            }\n        }\n\n        function searchStudentByName(query) {\n            if (!query.trim()) {\n                document.getElementById('searchResults').innerHTML = '<p>Digite para buscar alunos por nome</p>';\n                selectedStudentId = null;\n                return;\n            }\n\n            const filtered = allStudents.filter(enrollment => {\n                const student = enrollment?.student;\n                if (!student || !student.user) return false;\n                const user = student.user;\n                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase();\n                return fullName.includes(query.toLowerCase());\n            });\n\n            displaySearchResults(filtered);\n        }\n\n        function searchStudentByID(query) {\n            if (!query.trim()) {\n                document.getElementById('searchResults').innerHTML = '<p>Digite para buscar por matrÃ­cula</p>';\n                selectedStudentId = null;\n                return;\n            }\n\n            const filtered = allStudents.filter(enrollment => {\n                const student = enrollment?.student;\n                if (!student) return false;\n                const user = student.user || {};\n                return student.id?.includes(query) || \n                       (user.email || '').includes(query);\n            });\n\n            displaySearchResults(filtered);\n        }\n\n        function displaySearchResults(students) {\n            if (students.length === 0) {\n                document.getElementById('searchResults').innerHTML = '<p style=\"color: #EF4444;\">Nenhum aluno encontrado</p>';\n                selectedStudentId = null;\n                return;\n            }\n\n            const html = students.map(enrollment => {\n                const student = enrollment?.student;\n                if (!student || !student.id) return '';\n                \n                const user = student.user || {};\n                const firstName = user.firstName || 'N';\n                const lastName = user.lastName || 'A';\n                const email = user.email || 'sem-email@exemplo.com';\n                \n                return `\n                    <div onclick=\"selectStudent('${student.id}')\" \n                         style=\"padding: 0.5rem; margin: 0.25rem 0; background: rgba(59, 130, 246, 0.1); border-radius: 4px; cursor: pointer; border: 1px solid rgba(59, 130, 246, 0.3);\"\n                         onmouseover=\"this.style.background='rgba(59, 130, 246, 0.2)'\"\n                         onmouseout=\"this.style.background='rgba(59, 130, 246, 0.1)'\">\n                        <strong>${firstName} ${lastName}</strong><br>\n                        <small style=\"color: #CBD5E1;\">${email} | ID: ${student.id.slice(0, 8)}...</small>\n                    </div>\n                `;\n            }).join('');\n\n            document.getElementById('searchResults').innerHTML = html;\n        }\n\n        function selectStudent(studentId) {\n            selectedStudentId = studentId;\n            const student = allStudents.find(e => e.student.id === studentId);\n            if (student) {\n                const user = student.student.user || {};\n                const firstName = user.firstName || 'N';\n                const lastName = user.lastName || 'A';\n                document.getElementById('searchResults').innerHTML = `\n                    <p style=\"color: #10B981;\">âœ… Selecionado: ${firstName} ${lastName}</p>\n                `;\n            }\n        }\n\n        function markSelectedPresent() {\n            if (!selectedStudentId) {\n                showToast('Selecione um aluno primeiro', 'error');\n                return;\n            }\n            toggleAttendance(selectedStudentId, 'present', true);\n        }\n\n        // Enhanced toast notification\n        function showToast(message, type = 'success') {\n            const toast = document.getElementById('toast') || createToast();\n            const icon = type === 'error' ? 'âŒ' : 'âœ…';\n            toast.innerHTML = `\n                <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                    <span>${icon}</span>\n                    <span>${message}</span>\n                </div>\n            `;\n            toast.className = `toast ${type}`;\n            toast.style.display = 'block';\n            setTimeout(() => toast.style.display = 'none', 3000);\n        }\n\n        function createToast() {\n            const toast = document.createElement('div');\n            toast.id = 'toast';\n            toast.className = 'toast';\n            toast.style.cssText = `\n                position: fixed; top: 20px; right: 20px; z-index: 10000;\n                background: rgba(16, 185, 129, 0.9); color: white; padding: 1rem;\n                border-radius: 8px; display: none; max-width: 300px;\n            `;\n            document.body.appendChild(toast);\n            return toast;\n        }\n\n        // Initialize attendance when page loads\n        document.addEventListener('DOMContentLoaded', function() {\n            loadAllStudents();\n        });\n\n        // ==========================================\n        // STUDENT PORTAL FUNCTIONALITY\n        // ==========================================\n\n        let currentStudent = null;\n\n        // Student login function\n        async function studentLogin() {\n            const name = document.getElementById('studentName').value.trim();\n            const matricula = document.getElementById('studentMatricula').value.trim();\n\n            if (!name || !matricula) {\n                showToast('Por favor, preencha nome e matrÃ­cula', 'error');\n                return;\n            }\n\n            try {\n                // Search for student by name and email/ID\n                const response = await fetch(`/api/students`);\n                const result = await response.json();\n\n                if (result.success) {\n                    const student = result.data.find(enrollment => {\n                        const s = enrollment?.student;\n                        if (!s || !s.user) return false;\n                        const user = s.user;\n                        const fullName = `${user.firstName || 'N'} ${user.lastName || 'A'}`.toLowerCase();\n                        return fullName.includes(name.toLowerCase()) && \n                               ((user.email || '').includes(matricula) || s.id.includes(matricula));\n                    });\n\n                    if (student) {\n                        currentStudent = student.student;\n                        showStudentDashboard();\n                        showToast(`Bem-vindo, ${currentStudent.user.firstName}!`);\n                    } else {\n                        showToast('Aluno nÃ£o encontrado. Verifique nome e matrÃ­cula', 'error');\n                    }\n                }\n            } catch (error) {\n                console.error('Erro no login:', error);\n                showToast('Erro ao fazer login', 'error');\n            }\n        }\n\n        // Show student dashboard after login\n        function showStudentDashboard() {\n            document.getElementById('studentLoginSection').style.display = 'none';\n            document.getElementById('studentDashboard').style.display = 'block';\n            \n            // Update welcome message\n            document.getElementById('studentWelcome').textContent = \n                `ðŸ‘‹ Bem-vindo, ${currentStudent.user.firstName} ${currentStudent.user.lastName}!`;\n\n            // Load student data\n            loadStudentData();\n        }\n\n        // Student logout\n        function studentLogout() {\n            currentStudent = null;\n            document.getElementById('studentLoginSection').style.display = 'block';\n            document.getElementById('studentDashboard').style.display = 'none';\n            document.getElementById('studentName').value = '';\n            document.getElementById('studentMatricula').value = '';\n            showToast('Logout realizado com sucesso');\n        }\n\n        // Load student specific data\n        async function loadStudentData() {\n            try {\n                // Load attendance data\n                const attendanceResponse = await fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance`);\n                const attendanceResult = await attendanceResponse.json();\n                \n                if (attendanceResult.success) {\n                    const studentAttendance = attendanceResult.data.find(a => a.studentId === currentStudent.id);\n                    updateStudentStats(studentAttendance);\n                    loadStudentAttendanceHistory();\n                }\n\n                // Load progress data\n                loadStudentProgress();\n                loadStudentChallenges();\n\n            } catch (error) {\n                console.error('Erro ao carregar dados do aluno:', error);\n            }\n        }\n\n        // Update student statistics\n        function updateStudentStats(todayAttendance) {\n            // No hardcoded data - will be populated by real API calls\n\n            // Update attendance status for today\n            if (todayAttendance && todayAttendance.present) {\n                document.getElementById('studentManualResult').innerHTML = \n                    '<span style=\"color: #10B981;\">âœ… PresenÃ§a jÃ¡ confirmada!</span>';\n            }\n        }\n\n        // Load student attendance history\n        function loadStudentAttendanceHistory() {\n            const historyHtml = `\n                <div style=\"space-y: 0.5rem;\">\n                    <div style=\"display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 4px; margin-bottom: 0.5rem;\">\n                        <span>Aula 15 - 27/06</span>\n                        <span style=\"color: #10B981;\">âœ… Presente</span>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 4px; margin-bottom: 0.5rem;\">\n                        <span>Aula 14 - 25/06</span>\n                        <span style=\"color: #10B981;\">âœ… Presente</span>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(239, 68, 68, 0.1); border-radius: 4px; margin-bottom: 0.5rem;\">\n                        <span>Aula 13 - 22/06</span>\n                        <span style=\"color: #EF4444;\">âŒ Ausente</span>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(245, 158, 11, 0.1); border-radius: 4px; margin-bottom: 0.5rem;\">\n                        <span>Aula 12 - 20/06</span>\n                        <span style=\"color: #F59E0B;\">â° Atrasado</span>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 4px; margin-bottom: 0.5rem;\">\n                        <span>Aula 11 - 18/06</span>\n                        <span style=\"color: #10B981;\">âœ… Presente</span>\n                    </div>\n                </div>\n            `;\n            document.getElementById('studentAttendanceHistory').innerHTML = historyHtml;\n        }\n\n        // Load student progress in techniques\n        function loadStudentProgress() {\n            const progressHtml = `\n                <div style=\"space-y: 0.5rem;\">\n                    <div style=\"padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 4px; margin-bottom: 0.5rem;\">\n                        <div style=\"font-weight: 600; color: #10B981;\">âœ… Postura de Guarda</div>\n                        <small style=\"color: #CBD5E1;\">Dominada - 95% precisÃ£o</small>\n                    </div>\n                    <div style=\"padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 4px; margin-bottom: 0.5rem;\">\n                        <div style=\"font-weight: 600; color: #10B981;\">âœ… Soco Direto</div>\n                        <small style=\"color: #CBD5E1;\">Dominada - 88% precisÃ£o</small>\n                    </div>\n                    <div style=\"padding: 0.5rem; background: rgba(245, 158, 11, 0.1); border-radius: 4px; margin-bottom: 0.5rem;\">\n                        <div style=\"font-weight: 600; color: #F59E0B;\">ðŸ”„ Defesa Contra Soco</div>\n                        <small style=\"color: #CBD5E1;\">Em progresso - 65% precisÃ£o</small>\n                    </div>\n                    <div style=\"padding: 0.5rem; background: rgba(75, 85, 99, 0.1); border-radius: 4px; margin-bottom: 0.5rem;\">\n                        <div style=\"font-weight: 600; color: #6B7280;\">â³ Joelhada</div>\n                        <small style=\"color: #CBD5E1;\">PrÃ³xima tÃ©cnica</small>\n                    </div>\n                    <div style=\"padding: 0.5rem; background: rgba(75, 85, 99, 0.1); border-radius: 4px; margin-bottom: 0.5rem;\">\n                        <div style=\"font-weight: 600; color: #6B7280;\">â³ Esquiva Lateral</div>\n                        <small style=\"color: #CBD5E1;\">PrÃ³xima tÃ©cnica</small>\n                    </div>\n                </div>\n            `;\n            document.getElementById('studentTechniquesProgress').innerHTML = progressHtml;\n        }\n\n        // Load student challenges\n        function loadStudentChallenges() {\n            const challengesHtml = `\n                <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;\">\n                    <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);\">\n                        <h5 style=\"color: #3B82F6; margin-bottom: 0.5rem;\">ðŸ“± Desafio da Semana</h5>\n                        <p style=\"margin-bottom: 1rem;\">Pratique 10 socos diretos em casa e filme</p>\n                        <button style=\"width: 100%; padding: 0.5rem; background: #3B82F6; color: white; border: none; border-radius: 4px; cursor: pointer;\">\n                            Enviar VÃ­deo\n                        </button>\n                    </div>\n                    <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                        <h5 style=\"color: #10B981; margin-bottom: 0.5rem;\">âœ… Desafio Completo</h5>\n                        <p style=\"margin-bottom: 1rem;\">Postura de guarda por 2 minutos</p>\n                        <div style=\"color: #10B981; font-weight: 600;\">+50 Pontos XP</div>\n                    </div>\n                    <div style=\"background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(245, 158, 11, 0.3);\">\n                        <h5 style=\"color: #F59E0B; margin-bottom: 0.5rem;\">â° Desafio Extra</h5>\n                        <p style=\"margin-bottom: 1rem;\">Treine cardio por 15 minutos</p>\n                        <button style=\"width: 100%; padding: 0.5rem; background: #F59E0B; color: white; border: none; border-radius: 4px; cursor: pointer;\">\n                            Marcar Completo\n                        </button>\n                    </div>\n                </div>\n            `;\n            document.getElementById('studentChallenges').innerHTML = challengesHtml;\n        }\n\n        // Student QR scan function\n        function studentQRScan() {\n            const resultDiv = document.getElementById('studentQRResult');\n            \n            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n                resultDiv.innerHTML = '<span style=\"color: #F59E0B;\">ðŸ“· Ativando cÃ¢mera...</span>';\n                \n                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })\n                    .then(stream => {\n                        resultDiv.innerHTML = `\n                            <div style=\"margin: 1rem 0;\">\n                                <video id=\"studentQRVideo\" width=\"200\" height=\"150\" style=\"border-radius: 8px; background: #000;\"></video>\n                                <div style=\"margin-top: 0.5rem;\">\n                                    <button onclick=\"stopStudentQRScan()\" style=\"background: #EF4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;\">\n                                        Parar\n                                    </button>\n                                </div>\n                            </div>\n                        `;\n                        const video = document.getElementById('studentQRVideo');\n                        video.srcObject = stream;\n                        video.play();\n                        \n                        // Simulate QR detection after 3 seconds\n                        setTimeout(() => {\n                            studentMarkPresenceQR();\n                        }, 3000);\n                    })\n                    .catch(err => {\n                        resultDiv.innerHTML = '<span style=\"color: #EF4444;\">âŒ Erro ao acessar cÃ¢mera</span>';\n                    });\n            } else {\n                resultDiv.innerHTML = '<span style=\"color: #EF4444;\">âŒ CÃ¢mera nÃ£o disponÃ­vel</span>';\n            }\n        }\n\n        function stopStudentQRScan() {\n            const video = document.getElementById('studentQRVideo');\n            if (video && video.srcObject) {\n                video.srcObject.getTracks().forEach(track => track.stop());\n            }\n            document.getElementById('studentQRResult').innerHTML = 'Escaneie o QR code mostrado pelo instrutor';\n        }\n\n        function studentMarkPresenceQR() {\n            stopStudentQRScan();\n            markStudentPresent('QR_CODE');\n            document.getElementById('studentQRResult').innerHTML = '<span style=\"color: #10B981;\">âœ… QR Code detectado! PresenÃ§a confirmada</span>';\n        }\n\n        // Student GPS check\n        function studentGPSCheck() {\n            const resultDiv = document.getElementById('studentGPSResult');\n            \n            if (navigator.geolocation) {\n                resultDiv.innerHTML = '<span style=\"color: #F59E0B;\">ðŸ“ Verificando localizaÃ§Ã£o...</span>';\n                \n                navigator.geolocation.getCurrentPosition(\n                    position => {\n                        const lat = position.coords.latitude;\n                        const lng = position.coords.longitude;\n                        \n                        // Academy coordinates (mock)\n                        const academyLat = -23.5505;\n                        const academyLng = -46.6333;\n                        \n                        const distance = calculateDistance(lat, lng, academyLat, academyLng);\n                        \n                        if (distance < 0.1) { // Within 100m\n                            markStudentPresent('GEOLOCATION');\n                            resultDiv.innerHTML = '<span style=\"color: #10B981;\">âœ… LocalizaÃ§Ã£o confirmada! PresenÃ§a marcada</span>';\n                        } else {\n                            resultDiv.innerHTML = `<span style=\"color: #EF4444;\">âŒ VocÃª estÃ¡ a ${distance.toFixed(2)}km da academia</span>`;\n                        }\n                    },\n                    error => {\n                        resultDiv.innerHTML = '<span style=\"color: #EF4444;\">âŒ Erro ao obter localizaÃ§Ã£o</span>';\n                    }\n                );\n            } else {\n                resultDiv.innerHTML = '<span style=\"color: #EF4444;\">âŒ GPS nÃ£o disponÃ­vel</span>';\n            }\n        }\n\n        // Student manual check-in\n        function studentManualCheckIn() {\n            markStudentPresent('MANUAL');\n            document.getElementById('studentManualResult').innerHTML = '<span style=\"color: #10B981;\">âœ… PresenÃ§a confirmada manualmente!</span>';\n        }\n\n        // Mark student present (unified function)\n        async function markStudentPresent(method) {\n            if (!currentStudent) {\n                showToast('Erro: aluno nÃ£o identificado', 'error');\n                return;\n            }\n\n            try {\n                const attendanceData = {\n                    studentId: currentStudent.id,\n                    classId: currentClassId,\n                    courseId: '750273f9-7508-4fbf-affb-8efe189f2875',\n                    lessonNumber: currentLessonNumber,\n                    date: new Date().toISOString(),\n                    present: true,\n                    arrived_late: false,\n                    left_early: false,\n                    method: method\n                };\n\n                const response = await fetch('/api/attendance', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(attendanceData)\n                });\n\n                const result = await response.json();\n                \n                if (result.success) {\n                    showToast(`PresenÃ§a confirmada via ${method}!`);\n                    // Update stats\n                    updateStudentStats({present: true});\n                } else {\n                    throw new Error(result.message || 'Failed to mark attendance');\n                }\n            } catch (error) {\n                console.error('Erro ao marcar presenÃ§a:', error);\n                showToast('Erro ao confirmar presenÃ§a', 'error');\n            }\n        }\n\n        // Navigation functionality consolidated in main showSection function above\n\n        // ==========================================\n        // PUBLIC CHECK-IN KIOSK FUNCTIONALITY\n        // ==========================================\n\n        let publicCheckinStudents = [];\n        let checkinCount = 0;\n        let selectedStudentForCheckin = null;\n\n        // Load public check-in interface\n        async function loadPublicCheckin() {\n            await loadStudentsForCheckin();\n            loadRecentCheckins();\n            updateCheckinCount();\n            document.getElementById('quickMatricula').value = '';\n            document.getElementById('quickResult').innerHTML = 'Digite sua matrÃ­cula e pressione Enter';\n        }\n\n        // Load students for visual selection\n        async function loadStudentsForCheckin() {\n            try {\n                const response = await fetch(`/api/students`);\n                const result = await response.json();\n\n                if (result.success) {\n                    publicCheckinStudents = result.data;\n                    displayStudentGrid();\n                }\n            } catch (error) {\n                console.error('Erro ao carregar alunos:', error);\n            }\n        }\n\n        // Display student grid with photos\n        function displayStudentGrid() {\n            const grid = document.getElementById('studentGrid');\n            \n            if (!grid) {\n                console.error('studentGrid element not found');\n                return;\n            }\n            \n            const html = publicCheckinStudents.map(item => {\n                // Check if data is in enrollment.student format or direct student format\n                const student = item?.student || item;\n                if (!student || !student.id) {\n                    console.warn('Invalid student data in enrollment:', item);\n                    return '';\n                }\n                \n                // Safe access to user data\n                const user = student.user || {};\n                const firstName = user.firstName || 'N';\n                const lastName = user.lastName || 'A';\n                const initials = firstName.charAt(0) + lastName.charAt(0);\n                \n                return `\n                    <div onclick=\"selectStudentForCheckin('${student.id}')\" \n                         class=\"student-card\" id=\"card-${student.id}\"\n                         style=\"background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: all 0.2s;\"\n                         onmouseover=\"this.style.background='rgba(59, 130, 246, 0.2)'; this.style.borderColor='#3B82F6'\"\n                         onmouseout=\"this.style.background='rgba(255,255,255,0.1)'; this.style.borderColor='transparent'\">\n                        \n                        <div style=\"width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #3B82F6, #10B981); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.5rem; margin: 0 auto 0.5rem;\">\n                            ${initials}\n                        </div>\n                        \n                        <div style=\"font-weight: 600; color: white; font-size: 0.875rem; margin-bottom: 0.25rem;\">\n                            ${firstName}\n                        </div>\n                        <div style=\"font-weight: 600; color: white; font-size: 0.875rem; margin-bottom: 0.5rem;\">\n                            ${lastName}\n                        </div>\n                        \n                        <div style=\"font-size: 0.75rem; color: #CBD5E1;\">\n                            ID: ${student.id.slice(0, 6)}...\n                        </div>\n                        \n                        <div id=\"status-${student.id}\" style=\"margin-top: 0.5rem; font-size: 0.75rem;\">\n                            <span style=\"color: #6B7280;\">ðŸ‘¤ Ausente</span>\n                        </div>\n                    </div>\n                `;\n            }).join('');\n\n            grid.innerHTML = html;\n        }\n\n        // Select student for check-in\n        function selectStudentForCheckin(studentId) {\n            // Reset all cards\n            document.querySelectorAll('.student-card').forEach(card => {\n                card.style.background = 'rgba(255,255,255,0.1)';\n                card.style.borderColor = 'transparent';\n            });\n\n            // Highlight selected card\n            const selectedCard = document.getElementById(`card-${studentId}`);\n            if (selectedCard) {\n                selectedCard.style.background = 'rgba(16, 185, 129, 0.2)';\n                selectedCard.style.borderColor = '#10B981';\n            }\n\n            selectedStudentForCheckin = studentId;\n            \n            // Find student info - handle both direct student format and enrollment format\n            const studentItem = publicCheckinStudents.find(item => {\n                const student = item?.student || item;\n                return student && student.id === studentId;\n            });\n            \n            if (studentItem) {\n                const student = studentItem?.student || studentItem;\n                const user = student.user || {};\n                const firstName = user.firstName || 'N';\n                const lastName = user.lastName || 'A';\n                document.getElementById('quickResult').innerHTML = \n                    `<span style=\"color: #10B981;\">âœ… ${firstName} ${lastName} selecionado</span>`;\n                \n                // Auto check-in after 2 seconds\n                setTimeout(() => {\n                    publicCheckinStudent(studentId);\n                }, 2000);\n            }\n        }\n\n        // Handle quick search by typing\n        function handleQuickSearch(event) {\n            const query = event.target.value.trim();\n            \n            if (event.key === 'Enter' && query) {\n                quickCheckin();\n                return;\n            }\n\n            if (!query) {\n                document.getElementById('quickResult').innerHTML = 'Digite sua matrÃ­cula e pressione Enter';\n                return;\n            }\n\n            // Real-time search - handle both direct student format and enrollment format\n            const found = publicCheckinStudents.find(item => {\n                const student = item?.student || item;\n                if (!student || !student.user) return false;\n                const user = student.user;\n                return student.id.includes(query) || \n                       (user.email || '').includes(query) ||\n                       `${user.firstName || 'N'} ${user.lastName || 'A'}`.toLowerCase().includes(query.toLowerCase());\n            });\n\n            if (found) {\n                const student = found?.student || found;\n                selectedStudentForCheckin = student.id;\n                const user = student.user || {};\n                const firstName = user.firstName || 'N';\n                const lastName = user.lastName || 'A';\n                document.getElementById('quickResult').innerHTML = \n                    `<span style=\"color: #10B981;\">âœ… ${firstName} ${lastName} encontrado - Pressione Enter</span>`;\n            } else {\n                selectedStudentForCheckin = null;\n                document.getElementById('quickResult').innerHTML = \n                    `<span style=\"color: #F59E0B;\">âš ï¸ Aluno nÃ£o encontrado</span>`;\n            }\n        }\n\n        // Quick check-in function\n        function quickCheckin() {\n            if (!selectedStudentForCheckin) {\n                document.getElementById('quickResult').innerHTML = \n                    `<span style=\"color: #EF4444;\">âŒ Digite uma matrÃ­cula vÃ¡lida</span>`;\n                return;\n            }\n\n            publicCheckinStudent(selectedStudentForCheckin);\n        }\n\n        // Public check-in student (unified function)\n        async function publicCheckinStudent(studentId) {\n            try {\n                const attendanceData = {\n                    studentId: studentId,\n                    classId: currentClassId,\n                    courseId: '750273f9-7508-4fbf-affb-8efe189f2875',\n                    lessonNumber: currentLessonNumber,\n                    date: new Date().toISOString(),\n                    present: true,\n                    arrived_late: false,\n                    left_early: false,\n                    method: 'KIOSK'\n                };\n\n                const response = await fetch('/api/attendance', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(attendanceData)\n                });\n\n                const result = await response.json();\n                \n                if (result.success) {\n                    const studentItem = publicCheckinStudents.find(item => {\n                        const student = item?.student || item;\n                        return student && student.id === studentId;\n                    });\n                    \n                    if (studentItem) {\n                        const student = studentItem?.student || studentItem;\n                        const user = student.user || {};\n                        const studentName = `${user.firstName || 'N'} ${user.lastName || 'A'}`;\n                        \n                        // Update UI\n                        updateStudentCheckinStatus(studentId, true);\n                        showSuccessAnimation(studentName);\n                        loadRecentCheckins();\n                        updateCheckinCount();\n                        \n                        // Clear selection\n                        selectedStudentForCheckin = null;\n                        document.getElementById('quickMatricula').value = '';\n                        document.getElementById('quickResult').innerHTML = 'Digite sua matrÃ­cula e pressione Enter';\n                    }\n                    \n                } else {\n                    throw new Error(result.message || 'Failed to mark attendance');\n                }\n            } catch (error) {\n                console.error('Erro no check-in:', error);\n                document.getElementById('quickResult').innerHTML = \n                    `<span style=\"color: #EF4444;\">âŒ Erro no check-in</span>`;\n            }\n        }\n\n        // Update student check-in status in the grid\n        function updateStudentCheckinStatus(studentId, present) {\n            const statusDiv = document.getElementById(`status-${studentId}`);\n            const card = document.getElementById(`card-${studentId}`);\n            \n            if (present) {\n                statusDiv.innerHTML = '<span style=\"color: #10B981;\">âœ… Presente</span>';\n                card.style.background = 'rgba(16, 185, 129, 0.1)';\n                card.style.borderColor = '#10B981';\n                card.onclick = null; // Disable further clicks\n                card.style.cursor = 'default';\n            }\n        }\n\n        // Show success animation\n        function showSuccessAnimation(studentName) {\n            const animation = document.createElement('div');\n            animation.style.cssText = `\n                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);\n                background: rgba(16, 185, 129, 0.95); color: white; padding: 2rem;\n                border-radius: 16px; font-size: 1.5rem; font-weight: bold;\n                z-index: 10000; text-align: center; min-width: 300px;\n                animation: successPulse 0.5s ease-in-out;\n            `;\n            animation.innerHTML = `\n                <div style=\"font-size: 3rem; margin-bottom: 1rem;\">âœ…</div>\n                <div>Check-in Realizado!</div>\n                <div style=\"font-size: 1rem; margin-top: 0.5rem;\">${studentName}</div>\n            `;\n            \n            // Add CSS animation\n            const style = document.createElement('style');\n            style.textContent = `\n                @keyframes successPulse {\n                    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }\n                    50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }\n                    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }\n                }\n            `;\n            document.head.appendChild(style);\n            document.body.appendChild(animation);\n            \n            setTimeout(() => {\n                document.body.removeChild(animation);\n                document.head.removeChild(style);\n            }, 3000);\n        }\n\n        // Load recent check-ins\n        async function loadRecentCheckins() {\n            try {\n                const response = await fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance`);\n                const result = await response.json();\n\n                if (result.success) {\n                    displayRecentCheckins(result.data);\n                }\n            } catch (error) {\n                console.error('Erro ao carregar check-ins:', error);\n            }\n        }\n\n        // Display recent check-ins\n        function displayRecentCheckins(attendanceRecords) {\n            const container = document.getElementById('recentCheckins');\n            \n            if (!attendanceRecords || attendanceRecords.length === 0) {\n                container.innerHTML = `\n                    <div style=\"text-align: center; padding: 2rem; color: #6B7280;\">\n                        Nenhum check-in hoje ainda\n                    </div>\n                `;\n                return;\n            }\n\n            const html = attendanceRecords\n                .filter(record => record.present)\n                .map(record => {\n                    const student = publicCheckinStudents.find(e => e.student.id === record.studentId);\n                    if (!student) return '';\n                    \n                    const time = new Date().toLocaleTimeString('pt-BR', { \n                        hour: '2-digit', \n                        minute: '2-digit' \n                    });\n                    \n                    return `\n                        <div style=\"display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #10B981;\">\n                            <div>\n                                <div style=\"font-weight: 600; color: white;\">\n                                    ${(student.student?.user?.firstName || 'N/A')} ${(student.student?.user?.lastName || '')}\n                                </div>\n                                <div style=\"font-size: 0.875rem; color: #CBD5E1;\">\n                                    ID: ${(student.student?.id || 'N/A').toString().slice(0, 8)}...\n                                </div>\n                            </div>\n                            <div style=\"text-align: right;\">\n                                <div style=\"color: #10B981; font-weight: 600;\">âœ… Presente</div>\n                                <div style=\"font-size: 0.875rem; color: #CBD5E1;\">${time}</div>\n                            </div>\n                        </div>\n                    `;\n                })\n                .join('');\n\n            container.innerHTML = html || `\n                <div style=\"text-align: center; padding: 2rem; color: #6B7280;\">\n                    Nenhum check-in hoje ainda\n                </div>\n            `;\n        }\n\n        // Update check-in count\n        function updateCheckinCount() {\n            // Count present students\n            fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance`)\n                .then(response => response.json())\n                .then(result => {\n                    if (result.success) {\n                        const presentCount = result.data.filter(record => record.present).length;\n                        const totalStudents = publicCheckinStudents.length;\n                        document.getElementById('checkinCount').textContent = `${presentCount} Presentes`;\n                    }\n                })\n                .catch(error => console.error('Erro ao atualizar contador:', error));\n        }\n\n        // Refresh student grid\n        function refreshStudentGrid() {\n            loadStudentsForCheckin();\n            showToast('Lista de alunos atualizada');\n        }\n\n        // Public QR Scanner\n        function togglePublicQRScanner() {\n            const camera = document.getElementById('publicQRCamera');\n            \n            if (camera.style.display === 'none') {\n                startPublicQRScanner();\n            } else {\n                stopPublicQRScanner();\n            }\n        }\n\n        function startPublicQRScanner() {\n            const camera = document.getElementById('publicQRCamera');\n            const result = document.getElementById('publicQRResult');\n            \n            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n                camera.style.display = 'block';\n                camera.innerHTML = `\n                    <div style=\"background: rgba(0,0,0,0.8); padding: 1rem; border-radius: 8px; display: inline-block;\">\n                        <video id=\"publicQRVideo\" width=\"300\" height=\"200\" style=\"border-radius: 8px;\"></video>\n                        <div style=\"margin-top: 1rem;\">\n                            <button onclick=\"stopPublicQRScanner()\" style=\"background: #EF4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;\">\n                                Parar Scanner\n                            </button>\n                        </div>\n                    </div>\n                `;\n                \n                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })\n                    .then(stream => {\n                        const video = document.getElementById('publicQRVideo');\n                        video.srcObject = stream;\n                        video.play();\n                        result.innerHTML = '<span style=\"color: #10B981;\">ðŸ“· Scanner ativo - Aponte para o QR code</span>';\n                        \n                        // Simulate QR detection after 5 seconds\n                        setTimeout(() => {\n                            if (publicCheckinStudents.length > 0) {\n                                const randomStudent = publicCheckinStudents[0].student; // Use first student for demo\n                                publicCheckinStudent(randomStudent.id);\n                                result.innerHTML = '<span style=\"color: #10B981;\">âœ… QR Code detectado!</span>';\n                                stopPublicQRScanner();\n                            }\n                        }, 5000);\n                    })\n                    .catch(err => {\n                        result.innerHTML = '<span style=\"color: #EF4444;\">âŒ Erro ao acessar cÃ¢mera</span>';\n                    });\n            } else {\n                result.innerHTML = '<span style=\"color: #EF4444;\">âŒ CÃ¢mera nÃ£o disponÃ­vel</span>';\n            }\n        }\n\n        function stopPublicQRScanner() {\n            const video = document.getElementById('publicQRVideo');\n            if (video && video.srcObject) {\n                video.srcObject.getTracks().forEach(track => track.stop());\n            }\n            document.getElementById('publicQRCamera').style.display = 'none';\n            document.getElementById('publicQRResult').innerHTML = 'Escaneie o QR code do seu cartÃ£o de aluno';\n        }\n\n        // ==========================================\n        // STUDENT DETAILS MODAL FUNCTIONS\n        // ==========================================\n\n        // Store current students data globally for modal access\n        window.currentStudents = [];\n\n        // Update currentStudents when data is loaded\n        const originalLoadStudents = loadStudents;\n        loadStudents = async function() {\n            await originalLoadStudents();\n            window.currentStudents = allStudents || [];\n        };\n\n        // Open student details modal\n        window.openStudentDetails = async function(studentId) {\n            try {\n                console.log('Opening student details for ID:', studentId);\n                \n                // Find student data from current students list\n                const student = window.currentStudents?.find(s => s.id === studentId);\n                \n                if (!student) {\n                    console.error('Student not found:', studentId);\n                    showToast('Aluno nÃ£o encontrado', 'error');\n                    return;\n                }\n\n                // Populate modal with student data\n                populateStudentModal(student);\n                \n                // Show modal\n                document.getElementById('studentDetailsModal').style.display = 'block';\n                document.body.style.overflow = 'hidden'; // Prevent background scrolling\n                \n            } catch (error) {\n                console.error('Error opening student details:', error);\n                showToast('Erro ao abrir detalhes do aluno', 'error');\n            }\n        };\n\n        // Close student details modal\n        window.closeStudentModal = function() {\n            document.getElementById('studentDetailsModal').style.display = 'none';\n            document.body.style.overflow = 'auto'; // Restore scrolling\n        };\n\n        // Switch between tabs in student modal\n        window.switchStudentTab = function(tabName) {\n            // Hide all tab contents\n            const tabContents = document.querySelectorAll('.student-tab-content');\n            tabContents.forEach(tab => {\n                tab.style.display = 'none';\n            });\n\n            // Remove active class from all tab buttons\n            const tabButtons = document.querySelectorAll('.student-tab-btn');\n            tabButtons.forEach(btn => {\n                btn.classList.remove('active');\n                btn.style.color = '#94A3B8';\n                btn.style.borderBottomColor = 'transparent';\n            });\n\n            // Show selected tab content\n            const selectedTab = document.getElementById(`student-tab-${tabName}`);\n            if (selectedTab) {\n                selectedTab.style.display = 'block';\n            }\n\n            // Add active class to selected tab button\n            const selectedBtn = document.querySelector(`[data-tab=\"${tabName}\"]`);\n            if (selectedBtn) {\n                selectedBtn.classList.add('active');\n                selectedBtn.style.color = '#3B82F6';\n                selectedBtn.style.borderBottomColor = '#3B82F6';\n            }\n\n            // Load dynamic content based on tab\n            loadTabContent(tabName);\n        };\n\n        // Populate student modal with data\n        function populateStudentModal(student) {\n            try {\n                // Header information\n                const user = student.user || {};\n                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();\n                document.getElementById('modalStudentName').textContent = fullName || 'Nome nÃ£o informado';\n                document.getElementById('modalStudentId').textContent = `ID: ${student.id?.substring(0, 8) || 'N/A'}...`;\n\n                // Summary information\n                document.getElementById('modalStudentStatus').textContent = student.isActive ? 'Ativo' : 'Inativo';\n                document.getElementById('modalStudentCategory').textContent = getCategoryText(student.category);\n                document.getElementById('modalStudentClasses').textContent = '1'; // Default for now\n                document.getElementById('modalStudentAttendance').textContent = '85%'; // Default for now\n\n                // Basic Information\n                document.getElementById('modalFullName').textContent = fullName || 'NÃ£o informado';\n                document.getElementById('modalCpf').textContent = user.cpf ? formatCPF(user.cpf) : 'NÃ£o informado';\n                document.getElementById('modalBirthDate').textContent = user.birthDate ? new Date(user.birthDate).toLocaleDateString('pt-BR') : 'NÃ£o informado';\n                document.getElementById('modalAge').textContent = calculateAge(user.birthDate) || 'N/A';\n                document.getElementById('modalGender').textContent = getGenderText(student.gender);\n                document.getElementById('modalEmail').textContent = user.email || 'NÃ£o informado';\n                document.getElementById('modalPhone').textContent = user.phone || 'NÃ£o informado';\n\n                // Address Information\n                document.getElementById('modalPostalCode').textContent = student.postalCode || 'NÃ£o informado';\n                document.getElementById('modalAddress').textContent = student.address || 'NÃ£o informado';\n                document.getElementById('modalAddressNumber').textContent = student.addressNumber || 'NÃ£o informado';\n                document.getElementById('modalNeighborhood').textContent = student.neighborhood || 'NÃ£o informado';\n                document.getElementById('modalCity').textContent = student.city || 'NÃ£o informado';\n                document.getElementById('modalState').textContent = student.state || 'NÃ£o informado';\n\n                // Academic Information\n                document.getElementById('modalRegistration').textContent = student.matricula || student.id?.substring(0, 8) || 'N/A';\n                document.getElementById('modalEnrollmentDate').textContent = student.createdAt ? new Date(student.createdAt).toLocaleDateString('pt-BR') : 'NÃ£o informado';\n                document.getElementById('modalStudentCategoryDetails').textContent = getCategoryText(student.category);\n                document.getElementById('modalStatusDetails').textContent = student.isActive ? 'Ativo' : 'Inativo';\n                document.getElementById('modalSpecialNeeds').textContent = student.specialNeeds?.length > 0 ? student.specialNeeds.join(', ') : 'Nenhuma';\n\n                // Emergency Contact (placeholder for now)\n                document.getElementById('modalEmergencyName').textContent = student.emergencyContact || 'NÃ£o informado';\n                document.getElementById('modalEmergencyPhone').textContent = 'NÃ£o informado';\n                document.getElementById('modalEmergencyRelation').textContent = 'NÃ£o informado';\n\n            } catch (error) {\n                console.error('Error populating student modal:', error);\n            }\n        }\n\n        // Load dynamic tab content\n        function loadTabContent(tabName) {\n            const tabContent = document.getElementById(`student-tab-${tabName}`);\n            \n            switch(tabName) {\n                case 'courses':\n                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {\n                        tabContent.innerHTML = `\n                            <div style=\"background: rgba(59, 130, 246, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                                <h3 style=\"color: #3B82F6; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸ“š</span> Cursos Matriculados\n                                </h3>\n                                <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #10B981; margin-bottom: 1rem;\">\n                                    <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                        <div>\n                                            <div style=\"color: #10B981; font-weight: bold;\">ðŸ¥‹ Krav Maga Faixa Branca - Defesa Pessoal 1</div>\n                                            <div style=\"color: #CBD5E1; font-size: 0.875rem; margin-top: 0.25rem;\">Iniciado em: 01/06/2025 â€¢ Progresso: 31%</div>\n                                        </div>\n                                        <div style=\"background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: bold;\">\n                                            ATIVO\n                                        </div>\n                                    </div>\n                                </div>\n                                <div style=\"text-align: center; padding: 2rem; color: #6B7280;\">\n                                    <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">ðŸŽ¯</div>\n                                    <p style=\"margin: 0;\">Pronto para novos desafios! Considere matricular em cursos avanÃ§ados.</p>\n                                </div>\n                            </div>\n                        `;\n                    }\n                    break;\n                case 'classes':\n                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {\n                        tabContent.innerHTML = `\n                            <div style=\"background: rgba(245, 158, 11, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(245, 158, 11, 0.2);\">\n                                <h3 style=\"color: #F59E0B; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸ«</span> Turmas Participantes\n                                </h3>\n                                <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #3B82F6; margin-bottom: 1rem;\">\n                                    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                        <div style=\"color: #3B82F6; font-weight: bold;\">Turma 1 - TerÃ§as e Quintas</div>\n                                        <div style=\"background: #3B82F6; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: bold;\">\n                                            ATIVO\n                                        </div>\n                                    </div>\n                                    <div style=\"color: #CBD5E1; font-size: 0.875rem;\">\n                                        <div>â° HorÃ¡rio: 18:00 - 19:00</div>\n                                        <div>ðŸ‘¥ Capacidade: 15/20 alunos</div>\n                                        <div>ðŸ“… PrÃ³xima aula: Quinta, 05/06/2025</div>\n                                    </div>\n                                </div>\n                            </div>\n                        `;\n                    }\n                    break;\n                case 'progress':\n                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {\n                        tabContent.innerHTML = `\n                            <div style=\"display: grid; gap: 2rem;\">\n                                <div style=\"background: rgba(139, 92, 246, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                                    <h3 style=\"color: #8B5CF6; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                        <span>ðŸ“ˆ</span> Progresso Geral\n                                    </h3>\n                                    <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;\">\n                                        <div style=\"text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;\">\n                                            <div style=\"color: #10B981; font-size: 2rem; font-weight: bold;\">5</div>\n                                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">TÃ©cnicas Dominadas</div>\n                                        </div>\n                                        <div style=\"text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px;\">\n                                            <div style=\"color: #3B82F6; font-size: 2rem; font-weight: bold;\">65</div>\n                                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">Pontos XP</div>\n                                        </div>\n                                        <div style=\"text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px;\">\n                                            <div style=\"color: #F59E0B; font-size: 2rem; font-weight: bold;\">85%</div>\n                                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">FrequÃªncia</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        `;\n                    }\n                    break;\n                case 'financial':\n                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {\n                        tabContent.innerHTML = `\n                            <div style=\"background: rgba(16, 185, 129, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(16, 185, 129, 0.2);\">\n                                <h3 style=\"color: #10B981; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸ’°</span> SituaÃ§Ã£o Financeira\n                                </h3>\n                                <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;\">\n                                    <div>\n                                        <h4 style=\"color: #CBD5E1; margin: 0 0 1rem 0;\">Plano Atual</h4>\n                                        <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #3B82F6;\">\n                                            <div style=\"color: #3B82F6; font-weight: bold; margin-bottom: 0.5rem;\">Plano Mensal Premium</div>\n                                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">R$ 150,00/mÃªs</div>\n                                        </div>\n                                    </div>\n                                    <div>\n                                        <h4 style=\"color: #CBD5E1; margin: 0 0 1rem 0;\">Status Pagamento</h4>\n                                        <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #10B981;\">\n                                            <div style=\"color: #10B981; font-weight: bold; margin-bottom: 0.5rem;\">âœ… Em Dia</div>\n                                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">PrÃ³ximo vencimento: 01/07/2025</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        `;\n                    }\n                    break;\n                case 'attendance':\n                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {\n                        tabContent.innerHTML = `\n                            <div style=\"background: rgba(59, 130, 246, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                                <h3 style=\"color: #3B82F6; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸ“Š</span> HistÃ³rico de FrequÃªncia\n                                </h3>\n                                <div style=\"display: grid; gap: 1rem;\">\n                                    <div style=\"display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;\">\n                                        <span style=\"color: #CBD5E1;\">Aula 15 - 27/06/2025</span>\n                                        <span style=\"color: #10B981; font-weight: bold;\">âœ… Presente</span>\n                                    </div>\n                                    <div style=\"display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;\">\n                                        <span style=\"color: #CBD5E1;\">Aula 14 - 25/06/2025</span>\n                                        <span style=\"color: #10B981; font-weight: bold;\">âœ… Presente</span>\n                                    </div>\n                                    <div style=\"display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;\">\n                                        <span style=\"color: #CBD5E1;\">Aula 13 - 22/06/2025</span>\n                                        <span style=\"color: #EF4444; font-weight: bold;\">âŒ Ausente</span>\n                                    </div>\n                                </div>\n                            </div>\n                        `;\n                    }\n                    break;\n                case 'history':\n                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {\n                        tabContent.innerHTML = `\n                            <div style=\"background: rgba(139, 92, 246, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                                <h3 style=\"color: #8B5CF6; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                    <span>ðŸ“œ</span> HistÃ³rico de Atividades\n                                </h3>\n                                <div style=\"display: grid; gap: 1rem;\">\n                                    <div style=\"padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid #3B82F6;\">\n                                        <div style=\"color: #3B82F6; font-weight: bold; margin-bottom: 0.25rem;\">MatrÃ­cula Realizada</div>\n                                        <div style=\"color: #CBD5E1; font-size: 0.875rem;\">01/06/2025 - Curso: Krav Maga Faixa Branca</div>\n                                    </div>\n                                    <div style=\"padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 4px solid #10B981;\">\n                                        <div style=\"color: #10B981; font-weight: bold; margin-bottom: 0.25rem;\">Primeira AvaliaÃ§Ã£o</div>\n                                        <div style=\"color: #CBD5E1; font-size: 0.875rem;\">15/06/2025 - Nota: 8.5/10</div>\n                                    </div>\n                                </div>\n                            </div>\n                        `;\n                    }\n                    break;\n            }\n        }\n\n        // Helper functions for modal\n        function calculateAge(birthDate) {\n            if (!birthDate) return null;\n            const today = new Date();\n            const birth = new Date(birthDate);\n            let age = today.getFullYear() - birth.getFullYear();\n            const monthDiff = today.getMonth() - birth.getMonth();\n            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n                age--;\n            }\n            return age + ' anos';\n        }\n\n        function getGenderText(gender) {\n            const genderMap = {\n                'MASCULINO': 'Masculino',\n                'FEMININO': 'Feminino',\n                'MALE': 'Masculino',\n                'FEMALE': 'Feminino'\n            };\n            return genderMap[gender] || gender || 'NÃ£o informado';\n        }\n\n        function getCategoryText(category) {\n            const categoryMap = {\n                'ADULT': 'Adulto',\n                'INICIANTE1': 'Iniciante 1',\n                'INICIANTE2': 'Iniciante 2',\n                'INTERMEDIARIO1': 'IntermediÃ¡rio 1',\n                'INTERMEDIARIO2': 'IntermediÃ¡rio 2',\n                'AVANCADO1': 'AvanÃ§ado 1',\n                'AVANCADO2': 'AvanÃ§ado 2'\n            };\n            return categoryMap[category] || category || 'NÃ£o informado';\n        }\n\n        // Additional modal functions for footer buttons\n        window.editStudentInfo = function() {\n            const modal = document.getElementById('studentDetailsModal');\n            const studentId = modal.dataset.currentStudentId;\n            \n            if (studentId) {\n                closeStudentModal();\n                // Use existing edit function\n                openStudentEditPage(studentId);\n            } else {\n                showToast('Erro: ID do aluno nÃ£o encontrado', 'error');\n            }\n        };\n\n        window.addStudentToClass = function() {\n            const modal = document.getElementById('studentDetailsModal');\n            const studentId = modal.dataset.currentStudentId;\n            \n            if (studentId) {\n                const student = window.currentStudents?.find(s => s.id === studentId);\n                if (student) {\n                    const user = student.user || {};\n                    const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();\n                    \n                    showToast(`Funcionalidade em desenvolvimento: Adicionar ${fullName} Ã  turma`, 'info');\n                } else {\n                    showToast('Aluno nÃ£o encontrado', 'error');\n                }\n            } else {\n                showToast('Erro: ID do aluno nÃ£o encontrado', 'error');\n            }\n        };\n\n        // Update the populateStudentModal function to store student ID\n        const originalPopulateStudentModal = populateStudentModal;\n        populateStudentModal = function(student) {\n            // Store student ID in modal for footer button functions\n            const modal = document.getElementById('studentDetailsModal');\n            if (modal) {\n                modal.dataset.currentStudentId = student.id;\n            }\n            \n            // Call original function\n            originalPopulateStudentModal(student);\n        };\n\n        // Event listeners for modal\n        document.addEventListener('DOMContentLoaded', function() {\n            // Close modal when clicking outside\n            const modal = document.getElementById('studentDetailsModal');\n            if (modal) {\n                modal.addEventListener('click', (e) => {\n                    if (e.target.id === 'studentDetailsModal') {\n                        closeStudentModal();\n                    }\n                });\n            }\n\n            // Close modal with Escape key\n            document.addEventListener('keydown', (e) => {\n                if (e.key === 'Escape' && modal && modal.style.display === 'block') {\n                    closeStudentModal();\n                }\n            });\n        });\n\n        // ==========================================\n        // COURSE MANAGEMENT FUNCTIONS  \n        // ==========================================\n\n        // Show course details\n        function showCourseDetails() {\n            showToast('Funcionalidade em desenvolvimento', 'info');\n        }\n\n        // Show lesson plan manager\n        function showLessonPlanManager() {\n            showSection('course-management');\n            loadAllLessonPlans();\n        }\n\n        // Show lessons by unit\n        function showLessonsByUnit(unit) {\n            document.getElementById('current-unit-name').textContent = getUnitName(unit);\n            loadLessonPlansByUnit(unit);\n        }\n\n        // Show all lessons\n        function showAllLessons() {\n            document.getElementById('current-unit-name').textContent = 'Todas as Unidades';\n            loadAllLessonPlans();\n        }\n\n        // Get unit display name\n        function getUnitName(unit) {\n            const units = {\n                'fundamentos': 'Fundamentos (Aulas 1-10)',\n                'golpes': 'Golpes BÃ¡sicos (Aulas 4-15)', \n                'defesas': 'Defesas BÃ¡sicas (Aulas 10-25)',\n                'avancadas': 'Defesas AvanÃ§adas (Aulas 25-35)',\n                'integracao': 'IntegraÃ§Ã£o (Aulas 35-48)'\n            };\n            return units[unit] || 'Unidade Desconhecida';\n        }\n\n        // Load all lesson plans\n        async function loadAllLessonPlans() {\n            try {\n                document.getElementById('lesson-plans-table-body').innerHTML = `\n                    <tr>\n                        <td colspan=\"9\" style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                            <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">ðŸ“‹</div>\n                            Carregando planos de aula...\n                        </td>\n                    </tr>\n                `;\n\n                // Show empty state - no mock data\n                displayLessonPlans([]);\n\n            } catch (error) {\n                console.error('Erro ao carregar planos de aula:', error);\n                showToast('Erro ao carregar planos de aula', 'error');\n            }\n        }\n\n        // Load lessons by unit\n        async function loadLessonPlansByUnit(unit) {\n            // No mock data - show empty state\n            displayLessonPlans([]);\n        }\n\n        // REMOVED: generateMockLessonPlans function - no mock data allowed\n\n        // Display lesson plans in table\n        function displayLessonPlans(plans) {\n            const tbody = document.getElementById('lesson-plans-table-body');\n            \n            if (plans.length === 0) {\n                tbody.innerHTML = `\n                    <tr>\n                        <td colspan=\"9\" style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                            <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">ðŸ“­</div>\n                            Nenhum plano de aula encontrado\n                        </td>\n                    </tr>\n                `;\n                return;\n            }\n\n            tbody.innerHTML = plans.map(plan => `\n                <tr style=\"border-left: 3px solid ${plan.statusColor};\">\n                    <td style=\"font-weight: bold; color: #F8FAFC;\">${plan.lessonNumber}</td>\n                    <td style=\"color: #CBD5E1;\">${plan.weekNumber}</td>\n                    <td style=\"color: #F8FAFC; font-weight: 500;\">${plan.title}</td>\n                    <td style=\"color: #CBD5E1;\">${plan.unit}</td>\n                    <td style=\"color: #CBD5E1; font-size: 0.85rem;\">${plan.techniques}</td>\n                    <td style=\"color: #CBD5E1;\">${plan.duration}</td>\n                    <td style=\"text-align: center;\">\n                        ${'â­'.repeat(plan.level)}\n                    </td>\n                    <td style=\"color: ${plan.statusColor}; font-weight: 500;\">${plan.status}</td>\n                    <td>\n                        <div style=\"display: flex; gap: 0.5rem; flex-wrap: wrap;\">\n                            <button class=\"btn\" onclick=\"viewLessonPlan(${plan.lessonNumber})\" \n                                    style=\"background: #3B82F6; padding: 0.25rem 0.5rem; font-size: 0.8rem;\">\n                                ðŸ‘ï¸ Ver\n                            </button>\n                            <button class=\"btn\" onclick=\"editLessonPlan(${plan.lessonNumber})\" \n                                    style=\"background: #F59E0B; padding: 0.25rem 0.5rem; font-size: 0.8rem;\">\n                                âœï¸ Editar\n                            </button>\n                            <button class=\"btn\" onclick=\"generateAIVariation(${plan.lessonNumber})\" \n                                    style=\"background: #8B5CF6; padding: 0.25rem 0.5rem; font-size: 0.8rem;\">\n                                ðŸ¤– IA\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `).join('');\n        }\n\n        // View lesson plan details\n        function viewLessonPlan(lessonNumber) {\n            showToast(`Visualizando plano da Aula ${lessonNumber}`, 'info');\n            // TODO: Open lesson plan detail modal\n        }\n\n        // Edit lesson plan\n        function editLessonPlan(lessonNumber) {\n            showToast(`Editando plano da Aula ${lessonNumber}`, 'info');\n            // TODO: Open lesson plan editor\n        }\n\n        // Generate AI variation\n        function generateAIVariation(lessonNumber) {\n            showToast(`Gerando variaÃ§Ã£o IA para Aula ${lessonNumber}...`, 'info');\n            // TODO: Call AI generation API\n        }\n\n        // Open AI lesson generator\n        function openAILessonGenerator() {\n            showToast('Gerador IA em desenvolvimento - Em breve!', 'info');\n            // TODO: Open AI generator modal\n        }\n\n        // Show curriculum builder\n        function showCurriculumBuilder() {\n            showToast('Curriculum Builder em desenvolvimento', 'info');\n        }\n\n        // Show progress analytics\n        function showProgressAnalytics() {\n            showToast('Analytics em desenvolvimento', 'info');\n        }\n\n        // Export lesson plans\n        function exportLessonPlans() {\n            showToast('Exportando planos de aula...', 'info');\n            // TODO: Generate PDF or CSV export\n        }\n\n        // Import lesson plans\n        function importLessonPlans() {\n            showToast('ImportaÃ§Ã£o em desenvolvimento', 'info');\n            // TODO: File upload functionality\n        }\n\n        // Initialize course management when section loads\n        window.addEventListener('load', () => {\n            // Load lesson plans if course-management is the initial section\n            if (window.location.hash === '#course-management') {\n                setTimeout(() => loadAllLessonPlans(), 500);\n            }\n        });\n\n        // Close modal when clicking outside\n        document.addEventListener('click', function(e) {\n            if (e.target.classList.contains('modal')) {\n                e.target.classList.remove('active');\n            }\n        });\n    </script>\n\n    <!-- Techniques Manager Modal -->\n    <div id=\"techniquesManagerModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 1000px; max-height: 90vh; overflow-y: auto;\">\n            <div class=\"modal-header\">\n                <h2>ðŸ¥Š Banco de PosiÃ§Ãµes/TÃ©cnicas</h2>\n                <button class=\"btn btn-secondary\" onclick=\"closeTechniquesManagerModal()\">âœ•</button>\n            </div>\n            <div class=\"modal-body\">\n                <div style=\"display: grid; gap: 1.5rem;\">\n                    <!-- Stats Overview -->\n                    <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;\">\n                        <div style=\"background: rgba(59, 130, 246, 0.2); padding: 1rem; border-radius: 8px; text-align: center;\">\n                            <div style=\"font-size: 1.5rem; font-weight: bold; color: #3B82F6;\" id=\"totalTechniquesCount\">42</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.9rem;\">Total TÃ©cnicas</div>\n                        </div>\n                        <div style=\"background: rgba(16, 185, 129, 0.2); padding: 1rem; border-radius: 8px; text-align: center;\">\n                            <div style=\"font-size: 1.5rem; font-weight: bold; color: #10B981;\" id=\"categoriesCount\">8</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.9rem;\">Categorias</div>\n                        </div>\n                        <div style=\"background: rgba(245, 158, 11, 0.2); padding: 1rem; border-radius: 8px; text-align: center;\">\n                            <div style=\"font-size: 1.5rem; font-weight: bold; color: #F59E0B;\" id=\"coursesUsingCount\">2</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.9rem;\">Cursos Usando</div>\n                        </div>\n                        <div style=\"background: rgba(139, 92, 246, 0.2); padding: 1rem; border-radius: 8px; text-align: center;\">\n                            <div style=\"font-size: 1.5rem; font-weight: bold; color: #8B5CF6;\" id=\"reusedCount\">15</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.9rem;\">Reutilizadas</div>\n                        </div>\n                    </div>\n\n                    <!-- Controls -->\n                    <div style=\"display: flex; justify-content: space-between; align-items: center; gap: 1rem;\">\n                        <div style=\"display: flex; gap: 1rem; align-items: center;\">\n                            <input type=\"text\" id=\"techniqueSearch\" placeholder=\"Buscar tÃ©cnica...\" \n                                   style=\"padding: 0.5rem; border-radius: 6px; border: 1px solid #374151; background: rgba(55, 65, 81, 0.5); color: #F8FAFC; width: 300px;\">\n                            <select id=\"categoryFilter\" style=\"padding: 0.5rem; border-radius: 6px; border: 1px solid #374151; background: rgba(55, 65, 81, 0.5); color: #F8FAFC;\">\n                                <option value=\"\">Todas Categorias</option>\n                                <option value=\"STANCE\">Postura</option>\n                                <option value=\"STRIKE\">Golpes</option>\n                                <option value=\"DEFENSE\">Defesa</option>\n                                <option value=\"GRAPPLING\">Agarramento</option>\n                                <option value=\"COMBO\">CombinaÃ§Ã£o</option>\n                                <option value=\"MOVEMENT\">MovimentaÃ§Ã£o</option>\n                                <option value=\"SCENARIO\">CenÃ¡rio</option>\n                                <option value=\"CONDITIONING\">Condicionamento</option>\n                            </select>\n                        </div>\n                        <button class=\"btn btn-primary\" onclick=\"openAddTechniqueModal()\">\n                            <span>âž•</span> Nova TÃ©cnica\n                        </button>\n                    </div>\n\n                    <!-- Techniques Table -->\n                    <div style=\"border: 1px solid #374151; border-radius: 8px; overflow: hidden;\">\n                        <table style=\"width: 100%; border-collapse: collapse;\">\n                            <thead style=\"background: rgba(55, 65, 81, 0.5);\">\n                                <tr>\n                                    <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; border-bottom: 1px solid #374151;\">Nome</th>\n                                    <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; border-bottom: 1px solid #374151;\">Categoria</th>\n                                    <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; border-bottom: 1px solid #374151;\">NÃ­vel</th>\n                                    <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; border-bottom: 1px solid #374151;\">Usado em</th>\n                                    <th style=\"padding: 1rem; text-align: left; color: #F8FAFC; border-bottom: 1px solid #374151;\">PrÃ©-requisitos</th>\n                                    <th style=\"padding: 1rem; text-align: center; color: #F8FAFC; border-bottom: 1px solid #374151;\">AÃ§Ãµes</th>\n                                </tr>\n                            </thead>\n                            <tbody id=\"techniquesTableBody\" style=\"color: #CBD5E1;\">\n                                <tr>\n                                    <td colspan=\"6\" style=\"padding: 2rem; text-align: center;\">\n                                        <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">â³</div>\n                                        Carregando tÃ©cnicas...\n                                    </td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Add Technique Modal -->\n    <div id=\"addTechniqueModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 600px;\">\n            <div class=\"modal-header\">\n                <h2>âž• Adicionar Nova TÃ©cnica</h2>\n                <button class=\"btn btn-secondary\" onclick=\"closeAddTechniqueModal()\">âœ•</button>\n            </div>\n            <div class=\"modal-body\">\n                <form id=\"addTechniqueForm\" style=\"display: grid; gap: 1rem;\">\n                    <div class=\"form-group\">\n                        <label for=\"techniqueName\">Nome da TÃ©cnica *</label>\n                        <input type=\"text\" id=\"techniqueName\" required placeholder=\"Ex: Defesa 360Â° Superior\">\n                    </div>\n                    \n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                        <div class=\"form-group\">\n                            <label for=\"techniqueCategory\">Categoria *</label>\n                            <select id=\"techniqueCategory\" required>\n                                <option value=\"\">Selecione</option>\n                                <option value=\"STANCE\">ðŸ¥‹ Postura</option>\n                                <option value=\"STRIKE\">ðŸ‘Š Golpes</option>\n                                <option value=\"DEFENSE\">ðŸ›¡ï¸ Defesa</option>\n                                <option value=\"GRAPPLING\">ðŸ¤¼ Agarramento</option>\n                                <option value=\"COMBO\">âš¡ CombinaÃ§Ã£o</option>\n                                <option value=\"MOVEMENT\">ðŸƒ MovimentaÃ§Ã£o</option>\n                                <option value=\"SCENARIO\">ðŸŽ­ CenÃ¡rio</option>\n                                <option value=\"CONDITIONING\">ðŸ’ª Condicionamento</option>\n                            </select>\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"techniqueLevel\">NÃ­vel *</label>\n                            <select id=\"techniqueLevel\" required>\n                                <option value=\"BEGINNER\">â­ Iniciante</option>\n                                <option value=\"INTERMEDIATE\">â­â­ IntermediÃ¡rio</option>\n                                <option value=\"ADVANCED\">â­â­â­ AvanÃ§ado</option>\n                                <option value=\"EXPERT\">â­â­â­â­ Expert</option>\n                            </select>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label for=\"techniqueDescription\">DescriÃ§Ã£o</label>\n                        <textarea id=\"techniqueDescription\" rows=\"3\" placeholder=\"DescriÃ§Ã£o detalhada da tÃ©cnica...\"></textarea>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label for=\"techniqueInstructions\">InstruÃ§Ãµes Passo a Passo</label>\n                        <textarea id=\"techniqueInstructions\" rows=\"4\" placeholder=\"1. PosiÃ§Ã£o inicial...&#10;2. Movimento principal...&#10;3. FinalizaÃ§Ã£o...\"></textarea>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label for=\"techniquePrerequisites\">PrÃ©-requisitos (opcional)</label>\n                        <input type=\"text\" id=\"techniquePrerequisites\" placeholder=\"Ex: Guarda de Boxe, MovimentaÃ§Ã£o BÃ¡sica\">\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label for=\"techniqueKeyPoints\">Pontos-Chave</label>\n                        <textarea id=\"techniqueKeyPoints\" rows=\"3\" placeholder=\"Aspectos importantes para execuÃ§Ã£o correta...\"></textarea>\n                    </div>\n\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                        <div class=\"form-group\">\n                            <label for=\"techniqueEquipment\">Equipamentos</label>\n                            <input type=\"text\" id=\"techniqueEquipment\" placeholder=\"Ex: Tatame, Pads, Luvas\">\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"techniqueDuration\">DuraÃ§Ã£o (minutos)</label>\n                            <input type=\"number\" id=\"techniqueDuration\" min=\"1\" max=\"60\" value=\"10\">\n                        </div>\n                    </div>\n                </form>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"btn btn-secondary\" onclick=\"closeAddTechniqueModal()\">Cancelar</button>\n                <button class=\"btn btn-primary\" onclick=\"saveTechnique()\">\n                    <span>ðŸ’¾</span> Salvar TÃ©cnica\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <!-- Universal Course Creator Modal -->\n    <div id=\"universalCourseModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 1000px; max-height: 90vh; overflow-y: auto;\">\n            <div class=\"modal-header\">\n                <h2>ðŸŽ­ Criador Universal de Cursos</h2>\n                <button class=\"btn btn-secondary\" onclick=\"closeUniversalCourseModal()\">âœ•</button>\n            </div>\n            <div class=\"modal-body\">\n                <div style=\"display: grid; gap: 2rem;\">\n                    <!-- Martial Art & Level Selection -->\n                    <div class=\"form-section\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ¥‹ Arte Marcial e NÃ­vel</h3>\n                        <div style=\"display: grid; gap: 1rem;\">\n                            <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;\">\n                                <div class=\"form-group\">\n                                    <label for=\"martialArt\">Arte Marcial *</label>\n                                    <select id=\"martialArt\" required onchange=\"updateTechniquesForArt()\">\n                                        <option value=\"\">Selecione</option>\n                                        <option value=\"KRAV_MAGA\">ðŸ¥Š Krav Maga</option>\n                                        <option value=\"JIU_JITSU\">ðŸ¥‹ Jiu-Jitsu</option>\n                                        <option value=\"BOXING\">ðŸ‘Š Boxe</option>\n                                        <option value=\"MUAY_THAI\">ðŸ¦µ Muay Thai</option>\n                                        <option value=\"KARATE\">ðŸ¥‹ KaratÃª</option>\n                                        <option value=\"TAEKWONDO\">ðŸ¦µ Taekwondo</option>\n                                        <option value=\"MMA\">ðŸ¥Š MMA</option>\n                                        <option value=\"CAPOEIRA\">ðŸ¤¸ Capoeira</option>\n                                    </select>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"beltLevel\">Faixa/NÃ­vel *</label>\n                                    <select id=\"beltLevel\" required onchange=\"updateBeltInfo()\">\n                                        <option value=\"\">Primeiro selecione a arte</option>\n                                    </select>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"courseGraduation\">GraduaÃ§Ã£o/Grau</label>\n                                    <select id=\"courseGraduation\">\n                                        <option value=\"\">Sem graduaÃ§Ã£o</option>\n                                        <option value=\"1\">1Âº Grau</option>\n                                        <option value=\"2\">2Âº Grau</option>\n                                        <option value=\"3\">3Âº Grau</option>\n                                        <option value=\"4\">4Âº Grau</option>\n                                        <option value=\"5\">5Âº Grau</option>\n                                    </select>\n                                </div>\n                            </div>\n                            \n                            <div id=\"beltInfo\" style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #3B82F6; display: none;\">\n                                <div id=\"beltInfoContent\"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- RAG Status Indicator -->\n                    <div id=\"ragStatus\" style=\"margin-bottom: 1rem;\">\n                        <!-- RAG status will be populated dynamically -->\n                    </div>\n                    \n                    <!-- Course Basic Info -->\n                    <div class=\"form-section\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“š InformaÃ§Ãµes do Curso</h3>\n                        <div style=\"display: grid; gap: 1rem;\">\n                            <div style=\"display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;\">\n                                <div class=\"form-group\">\n                                    <label for=\"universalCourseTitle\">Nome do Curso *</label>\n                                    <input type=\"text\" id=\"universalCourseTitle\" placeholder=\"Ex: Jiu-Jitsu Faixa Azul - TÃ©cnicas AvanÃ§adas\" required>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"universalCourseDuration\">DuraÃ§Ã£o (semanas) *</label>\n                                    <input type=\"number\" id=\"universalCourseDuration\" value=\"20\" min=\"4\" max=\"52\" required>\n                                </div>\n                            </div>\n                            \n                            <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                                <div class=\"form-group\">\n                                    <label for=\"universalCourseLevel\">NÃ­vel de Dificuldade</label>\n                                    <select id=\"universalCourseLevel\">\n                                        <option value=\"BEGINNER\">â­ Iniciante</option>\n                                        <option value=\"INTERMEDIATE\">â­â­ IntermediÃ¡rio</option>\n                                        <option value=\"ADVANCED\">â­â­â­ AvanÃ§ado</option>\n                                        <option value=\"EXPERT\">â­â­â­â­ Expert</option>\n                                    </select>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"lessonsPerWeekUniversal\">Aulas por Semana</label>\n                                    <select id=\"lessonsPerWeekUniversal\">\n                                        <option value=\"1\">1 aula</option>\n                                        <option value=\"2\" selected>2 aulas</option>\n                                        <option value=\"3\">3 aulas</option>\n                                        <option value=\"4\">4 aulas</option>\n                                        <option value=\"5\">5 aulas</option>\n                                    </select>\n                                </div>\n                            </div>\n\n                            <div class=\"form-group\">\n                                <label for=\"universalCourseObjectives\">Objetivos do Curso</label>\n                                <textarea id=\"universalCourseObjectives\" rows=\"3\" placeholder=\"Descreva os objetivos principais do curso...\"></textarea>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Technique Selection -->\n                    <div class=\"form-section\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ¥Š SeleÃ§Ã£o de TÃ©cnicas</h3>\n                        <div style=\"display: grid; gap: 1rem;\">\n                            <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #3B82F6;\">\n                                <h4 style=\"color: #3B82F6; margin-bottom: 0.5rem;\">ðŸ’¡ EstratÃ©gia de SeleÃ§Ã£o</h4>\n                                <div style=\"display: flex; gap: 1rem; margin-bottom: 1rem;\">\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1;\">\n                                        <input type=\"radio\" name=\"selectionStrategy\" value=\"reuse\" checked>\n                                        <span>ðŸ”„ Reutilizar do Faixa Branca + Novas</span>\n                                    </label>\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1;\">\n                                        <input type=\"radio\" name=\"selectionStrategy\" value=\"fresh\">\n                                        <span>ðŸ†• SeleÃ§Ã£o Completamente Nova</span>\n                                    </label>\n                                    <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1;\">\n                                        <input type=\"radio\" name=\"selectionStrategy\" value=\"custom\">\n                                        <span>âš™ï¸ SeleÃ§Ã£o Manual</span>\n                                    </label>\n                                </div>\n                            </div>\n\n                            <div id=\"techniqueSelectionArea\" style=\"border: 1px solid #374151; border-radius: 8px; max-height: 300px; overflow-y: auto;\">\n                                <div style=\"padding: 2rem; text-align: center; color: #CBD5E1;\">\n                                    <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">ðŸŽ¯</div>\n                                    Carregando banco de tÃ©cnicas para seleÃ§Ã£o...\n                                </div>\n                            </div>\n\n                            <div style=\"background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px;\">\n                                <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                    <span style=\"color: #F59E0B; font-weight: bold;\">TÃ©cnicas Selecionadas:</span>\n                                    <span id=\"selectedTechniquesCount\" style=\"color: #F8FAFC;\">0</span>\n                                </div>\n                                <div id=\"selectedTechniquesList\" style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                                    Nenhuma tÃ©cnica selecionada ainda\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Document Upload for Yellow Belt -->\n                    <div class=\"form-section\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“„ Seu Modelo de Curso</h3>\n                        <div style=\"border: 2px dashed #374151; border-radius: 12px; padding: 2rem; text-align: center; background: rgba(55, 65, 81, 0.3);\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“‹</div>\n                            <input type=\"file\" id=\"courseModelFile\" accept=\".pdf,.doc,.docx,.txt,.md\" \n                                   style=\"display: none;\" onchange=\"handleCourseModelUpload(event)\">\n                            <button type=\"button\" onclick=\"document.getElementById('yellowBeltModel').click()\" \n                                    style=\"background: #F59E0B; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; margin-bottom: 1rem;\">\n                                ðŸ“Ž Upload Modelo de Curso\n                            </button>\n                            <p style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                                FaÃ§a upload do seu modelo de curso (opcional)<br>\n                                A IA usarÃ¡ este documento para estruturar o curso\n                            </p>\n                            <div id=\"courseModelFileInfo\" style=\"margin-top: 1rem;\"></div>\n                        </div>\n                    </div>\n\n                    <!-- AI Configuration -->\n                    <div class=\"form-section\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ¤– ConfiguraÃ§Ã£o da IA</h3>\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                            <div>\n                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block;\">ðŸŽ¯ Gerar Planos de Aula</label>\n                                <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                                    <input type=\"checkbox\" id=\"universalGeneratePlans\" checked>\n                                    <span style=\"color: #CBD5E1;\">Gerar automaticamente todos os planos</span>\n                                </div>\n                            </div>\n                            <div>\n                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block;\">ðŸ¤– Modelo IA</label>\n                                <select id=\"universalAiModel\" style=\"width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid #374151; background: rgba(55, 65, 81, 0.5); color: #F8FAFC;\">\n                                    <option value=\"claude-3\">Claude 3 (Recomendado)</option>\n                                    <option value=\"gpt-4\">GPT-4</option>\n                                    <option value=\"gemini\">Gemini</option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"modal-footer\" style=\"padding: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                    <div style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                        â±ï¸ Tempo estimado: 5-8 minutos\n                    </div>\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button class=\"btn btn-secondary\" onclick=\"closeUniversalCourseModal()\">Cancelar</button>\n                        <button class=\"btn btn-primary\" onclick=\"createUniversalCourse()\" id=\"createUniversalBtn\">\n                            <span>ðŸŽ­</span> Criar Curso\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Technique Audit Modal -->\n    <div id=\"techniqueAuditModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 800px; max-height: 90vh; overflow-y: auto;\">\n            <div class=\"modal-header\">\n                <h2>ðŸ” Auditoria de TÃ©cnica</h2>\n                <button class=\"btn btn-secondary\" onclick=\"closeTechniqueAuditModal()\">âœ•</button>\n            </div>\n            <div class=\"modal-body\">\n                <div id=\"techniqueAuditContent\">\n                    <!-- Content will be populated dynamically -->\n                </div>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"btn btn-success\" onclick=\"approveTechnique()\" id=\"approveBtn\">\n                    <span>âœ…</span> Aprovar\n                </button>\n                <button class=\"btn btn-warning\" onclick=\"editTechnique()\" id=\"editBtn\" style=\"margin-left: 1rem;\">\n                    <span>âœï¸</span> Editar\n                </button>\n                <button class=\"btn btn-danger\" onclick=\"rejectTechnique()\" id=\"rejectBtn\" style=\"margin-left: 1rem;\">\n                    <span>âŒ</span> Rejeitar\n                </button>\n                <button class=\"btn btn-secondary\" onclick=\"closeTechniqueAuditModal()\" style=\"margin-left: 1rem;\">Cancelar</button>\n            </div>\n        </div>\n    </div>\n\n    <!-- Video Upload Modal -->\n    <div id=\"videoUploadModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 600px;\">\n            <div class=\"modal-header\">\n                <h2>ðŸ“¹ Upload de VÃ­deo - TÃ©cnica</h2>\n                <button class=\"btn btn-secondary\" onclick=\"closeVideoUploadModal()\">âœ•</button>\n            </div>\n            <div class=\"modal-body\">\n                <div style=\"display: grid; gap: 1.5rem;\">\n                    <div id=\"videoTechniqueInfo\" style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px;\">\n                        <!-- Technique info will be shown here -->\n                    </div>\n                    \n                    <div style=\"border: 2px dashed #374151; border-radius: 12px; padding: 2rem; text-align: center; background: rgba(55, 65, 81, 0.3);\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“¹</div>\n                        <input type=\"file\" id=\"techniqueVideo\" accept=\"video/*\" \n                               style=\"display: none;\" onchange=\"handleVideoUpload(event)\">\n                        <button type=\"button\" onclick=\"document.getElementById('techniqueVideo').click()\" \n                                style=\"background: #3B82F6; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; margin-bottom: 1rem;\">\n                            ðŸ“Ž Selecionar VÃ­deo\n                        </button>\n                        <p style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                            Formatos aceitos: MP4, AVI, MOV<br>\n                            Tamanho mÃ¡ximo: 100MB\n                        </p>\n                        <div id=\"videoPreview\" style=\"margin-top: 1rem;\"></div>\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"videoDescription\">DescriÃ§Ã£o do VÃ­deo</label>\n                        <textarea id=\"videoDescription\" rows=\"3\" placeholder=\"Descreva o que estÃ¡ sendo demonstrado no vÃ­deo...\"></textarea>\n                    </div>\n                </div>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"btn btn-primary\" onclick=\"uploadVideo()\" id=\"uploadVideoBtn\">\n                    <span>ðŸš€</span> Upload VÃ­deo\n                </button>\n                <button class=\"btn btn-secondary\" onclick=\"closeVideoUploadModal()\">Cancelar</button>\n            </div>\n        </div>\n    </div>\n\n    <!-- Document Uploader Modal -->\n    <div id=\"documentUploaderModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 900px; max-height: 90vh; overflow-y: auto;\">\n            <div class=\"modal-header\">\n                <h2>ðŸ“Ž Adicionar ConteÃºdo Ã  Base de Conhecimento</h2>\n                <button class=\"btn btn-secondary\" onclick=\"closeDocumentUploader()\">âœ•</button>\n            </div>\n            <div class=\"modal-body\">\n                <div style=\"display: grid; gap: 2rem;\">\n                    \n                    <!-- Upload Tabs -->\n                    <div style=\"display: flex; gap: 1rem; border-bottom: 1px solid #374151; padding-bottom: 1rem;\">\n                        <button class=\"upload-tab active\" onclick=\"switchUploadTab('documents')\" id=\"documentsTab\">\n                            ðŸ“„ Documentos\n                        </button>\n                        <button class=\"upload-tab\" onclick=\"switchUploadTab('text')\" id=\"textTab\">\n                            ðŸ“ Texto Manual\n                        </button>\n                        <button class=\"upload-tab\" onclick=\"switchUploadTab('links')\" id=\"linksTab\">\n                            ðŸ”— Links/URLs\n                        </button>\n                        <button class=\"upload-tab\" onclick=\"switchUploadTab('youtube')\" id=\"youtubeTab\">\n                            ðŸ“º YouTube\n                        </button>\n                    </div>\n                    \n                    <!-- Document Upload Section -->\n                    <div id=\"documentsSection\" class=\"upload-section\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“„ Upload de Documentos</h3>\n                        <div style=\"border: 2px dashed #374151; border-radius: 12px; padding: 2rem; text-align: center; background: rgba(55, 65, 81, 0.3);\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“</div>\n                            <input type=\"file\" id=\"documentFiles\" multiple accept=\".pdf,.doc,.docx,.txt,.md,.rtf\" \n                                   style=\"display: none;\" onchange=\"handleDocumentUpload(event)\">\n                            <button type=\"button\" onclick=\"document.getElementById('documentFiles').click()\" \n                                    style=\"background: #8B5CF6; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; margin-bottom: 1rem;\">\n                                ðŸ“Ž Selecionar Documentos\n                            </button>\n                            <p style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                                Formatos aceitos: PDF, DOC, DOCX, TXT, MD, RTF<br>\n                                MÃºltiplos arquivos permitidos â€¢ Tamanho mÃ¡ximo: 50MB por arquivo\n                            </p>\n                            <div id=\"documentPreview\" style=\"margin-top: 1rem;\"></div>\n                        </div>\n                        \n                        <div class=\"form-group\" style=\"margin-top: 1rem;\">\n                            <label for=\"documentTags\">Tags (separadas por vÃ­rgula)</label>\n                            <input type=\"text\" id=\"documentTags\" placeholder=\"krav-maga, defesa-pessoal, iniciante, faixa-branca\">\n                        </div>\n                    </div>\n                    \n                    <!-- Text Input Section -->\n                    <div id=\"textSection\" class=\"upload-section\" style=\"display: none;\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“ Adicionar Texto Manual</h3>\n                        <div class=\"form-group\">\n                            <label for=\"textTitle\">TÃ­tulo do ConteÃºdo *</label>\n                            <input type=\"text\" id=\"textTitle\" placeholder=\"Ex: PrincÃ­pios Fundamentais do Krav Maga\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"textContent\">ConteÃºdo *</label>\n                            <textarea id=\"textContent\" rows=\"12\" placeholder=\"Cole aqui seu conteÃºdo de texto, manuais, instruÃ§Ãµes, metodologias...\" required></textarea>\n                        </div>\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                            <div class=\"form-group\">\n                                <label for=\"textCategory\">Categoria</label>\n                                <select id=\"textCategory\">\n                                    <option value=\"\">Selecione</option>\n                                    <option value=\"METHODOLOGY\">Metodologia</option>\n                                    <option value=\"TECHNIQUES\">TÃ©cnicas</option>\n                                    <option value=\"THEORY\">Teoria</option>\n                                    <option value=\"SAFETY\">SeguranÃ§a</option>\n                                    <option value=\"PROGRESSION\">ProgressÃ£o</option>\n                                    <option value=\"EVALUATION\">AvaliaÃ§Ã£o</option>\n                                </select>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"textTags\">Tags</label>\n                                <input type=\"text\" id=\"textTags\" placeholder=\"defesa, ataque, movimento\">\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Links Section -->\n                    <div id=\"linksSection\" class=\"upload-section\" style=\"display: none;\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ”— Adicionar Links/URLs</h3>\n                        <div class=\"form-group\">\n                            <label for=\"linkUrl\">URL *</label>\n                            <input type=\"url\" id=\"linkUrl\" placeholder=\"https://exemplo.com/artigo-sobre-krav-maga\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"linkTitle\">TÃ­tulo (opcional)</label>\n                            <input type=\"text\" id=\"linkTitle\" placeholder=\"SerÃ¡ extraÃ­do automaticamente se nÃ£o preenchido\">\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"linkDescription\">DescriÃ§Ã£o</label>\n                            <textarea id=\"linkDescription\" rows=\"3\" placeholder=\"Breve descriÃ§Ã£o sobre o conteÃºdo do link\"></textarea>\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"linkTags\">Tags</label>\n                            <input type=\"text\" id=\"linkTags\" placeholder=\"artigo, externa, referÃªncia\">\n                        </div>\n                        <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; margin-top: 1rem;\">\n                            <div style=\"color: #3B82F6; font-weight: bold; margin-bottom: 0.5rem;\">â„¹ï¸ ExtraÃ§Ã£o AutomÃ¡tica</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                                O sistema irÃ¡ extrair automaticamente o texto do site e indexar o conteÃºdo.\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- YouTube Section -->\n                    <div id=\"youtubeSection\" class=\"upload-section\" style=\"display: none;\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“º VÃ­deos do YouTube</h3>\n                        <div class=\"form-group\">\n                            <label for=\"youtubeUrl\">URL do YouTube *</label>\n                            <input type=\"url\" id=\"youtubeUrl\" placeholder=\"https://www.youtube.com/watch?v=...\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"youtubeDescription\">DescriÃ§Ã£o do ConteÃºdo</label>\n                            <textarea id=\"youtubeDescription\" rows=\"3\" placeholder=\"Descreva o que Ã© abordado no vÃ­deo\"></textarea>\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"youtubeTags\">Tags</label>\n                            <input type=\"text\" id=\"youtubeTags\" placeholder=\"video, demonstraÃ§Ã£o, tutorial\">\n                        </div>\n                        <div style=\"background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; margin-top: 1rem;\">\n                            <div style=\"color: #F59E0B; font-weight: bold; margin-bottom: 0.5rem;\">ðŸŽ¯ ExtraÃ§Ã£o de TranscriÃ§Ã£o</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                                O sistema irÃ¡ extrair a transcriÃ§Ã£o automÃ¡tica do vÃ­deo (se disponÃ­vel) e indexar o conteÃºdo.\n                            </div>\n                        </div>\n                    </div>\n                    \n                </div>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"btn btn-primary\" onclick=\"uploadContent()\" id=\"uploadContentBtn\">\n                    <span>ðŸš€</span> Adicionar Ã  Base\n                </button>\n                <button class=\"btn btn-secondary\" onclick=\"closeDocumentUploader()\">Cancelar</button>\n            </div>\n        </div>\n    </div>\n\n    <!-- RAG Test Modal -->\n    <div id=\"ragTestModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 800px;\">\n            <div class=\"modal-header\">\n                <h2>ðŸ§ª Teste do Sistema RAG</h2>\n                <button class=\"btn btn-secondary\" onclick=\"closeRAGTest()\">âœ•</button>\n            </div>\n            <div class=\"modal-body\">\n                <div style=\"display: grid; gap: 1.5rem;\">\n                    <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px;\">\n                        <h4 style=\"color: #3B82F6; margin-bottom: 0.5rem;\">ðŸŽ¯ Como Funciona o Teste</h4>\n                        <div style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                            FaÃ§a uma pergunta ou solicite informaÃ§Ãµes. A IA irÃ¡ buscar na sua base de conhecimento \n                            e retornar uma resposta baseada nos seus documentos.\n                        </div>\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"ragQuestion\">Sua Pergunta</label>\n                        <textarea id=\"ragQuestion\" rows=\"3\" placeholder=\"Ex: Como ensinar defesa contra agarramento para iniciantes?\"></textarea>\n                    </div>\n                    \n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                        <div class=\"form-group\">\n                            <label for=\"ragMartialArt\">Arte Marcial (opcional)</label>\n                            <select id=\"ragMartialArt\">\n                                <option value=\"\">Todas</option>\n                                <option value=\"KRAV_MAGA\">Krav Maga</option>\n                                <option value=\"JIU_JITSU\">Jiu-Jitsu</option>\n                                <option value=\"BOXING\">Boxe</option>\n                                <option value=\"MUAY_THAI\">Muay Thai</option>\n                            </select>\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"ragLevel\">NÃ­vel (opcional)</label>\n                            <select id=\"ragLevel\">\n                                <option value=\"\">Todos</option>\n                                <option value=\"BEGINNER\">Iniciante</option>\n                                <option value=\"INTERMEDIATE\">IntermediÃ¡rio</option>\n                                <option value=\"ADVANCED\">AvanÃ§ado</option>\n                            </select>\n                        </div>\n                    </div>\n                    \n                    <div id=\"ragResults\" style=\"min-height: 200px; background: rgba(55, 65, 81, 0.3); border-radius: 8px; padding: 1rem;\">\n                        <div style=\"text-align: center; color: #9CA3AF; padding: 2rem;\">\n                            Digite sua pergunta e clique em \"Consultar RAG\" para ver a resposta\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"btn btn-primary\" onclick=\"consultRAG()\" id=\"consultRAGBtn\">\n                    <span>ðŸ§ </span> Consultar RAG\n                </button>\n                <button class=\"btn btn-secondary\" onclick=\"closeRAGTest()\">Fechar</button>\n            </div>\n        </div>\n    </div>\n\n    <!-- AI Course Generator Modal -->\n    <div id=\"aiCourseGeneratorModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 900px; max-height: 90vh; overflow-y: auto;\">\n            <div class=\"modal-header\">\n                <h2>ðŸŽ¯ Gerador IA de Curso Completo</h2>\n                <button class=\"btn btn-secondary\" onclick=\"closeAICourseGeneratorModal()\">âœ•</button>\n            </div>\n            <div class=\"modal-body\">\n                <div style=\"display: grid; gap: 2rem;\">\n                    <!-- Modo de CriaÃ§Ã£o -->\n                    <div class=\"form-section\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸŽ›ï¸ Modo de CriaÃ§Ã£o</h3>\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                            <div class=\"creation-mode-card\" onclick=\"selectCreationMode('scratch')\" \n                                 style=\"padding: 1.5rem; border: 2px solid #374151; border-radius: 12px; cursor: pointer; text-align: center; transition: all 0.2s;\">\n                                <div style=\"font-size: 2rem; margin-bottom: 0.5rem;\">ðŸš€</div>\n                                <h4 style=\"color: #F8FAFC; margin-bottom: 0.5rem;\">Do Zero</h4>\n                                <p style=\"color: #CBD5E1; font-size: 0.9rem;\">IA cria tudo baseado apenas nas informaÃ§Ãµes bÃ¡sicas</p>\n                            </div>\n                            <div class=\"creation-mode-card\" onclick=\"selectCreationMode('document')\" \n                                 style=\"padding: 1.5rem; border: 2px solid #374151; border-radius: 12px; cursor: pointer; text-align: center; transition: all 0.2s;\">\n                                <div style=\"font-size: 2rem; margin-bottom: 0.5rem;\">ðŸ“„</div>\n                                <h4 style=\"color: #F8FAFC; margin-bottom: 0.5rem;\">Com Documentos</h4>\n                                <p style=\"color: #CBD5E1; font-size: 0.9rem;\">IA usa documentos modelo, curriculums, planos existentes</p>\n                            </div>\n                        </div>\n                        <input type=\"hidden\" id=\"creationMode\" value=\"\">\n                    </div>\n\n                    <!-- InformaÃ§Ãµes BÃ¡sicas do Curso -->\n                    <div class=\"form-section\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“š InformaÃ§Ãµes BÃ¡sicas</h3>\n                        <div style=\"display: grid; gap: 1rem;\">\n                            <div style=\"display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;\">\n                                <div class=\"form-group\">\n                                    <label for=\"courseTitle\">Nome do Curso *</label>\n                                    <input type=\"text\" id=\"courseTitle\" placeholder=\"Ex: Krav Maga Faixa Preta - Instrutor\" required>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"courseDuration\">DuraÃ§Ã£o (semanas) *</label>\n                                    <input type=\"number\" id=\"courseDuration\" min=\"1\" max=\"52\" value=\"24\" required>\n                                </div>\n                            </div>\n                            \n                            <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;\">\n                                <div class=\"form-group\">\n                                    <label for=\"courseLevel\">NÃ­vel *</label>\n                                    <select id=\"courseLevel\" required>\n                                        <option value=\"\">Selecione</option>\n                                        <option value=\"INICIANTE\">Iniciante</option>\n                                        <option value=\"INTERMEDIARIO\">IntermediÃ¡rio</option>\n                                        <option value=\"AVANCADO\">AvanÃ§ado</option>\n                                        <option value=\"INSTRUTOR\">Instrutor</option>\n                                    </select>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"courseCategory\">Categoria *</label>\n                                    <select id=\"courseCategory\" required>\n                                        <option value=\"\">Selecione</option>\n                                        <option value=\"ADULT\">Adulto</option>\n                                        <option value=\"KIDS\">Infantil</option>\n                                        <option value=\"TEEN\">Adolescente</option>\n                                        <option value=\"SENIOR\">Terceira Idade</option>\n                                    </select>\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"lessonsPerWeek\">Aulas por Semana</label>\n                                    <select id=\"lessonsPerWeek\">\n                                        <option value=\"1\">1 aula</option>\n                                        <option value=\"2\" selected>2 aulas</option>\n                                        <option value=\"3\">3 aulas</option>\n                                        <option value=\"4\">4 aulas</option>\n                                    </select>\n                                </div>\n                            </div>\n\n                            <div class=\"form-group\">\n                                <label for=\"courseObjectives\">Objetivos Principais</label>\n                                <textarea id=\"courseObjectives\" rows=\"3\" \n                                          placeholder=\"Ex: Desenvolver habilidades de defesa pessoal, aumentar condicionamento fÃ­sico, preparar instrutores...\"></textarea>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Upload de Documentos -->\n                    <div class=\"form-section\" id=\"documentSection\" style=\"display: none;\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“ Documentos e Contexto</h3>\n                        <div style=\"display: grid; gap: 1.5rem;\">\n                            \n                            <!-- Templates PrÃ©-definidos -->\n                            <div>\n                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block;\">ðŸŽ¯ Templates DisponÃ­veis</label>\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem;\">\n                                    <button type=\"button\" class=\"template-btn\" onclick=\"loadTemplate('krav-maga-basic')\" \n                                            style=\"padding: 0.75rem; background: rgba(59, 130, 246, 0.2); border: 1px solid #3B82F6; border-radius: 8px; color: #3B82F6; cursor: pointer;\">\n                                        ðŸ¥‹ Krav Maga BÃ¡sico\n                                    </button>\n                                    <button type=\"button\" class=\"template-btn\" onclick=\"loadTemplate('self-defense')\" \n                                            style=\"padding: 0.75rem; background: rgba(16, 185, 129, 0.2); border: 1px solid #10B981; border-radius: 8px; color: #10B981; cursor: pointer;\">\n                                        ðŸ›¡ï¸ Defesa Pessoal\n                                    </button>\n                                    <button type=\"button\" class=\"template-btn\" onclick=\"loadTemplate('instructor')\" \n                                            style=\"padding: 0.75rem; background: rgba(245, 158, 11, 0.2); border: 1px solid #F59E0B; border-radius: 8px; color: #F59E0B; cursor: pointer;\">\n                                        ðŸ‘¨â€ðŸ« FormaÃ§Ã£o Instrutor\n                                    </button>\n                                </div>\n                            </div>\n\n                            <!-- Upload de Arquivos -->\n                            <div>\n                                <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block;\">ðŸ“Ž Upload de Documentos</label>\n                                <div style=\"border: 2px dashed #374151; border-radius: 12px; padding: 2rem; text-align: center; background: rgba(55, 65, 81, 0.3);\">\n                                    <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“</div>\n                                    <input type=\"file\" id=\"courseDocuments\" multiple accept=\".pdf,.doc,.docx,.txt,.md\" \n                                           style=\"display: none;\" onchange=\"handleFileUpload(event)\">\n                                    <button type=\"button\" onclick=\"document.getElementById('courseDocuments').click()\" \n                                            style=\"background: #3B82F6; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; margin-bottom: 1rem;\">\n                                        Selecionar Arquivos\n                                    </button>\n                                    <p style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                                        Aceita: PDF, DOC, DOCX, TXT, MD<br>\n                                        <strong>SugestÃµes:</strong> Curriculums, planos modelo, regulamentos, metodologias\n                                    </p>\n                                    <div id=\"uploadedFiles\" style=\"margin-top: 1rem;\"></div>\n                                </div>\n                            </div>\n\n                            <!-- Contexto Adicional -->\n                            <div>\n                                <label for=\"additionalContext\" style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block;\">ðŸ’­ Contexto Adicional</label>\n                                <textarea id=\"additionalContext\" rows=\"4\" \n                                          placeholder=\"InformaÃ§Ãµes especÃ­ficas: metodologia preferida, restriÃ§Ãµes, adaptaÃ§Ãµes necessÃ¡rias, experiÃªncias anteriores, cultura da academia, etc.\"\n                                          style=\"width: 100%; padding: 1rem; background: rgba(55, 65, 81, 0.5); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC;\"></textarea>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- ConfiguraÃ§Ãµes AvanÃ§adas -->\n                    <div class=\"form-section\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">âš™ï¸ ConfiguraÃ§Ãµes AvanÃ§adas</h3>\n                        <div style=\"display: grid; gap: 1rem;\">\n                            <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                                <div>\n                                    <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block;\">ðŸŽ¯ Gerar Planos de Aula</label>\n                                    <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                                        <input type=\"checkbox\" id=\"generateLessonPlans\" checked>\n                                        <span style=\"color: #CBD5E1;\">Gerar automaticamente todos os planos de aula</span>\n                                    </div>\n                                </div>\n                                <div>\n                                    <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block;\">ðŸ† Incluir AvaliaÃ§Ãµes</label>\n                                    <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                                        <input type=\"checkbox\" id=\"includeEvaluations\" checked>\n                                        <span style=\"color: #CBD5E1;\">Criar sistema de avaliaÃ§Ãµes e exames</span>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">\n                                <div>\n                                    <label style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block;\">ðŸ§© AdaptaÃ§Ãµes Especiais</label>\n                                    <div style=\"display: flex; flex-wrap: wrap; gap: 0.5rem;\">\n                                        <label style=\"display: flex; align-items: center; gap: 0.25rem; color: #CBD5E1; margin-right: 1rem;\">\n                                            <input type=\"checkbox\" name=\"adaptations\" value=\"TEA\">\n                                            <span>TEA</span>\n                                        </label>\n                                        <label style=\"display: flex; align-items: center; gap: 0.25rem; color: #CBD5E1; margin-right: 1rem;\">\n                                            <input type=\"checkbox\" name=\"adaptations\" value=\"TDAH\">\n                                            <span>TDAH</span>\n                                        </label>\n                                        <label style=\"display: flex; align-items: center; gap: 0.25rem; color: #CBD5E1;\">\n                                            <input type=\"checkbox\" name=\"adaptations\" value=\"MOBILIDADE_REDUZIDA\">\n                                            <span>Mobilidade Reduzida</span>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div>\n                                    <label for=\"aiModel\" style=\"color: #F8FAFC; margin-bottom: 0.5rem; display: block;\">ðŸ¤– Modelo de IA</label>\n                                    <select id=\"aiModel\">\n                                        <option value=\"gpt-4\">GPT-4 (Mais criativo)</option>\n                                        <option value=\"claude-3\">Claude 3 (Mais estruturado)</option>\n                                        <option value=\"gemini\">Gemini (Balanceado)</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"modal-footer\" style=\"padding: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                    <div style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                        â±ï¸ Tempo estimado: 3-5 minutos\n                    </div>\n                    <div style=\"display: flex; gap: 1rem;\">\n                        <button class=\"btn btn-secondary\" onclick=\"closeAICourseGeneratorModal()\">Cancelar</button>\n                        <button class=\"btn btn-primary\" onclick=\"generateCourseWithAI()\" id=\"generateCourseBtn\">\n                            <span>ðŸŽ¯</span> Gerar Curso Completo\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- AI Lesson Generator Modal -->\n    <div id=\"aiGeneratorModal\" class=\"modal\">\n        <div class=\"modal-content\" style=\"max-width: 600px;\">\n            <div class=\"modal-header\">\n                <h2>ðŸ¤– Gerador IA de Planos de Aula</h2>\n                <button class=\"btn btn-secondary\" onclick=\"closeAIGeneratorModal()\">âœ•</button>\n            </div>\n            <div class=\"modal-body\">\n                <form id=\"aiGeneratorForm\" style=\"display: grid; gap: 1.5rem;\">\n                    <div class=\"form-group\">\n                        <label for=\"aiLessonNumber\">NÃºmero da Aula</label>\n                        <input type=\"number\" id=\"aiLessonNumber\" min=\"1\" max=\"48\" value=\"16\" required>\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <label for=\"aiLessonUnit\">Unidade do Curriculum</label>\n                        <select id=\"aiLessonUnit\" required>\n                            <option value=\"\">Selecione uma unidade</option>\n                            <option value=\"fundamentos\">ðŸ¥Š Fundamentos (Aulas 1-10)</option>\n                            <option value=\"golpes\">ðŸ‘Š Golpes BÃ¡sicos (Aulas 4-15)</option>\n                            <option value=\"defesas\">ðŸ›¡ï¸ Defesas BÃ¡sicas (Aulas 10-25)</option>\n                            <option value=\"avancadas\">âš”ï¸ Defesas AvanÃ§adas (Aulas 25-35)</option>\n                            <option value=\"integracao\">ðŸŽ­ IntegraÃ§Ã£o (Aulas 35-48)</option>\n                        </select>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label for=\"aiMainTechnique\">TÃ©cnica Principal</label>\n                        <input type=\"text\" id=\"aiMainTechnique\" placeholder=\"Ex: Defesa 360Â° Interior\" required>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label for=\"aiLessonObjectives\">Objetivos da Aula</label>\n                        <textarea id=\"aiLessonObjectives\" rows=\"3\" \n                                  placeholder=\"Ex: Desenvolver coordenaÃ§Ã£o motora, Aplicar tÃ©cnica em cenÃ¡rio real...\"></textarea>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label for=\"aiSpecialNeeds\">AdaptaÃ§Ãµes Especiais</label>\n                        <div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem;\">\n                            <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1;\">\n                                <input type=\"checkbox\" id=\"aiTEA\" value=\"TEA\">\n                                <span>TEA</span>\n                            </label>\n                            <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1;\">\n                                <input type=\"checkbox\" id=\"aiTDAH\" value=\"TDAH\">\n                                <span>TDAH</span>\n                            </label>\n                            <label style=\"display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1;\">\n                                <input type=\"checkbox\" id=\"aiMobilidade\" value=\"MOBILIDADE_REDUZIDA\">\n                                <span>Mobilidade Reduzida</span>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label for=\"aiDifficulty\">NÃ­vel de Dificuldade</label>\n                        <select id=\"aiDifficulty\" required>\n                            <option value=\"1\">â­ Iniciante</option>\n                            <option value=\"2\">â­â­ IntermediÃ¡rio</option>\n                            <option value=\"3\">â­â­â­ AvanÃ§ado</option>\n                        </select>\n                    </div>\n                </form>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"btn btn-secondary\" onclick=\"closeAIGeneratorModal()\">Cancelar</button>\n                <button class=\"btn btn-primary\" onclick=\"generateLessonPlanWithAI()\">\n                    <span>ðŸ¤–</span> Gerar Plano com IA\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // ==========================================\n        // TECHNIQUES MANAGER FUNCTIONALITY\n        // ==========================================\n\n        let allTechniques = [];\n        let selectedTechniques = [];\n        let courseModelFile = null;\n        let beltSystems = {};\n        let auditResults = [];\n        let pendingTechniques = [];\n        \n        // RAG System Variables (declared in main script section)\n\n        // Open Techniques Manager Modal\n        function openTechniquesManager() {\n            document.getElementById('techniquesManagerModal').classList.add('active');\n            loadTechniquesDatabase();\n        }\n\n        // Close Techniques Manager Modal\n        function closeTechniquesManagerModal() {\n            document.getElementById('techniquesManagerModal').classList.remove('active');\n        }\n\n        // Load techniques database\n        async function loadTechniquesDatabase() {\n            try {\n                // Generate mock techniques based on existing course data\n                allTechniques = generateMockTechniques();\n                displayTechniquesTable(allTechniques);\n                updateTechniquesStats();\n            } catch (error) {\n                console.error('Erro ao carregar tÃ©cnicas:', error);\n                showToast('Erro ao carregar banco de tÃ©cnicas', 'error');\n            }\n        }\n\n        // Generate mock techniques database with audit status\n        function generateMockTechniques() {\n            const techniques = [\n                // Krav Maga - Beginner (Practitioner 1)\n                { id: '1', name: 'Guarda de Boxe', category: 'STANCE', level: 'BEGINNER', martialArt: 'KRAV_MAGA', usedIn: ['Practitioner 1'], prerequisites: '', isPreviousLevel: false, status: 'APPROVED', videoUrl: null, auditScore: 98 },\n                { id: '2', name: 'Jab (Soco Direto)', category: 'STRIKE', level: 'BEGINNER', martialArt: 'KRAV_MAGA', usedIn: ['Practitioner 1'], prerequisites: 'Guarda de Boxe', isPreviousLevel: false, status: 'APPROVED', videoUrl: null, auditScore: 95 },\n                { id: '3', name: 'Cross (Soco Cruzado)', category: 'STRIKE', level: 'BEGINNER', martialArt: 'KRAV_MAGA', usedIn: ['Practitioner 1'], prerequisites: 'Guarda de Boxe, Jab', isPreviousLevel: false },\n                { id: '4', name: 'Hook (Gancho)', category: 'STRIKE', level: 'BEGINNER', martialArt: 'KRAV_MAGA', usedIn: ['Practitioner 1'], prerequisites: 'Jab, Cross', isPreviousLevel: false },\n                { id: '5', name: 'Uppercut', category: 'STRIKE', level: 'BEGINNER', martialArt: 'KRAV_MAGA', usedIn: ['Practitioner 1'], prerequisites: 'Hook', isPreviousLevel: false },\n                { id: '6', name: 'Defesa 360Â° Interior', category: 'DEFENSE', level: 'BEGINNER', usedIn: ['Faixa Branca'], prerequisites: 'Guarda de Boxe', isFromWhiteBelt: true },\n                { id: '7', name: 'Defesa 360Â° Exterior', category: 'DEFENSE', level: 'BEGINNER', usedIn: ['Faixa Branca'], prerequisites: 'Defesa 360Â° Interior', isFromWhiteBelt: true },\n                { id: '8', name: 'Joelhada Frontal', category: 'STRIKE', level: 'BEGINNER', usedIn: ['Faixa Branca'], prerequisites: 'Guarda de Boxe', isFromWhiteBelt: true },\n                { id: '9', name: 'Chute Frontal', category: 'STRIKE', level: 'BEGINNER', usedIn: ['Faixa Branca'], prerequisites: 'Joelhada Frontal', isFromWhiteBelt: true },\n                { id: '10', name: 'Esquiva Lateral', category: 'MOVEMENT', level: 'BEGINNER', usedIn: ['Faixa Branca'], prerequisites: 'MovimentaÃ§Ã£o BÃ¡sica', isFromWhiteBelt: true },\n                \n                // Jiu-Jitsu techniques\n                { id: '23', name: 'Closed Guard', category: 'GRAPPLING', level: 'BEGINNER', martialArt: 'JIU_JITSU', usedIn: ['White Belt'], prerequisites: '', isPreviousLevel: false },\n                { id: '24', name: 'Armbar from Guard', category: 'GRAPPLING', level: 'INTERMEDIATE', martialArt: 'JIU_JITSU', usedIn: ['Blue Belt'], prerequisites: 'Closed Guard', isPreviousLevel: false },\n                { id: '25', name: 'Triangle Choke', category: 'GRAPPLING', level: 'INTERMEDIATE', martialArt: 'JIU_JITSU', usedIn: ['Blue Belt'], prerequisites: 'Closed Guard', isPreviousLevel: false },\n                \n                // Boxing techniques\n                { id: '26', name: 'Orthodox Stance', category: 'STANCE', level: 'BEGINNER', martialArt: 'BOXING', usedIn: ['Beginner'], prerequisites: '', isPreviousLevel: false },\n                { id: '27', name: 'Slip and Counter', category: 'COMBO', level: 'INTERMEDIATE', martialArt: 'BOXING', usedIn: ['Amateur'], prerequisites: 'Orthodox Stance, Jab', isPreviousLevel: false },\n                \n                // Muay Thai techniques\n                { id: '28', name: 'Fighting Stance', category: 'STANCE', level: 'BEGINNER', martialArt: 'MUAY_THAI', usedIn: ['White Prajioud'], prerequisites: '', isPreviousLevel: false },\n                { id: '29', name: 'Roundhouse Kick', category: 'STRIKE', level: 'INTERMEDIATE', martialArt: 'MUAY_THAI', usedIn: ['Yellow Prajioud'], prerequisites: 'Fighting Stance', isPreviousLevel: false },\n                \n                // General techniques (work for all martial arts)\n                { id: '30', name: 'Basic Conditioning', category: 'CONDITIONING', level: 'BEGINNER', martialArt: 'GENERAL', usedIn: ['All Levels'], prerequisites: '', isPreviousLevel: false },\n                { id: '31', name: 'Situational Awareness', category: 'SCENARIO', level: 'BEGINNER', martialArt: 'GENERAL', usedIn: ['All Levels'], prerequisites: '', isPreviousLevel: false },\n                \n                // Krav Maga - Intermediate\n                { id: '11', name: 'Defesa 360Â° Superior', category: 'DEFENSE', level: 'INTERMEDIATE', martialArt: 'KRAV_MAGA', usedIn: [], prerequisites: 'Defesa 360Â° Interior, Defesa 360Â° Exterior', isPreviousLevel: false },\n                { id: '12', name: 'Combo Jab-Cross-Hook', category: 'COMBO', level: 'INTERMEDIATE', martialArt: 'KRAV_MAGA', usedIn: [], prerequisites: 'Jab, Cross, Hook', isPreviousLevel: false },\n                { id: '13', name: 'Defesa contra Agarramento de Ombros', category: 'DEFENSE', level: 'INTERMEDIATE', martialArt: 'KRAV_MAGA', usedIn: [], prerequisites: 'Defesa 360Â°', isPreviousLevel: false },\n                { id: '14', name: 'Cotovelo Horizontal', category: 'STRIKE', level: 'INTERMEDIATE', usedIn: [], prerequisites: 'Joelhada Frontal', isFromWhiteBelt: false },\n                { id: '15', name: 'Chute Lateral', category: 'STRIKE', level: 'INTERMEDIATE', usedIn: [], prerequisites: 'Chute Frontal', isFromWhiteBelt: false },\n                { id: '16', name: 'Defesa contra Estrangulamento Lateral', category: 'DEFENSE', level: 'INTERMEDIATE', usedIn: [], prerequisites: 'Defesa contra Estrangulamento Frontal', isFromWhiteBelt: false },\n                { id: '17', name: 'LiberaÃ§Ã£o de Pegada no Punho', category: 'DEFENSE', level: 'INTERMEDIATE', usedIn: [], prerequisites: 'MovimentaÃ§Ã£o BÃ¡sica', isFromWhiteBelt: false },\n                { id: '18', name: 'Defesa contra EmpurrÃ£o', category: 'DEFENSE', level: 'INTERMEDIATE', usedIn: [], prerequisites: 'Esquiva Lateral', isFromWhiteBelt: false },\n                { id: '19', name: 'Joelhada Diagonal', category: 'STRIKE', level: 'INTERMEDIATE', usedIn: [], prerequisites: 'Joelhada Frontal', isFromWhiteBelt: false },\n                { id: '20', name: 'Combo Defesa-Contra-Ataque', category: 'COMBO', level: 'INTERMEDIATE', usedIn: [], prerequisites: 'Defesa 360Â°, Jab-Cross', isFromWhiteBelt: false },\n                \n                // AvanÃ§adas para futuras faixas\n                { id: '21', name: 'Defesa contra MÃºltiplos Atacantes', category: 'SCENARIO', level: 'ADVANCED', martialArt: 'KRAV_MAGA', usedIn: [], prerequisites: 'Combo Defesa-Contra-Ataque', isPreviousLevel: false },\n                { id: '22', name: 'FinalizaÃ§Ã£o e Fuga', category: 'SCENARIO', level: 'ADVANCED', martialArt: 'KRAV_MAGA', usedIn: [], prerequisites: 'Defesa contra MÃºltiplos Atacantes', isPreviousLevel: false }\n            ];\n\n            return techniques.map(tech => ({\n                ...tech,\n                description: generateTechniqueDescription(tech),\n                instructions: generateTechniqueInstructions(tech),\n                keyPoints: generateTechniqueKeyPoints(tech),\n                equipment: generateTechniqueEquipment(tech.category),\n                duration: getTechniqueDuration(tech.level),\n                // Audit fields\n                status: tech.status || 'PENDING',\n                auditScore: tech.auditScore || null,\n                duplicateOf: null,\n                qualityIssues: [],\n                videoUrl: tech.videoUrl || null,\n                createdAt: new Date().toISOString(),\n                lastAuditAt: tech.status === 'APPROVED' ? new Date().toISOString() : null\n            }));\n        }\n\n        // Display techniques table\n        function displayTechniquesTable(techniques) {\n            const tbody = document.getElementById('techniquesTableBody');\n            \n            if (techniques.length === 0) {\n                tbody.innerHTML = `\n                    <tr>\n                        <td colspan=\"6\" style=\"padding: 2rem; text-align: center;\">\n                            <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">ðŸ”</div>\n                            Nenhuma tÃ©cnica encontrada\n                        </td>\n                    </tr>\n                `;\n                return;\n            }\n\n            tbody.innerHTML = techniques.map(tech => `\n                <tr style=\"border-bottom: 1px solid #374151;\">\n                    <td style=\"padding: 1rem;\">\n                        <div style=\"font-weight: bold; color: #F8FAFC; margin-bottom: 0.25rem;\">${tech.name}</div>\n                        <div style=\"font-size: 0.8rem; color: #9CA3AF;\">${tech.description}</div>\n                    </td>\n                    <td style=\"padding: 1rem;\">\n                        <span style=\"background: ${getCategoryColor(tech.category)}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;\">\n                            ${getCategoryIcon(tech.category)} ${getCategoryName(tech.category)}\n                        </span>\n                    </td>\n                    <td style=\"padding: 1rem;\">\n                        <div style=\"color: ${getLevelColor(tech.level)};\">\n                            ${'â­'.repeat(getLevelStars(tech.level))} ${getLevelName(tech.level)}\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem;\">\n                        <div style=\"color: #CBD5E1;\">\n                            ${tech.usedIn.length > 0 ? tech.usedIn.join(', ') : 'NÃ£o usado'}\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem;\">\n                        <div style=\"color: #9CA3AF; font-size: 0.8rem;\">\n                            ${tech.prerequisites || 'Nenhum'}\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem; text-align: center;\">\n                        <div style=\"display: flex; gap: 0.5rem; justify-content: center;\">\n                            <button onclick=\"viewTechniqueDetails('${tech.id}')\" style=\"background: #3B82F6; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;\">\n                                ðŸ‘ï¸\n                            </button>\n                            <button onclick=\"editTechnique('${tech.id}')\" style=\"background: #F59E0B; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;\">\n                                âœï¸\n                            </button>\n                            <button onclick=\"deleteTechnique('${tech.id}')\" style=\"background: #EF4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;\">\n                                ðŸ—‘ï¸\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `).join('');\n        }\n\n        // Update techniques stats\n        function updateTechniquesStats() {\n            document.getElementById('totalTechniquesCount').textContent = allTechniques.length;\n            document.getElementById('categoriesCount').textContent = new Set(allTechniques.map(t => t.category)).size;\n            document.getElementById('coursesUsingCount').textContent = new Set(allTechniques.flatMap(t => t.usedIn)).size;\n            document.getElementById('reusedCount').textContent = allTechniques.filter(t => t.usedIn.length > 0).length;\n        }\n\n        // Helper functions for technique display\n        function getCategoryColor(category) {\n            const colors = {\n                'STANCE': '#3B82F6',\n                'STRIKE': '#EF4444', \n                'DEFENSE': '#10B981',\n                'GRAPPLING': '#8B5CF6',\n                'COMBO': '#F59E0B',\n                'MOVEMENT': '#06B6D4',\n                'SCENARIO': '#EC4899',\n                'CONDITIONING': '#84CC16'\n            };\n            return colors[category] || '#6B7280';\n        }\n\n        function getCategoryIcon(category) {\n            const icons = {\n                'STANCE': 'ðŸ¥‹',\n                'STRIKE': 'ðŸ‘Š',\n                'DEFENSE': 'ðŸ›¡ï¸',\n                'GRAPPLING': 'ðŸ¤¼',\n                'COMBO': 'âš¡',\n                'MOVEMENT': 'ðŸƒ',\n                'SCENARIO': 'ðŸŽ­',\n                'CONDITIONING': 'ðŸ’ª'\n            };\n            return icons[category] || 'ðŸ¥Š';\n        }\n\n        function getCategoryName(category) {\n            const names = {\n                'STANCE': 'Postura',\n                'STRIKE': 'Golpe',\n                'DEFENSE': 'Defesa',\n                'GRAPPLING': 'Agarramento',\n                'COMBO': 'CombinaÃ§Ã£o',\n                'MOVEMENT': 'Movimento',\n                'SCENARIO': 'CenÃ¡rio',\n                'CONDITIONING': 'Condicionamento'\n            };\n            return names[category] || category;\n        }\n\n        function getLevelColor(level) {\n            const colors = {\n                'BEGINNER': '#10B981',\n                'INTERMEDIATE': '#F59E0B',\n                'ADVANCED': '#EF4444',\n                'EXPERT': '#8B5CF6'\n            };\n            return colors[level] || '#6B7280';\n        }\n\n        function getLevelStars(level) {\n            const stars = {\n                'BEGINNER': 1,\n                'INTERMEDIATE': 2,\n                'ADVANCED': 3,\n                'EXPERT': 4\n            };\n            return stars[level] || 1;\n        }\n\n        function getLevelName(level) {\n            const names = {\n                'BEGINNER': 'Iniciante',\n                'INTERMEDIATE': 'IntermediÃ¡rio',\n                'ADVANCED': 'AvanÃ§ado',\n                'EXPERT': 'Expert'\n            };\n            return names[level] || level;\n        }\n\n        // Generate technique details\n        function generateTechniqueDescription(tech) {\n            const descriptions = {\n                'STANCE': 'PosiÃ§Ã£o fundamental para execuÃ§Ã£o de tÃ©cnicas',\n                'STRIKE': 'TÃ©cnica de ataque direcionada para neutralizar ameaÃ§as',\n                'DEFENSE': 'Movimento defensivo para proteÃ§Ã£o contra ataques',\n                'GRAPPLING': 'TÃ©cnica de combate prÃ³ximo e controle corporal',\n                'COMBO': 'SequÃªncia combinada de movimentos tÃ©cnicos',\n                'MOVEMENT': 'PadrÃ£o de movimentaÃ§Ã£o e posicionamento',\n                'SCENARIO': 'AplicaÃ§Ã£o prÃ¡tica em situaÃ§Ãµes realÃ­sticas',\n                'CONDITIONING': 'ExercÃ­cio para desenvolvimento fÃ­sico especÃ­fico'\n            };\n            return descriptions[tech.category] || 'TÃ©cnica de Krav Maga';\n        }\n\n        function generateTechniqueInstructions(tech) {\n            return `1. PosiÃ§Ã£o inicial: ${tech.prerequisites ? 'A partir de ' + tech.prerequisites : 'Postura neutra'}\\n2. ExecuÃ§Ã£o da tÃ©cnica ${tech.name}\\n3. FinalizaÃ§Ã£o em posiÃ§Ã£o segura\\n4. Retorno Ã  guarda`;\n        }\n\n        function generateTechniqueKeyPoints(tech) {\n            return `Manter postura correta, aplicar forÃ§a adequada, precisÃ£o na execuÃ§Ã£o, fluidez do movimento`;\n        }\n\n        function generateTechniqueEquipment(category) {\n            const equipment = {\n                'STANCE': 'Tatame',\n                'STRIKE': 'Tatame, Pads de foco',\n                'DEFENSE': 'Tatame, Equipamento de proteÃ§Ã£o',\n                'GRAPPLING': 'Tatame, ProteÃ§Ãµes',\n                'COMBO': 'Tatame, Pads, Luvas',\n                'MOVEMENT': 'Tatame, EspaÃ§o amplo',\n                'SCENARIO': 'Tatame, Equipamentos variados',\n                'CONDITIONING': 'Tatame, Equipamentos de treino'\n            };\n            return equipment[category] || 'Tatame';\n        }\n\n        function getTechniqueDuration(level) {\n            const durations = {\n                'BEGINNER': 10,\n                'INTERMEDIATE': 15,\n                'ADVANCED': 20,\n                'EXPERT': 25\n            };\n            return durations[level] || 10;\n        }\n\n        // Technique actions\n        function viewTechniqueDetails(techniqueId) {\n            const technique = allTechniques.find(t => t.id === techniqueId);\n            if (technique) {\n                showToast(`Visualizando: ${technique.name}`, 'info');\n                // TODO: Open technique details modal\n            }\n        }\n\n        function editTechnique(techniqueId) {\n            const technique = allTechniques.find(t => t.id === techniqueId);\n            if (technique) {\n                showToast(`Editando: ${technique.name}`, 'info');\n                // TODO: Open edit technique modal\n            }\n        }\n\n        function deleteTechnique(techniqueId) {\n            const technique = allTechniques.find(t => t.id === techniqueId);\n            if (technique && confirm(`Deseja excluir a tÃ©cnica \"${technique.name}\"?`)) {\n                allTechniques = allTechniques.filter(t => t.id !== techniqueId);\n                displayTechniquesTable(allTechniques);\n                updateTechniquesStats();\n                showToast(`TÃ©cnica \"${technique.name}\" excluÃ­da`, 'success');\n            }\n        }\n\n        // Add new technique\n        function openAddTechniqueModal() {\n            document.getElementById('addTechniqueModal').classList.add('active');\n        }\n\n        function closeAddTechniqueModal() {\n            document.getElementById('addTechniqueModal').classList.remove('active');\n            document.getElementById('addTechniqueForm').reset();\n        }\n\n        function saveTechnique() {\n            const formData = {\n                id: Date.now().toString(),\n                name: document.getElementById('techniqueName').value,\n                category: document.getElementById('techniqueCategory').value,\n                level: document.getElementById('techniqueLevel').value,\n                description: document.getElementById('techniqueDescription').value,\n                instructions: document.getElementById('techniqueInstructions').value,\n                prerequisites: document.getElementById('techniquePrerequisites').value,\n                keyPoints: document.getElementById('techniqueKeyPoints').value,\n                equipment: document.getElementById('techniqueEquipment').value,\n                duration: parseInt(document.getElementById('techniqueDuration').value),\n                usedIn: [],\n                isFromWhiteBelt: false\n            };\n\n            if (!formData.name || !formData.category || !formData.level) {\n                showToast('Preencha todos os campos obrigatÃ³rios', 'error');\n                return;\n            }\n\n            allTechniques.push(formData);\n            displayTechniquesTable(allTechniques);\n            updateTechniquesStats();\n            closeAddTechniqueModal();\n            showToast(`TÃ©cnica \"${formData.name}\" adicionada com sucesso!`, 'success');\n        }\n\n        // Search and filter techniques\n        document.addEventListener('DOMContentLoaded', function() {\n            const searchInput = document.getElementById('techniqueSearch');\n            const categoryFilter = document.getElementById('categoryFilter');\n\n            if (searchInput) {\n                searchInput.addEventListener('input', filterTechniques);\n            }\n            if (categoryFilter) {\n                categoryFilter.addEventListener('change', filterTechniques);\n            }\n        });\n\n        function filterTechniques() {\n            const searchTerm = document.getElementById('techniqueSearch')?.value.toLowerCase() || '';\n            const selectedCategory = document.getElementById('categoryFilter')?.value || '';\n\n            let filteredTechniques = allTechniques.filter(tech => {\n                const matchesSearch = tech.name.toLowerCase().includes(searchTerm) || \n                                    tech.description.toLowerCase().includes(searchTerm);\n                const matchesCategory = !selectedCategory || tech.category === selectedCategory;\n                \n                return matchesSearch && matchesCategory;\n            });\n\n            displayTechniquesTable(filteredTechniques);\n        }\n\n        // ==========================================\n        // UNIVERSAL COURSE CREATOR\n        // ==========================================\n\n        // Open Universal Course Creator (RAG-Enhanced)\n        function openUniversalCourseCreator() {\n            document.getElementById('universalCourseModal').classList.add('active');\n            loadTechniqueSelectionArea();\n            initializeBeltSystems();\n            updateRAGStatus(); // Add RAG status update\n        }\n\n        // Close Universal Course Creator\n        function closeUniversalCourseModal() {\n            document.getElementById('universalCourseModal').classList.remove('active');\n            selectedTechniques = [];\n            courseModelFile = null;\n            updateSelectedTechniquesList();\n        }\n\n        // Initialize belt systems for different martial arts\n        function initializeBeltSystems() {\n            beltSystems = {\n                'KRAV_MAGA': {\n                    name: 'Krav Maga',\n                    levels: [\n                        { value: 'PRACTITIONER_1', name: 'Practitioner 1', color: '#FFFFFF' },\n                        { value: 'PRACTITIONER_2', name: 'Practitioner 2', color: '#FFD700' },\n                        { value: 'PRACTITIONER_3', name: 'Practitioner 3', color: '#FFA500' },\n                        { value: 'GRADUATE_1', name: 'Graduate 1', color: '#32CD32' },\n                        { value: 'GRADUATE_2', name: 'Graduate 2', color: '#0000FF' },\n                        { value: 'EXPERT_1', name: 'Expert 1', color: '#8B4513' },\n                        { value: 'EXPERT_2', name: 'Expert 2', color: '#000000' }\n                    ]\n                },\n                'JIU_JITSU': {\n                    name: 'Jiu-Jitsu',\n                    levels: [\n                        { value: 'WHITE', name: 'Faixa Branca', color: '#FFFFFF' },\n                        { value: 'BLUE', name: 'Faixa Azul', color: '#0000FF' },\n                        { value: 'PURPLE', name: 'Faixa Roxa', color: '#800080' },\n                        { value: 'BROWN', name: 'Faixa Marrom', color: '#8B4513' },\n                        { value: 'BLACK', name: 'Faixa Preta', color: '#000000' }\n                    ]\n                },\n                'BOXING': {\n                    name: 'Boxe',\n                    levels: [\n                        { value: 'BEGINNER', name: 'Iniciante', color: '#FFFFFF' },\n                        { value: 'AMATEUR', name: 'Amador', color: '#C0C0C0' },\n                        { value: 'SEMI_PRO', name: 'Semi-Profissional', color: '#FFD700' },\n                        { value: 'PROFESSIONAL', name: 'Profissional', color: '#000000' }\n                    ]\n                },\n                'MUAY_THAI': {\n                    name: 'Muay Thai',\n                    levels: [\n                        { value: 'WHITE', name: 'Prajioud Branco', color: '#FFFFFF' },\n                        { value: 'YELLOW', name: 'Prajioud Amarelo', color: '#FFD700' },\n                        { value: 'GREEN', name: 'Prajioud Verde', color: '#008000' },\n                        { value: 'BLUE', name: 'Prajioud Azul', color: '#0000FF' },\n                        { value: 'RED', name: 'Prajioud Vermelho', color: '#FF0000' },\n                        { value: 'BLACK', name: 'Prajioud Preto', color: '#000000' }\n                    ]\n                },\n                'KARATE': {\n                    name: 'KaratÃª',\n                    levels: [\n                        { value: 'WHITE', name: 'Faixa Branca', color: '#FFFFFF' },\n                        { value: 'YELLOW', name: 'Faixa Amarela', color: '#FFD700' },\n                        { value: 'ORANGE', name: 'Faixa Laranja', color: '#FFA500' },\n                        { value: 'GREEN', name: 'Faixa Verde', color: '#008000' },\n                        { value: 'BLUE', name: 'Faixa Azul', color: '#0000FF' },\n                        { value: 'BROWN', name: 'Faixa Marrom', color: '#8B4513' },\n                        { value: 'BLACK', name: 'Faixa Preta', color: '#000000' }\n                    ]\n                },\n                'TAEKWONDO': {\n                    name: 'Taekwondo',\n                    levels: [\n                        { value: 'WHITE', name: 'Faixa Branca', color: '#FFFFFF' },\n                        { value: 'YELLOW', name: 'Faixa Amarela', color: '#FFD700' },\n                        { value: 'GREEN', name: 'Faixa Verde', color: '#008000' },\n                        { value: 'BLUE', name: 'Faixa Azul', color: '#0000FF' },\n                        { value: 'RED', name: 'Faixa Vermelha', color: '#FF0000' },\n                        { value: 'BLACK', name: 'Faixa Preta', color: '#000000' }\n                    ]\n                },\n                'MMA': {\n                    name: 'MMA',\n                    levels: [\n                        { value: 'BEGINNER', name: 'Iniciante', color: '#FFFFFF' },\n                        { value: 'INTERMEDIATE', name: 'IntermediÃ¡rio', color: '#FFD700' },\n                        { value: 'ADVANCED', name: 'AvanÃ§ado', color: '#FFA500' },\n                        { value: 'PRO', name: 'Profissional', color: '#000000' }\n                    ]\n                },\n                'CAPOEIRA': {\n                    name: 'Capoeira',\n                    levels: [\n                        { value: 'CRUA', name: 'CordÃ£o Cru', color: '#F5F5DC' },\n                        { value: 'AMARELO', name: 'CordÃ£o Amarelo', color: '#FFD700' },\n                        { value: 'LARANJA', name: 'CordÃ£o Laranja', color: '#FFA500' },\n                        { value: 'AZUL', name: 'CordÃ£o Azul', color: '#0000FF' },\n                        { value: 'VERDE', name: 'CordÃ£o Verde', color: '#008000' },\n                        { value: 'ROXO', name: 'CordÃ£o Roxo', color: '#800080' },\n                        { value: 'MARROM', name: 'CordÃ£o Marrom', color: '#8B4513' },\n                        { value: 'VERMELHO', name: 'CordÃ£o Vermelho', color: '#FF0000' }\n                    ]\n                }\n            };\n        }\n\n        // Update belt options when martial art changes\n        function updateTechniquesForArt() {\n            const martialArt = document.getElementById('martialArt').value;\n            const beltSelect = document.getElementById('beltLevel');\n            \n            // Clear belt options\n            beltSelect.innerHTML = '<option value=\"\">Selecione a faixa/nÃ­vel</option>';\n            \n            if (martialArt && beltSystems[martialArt]) {\n                const system = beltSystems[martialArt];\n                system.levels.forEach(level => {\n                    const option = document.createElement('option');\n                    option.value = level.value;\n                    option.textContent = level.name;\n                    option.style.color = level.color === '#FFFFFF' ? '#000000' : level.color;\n                    beltSelect.appendChild(option);\n                });\n            }\n            \n            // Update techniques based on martial art\n            updateTechniqueSelectionStrategy();\n        }\n\n        // Update belt info display\n        function updateBeltInfo() {\n            const martialArt = document.getElementById('martialArt').value;\n            const beltLevel = document.getElementById('beltLevel').value;\n            const beltInfo = document.getElementById('beltInfo');\n            const beltInfoContent = document.getElementById('beltInfoContent');\n            \n            if (martialArt && beltLevel && beltSystems[martialArt]) {\n                const system = beltSystems[martialArt];\n                const level = system.levels.find(l => l.value === beltLevel);\n                \n                if (level) {\n                    beltInfoContent.innerHTML = `\n                        <div style=\"display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;\">\n                            <div style=\"width: 30px; height: 20px; background: ${level.color}; border: 1px solid #374151; border-radius: 4px;\"></div>\n                            <div>\n                                <div style=\"font-weight: bold; color: #F8FAFC;\">${system.name} - ${level.name}</div>\n                                <div style=\"color: #9CA3AF; font-size: 0.9rem;\">Sistema de graduaÃ§Ã£o selecionado</div>\n                            </div>\n                        </div>\n                    `;\n                    beltInfo.style.display = 'block';\n                    \n                    // Auto-populate course title\n                    const titleField = document.getElementById('universalCourseTitle');\n                    if (!titleField.value) {\n                        titleField.value = `${system.name} ${level.name} - Curso Completo`;\n                    }\n                } else {\n                    beltInfo.style.display = 'none';\n                }\n            } else {\n                beltInfo.style.display = 'none';\n            }\n        }\n\n        // Get martial art name\n        function getMartialArtName(artCode) {\n            return beltSystems[artCode]?.name || artCode;\n        }\n\n        // Load technique selection area\n        function loadTechniqueSelectionArea() {\n            if (allTechniques.length === 0) {\n                allTechniques = generateMockTechniques();\n            }\n\n            updateTechniqueSelectionStrategy();\n        }\n\n        // Update technique selection based on strategy\n        function updateTechniqueSelectionStrategy() {\n            const strategy = document.querySelector('input[name=\"selectionStrategy\"]:checked')?.value || 'reuse';\n            const selectionArea = document.getElementById('techniqueSelectionArea');\n\n            let techniquesToShow = [];\n\n            const martialArt = document.getElementById('martialArt')?.value;\n            const beltLevel = document.getElementById('beltLevel')?.value;\n            \n            // Filter techniques by martial art if selected\n            let availableTechniques = allTechniques;\n            if (martialArt) {\n                availableTechniques = allTechniques.filter(t => \n                    t.martialArt === martialArt || t.martialArt === 'GENERAL'\n                );\n            }\n            \n            switch (strategy) {\n                case 'reuse':\n                    // Show techniques from previous belt level + new ones\n                    const previousLevelTechniques = availableTechniques.filter(t => t.isPreviousLevel);\n                    const newTechniques = availableTechniques.filter(t => !t.isPreviousLevel && t.level === 'INTERMEDIATE');\n                    selectedTechniques = [...previousLevelTechniques];\n                    techniquesToShow = newTechniques;\n                    break;\n                    \n                case 'fresh':\n                    // Show techniques appropriate for the belt level\n                    selectedTechniques = [];\n                    techniquesToShow = availableTechniques.filter(t => {\n                        if (!beltLevel) return t.level === 'BEGINNER';\n                        \n                        if (beltLevel === 'WHITE' || beltLevel === 'PRACTITIONER_1' || beltLevel === 'BEGINNER' || beltLevel === 'CRUA') {\n                            return t.level === 'BEGINNER';\n                        } else if (beltLevel === 'BLACK' || beltLevel === 'EXPERT_1' || beltLevel === 'PRO' || beltLevel === 'VERMELHO') {\n                            return t.level === 'ADVANCED' || t.level === 'EXPERT';\n                        } else {\n                            return t.level === 'INTERMEDIATE';\n                        }\n                    });\n                    break;\n                    \n                case 'custom':\n                    // Show all techniques for manual selection\n                    selectedTechniques = [];\n                    techniquesToShow = availableTechniques;\n                    break;\n            }\n\n            displayTechniqueSelection(techniquesToShow, strategy);\n            updateSelectedTechniquesList();\n        }\n\n        // Display technique selection interface\n        function displayTechniqueSelection(techniques, strategy) {\n            const selectionArea = document.getElementById('techniqueSelectionArea');\n            \n            let content = '';\n            \n            if (strategy === 'reuse') {\n                const previousTechniques = allTechniques.filter(t => t.isPreviousLevel);\n                content = `\n                    <div style=\"padding: 1rem; background: rgba(16, 185, 129, 0.1); border-bottom: 1px solid #374151;\">\n                        <h4 style=\"color: #10B981; margin-bottom: 0.5rem;\">âœ… TÃ©cnicas do NÃ­vel Anterior (JÃ¡ IncluÃ­das)</h4>\n                        <div style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                            ${previousTechniques.length > 0 ? previousTechniques.map(t => t.name).join(', ') : 'Nenhuma tÃ©cnica do nÃ­vel anterior'}\n                        </div>\n                    </div>\n                    <div style=\"padding: 1rem;\">\n                        <h4 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“ Selecione TÃ©cnicas Adicionais:</h4>\n                `;\n            } else {\n                content = `\n                    <div style=\"padding: 1rem;\">\n                        <h4 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ“ Selecione as TÃ©cnicas:</h4>\n                `;\n            }\n\n            content += techniques.map(tech => `\n                <div style=\"display: flex; align-items: center; gap: 1rem; padding: 0.75rem; border-bottom: 1px solid #374151; hover: background-color: rgba(255,255,255,0.05);\">\n                    <input type=\"checkbox\" id=\"tech_${tech.id}\" value=\"${tech.id}\" onchange=\"toggleTechniqueSelection('${tech.id}')\">\n                    <label for=\"tech_${tech.id}\" style=\"flex: 1; cursor: pointer; color: #F8FAFC;\">\n                        <div style=\"font-weight: bold; margin-bottom: 0.25rem;\">${tech.name}</div>\n                        <div style=\"font-size: 0.8rem; color: #9CA3AF;\">\n                            ${getCategoryIcon(tech.category)} ${getCategoryName(tech.category)} â€¢ \n                            ${'â­'.repeat(getLevelStars(tech.level))} ${getLevelName(tech.level)}\n                        </div>\n                    </label>\n                </div>\n            `).join('');\n\n            content += '</div>';\n            selectionArea.innerHTML = content;\n        }\n\n        // Toggle technique selection\n        function toggleTechniqueSelection(techniqueId) {\n            const technique = allTechniques.find(t => t.id === techniqueId);\n            const checkbox = document.getElementById(`tech_${techniqueId}`);\n            \n            if (checkbox.checked) {\n                if (!selectedTechniques.find(t => t.id === techniqueId)) {\n                    selectedTechniques.push(technique);\n                }\n            } else {\n                selectedTechniques = selectedTechniques.filter(t => t.id !== techniqueId);\n            }\n            \n            updateSelectedTechniquesList();\n        }\n\n        // Update selected techniques list\n        function updateSelectedTechniquesList() {\n            const countElement = document.getElementById('selectedTechniquesCount');\n            const listElement = document.getElementById('selectedTechniquesList');\n            \n            countElement.textContent = selectedTechniques.length;\n            \n            if (selectedTechniques.length === 0) {\n                listElement.textContent = 'Nenhuma tÃ©cnica selecionada ainda';\n            } else {\n                listElement.innerHTML = selectedTechniques.map(tech => \n                    `<span style=\"background: ${getCategoryColor(tech.category)}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; margin: 0.25rem; display: inline-block; font-size: 0.8rem;\">\n                        ${getCategoryIcon(tech.category)} ${tech.name}\n                    </span>`\n                ).join('');\n            }\n        }\n\n        // Handle Course model upload\n        function handleCourseModelUpload(event) {\n            const file = event.target.files[0];\n            if (file) {\n                courseModelFile = file;\n                document.getElementById('courseModelFileInfo').innerHTML = `\n                    <div style=\"text-align: left; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border: 1px solid #F59E0B;\">\n                        <div style=\"color: #F59E0B; font-weight: bold; margin-bottom: 0.5rem;\">ðŸ“Ž Arquivo Carregado:</div>\n                        <div style=\"color: #F8FAFC;\">${getFileIcon(file.name)} ${file.name}</div>\n                        <div style=\"color: #9CA3AF; font-size: 0.8rem;\">${formatFileSize(file.size)}</div>\n                    </div>\n                `;\n                showToast(`Modelo \"${file.name}\" carregado com sucesso!`, 'success');\n            }\n        }\n\n        // Create Universal Course (RAG-Enhanced)\n        async function createUniversalCourse() {\n            const courseData = {\n                title: document.getElementById('universalCourseTitle').value,\n                duration: parseInt(document.getElementById('universalCourseDuration').value),\n                objectives: document.getElementById('universalCourseObjectives').value,\n                martialArt: document.getElementById('martialArt').value,\n                beltLevel: document.getElementById('beltLevel').value,\n                graduation: document.getElementById('courseGraduation').value,\n                level: document.getElementById('universalCourseLevel').value,\n                lessonsPerWeek: parseInt(document.getElementById('lessonsPerWeekUniversal').value),\n                selectedTechniques: selectedTechniques,\n                modelFile: courseModelFile,\n                generatePlans: document.getElementById('universalGeneratePlans').checked,\n                aiModel: document.getElementById('universalAiModel').value,\n                selectionStrategy: document.querySelector('input[name=\"selectionStrategy\"]:checked')?.value\n            };\n\n            if (!courseData.title || !courseData.martialArt || !courseData.beltLevel || selectedTechniques.length === 0) {\n                showToast('Preencha todos os campos obrigatÃ³rios e selecione tÃ©cnicas', 'error');\n                return;\n            }\n\n            // Show loading state\n            const createBtn = document.getElementById('createUniversalBtn');\n            const originalText = createBtn.innerHTML;\n            createBtn.innerHTML = '<span>â³</span> Criando Curso...';\n            createBtn.disabled = true;\n\n            try {\n                // RAG Enhancement: Query knowledge base for course-relevant content\n                const ragEnhancement = await queryRAGForCourseCreation(courseData);\n                courseData.ragContent = ragEnhancement;\n                \n                await simulateUniversalCourseCreation(courseData);\n                \n                showToast(`Curso de ${getMartialArtName(courseData.martialArt)} criado com sucesso! ${ragEnhancement.usedSources > 0 ? 'ðŸ§  Enriquecido com ' + ragEnhancement.usedSources + ' fontes da base de conhecimento' : ''}`, 'success');\n                closeUniversalCourseModal();\n                \n                // Refresh course data\n                showSection('courses');\n                \n            } catch (error) {\n                console.error('Erro ao criar curso:', error);\n                showToast('Erro ao criar curso', 'error');\n            } finally {\n                // Restore button state\n                createBtn.innerHTML = originalText;\n                createBtn.disabled = false;\n            }\n        }\n\n        // Simulate Universal course creation (RAG-Enhanced)\n        async function simulateUniversalCourseCreation(courseData) {\n            return new Promise((resolve) => {\n                setTimeout(() => {\n                    const enhancedCourse = {\n                        title: courseData.title,\n                        duration: courseData.duration,\n                        totalTechniques: courseData.selectedTechniques.length,\n                        techniques: courseData.selectedTechniques.map(t => ({\n                            name: t.name,\n                            category: t.category,\n                            level: t.level,\n                            isFromWhiteBelt: t.isFromWhiteBelt\n                        })),\n                        strategy: courseData.selectionStrategy,\n                        modelFile: courseData.modelFile?.name,\n                        generatePlans: courseData.generatePlans,\n                        totalLessons: courseData.duration * courseData.lessonsPerWeek,\n                        aiModel: courseData.aiModel,\n                        courseStructure: generateRAGEnhancedStructure(courseData),\n                        ragEnhancements: courseData.ragContent\n                    };\n                    \n                    console.log('ðŸŽ“ RAG-Enhanced Universal Course Created:', enhancedCourse);\n                    \n                    // If lesson plans should be generated, create RAG-enhanced plans\n                    if (courseData.generatePlans) {\n                        enhancedCourse.lessonPlans = generateRAGEnhancedLessonPlans(courseData);\n                        console.log('ðŸ“š Generated RAG-Enhanced Lesson Plans:', enhancedCourse.lessonPlans.length);\n                    }\n                    \n                    resolve(enhancedCourse);\n                }, 4000); // Simulate 4 second creation\n            });\n        }\n\n        // Generate Yellow Belt course structure\n        function generateYellowBeltStructure(courseData) {\n            const totalLessons = courseData.duration * 2;\n            const techniquesPerLesson = Math.ceil(courseData.selectedTechniques.length / totalLessons);\n            \n            return {\n                totalWeeks: courseData.duration,\n                totalLessons: totalLessons,\n                lessonsPerWeek: 2,\n                techniquesDistribution: courseData.selectedTechniques.reduce((acc, tech, index) => {\n                    const lessonNumber = Math.floor(index / techniquesPerLesson) + 1;\n                    if (!acc[lessonNumber]) acc[lessonNumber] = [];\n                    acc[lessonNumber].push(tech.name);\n                    return acc;\n                }, {}),\n                prerequisites: {\n                    requiredCourse: 'Krav Maga Faixa Branca',\n                    minimumGrade: '70%',\n                    requiredTechniques: allTechniques.filter(t => t.isFromWhiteBelt).map(t => t.name)\n                }\n            };\n        }\n\n        // Listen for strategy changes\n        document.addEventListener('change', function(e) {\n            if (e.target.name === 'selectionStrategy') {\n                updateTechniqueSelectionStrategy();\n            }\n        });\n\n        // ==========================================\n        // AI COURSE GENERATOR FUNCTIONALITY\n        // ==========================================\n\n        let uploadedFiles = [];\n        let selectedTemplate = null;\n\n        // Open AI Course Generator Modal\n        function openAICourseGenerator() {\n            document.getElementById('aiCourseGeneratorModal').classList.add('active');\n            resetCourseForm();\n        }\n\n        // Close AI Course Generator Modal\n        function closeAICourseGeneratorModal() {\n            document.getElementById('aiCourseGeneratorModal').classList.remove('active');\n            resetCourseForm();\n        }\n\n        // Select creation mode\n        function selectCreationMode(mode) {\n            document.getElementById('creationMode').value = mode;\n            \n            // Update UI\n            document.querySelectorAll('.creation-mode-card').forEach(card => {\n                card.style.borderColor = '#374151';\n                card.style.background = '';\n            });\n            \n            const selectedCard = event.target.closest('.creation-mode-card');\n            selectedCard.style.borderColor = '#3B82F6';\n            selectedCard.style.background = 'rgba(59, 130, 246, 0.1)';\n            \n            // Show/hide document section\n            const documentSection = document.getElementById('documentSection');\n            if (mode === 'document') {\n                documentSection.style.display = 'block';\n            } else {\n                documentSection.style.display = 'none';\n            }\n        }\n\n        // Load template\n        function loadTemplate(templateType) {\n            selectedTemplate = templateType;\n            \n            // Update template buttons\n            document.querySelectorAll('.template-btn').forEach(btn => {\n                btn.style.background = btn.style.background.replace('0.2', '0.1');\n            });\n            event.target.style.background = event.target.style.background.replace('0.1', '0.3');\n            \n            // Load template data\n            const templates = {\n                'krav-maga-basic': {\n                    title: 'Krav Maga Faixa Branca - Defesa Pessoal 1',\n                    level: 'INICIANTE',\n                    category: 'ADULT',\n                    duration: 24,\n                    objectives: 'Desenvolver habilidades fundamentais de defesa pessoal, melhorar condicionamento fÃ­sico, ensinar consciÃªncia situacional'\n                },\n                'self-defense': {\n                    title: 'Defesa Pessoal para Mulheres',\n                    level: 'INICIANTE',\n                    category: 'ADULT',\n                    duration: 12,\n                    objectives: 'Ensinar tÃ©cnicas bÃ¡sicas de defesa, desenvolver confianÃ§a, promover seguranÃ§a pessoal'\n                },\n                'instructor': {\n                    title: 'FormaÃ§Ã£o de Instrutores Krav Maga',\n                    level: 'INSTRUTOR',\n                    category: 'ADULT',\n                    duration: 36,\n                    objectives: 'Formar instrutores qualificados, ensinar metodologia de ensino, desenvolver habilidades de lideranÃ§a'\n                }\n            };\n            \n            const template = templates[templateType];\n            if (template) {\n                document.getElementById('courseTitle').value = template.title;\n                document.getElementById('courseLevel').value = template.level;\n                document.getElementById('courseCategory').value = template.category;\n                document.getElementById('courseDuration').value = template.duration;\n                document.getElementById('courseObjectives').value = template.objectives;\n            }\n\n            showToast(`Template \"${templateType}\" carregado com sucesso!`, 'success');\n        }\n\n        // Handle file upload\n        function handleFileUpload(event) {\n            const files = Array.from(event.target.files);\n            uploadedFiles = [...uploadedFiles, ...files];\n            \n            displayUploadedFiles();\n            showToast(`${files.length} arquivo(s) carregado(s)`, 'success');\n        }\n\n        // Display uploaded files\n        function displayUploadedFiles() {\n            const container = document.getElementById('uploadedFiles');\n            \n            if (uploadedFiles.length === 0) {\n                container.innerHTML = '';\n                return;\n            }\n            \n            container.innerHTML = `\n                <div style=\"text-align: left; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #374151;\">\n                    <h4 style=\"color: #F8FAFC; margin-bottom: 0.5rem;\">ðŸ“Ž Arquivos Carregados:</h4>\n                    ${uploadedFiles.map((file, index) => `\n                        <div style=\"display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: rgba(59, 130, 246, 0.1); border-radius: 6px; margin-bottom: 0.5rem;\">\n                            <span style=\"color: #CBD5E1;\">\n                                ${getFileIcon(file.name)} ${file.name} \n                                <small style=\"color: #9CA3AF;\">(${formatFileSize(file.size)})</small>\n                            </span>\n                            <button onclick=\"removeFile(${index})\" style=\"background: #EF4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;\">\n                                âœ•\n                            </button>\n                        </div>\n                    `).join('')}\n                </div>\n            `;\n        }\n\n        // Remove file\n        function removeFile(index) {\n            uploadedFiles.splice(index, 1);\n            displayUploadedFiles();\n            showToast('Arquivo removido', 'info');\n        }\n\n        // Get file icon\n        function getFileIcon(filename) {\n            const ext = filename.split('.').pop().toLowerCase();\n            const icons = {\n                'pdf': 'ðŸ“„',\n                'doc': 'ðŸ“',\n                'docx': 'ðŸ“',\n                'txt': 'ðŸ“„',\n                'md': 'ðŸ“‹'\n            };\n            return icons[ext] || 'ðŸ“';\n        }\n\n        // Format file size\n        function formatFileSize(bytes) {\n            if (bytes === 0) return '0 Bytes';\n            const k = 1024;\n            const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n            const i = Math.floor(Math.log(bytes) / Math.log(k));\n            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n        }\n\n        // Generate course with AI\n        async function generateCourseWithAI() {\n            const formData = collectCourseFormData();\n            \n            if (!validateCourseForm(formData)) {\n                return;\n            }\n\n            // Show loading state\n            const generateBtn = document.getElementById('generateCourseBtn');\n            const originalText = generateBtn.innerHTML;\n            generateBtn.innerHTML = '<span>â³</span> Gerando Curso...';\n            generateBtn.disabled = true;\n\n            try {\n                // Simulate AI course generation\n                await simulateAICourseGeneration(formData);\n                \n                showToast('Curso gerado com sucesso! Criando planos de aula...', 'success');\n                \n                if (formData.generateLessonPlans) {\n                    await simulateLessonPlansGeneration(formData);\n                    showToast('Planos de aula gerados com sucesso!', 'success');\n                }\n                \n                closeAICourseGeneratorModal();\n                // Refresh course data\n                loadAllLessonPlans();\n                \n            } catch (error) {\n                console.error('Erro na geraÃ§Ã£o do curso:', error);\n                showToast('Erro ao gerar curso', 'error');\n            } finally {\n                // Restore button state\n                generateBtn.innerHTML = originalText;\n                generateBtn.disabled = false;\n            }\n        }\n\n        // Collect form data\n        function collectCourseFormData() {\n            return {\n                mode: document.getElementById('creationMode').value,\n                title: document.getElementById('courseTitle').value,\n                duration: document.getElementById('courseDuration').value,\n                level: document.getElementById('courseLevel').value,\n                category: document.getElementById('courseCategory').value,\n                lessonsPerWeek: document.getElementById('lessonsPerWeek').value,\n                objectives: document.getElementById('courseObjectives').value,\n                additionalContext: document.getElementById('additionalContext').value,\n                generateLessonPlans: document.getElementById('generateLessonPlans').checked,\n                includeEvaluations: document.getElementById('includeEvaluations').checked,\n                aiModel: document.getElementById('aiModel').value,\n                adaptations: Array.from(document.querySelectorAll('input[name=\"adaptations\"]:checked')).map(cb => cb.value),\n                uploadedFiles: uploadedFiles,\n                selectedTemplate: selectedTemplate\n            };\n        }\n\n        // Validate form\n        function validateCourseForm(formData) {\n            if (!formData.mode) {\n                showToast('Selecione um modo de criaÃ§Ã£o', 'error');\n                return false;\n            }\n            \n            if (!formData.title || !formData.level || !formData.category) {\n                showToast('Preencha todos os campos obrigatÃ³rios', 'error');\n                return false;\n            }\n            \n            if (formData.mode === 'document' && uploadedFiles.length === 0 && !selectedTemplate) {\n                showToast('Carregue documentos ou selecione um template', 'error');\n                return false;\n            }\n            \n            return true;\n        }\n\n        // Simulate AI course generation\n        async function simulateAICourseGeneration(formData) {\n            return new Promise((resolve) => {\n                setTimeout(() => {\n                    console.log('ðŸŽ¯ IA Generated Course:', {\n                        title: formData.title,\n                        structure: generateCourseStructure(formData),\n                        curriculum: generateCourseCurriculum(formData),\n                        objectives: formData.objectives.split(',').map(obj => obj.trim()),\n                        totalLessons: formData.duration * formData.lessonsPerWeek,\n                        weeks: formData.duration,\n                        level: formData.level,\n                        category: formData.category,\n                        adaptations: formData.adaptations,\n                        evaluationSystem: formData.includeEvaluations ? generateEvaluationSystem(formData) : null,\n                        generatedWith: {\n                            model: formData.aiModel,\n                            mode: formData.mode,\n                            documentsUsed: uploadedFiles.map(f => f.name),\n                            template: selectedTemplate\n                        }\n                    });\n                    resolve();\n                }, 3000); // Simulate 3 second generation\n            });\n        }\n\n        // Generate course structure\n        function generateCourseStructure(formData) {\n            const totalLessons = formData.duration * formData.lessonsPerWeek;\n            const unitsCount = Math.ceil(totalLessons / 10);\n            \n            return {\n                totalWeeks: formData.duration,\n                lessonsPerWeek: formData.lessonsPerWeek,\n                totalLessons: totalLessons,\n                units: Array.from({length: unitsCount}, (_, i) => ({\n                    number: i + 1,\n                    name: generateUnitName(i, formData.level),\n                    lessonsStart: i * 10 + 1,\n                    lessonsEnd: Math.min((i + 1) * 10, totalLessons),\n                    focus: generateUnitFocus(i, formData.level)\n                }))\n            };\n        }\n\n        // Generate unit names based on level\n        function generateUnitName(unitIndex, level) {\n            const unitNames = {\n                'INICIANTE': ['Fundamentos', 'TÃ©cnicas BÃ¡sicas', 'Defesas Simples', 'AplicaÃ§Ã£o PrÃ¡tica'],\n                'INTERMEDIARIO': ['RevisÃ£o AvanÃ§ada', 'TÃ©cnicas Complexas', 'Defesas MÃºltiplas', 'CenÃ¡rios Reais'],\n                'AVANCADO': ['Refinamento TÃ©cnico', 'Combos AvanÃ§ados', 'Defesas Extremas', 'InstruÃ§Ã£o'],\n                'INSTRUTOR': ['Metodologia', 'Pedagogia', 'DemonstraÃ§Ã£o', 'AvaliaÃ§Ã£o']\n            };\n            \n            return unitNames[level]?.[unitIndex] || `Unidade ${unitIndex + 1}`;\n        }\n\n        // Generate unit focus\n        function generateUnitFocus(unitIndex, level) {\n            const focuses = {\n                'INICIANTE': ['CoordenaÃ§Ã£o e postura', 'TÃ©cnicas fundamentais', 'ReaÃ§Ãµes bÃ¡sicas', 'ConfianÃ§a'],\n                'INTERMEDIARIO': ['PrecisÃ£o tÃ©cnica', 'CombinaÃ§Ãµes', 'Adaptabilidade', 'Condicionamento'],\n                'AVANCADO': ['PerfeiÃ§Ã£o tÃ©cnica', 'Criatividade', 'LideranÃ§a', 'EspecializaÃ§Ã£o'],\n                'INSTRUTOR': ['Ensino efetivo', 'ComunicaÃ§Ã£o', 'CorreÃ§Ã£o tÃ©cnica', 'Desenvolvimento de alunos']\n            };\n            \n            return focuses[level]?.[unitIndex] || 'Desenvolvimento geral';\n        }\n\n        // Generate course curriculum\n        function generateCourseCurriculum(formData) {\n            return {\n                principles: generateCoursePrinciples(formData.level),\n                techniques: generateCourseTechniques(formData.level),\n                progressionSystem: generateProgressionSystem(formData.level),\n                equipmentNeeded: generateEquipmentList(formData.level)\n            };\n        }\n\n        // Generate evaluation system\n        function generateEvaluationSystem(formData) {\n            return {\n                evaluationMethods: ['TÃ©cnica individual', 'CenÃ¡rios prÃ¡ticos', 'Exame teÃ³rico', 'AvaliaÃ§Ã£o contÃ­nua'],\n                gradingCriteria: ['PrecisÃ£o tÃ©cnica', 'AplicaÃ§Ã£o prÃ¡tica', 'Conhecimento teÃ³rico', 'ProgressÃ£o'],\n                examSchedule: generateExamSchedule(formData.duration),\n                certificationRequirements: ['75% frequÃªncia mÃ­nima', 'AprovaÃ§Ã£o em todas avaliaÃ§Ãµes', 'DemonstraÃ§Ã£o prÃ¡tica']\n            };\n        }\n\n        // Simulate lesson plans generation\n        async function simulateLessonPlansGeneration(formData) {\n            return new Promise((resolve) => {\n                setTimeout(() => {\n                    console.log('ðŸ“š IA Generated Lesson Plans for course:', formData.title);\n                    resolve();\n                }, 2000);\n            });\n        }\n\n        // Reset form\n        function resetCourseForm() {\n            document.getElementById('creationMode').value = '';\n            document.querySelectorAll('.creation-mode-card').forEach(card => {\n                card.style.borderColor = '#374151';\n                card.style.background = '';\n            });\n            document.getElementById('documentSection').style.display = 'none';\n            uploadedFiles = [];\n            selectedTemplate = null;\n            displayUploadedFiles();\n        }\n\n        // Helper functions for curriculum generation\n        function generateCoursePrinciples(level) {\n            const principles = {\n                'INICIANTE': ['SeguranÃ§a primeiro', 'Simplicidade', 'Efetividade', 'ProgressÃ£o gradual'],\n                'INTERMEDIARIO': ['Adaptabilidade', 'FluÃªncia tÃ©cnica', 'Tomada de decisÃ£o', 'Condicionamento'],\n                'AVANCADO': ['Maestria tÃ©cnica', 'Criatividade', 'LideranÃ§a', 'InovaÃ§Ã£o'],\n                'INSTRUTOR': ['Pedagogia efetiva', 'ComunicaÃ§Ã£o clara', 'Desenvolvimento de outros', 'Responsabilidade']\n            };\n            return principles[level] || principles['INICIANTE'];\n        }\n\n        function generateCourseTechniques(level) {\n            const techniques = {\n                'INICIANTE': ['Postura bÃ¡sica', 'Golpes fundamentais', 'Defesas simples', 'MovimentaÃ§Ã£o'],\n                'INTERMEDIARIO': ['CombinaÃ§Ãµes', 'Defesas mÃºltiplas', 'Contra-ataques', 'CenÃ¡rios variados'],\n                'AVANCADO': ['TÃ©cnicas complexas', 'ImprovisaÃ§Ã£o', 'Ensino', 'EspecializaÃ§Ã£o'],\n                'INSTRUTOR': ['DemonstraÃ§Ã£o perfeita', 'CorreÃ§Ã£o tÃ©cnica', 'AdaptaÃ§Ã£o metodolÃ³gica', 'AvaliaÃ§Ã£o']\n            };\n            return techniques[level] || techniques['INICIANTE'];\n        }\n\n        function generateProgressionSystem(level) {\n            return {\n                assessmentFrequency: level === 'INSTRUTOR' ? 'Semanal' : 'Quinzenal',\n                practiceHours: level === 'INICIANTE' ? '2-3 horas/semana' : '4-6 horas/semana',\n                masteryLevel: level === 'INICIANTE' ? '70%' : '85%'\n            };\n        }\n\n        function generateEquipmentList(level) {\n            const equipment = {\n                'INICIANTE': ['Tatame', 'Roupas confortÃ¡veis'],\n                'INTERMEDIARIO': ['Tatame', 'Luvas', 'Protetores'],\n                'AVANCADO': ['Tatame completo', 'Equipamentos variados', 'Material de treino'],\n                'INSTRUTOR': ['Todo equipamento', 'Material didÃ¡tico', 'Recursos audiovisuais']\n            };\n            return equipment[level] || equipment['INICIANTE'];\n        }\n\n        function generateExamSchedule(duration) {\n            const exams = [];\n            for (let week = 6; week <= duration; week += 6) {\n                exams.push(`Semana ${week}: AvaliaÃ§Ã£o de Unidade`);\n            }\n            exams.push(`Semana ${duration}: Exame Final`);\n            return exams;\n        }\n\n        // ==========================================\n        // AI LESSON GENERATOR FUNCTIONALITY\n        // ==========================================\n\n        // Open AI Generator Modal  \n        function openAILessonGenerator() {\n            document.getElementById('aiGeneratorModal').classList.add('active');\n        }\n\n        // Close AI Generator Modal\n        function closeAIGeneratorModal() {\n            document.getElementById('aiGeneratorModal').classList.remove('active');\n        }\n\n        // Generate lesson plan with AI\n        async function generateLessonPlanWithAI() {\n            const formData = {\n                lessonNumber: document.getElementById('aiLessonNumber').value,\n                unit: document.getElementById('aiLessonUnit').value,\n                mainTechnique: document.getElementById('aiMainTechnique').value,\n                objectives: document.getElementById('aiLessonObjectives').value,\n                difficulty: document.getElementById('aiDifficulty').value,\n                specialNeeds: Array.from(document.querySelectorAll('#aiGeneratorForm input[type=\"checkbox\"]:checked')).map(cb => cb.value)\n            };\n\n            if (!formData.lessonNumber || !formData.unit || !formData.mainTechnique) {\n                showToast('Preencha todos os campos obrigatÃ³rios', 'error');\n                return;\n            }\n\n            // Show loading state\n            const generateBtn = document.querySelector('[onclick=\"generateLessonPlanWithAI()\"]');\n            const originalText = generateBtn.innerHTML;\n            generateBtn.innerHTML = '<span>â³</span> Gerando...';\n            generateBtn.disabled = true;\n\n            try {\n                // Simulate AI generation - replace with actual API call\n                await simulateAIGeneration(formData);\n                \n                showToast('Plano de aula gerado com sucesso!', 'success');\n                closeAIGeneratorModal();\n                loadAllLessonPlans(); // Refresh the lesson plans table\n                \n            } catch (error) {\n                console.error('Erro na geraÃ§Ã£o IA:', error);\n                showToast('Erro ao gerar plano de aula', 'error');\n            } finally {\n                // Restore button state\n                generateBtn.innerHTML = originalText;\n                generateBtn.disabled = false;\n            }\n        }\n\n        // ==========================================\n        // CENTRAL RAG SYSTEM - MEMORIA DOS AGENTES IA\n        // ==========================================\n        \n        // Initialize knowledge base and RAG chunks\n        const knowledgeBase = {\n            techniques: [],\n            lessons: [],\n            students: [],\n            courses: []\n        };\n        \n        const ragChunks = [];\n        \n        // Central RAG Service - Memory for all AI agents\n        class CentralRAGService {\n            constructor() {\n                this.knowledgeBase = knowledgeBase;\n                this.ragChunks = ragChunks;\n            }\n            \n            // Universal query method for all AI agents\n            async queryKnowledge(query, context = {}) {\n                try {\n                    const enhancedQuery = this.enhanceQuery(query, context);\n                    const relevantChunks = this.findRelevantChunks(enhancedQuery);\n                    const response = await this.generateResponse(enhancedQuery, relevantChunks, context);\n                    \n                    return {\n                        success: true,\n                        answer: response.answer,\n                        sources: response.sources,\n                        confidence: response.confidence,\n                        chunks: relevantChunks.length,\n                        context: context\n                    };\n                } catch (error) {\n                    console.error('RAG Query Error:', error);\n                    return {\n                        success: false,\n                        answer: 'Desculpe, nÃ£o consegui acessar a base de conhecimento no momento.',\n                        sources: [],\n                        confidence: 0\n                    };\n                }\n            }\n            \n            // Enhance query with context information\n            enhanceQuery(query, context) {\n                let enhancedQuery = query;\n                \n                if (context.martialArt) {\n                    enhancedQuery += ` ${context.martialArt}`;\n                }\n                \n                if (context.level) {\n                    enhancedQuery += ` ${context.level}`;\n                }\n                \n                if (context.module) {\n                    enhancedQuery += ` ${context.module}`;\n                }\n                \n                return enhancedQuery;\n            }\n            \n            // Find relevant chunks using enhanced search\n            findRelevantChunks(query) {\n                const queryWords = query.toLowerCase().split(' ').filter(word => word.length > 2);\n                \n                return this.ragChunks.filter(chunk => {\n                    const chunkWords = chunk.content.toLowerCase();\n                    const titleWords = chunk.sourceTitle.toLowerCase();\n                    const tagWords = chunk.tags.join(' ').toLowerCase();\n                    \n                    const score = queryWords.reduce((acc, word) => {\n                        let points = 0;\n                        if (chunkWords.includes(word)) points += 3;\n                        if (titleWords.includes(word)) points += 5;\n                        if (tagWords.includes(word)) points += 2;\n                        return acc + points;\n                    }, 0);\n                    \n                    chunk.relevanceScore = score;\n                    return score > 0;\n                }).sort((a, b) => b.relevanceScore - a.relevanceScore).slice(0, 5);\n            }\n            \n            // Generate contextualized response\n            async generateResponse(query, chunks, context) {\n                await sleep(300); // Simulate processing\n                \n                if (chunks.length === 0) {\n                    return {\n                        answer: 'NÃ£o encontrei informaÃ§Ãµes especÃ­ficas sobre isso na base de conhecimento. Considere adicionar mais conteÃºdo relacionado.',\n                        sources: [],\n                        confidence: 0\n                    };\n                }\n                \n                const contextualAnswer = this.generateContextualAnswer(query, chunks, context);\n                \n                return {\n                    answer: contextualAnswer,\n                    sources: chunks.map(chunk => ({\n                        title: chunk.sourceTitle,\n                        type: chunk.sourceType,\n                        relevantText: chunk.content.substring(0, 150) + '...',\n                        score: chunk.relevanceScore\n                    })),\n                    confidence: Math.min(95, Math.max(60, chunks[0]?.relevanceScore * 10 || 60))\n                };\n            }\n            \n            // Generate contextual answer based on agent type\n            generateContextualAnswer(query, chunks, context) {\n                const combinedContent = chunks.map(c => c.content).join('\\n\\n');\n                const agentType = context.agent || 'general';\n                \n                // Agent-specific response formatting\n                switch (agentType) {\n                    case 'course-creator':\n                        return this.formatForCourseCreator(query, combinedContent, context);\n                    case 'lesson-planner':\n                        return this.formatForLessonPlanner(query, combinedContent, context);\n                    case 'technique-auditor':\n                        return this.formatForTechniqueAuditor(query, combinedContent, context);\n                    case 'instructor-assistant':\n                        return this.formatForInstructorAssistant(query, combinedContent, context);\n                    case 'student-advisor':\n                        return this.formatForStudentAdvisor(query, combinedContent, context);\n                    default:\n                        return this.formatGeneralResponse(query, combinedContent, context);\n                }\n            }\n            \n            // Agent-specific formatting methods\n            formatForCourseCreator(query, content, context) {\n                return `ðŸ“š **OrientaÃ§Ã£o para CriaÃ§Ã£o de Curso:** Baseado na base de conhecimento, para ${context.martialArt || 'esta arte marcial'} ${context.level || ''}: ${content.substring(0, 300)}. Recomendo seguir essa metodologia na estruturaÃ§Ã£o do curso.`;\n            }\n            \n            formatForLessonPlanner(query, content, context) {\n                return `ðŸ“ **OrientaÃ§Ã£o para Plano de Aula:** Para esta aula especÃ­fica, a base de conhecimento sugere: ${content.substring(0, 250)}. Adapte conforme o nÃ­vel da turma e objetivos especÃ­ficos.`;\n            }\n            \n            formatForTechniqueAuditor(query, content, context) {\n                return `ðŸ” **AnÃ¡lise de TÃ©cnica:** Segundo os padrÃµes documentados: ${content.substring(0, 200)}. Use estes critÃ©rios para validar a qualidade e consistÃªncia das tÃ©cnicas.`;\n            }\n            \n            formatForInstructorAssistant(query, content, context) {\n                return `ðŸ‘¨â€ðŸ« **Suporte ao Instrutor:** Com base na experiÃªncia documentada: ${content.substring(0, 250)}. Esta orientaÃ§Ã£o pode ajudar na conduÃ§Ã£o da aula.`;\n            }\n            \n            formatForStudentAdvisor(query, content, context) {\n                return `ðŸŽ“ **OrientaÃ§Ã£o ao Aluno:** Baseado nas melhores prÃ¡ticas: ${content.substring(0, 250)}. Isso pode ajudar no seu desenvolvimento e progresso.`;\n            }\n            \n            formatGeneralResponse(query, content, context) {\n                return `ðŸ’¡ **InformaÃ§Ã£o da Base de Conhecimento:** ${content.substring(0, 300)}. Esta informaÃ§Ã£o estÃ¡ baseada no conteÃºdo que vocÃª adicionou ao sistema.`;\n            }\n        }\n        \n        // Initialize Central RAG Service\n        const centralRAG = new CentralRAGService();\n        \n        // RAG-Enhanced AI generation for lesson plans\n        async function simulateAIGeneration(formData) {\n            return new Promise(async (resolve) => {\n                try {\n                    // Query Central RAG for lesson planning guidance\n                    const context = {\n                        agent: 'lesson-planner',\n                        unit: formData.unit,\n                        technique: formData.mainTechnique,\n                        module: 'lesson-planning'\n                    };\n                    \n                    const ragQueries = [\n                        `plano aula ${formData.unit} ${formData.mainTechnique}`,\n                        `metodologia ensino ${formData.mainTechnique}`,\n                        `progressÃ£o pedagÃ³gica aquecimento tÃ©cnica`,\n                        'adaptaÃ§Ãµes necessidades especiais ensino'\n                    ];\n                    \n                    let ragEnhancements = [];\n                    \n                    for (const query of ragQueries) {\n                        const ragResponse = await centralRAG.queryKnowledge(query, context);\n                        if (ragResponse.success) {\n                            ragEnhancements.push(ragResponse);\n                        }\n                    }\n                    \n                    setTimeout(() => {\n                        const enhancedPlan = {\n                            lesson: formData.lessonNumber,\n                            unit: formData.unit,\n                            technique: formData.mainTechnique,\n                            objectives: formData.objectives.split(',').map(obj => obj.trim()),\n                            warmup: generateWarmupActivities(formData.unit),\n                            techniques: generateTechniqueActivities(formData.mainTechnique),\n                            simulations: generateSimulationActivities(formData.mainTechnique),\n                            cooldown: generateCooldownActivities(),\n                            adaptations: generateAdaptations(formData.specialNeeds),\n                            equipment: generateEquipmentList(formData.unit),\n                            tacticalModule: generateTacticalModule(formData.unit),\n                            ragEnhancements: ragEnhancements,\n                            enhancedBy: 'Central RAG System'\n                        };\n                        \n                        console.log('ðŸ§  RAG-Enhanced Lesson Plan Generated:', enhancedPlan);\n                        resolve(enhancedPlan);\n                    }, 2000);\n                    \n                } catch (error) {\n                    console.error('Error in RAG-enhanced generation:', error);\n                    resolve();\n                }\n            });\n        }\n\n        // AI Helper Functions for generating lesson plan components\n        function generateWarmupActivities(unit) {\n            const warmups = {\n                'fundamentos': ['Aquecimento articular', 'Corrida leve', 'ExercÃ­cios de coordenaÃ§Ã£o'],\n                'golpes': ['Shadowboxing', 'Aquecimento de punhos', 'Mobilidade de ombros'],\n                'defesas': ['ExercÃ­cios de reaÃ§Ã£o', 'Aquecimento defensivo', 'CoordenaÃ§Ã£o motora'],\n                'avancadas': ['Aquecimento intenso', 'ExercÃ­cios de agilidade', 'PreparaÃ§Ã£o mental'],\n                'integracao': ['Aquecimento completo', 'PreparaÃ§Ã£o para combos', 'ExercÃ­cios de fluidez']\n            };\n            return warmups[unit] || ['Aquecimento geral'];\n        }\n\n        function generateTechniqueActivities(technique) {\n            return [\n                `DemonstraÃ§Ã£o da tÃ©cnica: ${technique}`,\n                'PrÃ¡tica em slow motion',\n                'RepetiÃ§Ãµes com parceiro',\n                'CorreÃ§Ã£o de postura',\n                'PrÃ¡tica em velocidade normal'\n            ];\n        }\n\n        function generateSimulationActivities(technique) {\n            return [\n                `AplicaÃ§Ã£o de ${technique} em cenÃ¡rio simulado`,\n                'VariaÃ§Ãµes de distÃ¢ncia',\n                'CenÃ¡rios de pressÃ£o',\n                'CombinaÃ§Ãµes com outras tÃ©cnicas'\n            ];\n        }\n\n        function generateCooldownActivities() {\n            return [\n                'Alongamento geral',\n                'ExercÃ­cios de respiraÃ§Ã£o',\n                'Relaxamento muscular',\n                'ReflexÃ£o sobre a aula'\n            ];\n        }\n\n        function generateAdaptations(specialNeeds) {\n            const adaptations = {};\n            if (specialNeeds.includes('TEA')) {\n                adaptations.TEA = 'DemonstraÃ§Ã£o visual clara, instruÃ§Ãµes estruturadas, ambiente previsÃ­vel';\n            }\n            if (specialNeeds.includes('TDAH')) {\n                adaptations.TDAH = 'InstruÃ§Ãµes curtas, pausas frequentes, atividades dinÃ¢micas';\n            }\n            if (specialNeeds.includes('MOBILIDADE_REDUZIDA')) {\n                adaptations.MOBILIDADE_REDUZIDA = 'AdaptaÃ§Ãµes para movimentos limitados, exercÃ­cios sentados';\n            }\n            return adaptations;\n        }\n\n        function generateEquipmentList(unit) {\n            const equipment = {\n                'fundamentos': ['Tatame', 'Espelho'],\n                'golpes': ['Tatame', 'Pads de foco', 'Luvas'],\n                'defesas': ['Tatame', 'Equipamentos de proteÃ§Ã£o'],\n                'avancadas': ['Tatame', 'Equipamentos variados', 'ProteÃ§Ãµes'],\n                'integracao': ['Tatame completo', 'Todos equipamentos']\n            };\n            return equipment[unit] || ['Tatame bÃ¡sico'];\n        }\n\n        function generateTacticalModule(unit) {\n            const modules = {\n                'fundamentos': 'RegulaÃ§Ã£o Emocional',\n                'golpes': 'PrecisÃ£o e Timing',\n                'defesas': 'ConsciÃªncia Situacional',\n                'avancadas': 'Tomada de DecisÃ£o',\n                'integracao': 'AplicaÃ§Ã£o PrÃ¡tica'\n            };\n            return modules[unit] || 'Desenvolvimento TÃ¡tico';\n        }\n\n        // Auto-fill technique based on unit selection\n        document.getElementById('aiLessonUnit').addEventListener('change', function() {\n            const unit = this.value;\n            const techniqueField = document.getElementById('aiMainTechnique');\n            const techniques = {\n                'fundamentos': 'Guarda de Boxe',\n                'golpes': 'Jab (Soco Direto)',\n                'defesas': 'Defesa 360Â° Interior',\n                'avancadas': 'Defesa contra Agarramento',\n                'integracao': 'Combo Jab-Cross-Hook'\n            };\n            if (techniques[unit]) {\n                techniqueField.value = techniques[unit];\n            }\n        });\n\n        // ==========================================\n        // SISTEMA DE AUDITORIA IA\n        // ==========================================\n\n        let currentTechniqueForAudit = null;\n        let currentVideoFile = null;\n\n        // Open audit panel\n        function openTechniqueAuditPanel() {\n            document.getElementById('auditPanel').style.display = 'block';\n            updateAuditStats();\n        }\n\n        // Close audit panel\n        function closeAuditPanel() {\n            document.getElementById('auditPanel').style.display = 'none';\n        }\n\n        // Run full audit with IA\n        async function runFullAudit() {\n            const auditBtn = document.querySelector('#auditPanel .btn-primary');\n            const originalText = auditBtn.innerHTML;\n            \n            auditBtn.innerHTML = '<span>ðŸ¤–</span> Analisando...';\n            auditBtn.disabled = true;\n\n            try {\n                // Simulate IA audit process\n                await simulateAIAudit();\n                \n                showToast('Auditoria IA concluÃ­da com sucesso!', 'success');\n                \n            } catch (error) {\n                console.error('Erro na auditoria:', error);\n                showToast('Erro durante a auditoria', 'error');\n            } finally {\n                auditBtn.innerHTML = originalText;\n                auditBtn.disabled = false;\n            }\n        }\n\n        // Simulate AI audit process\n        async function simulateAIAudit() {\n            const techniques = allTechniques.length > 0 ? allTechniques : generateMockTechniques();\n            auditResults = [];\n            \n            // Step 1: Detect duplicates\n            document.getElementById('auditResults').innerHTML = `\n                <div style=\"color: #F59E0B; padding: 1rem;\">\n                    <div style=\"font-size: 1.2rem; margin-bottom: 0.5rem;\">ðŸ” Etapa 1/3: Detectando Duplicatas...</div>\n                    <div class=\"progress-bar\" style=\"background: #374151; height: 8px; border-radius: 4px; overflow: hidden;\">\n                        <div style=\"background: #F59E0B; height: 100%; width: 33%; transition: width 0.3s;\"></div>\n                    </div>\n                </div>\n            `;\n            await sleep(1000);\n            \n            // Step 2: Analyze quality\n            document.getElementById('auditResults').innerHTML = `\n                <div style=\"color: #3B82F6; padding: 1rem;\">\n                    <div style=\"font-size: 1.2rem; margin-bottom: 0.5rem;\">ðŸŽ¯ Etapa 2/3: Analisando Qualidade...</div>\n                    <div class=\"progress-bar\" style=\"background: #374151; height: 8px; border-radius: 4px; overflow: hidden;\">\n                        <div style=\"background: #3B82F6; height: 100%; width: 66%; transition: width 0.3s;\"></div>\n                    </div>\n                </div>\n            `;\n            await sleep(1000);\n            \n            // Step 3: Generate results\n            document.getElementById('auditResults').innerHTML = `\n                <div style=\"color: #10B981; padding: 1rem;\">\n                    <div style=\"font-size: 1.2rem; margin-bottom: 0.5rem;\">ðŸ“Š Etapa 3/3: Gerando RelatÃ³rio...</div>\n                    <div class=\"progress-bar\" style=\"background: #374151; height: 8px; border-radius: 4px; overflow: hidden;\">\n                        <div style=\"background: #10B981; height: 100%; width: 100%; transition: width 0.3s;\"></div>\n                    </div>\n                </div>\n            `;\n            await sleep(1000);\n            \n            // Generate audit results with RAG enhancement\n            const duplicateResults = detectDuplicates(techniques);\n            const qualityResults = analyzeQualityWithRAG(techniques, auditGuidance);\n            \n            auditResults = [...duplicateResults, ...qualityResults];\n            \n            // Add RAG insights to results\n            if (auditGuidance.success) {\n                auditResults.unshift({\n                    type: 'RAG_INSIGHT',\n                    technique: null,\n                    severity: 'INFO',\n                    message: `ðŸ§  Base de Conhecimento: ${auditGuidance.answer}`,\n                    confidence: auditGuidance.confidence,\n                    sources: auditGuidance.sources\n                });\n            }\n            \n            displayAuditResults();\n            updateAuditStats();\n        }\n\n        // Detect duplicate techniques\n        function detectDuplicates(techniques) {\n            const duplicates = [];\n            const seen = new Map();\n            \n            techniques.forEach(tech => {\n                const key = `${tech.martialArt}-${tech.category}-${tech.name.toLowerCase()}`;\n                if (seen.has(key)) {\n                    const original = seen.get(key);\n                    duplicates.push({\n                        type: 'DUPLICATE',\n                        technique: tech,\n                        originalTechnique: original,\n                        severity: 'HIGH',\n                        message: `TÃ©cnica \"${tech.name}\" parece ser duplicata de \"${original.name}\"`\n                    });\n                } else {\n                    seen.set(key, tech);\n                }\n                \n                // Check for similar names (fuzzy matching)\n                techniques.forEach(otherTech => {\n                    if (tech.id !== otherTech.id && tech.martialArt === otherTech.martialArt) {\n                        const similarity = calculateSimilarity(tech.name, otherTech.name);\n                        if (similarity > 0.8) {\n                            duplicates.push({\n                                type: 'SIMILAR',\n                                technique: tech,\n                                originalTechnique: otherTech,\n                                severity: 'MEDIUM',\n                                similarity: similarity,\n                                message: `TÃ©cnica \"${tech.name}\" Ã© muito similar a \"${otherTech.name}\" (${Math.round(similarity * 100)}% similar)`\n                            });\n                        }\n                    }\n                });\n            });\n            \n            return duplicates;\n        }\n\n        // Analyze technique quality\n        function analyzeQuality(techniques) {\n            const qualityIssues = [];\n            \n            techniques.forEach(tech => {\n                let score = 100;\n                const issues = [];\n                \n                // Check name length\n                if (tech.name.length < 3) {\n                    score -= 20;\n                    issues.push('Nome muito curto');\n                }\n                \n                // Check description quality\n                if (!tech.description || tech.description.length < 10) {\n                    score -= 15;\n                    issues.push('DescriÃ§Ã£o insuficiente');\n                }\n                \n                // Check prerequisites logic\n                if (tech.level === 'ADVANCED' && !tech.prerequisites) {\n                    score -= 10;\n                    issues.push('TÃ©cnica avanÃ§ada sem prÃ©-requisitos');\n                }\n                \n                // Check martial art consistency\n                if (tech.martialArt === 'BOXING' && tech.category === 'GRAPPLING') {\n                    score -= 25;\n                    issues.push('Incompatibilidade: Boxe nÃ£o inclui tÃ©cnicas de grappling');\n                }\n                \n                // Check video presence for important techniques\n                if (tech.level === 'BEGINNER' && !tech.videoUrl) {\n                    score -= 5;\n                    issues.push('TÃ©cnica bÃ¡sica sem vÃ­deo demonstrativo');\n                }\n                \n                if (score < 80 || issues.length > 0) {\n                    qualityIssues.push({\n                        type: 'QUALITY',\n                        technique: tech,\n                        severity: score < 60 ? 'HIGH' : score < 80 ? 'MEDIUM' : 'LOW',\n                        score: score,\n                        issues: issues,\n                        message: `Problemas de qualidade detectados (Score: ${score}/100)`\n                    });\n                }\n            });\n            \n            return qualityIssues;\n        }\n\n        // Calculate name similarity\n        function calculateSimilarity(str1, str2) {\n            const len1 = str1.length;\n            const len2 = str2.length;\n            const matrix = Array(len2 + 1).fill(null).map(() => Array(len1 + 1).fill(null));\n            \n            for (let i = 0; i <= len1; i++) matrix[0][i] = i;\n            for (let j = 0; j <= len2; j++) matrix[j][0] = j;\n            \n            for (let j = 1; j <= len2; j++) {\n                for (let i = 1; i <= len1; i++) {\n                    const indicator = str1[i - 1] === str2[j - 1] ? 0 : 1;\n                    matrix[j][i] = Math.min(\n                        matrix[j][i - 1] + 1,\n                        matrix[j - 1][i] + 1,\n                        matrix[j - 1][i - 1] + indicator\n                    );\n                }\n            }\n            \n            return 1 - matrix[len2][len1] / Math.max(len1, len2);\n        }\n\n        // Display audit results\n        function displayAuditResults() {\n            const resultsDiv = document.getElementById('auditResults');\n            \n            if (auditResults.length === 0) {\n                resultsDiv.innerHTML = `\n                    <div style=\"text-align: center; color: #10B981; padding: 2rem;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">âœ…</div>\n                        <div style=\"font-size: 1.2rem; margin-bottom: 0.5rem;\">Auditoria ConcluÃ­da!</div>\n                        <div>Nenhum problema detectado. Todas as tÃ©cnicas estÃ£o em ordem.</div>\n                    </div>\n                `;\n                return;\n            }\n            \n            const duplicates = auditResults.filter(r => r.type === 'DUPLICATE' || r.type === 'SIMILAR');\n            const qualityIssues = auditResults.filter(r => r.type === 'QUALITY');\n            \n            let html = '';\n            \n            if (duplicates.length > 0) {\n                html += `\n                    <div style=\"margin-bottom: 2rem;\">\n                        <h3 style=\"color: #EF4444; margin-bottom: 1rem;\">ðŸ”´ Duplicatas Detectadas (${duplicates.length})</h3>\n                        ${duplicates.map(duplicate => `\n                            <div class=\"audit-item\" style=\"background: rgba(239, 68, 68, 0.1); border-left: 4px solid #EF4444; padding: 1rem; margin-bottom: 1rem; border-radius: 8px;\">\n                                <div style=\"display: flex; justify-content: between; align-items: start;\">\n                                    <div style=\"flex: 1;\">\n                                        <div style=\"font-weight: bold; color: #F8FAFC; margin-bottom: 0.5rem;\">\n                                            ${duplicate.technique.name} (${duplicate.technique.martialArt})\n                                        </div>\n                                        <div style=\"color: #CBD5E1; margin-bottom: 0.5rem;\">${duplicate.message}</div>\n                                        <div style=\"font-size: 0.9rem; color: #9CA3AF;\">\n                                            Severity: ${duplicate.severity}\n                                            ${duplicate.similarity ? ` | Similaridade: ${Math.round(duplicate.similarity * 100)}%` : ''}\n                                        </div>\n                                    </div>\n                                    <button onclick=\"auditTechnique('${duplicate.technique.id}')\" \n                                            style=\"background: #3B82F6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;\">\n                                        ðŸ” Revisar\n                                    </button>\n                                </div>\n                            </div>\n                        `).join('')}\n                    </div>\n                `;\n            }\n            \n            if (qualityIssues.length > 0) {\n                html += `\n                    <div style=\"margin-bottom: 2rem;\">\n                        <h3 style=\"color: #F59E0B; margin-bottom: 1rem;\">âš ï¸ Problemas de Qualidade (${qualityIssues.length})</h3>\n                        ${qualityIssues.map(issue => `\n                            <div class=\"audit-item\" style=\"background: rgba(245, 158, 11, 0.1); border-left: 4px solid #F59E0B; padding: 1rem; margin-bottom: 1rem; border-radius: 8px;\">\n                                <div style=\"display: flex; justify-content: between; align-items: start;\">\n                                    <div style=\"flex: 1;\">\n                                        <div style=\"font-weight: bold; color: #F8FAFC; margin-bottom: 0.5rem;\">\n                                            ${issue.technique.name} (Score: ${issue.score}/100)\n                                        </div>\n                                        <div style=\"color: #CBD5E1; margin-bottom: 0.5rem;\">\n                                            Problemas: ${issue.issues.join(', ')}\n                                        </div>\n                                        <div style=\"font-size: 0.9rem; color: #9CA3AF;\">\n                                            Severity: ${issue.severity}\n                                        </div>\n                                    </div>\n                                    <button onclick=\"auditTechnique('${issue.technique.id}')\" \n                                            style=\"background: #3B82F6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;\">\n                                        ðŸ” Revisar\n                                    </button>\n                                </div>\n                            </div>\n                        `).join('')}\n                    </div>\n                `;\n            }\n            \n            resultsDiv.innerHTML = html;\n        }\n\n        // Update audit statistics\n        function updateAuditStats() {\n            const techniques = allTechniques.length > 0 ? allTechniques : generateMockTechniques();\n            \n            const approved = techniques.filter(t => t.status === 'APPROVED').length;\n            const pending = techniques.filter(t => t.status === 'PENDING').length;\n            const duplicates = auditResults.filter(r => r.type === 'DUPLICATE' || r.type === 'SIMILAR').length;\n            const qualityIssues = auditResults.filter(r => r.type === 'QUALITY').length;\n            \n            document.getElementById('approvedCount').textContent = approved;\n            document.getElementById('pendingCount').textContent = pending;\n            document.getElementById('duplicatesCount').textContent = duplicates;\n            document.getElementById('qualityIssuesCount').textContent = qualityIssues;\n        }\n\n        // Audit specific technique\n        function auditTechnique(techniqueId) {\n            const technique = allTechniques.find(t => t.id === techniqueId);\n            if (!technique) return;\n            \n            currentTechniqueForAudit = technique;\n            \n            const auditData = auditResults.find(r => r.technique.id === techniqueId);\n            \n            document.getElementById('techniqueAuditContent').innerHTML = `\n                <div style=\"display: grid; gap: 1.5rem;\">\n                    <!-- Technique Info -->\n                    <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px;\">\n                        <h3 style=\"color: #3B82F6; margin-bottom: 1rem;\">ðŸ“‹ InformaÃ§Ãµes da TÃ©cnica</h3>\n                        <div style=\"display: grid; gap: 0.5rem;\">\n                            <div><strong>Nome:</strong> ${technique.name}</div>\n                            <div><strong>Arte Marcial:</strong> ${getMartialArtName(technique.martialArt)}</div>\n                            <div><strong>Categoria:</strong> ${getCategoryName(technique.category)}</div>\n                            <div><strong>NÃ­vel:</strong> ${getLevelName(technique.level)}</div>\n                            <div><strong>Status:</strong> <span style=\"color: ${getStatusColor(technique.status)}\">${getStatusName(technique.status)}</span></div>\n                        </div>\n                    </div>\n                    \n                    <!-- Audit Results -->\n                    ${auditData ? `\n                        <div style=\"background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #EF4444;\">\n                            <h3 style=\"color: #EF4444; margin-bottom: 1rem;\">âš ï¸ Problemas Detectados</h3>\n                            <div style=\"color: #CBD5E1;\">${auditData.message}</div>\n                            ${auditData.issues ? `\n                                <div style=\"margin-top: 1rem;\">\n                                    <strong>Detalhes:</strong>\n                                    <ul style=\"margin-top: 0.5rem; padding-left: 1rem;\">\n                                        ${auditData.issues.map(issue => `<li>${issue}</li>`).join('')}\n                                    </ul>\n                                </div>\n                            ` : ''}\n                        </div>\n                    ` : ''}\n                    \n                    <!-- Actions -->\n                    <div style=\"background: rgba(55, 65, 81, 0.3); padding: 1rem; border-radius: 8px;\">\n                        <h3 style=\"color: #F8FAFC; margin-bottom: 1rem;\">ðŸ› ï¸ AÃ§Ãµes DisponÃ­veis</h3>\n                        <div style=\"display: grid; gap: 1rem;\">\n                            <button onclick=\"openVideoUpload('${technique.id}')\" \n                                    style=\"background: #8B5CF6; color: white; border: none; padding: 0.75rem 1rem; border-radius: 6px; cursor: pointer;\">\n                                ðŸ“¹ Adicionar VÃ­deo\n                            </button>\n                            <button onclick=\"editTechniqueDetails('${technique.id}')\" \n                                    style=\"background: #F59E0B; color: white; border: none; padding: 0.75rem 1rem; border-radius: 6px; cursor: pointer;\">\n                                âœï¸ Editar Detalhes\n                            </button>\n                        </div>\n                    </div>\n                    \n                    <!-- Video Section -->\n                    ${technique.videoUrl ? `\n                        <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px;\">\n                            <h3 style=\"color: #10B981; margin-bottom: 1rem;\">ðŸ“¹ VÃ­deo Atual</h3>\n                            <div style=\"color: #CBD5E1;\">VÃ­deo jÃ¡ carregado: ${technique.videoUrl}</div>\n                        </div>\n                    ` : `\n                        <div style=\"background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px;\">\n                            <h3 style=\"color: #F59E0B; margin-bottom: 1rem;\">ðŸ“¹ VÃ­deo Pendente</h3>\n                            <div style=\"color: #CBD5E1;\">Nenhum vÃ­deo carregado para esta tÃ©cnica</div>\n                        </div>\n                    `}\n                </div>\n            `;\n            \n            document.getElementById('techniqueAuditModal').classList.add('active');\n        }\n\n        // Approve technique\n        function approveTechnique() {\n            if (!currentTechniqueForAudit) return;\n            \n            currentTechniqueForAudit.status = 'APPROVED';\n            currentTechniqueForAudit.lastAuditAt = new Date().toISOString();\n            \n            // Remove from audit results\n            auditResults = auditResults.filter(r => r.technique.id !== currentTechniqueForAudit.id);\n            \n            updateAuditStats();\n            displayAuditResults();\n            closeTechniqueAuditModal();\n            \n            showToast('TÃ©cnica aprovada com sucesso!', 'success');\n        }\n\n        // Reject technique\n        function rejectTechnique() {\n            if (!currentTechniqueForAudit) return;\n            \n            currentTechniqueForAudit.status = 'REJECTED';\n            currentTechniqueForAudit.lastAuditAt = new Date().toISOString();\n            \n            updateAuditStats();\n            displayAuditResults();\n            closeTechniqueAuditModal();\n            \n            showToast('TÃ©cnica rejeitada', 'warning');\n        }\n\n        // Edit technique\n        function editTechnique() {\n            if (!currentTechniqueForAudit) return;\n            \n            // Open technique for editing\n            closeTechniqueAuditModal();\n            openTechniquesManager();\n            \n            // Simulate finding and editing the technique\n            showToast('Abrindo tÃ©cnica para ediÃ§Ã£o...', 'info');\n        }\n\n        // Close audit modal\n        function closeTechniqueAuditModal() {\n            document.getElementById('techniqueAuditModal').classList.remove('active');\n            currentTechniqueForAudit = null;\n        }\n\n        // ==========================================\n        // SISTEMA DE VÃDEOS\n        // ==========================================\n\n        // Open video upload\n        function openVideoUpload(techniqueId) {\n            const technique = allTechniques.find(t => t.id === techniqueId);\n            if (!technique) return;\n            \n            currentTechniqueForAudit = technique;\n            \n            document.getElementById('videoTechniqueInfo').innerHTML = `\n                <h4 style=\"color: #3B82F6; margin-bottom: 0.5rem;\">ðŸ“‹ TÃ©cnica: ${technique.name}</h4>\n                <div style=\"color: #CBD5E1; font-size: 0.9rem;\">\n                    ${getMartialArtName(technique.martialArt)} â€¢ ${getCategoryName(technique.category)} â€¢ ${getLevelName(technique.level)}\n                </div>\n            `;\n            \n            document.getElementById('videoUploadModal').classList.add('active');\n        }\n\n        // Handle video upload\n        function handleVideoUpload(event) {\n            const file = event.target.files[0];\n            if (!file) return;\n            \n            // Validate file type\n            const validTypes = ['video/mp4', 'video/avi', 'video/mov', 'video/quicktime'];\n            if (!validTypes.includes(file.type)) {\n                showToast('Formato de vÃ­deo nÃ£o suportado', 'error');\n                return;\n            }\n            \n            // Validate file size (100MB)\n            if (file.size > 100 * 1024 * 1024) {\n                showToast('Arquivo muito grande. MÃ¡ximo: 100MB', 'error');\n                return;\n            }\n            \n            currentVideoFile = file;\n            \n            // Show preview\n            const preview = document.getElementById('videoPreview');\n            const videoUrl = URL.createObjectURL(file);\n            \n            preview.innerHTML = `\n                <div style=\"text-align: left; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 1px solid #10B981;\">\n                    <div style=\"color: #10B981; font-weight: bold; margin-bottom: 0.5rem;\">ðŸ“¹ VÃ­deo Selecionado:</div>\n                    <div style=\"color: #F8FAFC; margin-bottom: 0.5rem;\">${file.name}</div>\n                    <div style=\"color: #9CA3AF; font-size: 0.8rem; margin-bottom: 1rem;\">${formatFileSize(file.size)}</div>\n                    <video controls style=\"width: 100%; max-width: 300px; border-radius: 6px;\">\n                        <source src=\"${videoUrl}\" type=\"${file.type}\">\n                        Seu navegador nÃ£o suporta o elemento de vÃ­deo.\n                    </video>\n                </div>\n            `;\n            \n            showToast('VÃ­deo carregado e pronto para upload!', 'success');\n        }\n\n        // Upload video\n        async function uploadVideo() {\n            if (!currentVideoFile || !currentTechniqueForAudit) {\n                showToast('Selecione um vÃ­deo primeiro', 'error');\n                return;\n            }\n            \n            const uploadBtn = document.getElementById('uploadVideoBtn');\n            const originalText = uploadBtn.innerHTML;\n            \n            uploadBtn.innerHTML = '<span>â³</span> Fazendo Upload...';\n            uploadBtn.disabled = true;\n            \n            try {\n                // Simulate upload process\n                await sleep(2000);\n                \n                // Update technique with video URL (simulated)\n                const videoUrl = `videos/${currentTechniqueForAudit.id}/${currentVideoFile.name}`;\n                currentTechniqueForAudit.videoUrl = videoUrl;\n                currentTechniqueForAudit.videoDescription = document.getElementById('videoDescription').value;\n                \n                showToast('VÃ­deo carregado com sucesso!', 'success');\n                closeVideoUploadModal();\n                \n                // Update audit stats\n                updateAuditStats();\n                \n            } catch (error) {\n                console.error('Erro no upload:', error);\n                showToast('Erro durante o upload', 'error');\n            } finally {\n                uploadBtn.innerHTML = originalText;\n                uploadBtn.disabled = false;\n            }\n        }\n\n        // Close video upload modal\n        function closeVideoUploadModal() {\n            document.getElementById('videoUploadModal').classList.remove('active');\n            currentVideoFile = null;\n            document.getElementById('videoPreview').innerHTML = '';\n            document.getElementById('videoDescription').value = '';\n        }\n\n        // ==========================================\n        // UTILITY FUNCTIONS FOR AUDIT\n        // ==========================================\n\n        function getStatusColor(status) {\n            const colors = {\n                'APPROVED': '#10B981',\n                'PENDING': '#F59E0B',\n                'REJECTED': '#EF4444'\n            };\n            return colors[status] || '#6B7280';\n        }\n\n        function getStatusName(status) {\n            const names = {\n                'APPROVED': 'Aprovada',\n                'PENDING': 'Pendente',\n                'REJECTED': 'Rejeitada'\n            };\n            return names[status] || status;\n        }\n\n        function sleep(ms) {\n            return new Promise(resolve => setTimeout(resolve, ms));\n        }\n\n        // ==========================================\n        // SISTEMA RAG - BASE DE CONHECIMENTO\n        // ==========================================\n\n        // Initialize knowledge base with sample data\n        function initializeKnowledgeBase() {\n            // Try to load from localStorage first\n            const hasStoredData = loadKnowledgeBaseFromStorage();\n            \n            // If no stored data, initialize with sample data\n            if (!hasStoredData) {\n                knowledgeBase = [\n                {\n                    id: '1',\n                    type: 'DOCUMENT',\n                    title: 'Manual Krav Maga Faixa Branca',\n                    content: 'O Krav Maga Ã© um sistema de defesa pessoal desenvolvido para as forÃ§as de defesa israelenses. PrincÃ­pios fundamentais: 1) Evitar conflitos sempre que possÃ­vel, 2) Neutralizar ameaÃ§as rapidamente, 3) Usar movimentos naturais e instintivos...',\n                    tags: ['krav-maga', 'defesa-pessoal', 'iniciante', 'principios'],\n                    category: 'METHODOLOGY',\n                    martialArt: 'KRAV_MAGA',\n                    level: 'BEGINNER',\n                    createdAt: new Date().toISOString(),\n                    chunked: true\n                },\n                {\n                    id: '2',\n                    type: 'TEXT',\n                    title: 'ProgressÃ£o MetodolÃ³gica para Iniciantes',\n                    content: 'A progressÃ£o no Krav Maga deve seguir uma ordem lÃ³gica: 1) ConsciÃªncia situacional e prevenÃ§Ã£o, 2) Posturas e movimentos bÃ¡sicos, 3) TÃ©cnicas de golpes bÃ¡sicos, 4) Defesas contra ataques simples, 5) CombinaÃ§Ãµes e fluxo...',\n                    tags: ['progressao', 'metodologia', 'ensino'],\n                    category: 'PROGRESSION',\n                    martialArt: 'KRAV_MAGA',\n                    level: 'BEGINNER',\n                    createdAt: new Date().toISOString(),\n                    chunked: true\n                },\n                {\n                    id: '3',\n                    type: 'LINK',\n                    title: 'Fundamentos da BiomecÃ¢nica no Krav Maga',\n                    content: 'A biomecÃ¢nica no Krav Maga enfatiza o uso eficiente do corpo para maximizar a forÃ§a enquanto minimiza o gasto energÃ©tico. Conceitos chave incluem: transferÃªncia de peso, rotaÃ§Ã£o de quadril, alinhamento corporal...',\n                    url: 'https://exemplo.com/biomecanica-krav-maga',\n                    tags: ['biomecanica', 'tecnica', 'fundamentos'],\n                    category: 'THEORY',\n                    martialArt: 'KRAV_MAGA',\n                    level: 'INTERMEDIATE',\n                    createdAt: new Date().toISOString(),\n                    chunked: true\n                }\n                ];\n                \n                // Generate chunks for RAG\n                generateRAGChunks();\n                \n                // Save initial data to localStorage\n                saveKnowledgeBaseToStorage();\n            }\n        }\n\n        // Generate chunks for semantic search\n        function generateRAGChunks() {\n            ragChunks = [];\n            let chunkId = 1;\n            \n            knowledgeBase.forEach(item => {\n                // Split content into chunks of ~200 words\n                const words = item.content.split(' ');\n                const chunkSize = 200;\n                \n                for (let i = 0; i < words.length; i += chunkSize) {\n                    const chunkWords = words.slice(i, i + chunkSize);\n                    const chunkContent = chunkWords.join(' ');\n                    \n                    ragChunks.push({\n                        id: chunkId++,\n                        sourceId: item.id,\n                        sourceType: item.type,\n                        sourceTitle: item.title,\n                        content: chunkContent,\n                        tags: item.tags,\n                        category: item.category,\n                        martialArt: item.martialArt,\n                        level: item.level,\n                        embedding: generateMockEmbedding(chunkContent) // Simulated embedding\n                    });\n                }\n            });\n            \n            // Save chunks to localStorage after generation\n            saveKnowledgeBaseToStorage();\n        }\n\n        // Generate mock embedding (in real implementation, use actual AI embedding)\n        function generateMockEmbedding(text) {\n            // This is a simplified mock - in real implementation, use OpenAI embeddings or similar\n            const words = text.toLowerCase().split(' ');\n            const vector = new Array(384).fill(0); // 384-dimensional vector\n            \n            words.forEach((word, index) => {\n                const hash = word.split('').reduce((a, b) => {\n                    a = ((a << 5) - a) + b.charCodeAt(0);\n                    return a & a;\n                }, 0);\n                vector[Math.abs(hash) % 384] += 1;\n            });\n            \n            // Normalize vector\n            const magnitude = Math.sqrt(vector.reduce((sum, val) => sum + val * val, 0));\n            return vector.map(val => magnitude > 0 ? val / magnitude : 0);\n        }\n\n        // Open knowledge base panel\n        function openKnowledgeBase() {\n            document.getElementById('knowledgeBasePanel').style.display = 'block';\n            if (knowledgeBase.length === 0) {\n                initializeKnowledgeBase();\n            }\n            updateKnowledgeBaseStats();\n            displayKnowledgeContent();\n        }\n\n        // Close knowledge base panel\n        function closeKnowledgeBase() {\n            document.getElementById('knowledgeBasePanel').style.display = 'none';\n        }\n\n        // Update knowledge base statistics\n        function updateKnowledgeBaseStats() {\n            const documents = knowledgeBase.filter(item => item.type === 'DOCUMENT').length;\n            const texts = knowledgeBase.filter(item => item.type === 'TEXT').length;\n            const links = knowledgeBase.filter(item => item.type === 'LINK').length;\n            const chunks = ragChunks.length;\n            \n            document.getElementById('documentsCount').textContent = documents;\n            document.getElementById('textsCount').textContent = texts;\n            document.getElementById('linksCount').textContent = links;\n            document.getElementById('chunksCount').textContent = chunks;\n            \n            const lastIndexed = knowledgeBase.length > 0 ? 'Agora mesmo' : 'Nunca';\n            document.getElementById('lastIndexed').textContent = lastIndexed;\n        }\n\n        // Display knowledge content\n        function displayKnowledgeContent() {\n            const contentDiv = document.getElementById('knowledgeContent');\n            \n            if (knowledgeBase.length === 0) {\n                contentDiv.innerHTML = `\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                        <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">ðŸ§ </div>\n                        Sua base de conhecimento estÃ¡ vazia. Clique em \"Adicionar ConteÃºdo\" para comeÃ§ar.\n                    </div>\n                `;\n                return;\n            }\n            \n            const groupedByType = {\n                'DOCUMENT': knowledgeBase.filter(item => item.type === 'DOCUMENT'),\n                'TEXT': knowledgeBase.filter(item => item.type === 'TEXT'),\n                'LINK': knowledgeBase.filter(item => item.type === 'LINK'),\n                'YOUTUBE': knowledgeBase.filter(item => item.type === 'YOUTUBE')\n            };\n            \n            let html = '';\n            \n            Object.entries(groupedByType).forEach(([type, items]) => {\n                if (items.length === 0) return;\n                \n                const typeInfo = {\n                    'DOCUMENT': { icon: 'ðŸ“„', name: 'Documentos', color: '#8B5CF6' },\n                    'TEXT': { icon: 'ðŸ“', name: 'Textos', color: '#10B981' },\n                    'LINK': { icon: 'ðŸ”—', name: 'Links', color: '#3B82F6' },\n                    'YOUTUBE': { icon: 'ðŸ“º', name: 'YouTube', color: '#EF4444' }\n                };\n                \n                html += `\n                    <div style=\"margin-bottom: 2rem;\">\n                        <h3 style=\"color: ${typeInfo[type].color}; margin-bottom: 1rem;\">${typeInfo[type].icon} ${typeInfo[type].name} (${items.length})</h3>\n                        ${items.map(item => `\n                            <div style=\"background: rgba(55, 65, 81, 0.3); padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border-left: 4px solid ${typeInfo[type].color};\">\n                                <div style=\"display: flex; justify-content: space-between; align-items: start;\">\n                                    <div style=\"flex: 1;\">\n                                        <div style=\"font-weight: bold; color: #F8FAFC; margin-bottom: 0.5rem;\">${item.title}</div>\n                                        <div style=\"color: #CBD5E1; margin-bottom: 0.5rem; font-size: 0.9rem;\">\n                                            ${item.content.length > 100 ? item.content.substring(0, 100) + '...' : item.content}\n                                        </div>\n                                        <div style=\"display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;\">\n                                            ${item.tags.map(tag => `\n                                                <span style=\"background: ${typeInfo[type].color}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;\">\n                                                    ${tag}\n                                                </span>\n                                            `).join('')}\n                                        </div>\n                                        <div style=\"font-size: 0.8rem; color: #9CA3AF;\">\n                                            ${getMartialArtName(item.martialArt)} â€¢ ${item.category} â€¢ ${item.level}\n                                        </div>\n                                    </div>\n                                    <div style=\"display: flex; gap: 0.5rem;\">\n                                        <button onclick=\"editKnowledgeItem('${item.id}')\" \n                                                style=\"background: #F59E0B; color: white; border: none; padding: 0.5rem; border-radius: 4px; cursor: pointer;\">\n                                            âœï¸\n                                        </button>\n                                        <button onclick=\"deleteKnowledgeItem('${item.id}')\" \n                                                style=\"background: #EF4444; color: white; border: none; padding: 0.5rem; border-radius: 4px; cursor: pointer;\">\n                                            ðŸ—‘ï¸\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        `).join('')}\n                    </div>\n                `;\n            });\n            \n            contentDiv.innerHTML = html;\n        }\n\n        // Open document uploader\n        function openDocumentUploader() {\n            console.log('ðŸ“Ž Abrindo modal de upload...');\n            const modal = document.getElementById('documentUploaderModal');\n            if (modal) {\n                modal.classList.add('active');\n                switchUploadTab('documents');\n                console.log('âœ… Modal de upload aberto com sucesso!');\n            } else {\n                console.error('âŒ Modal documentUploaderModal nÃ£o encontrado!');\n            }\n        }\n\n        // Close document uploader\n        function closeDocumentUploader() {\n            document.getElementById('documentUploaderModal').classList.remove('active');\n            resetUploadForm();\n        }\n\n        // Switch upload tab\n        function switchUploadTab(tabName) {\n            currentUploadTab = tabName;\n            \n            // Update tab buttons\n            document.querySelectorAll('.upload-tab').forEach(tab => {\n                tab.classList.remove('active');\n            });\n            document.getElementById(tabName + 'Tab').classList.add('active');\n            \n            // Show/hide sections\n            document.querySelectorAll('.upload-section').forEach(section => {\n                section.style.display = 'none';\n            });\n            document.getElementById(tabName + 'Section').style.display = 'block';\n        }\n\n        // Handle document upload\n        function handleDocumentUpload(event) {\n            const files = Array.from(event.target.files);\n            uploadedDocuments = files;\n            \n            displayDocumentPreview(files);\n        }\n\n        // Display document preview\n        function displayDocumentPreview(files) {\n            const preview = document.getElementById('documentPreview');\n            \n            if (files.length === 0) {\n                preview.innerHTML = '';\n                return;\n            }\n            \n            preview.innerHTML = `\n                <div style=\"text-align: left; margin-top: 1rem; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 8px; border: 1px solid #8B5CF6;\">\n                    <div style=\"color: #8B5CF6; font-weight: bold; margin-bottom: 0.5rem;\">ðŸ“Ž ${files.length} Arquivo(s) Selecionado(s):</div>\n                    ${files.map(file => `\n                        <div style=\"color: #F8FAFC; margin-bottom: 0.25rem;\">\n                            ${getFileIcon(file.name)} ${file.name} (${formatFileSize(file.size)})\n                        </div>\n                    `).join('')}\n                </div>\n            `;\n        }\n\n        // Upload content to knowledge base\n        async function uploadContent() {\n            console.log('ðŸš€ Iniciando upload de conteÃºdo...');\n            const uploadBtn = document.getElementById('uploadContentBtn');\n            const originalText = uploadBtn.innerHTML;\n            \n            uploadBtn.innerHTML = '<span>â³</span> Processando...';\n            uploadBtn.disabled = true;\n            \n            try {\n                console.log('ðŸ“Š Tab atual:', currentUploadTab);\n                let newItems = [];\n                \n                switch (currentUploadTab) {\n                    case 'documents':\n                        console.log('ðŸ“„ Processando documentos...');\n                        newItems = await processDocuments();\n                        break;\n                    case 'text':\n                        console.log('ðŸ“ Processando texto...');\n                        newItems = await processTextInput();\n                        break;\n                    case 'links':\n                        console.log('ðŸ”— Processando links...');\n                        newItems = await processLink();\n                        break;\n                    case 'youtube':\n                        console.log('ðŸ“º Processando YouTube...');\n                        newItems = await processYouTube();\n                        break;\n                }\n                \n                // Add to knowledge base\n                console.log('ðŸ“š Itens processados:', newItems.length);\n                console.log('ðŸ“ Base antes:', knowledgeBase.length);\n                \n                knowledgeBase.push(...newItems);\n                \n                console.log('ðŸ“ Base depois:', knowledgeBase.length);\n                \n                // Regenerate chunks\n                console.log('âš¡ Gerando chunks RAG...');\n                generateRAGChunks();\n                \n                // Save to localStorage (generateRAGChunks already saves, but being explicit)\n                console.log('ðŸ’¾ Salvando no localStorage...');\n                saveKnowledgeBaseToStorage();\n                \n                // Update display\n                console.log('ðŸ”„ Atualizando interface...');\n                updateKnowledgeBaseStats();\n                displayKnowledgeContent();\n                \n                // Also update main section if it's open\n                const currentSection = document.querySelector('.content-section:not([style*=\"display: none\"])');\n                if (currentSection && currentSection.id === 'knowledge-base') {\n                    displayKnowledgeContentInMain();\n                }\n                \n                closeDocumentUploader();\n                \n                // Show detailed success message\n                const successMessage = `âœ… SUCESSO! ${newItems.length} item(s) processado(s):\nðŸ“ Base: ${knowledgeBase.length} itens total\nðŸ§  Chunks: ${ragChunks.length} chunks RAG\nðŸ’¾ Salvo no localStorage\nðŸ”„ Interface atualizada`;\n                \n                showToast(successMessage, 'success');\n                \n                // Also log detailed info to console\n                console.log('ðŸŽ‰ UPLOAD COMPLETO!');\n                console.log('ðŸ“Š EstatÃ­sticas finais:');\n                console.log('  ðŸ“ Total na base:', knowledgeBase.length);\n                console.log('  ðŸ§  Total chunks:', ragChunks.length);\n                console.log('  ðŸ’¾ Salvo no localStorage:', !!localStorage.getItem('academiaKnowledgeBase'));\n                console.log('  ðŸ“‹ Itens adicionados:', newItems.map(item => item.title));\n                \n            } catch (error) {\n                console.error('Erro no upload:', error);\n                showToast('Erro ao processar conteÃºdo', 'error');\n            } finally {\n                uploadBtn.innerHTML = originalText;\n                uploadBtn.disabled = false;\n            }\n        }\n\n        // Process documents\n        async function processDocuments() {\n            if (uploadedDocuments.length === 0) {\n                throw new Error('Nenhum documento selecionado');\n            }\n            \n            const tags = document.getElementById('documentTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);\n            const items = [];\n            \n            for (const file of uploadedDocuments) {\n                // Simulate document processing\n                await sleep(500);\n                \n                const content = await simulateDocumentExtraction(file);\n                \n                items.push({\n                    id: generateId(),\n                    type: 'DOCUMENT',\n                    title: file.name.replace(/\\.[^/.]+$/, ''),\n                    content: content,\n                    filename: file.name,\n                    fileSize: file.size,\n                    tags: tags,\n                    category: 'METHODOLOGY',\n                    martialArt: 'GENERAL',\n                    level: 'BEGINNER',\n                    createdAt: new Date().toISOString(),\n                    chunked: false\n                });\n            }\n            \n            return items;\n        }\n\n        // Process text input\n        async function processTextInput() {\n            console.log('âœï¸ Processando entrada de texto...');\n            const title = document.getElementById('textTitle').value.trim();\n            const content = document.getElementById('textContent').value.trim();\n            const category = document.getElementById('textCategory').value || 'METHODOLOGY';\n            const tags = document.getElementById('textTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);\n            \n            console.log('ðŸ“ Dados coletados:', { title, content: content.substring(0, 50) + '...', category, tags });\n            \n            if (!title || !content) {\n                console.error('âŒ TÃ­tulo ou conteÃºdo vazio');\n                throw new Error('TÃ­tulo e conteÃºdo sÃ£o obrigatÃ³rios');\n            }\n            \n            const newItem = {\n                id: generateId(),\n                type: 'TEXT',\n                title: title,\n                content: content,\n                tags: tags,\n                category: category,\n                martialArt: 'GENERAL',\n                level: 'BEGINNER',\n                createdAt: new Date().toISOString(),\n                chunked: false\n            };\n            \n            console.log('âœ… Item de texto criado:', newItem);\n            return [newItem];\n        }\n\n        // Process link\n        async function processLink() {\n            const url = document.getElementById('linkUrl').value.trim();\n            const title = document.getElementById('linkTitle').value.trim();\n            const description = document.getElementById('linkDescription').value.trim();\n            const tags = document.getElementById('linkTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);\n            \n            if (!url) {\n                throw new Error('URL Ã© obrigatÃ³ria');\n            }\n            \n            // Simulate web scraping\n            await sleep(1000);\n            const extractedContent = await simulateWebScraping(url);\n            \n            return [{\n                id: generateId(),\n                type: 'LINK',\n                title: title || extractedContent.title,\n                content: description || extractedContent.content,\n                url: url,\n                tags: tags,\n                category: 'THEORY',\n                martialArt: 'GENERAL',\n                level: 'INTERMEDIATE',\n                createdAt: new Date().toISOString(),\n                chunked: false\n            }];\n        }\n\n        // Process YouTube\n        async function processYouTube() {\n            const url = document.getElementById('youtubeUrl').value.trim();\n            const description = document.getElementById('youtubeDescription').value.trim();\n            const tags = document.getElementById('youtubeTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);\n            \n            if (!url || !url.includes('youtube.com')) {\n                throw new Error('URL vÃ¡lida do YouTube Ã© obrigatÃ³ria');\n            }\n            \n            // Simulate YouTube transcript extraction\n            await sleep(1500);\n            const transcriptData = await simulateYouTubeTranscript(url);\n            \n            return [{\n                id: generateId(),\n                type: 'YOUTUBE',\n                title: transcriptData.title,\n                content: description || transcriptData.transcript,\n                url: url,\n                videoId: transcriptData.videoId,\n                duration: transcriptData.duration,\n                tags: tags,\n                category: 'TECHNIQUES',\n                martialArt: 'GENERAL',\n                level: 'INTERMEDIATE',\n                createdAt: new Date().toISOString(),\n                chunked: false\n            }];\n        }\n\n        // Simulate document extraction (in real implementation, use PDF.js, mammoth.js, etc.)\n        async function simulateDocumentExtraction(file) {\n            const sampleContents = {\n                'pdf': 'ConteÃºdo extraÃ­do do PDF: Este documento contÃ©m informaÃ§Ãµes detalhadas sobre tÃ©cnicas de defesa pessoal, incluindo posturas bÃ¡sicas, movimentos fundamentais e princÃ­pios de seguranÃ§a...',\n                'doc': 'ConteÃºdo extraÃ­do do DOC: Manual de treinamento com metodologia estruturada para ensino de artes marciais, progressÃ£o pedagÃ³gica e avaliaÃ§Ã£o de alunos...',\n                'txt': 'ConteÃºdo do arquivo TXT: Notas e observaÃ§Ãµes sobre a aplicaÃ§Ã£o prÃ¡tica de tÃ©cnicas em situaÃ§Ãµes reais, consideraÃ§Ãµes de seguranÃ§a e adaptaÃ§Ãµes para diferentes pÃºblicos...'\n            };\n            \n            const extension = file.name.split('.').pop().toLowerCase();\n            return sampleContents[extension] || 'ConteÃºdo extraÃ­do do documento carregado com informaÃ§Ãµes relevantes para a base de conhecimento.';\n        }\n\n        // Simulate web scraping\n        async function simulateWebScraping(url) {\n            return {\n                title: 'Artigo sobre BiomecÃ¢nica em Artes Marciais',\n                content: 'Artigo tÃ©cnico sobre a aplicaÃ§Ã£o de princÃ­pios biomecÃ¢nicos no treinamento de artes marciais, incluindo anÃ¡lise de movimento, eficiÃªncia energÃ©tica e prevenÃ§Ã£o de lesÃµes...'\n            };\n        }\n\n        // Simulate YouTube transcript\n        async function simulateYouTubeTranscript(url) {\n            const videoId = url.split('v=')[1] || 'mock-video-id';\n            \n            return {\n                title: 'Tutorial: TÃ©cnica de Defesa BÃ¡sica',\n                videoId: videoId,\n                duration: '8:45',\n                transcript: 'TranscriÃ§Ã£o do vÃ­deo: Hoje vamos aprender a tÃ©cnica bÃ¡sica de defesa contra agarramento frontal. Primeiro, posicionem os pÃ©s na largura dos ombros...'\n            };\n        }\n\n        // Reset upload form\n        function resetUploadForm() {\n            uploadedDocuments = [];\n            \n            // Clear all form fields\n            document.getElementById('documentFiles').value = '';\n            document.getElementById('documentTags').value = '';\n            document.getElementById('documentPreview').innerHTML = '';\n            \n            document.getElementById('textTitle').value = '';\n            document.getElementById('textContent').value = '';\n            document.getElementById('textCategory').value = '';\n            document.getElementById('textTags').value = '';\n            \n            document.getElementById('linkUrl').value = '';\n            document.getElementById('linkTitle').value = '';\n            document.getElementById('linkDescription').value = '';\n            document.getElementById('linkTags').value = '';\n            \n            document.getElementById('youtubeUrl').value = '';\n            document.getElementById('youtubeDescription').value = '';\n            document.getElementById('youtubeTags').value = '';\n        }\n\n        // Search knowledge base\n        function searchKnowledge() {\n            const query = document.getElementById('knowledgeSearch').value.trim();\n            if (!query) {\n                displayKnowledgeContent();\n                return;\n            }\n            \n            // Simple text search (in real implementation, use semantic search)\n            const results = knowledgeBase.filter(item => \n                item.title.toLowerCase().includes(query.toLowerCase()) ||\n                item.content.toLowerCase().includes(query.toLowerCase()) ||\n                item.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase()))\n            );\n            \n            displaySearchResults(results, query);\n        }\n\n        // Display search results\n        function displaySearchResults(results, query) {\n            const contentDiv = document.getElementById('knowledgeContent');\n            \n            if (results.length === 0) {\n                contentDiv.innerHTML = `\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                        <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">ðŸ”</div>\n                        Nenhum resultado encontrado para \"${query}\"\n                    </div>\n                `;\n                return;\n            }\n            \n            let html = `\n                <div style=\"margin-bottom: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px;\">\n                    <h3 style=\"color: #3B82F6; margin-bottom: 0.5rem;\">ðŸ” Resultados da Busca</h3>\n                    <div style=\"color: #CBD5E1;\">Encontrados ${results.length} resultado(s) para \"${query}\"</div>\n                </div>\n            `;\n            \n            results.forEach(item => {\n                const typeInfo = {\n                    'DOCUMENT': { icon: 'ðŸ“„', color: '#8B5CF6' },\n                    'TEXT': { icon: 'ðŸ“', color: '#10B981' },\n                    'LINK': { icon: 'ðŸ”—', color: '#3B82F6' },\n                    'YOUTUBE': { icon: 'ðŸ“º', color: '#EF4444' }\n                };\n                \n                const info = typeInfo[item.type];\n                \n                html += `\n                    <div style=\"background: rgba(55, 65, 81, 0.3); padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border-left: 4px solid ${info.color};\">\n                        <div style=\"font-weight: bold; color: #F8FAFC; margin-bottom: 0.5rem;\">\n                            ${info.icon} ${item.title}\n                        </div>\n                        <div style=\"color: #CBD5E1; margin-bottom: 0.5rem; font-size: 0.9rem;\">\n                            ${highlightQuery(item.content.substring(0, 200) + '...', query)}\n                        </div>\n                        <div style=\"display: flex; gap: 0.5rem; flex-wrap: wrap;\">\n                            ${item.tags.map(tag => `\n                                <span style=\"background: ${info.color}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;\">\n                                    ${highlightQuery(tag, query)}\n                                </span>\n                            `).join('')}\n                        </div>\n                    </div>\n                `;\n            });\n            \n            contentDiv.innerHTML = html;\n        }\n\n        // Highlight query in text\n        function highlightQuery(text, query) {\n            const regex = new RegExp(`(${query})`, 'gi');\n            return text.replace(regex, '<mark style=\"background: #F59E0B; color: #000;\">$1</mark>');\n        }\n\n        // Test RAG system\n        function testRAG() {\n            document.getElementById('ragTestModal').classList.add('active');\n        }\n\n        // Close RAG test modal\n        function closeRAGTest() {\n            document.getElementById('ragTestModal').classList.remove('active');\n            document.getElementById('ragQuestion').value = '';\n            document.getElementById('ragResults').innerHTML = `\n                <div style=\"text-align: center; color: #9CA3AF; padding: 2rem;\">\n                    Digite sua pergunta e clique em \"Consultar RAG\" para ver a resposta\n                </div>\n            `;\n        }\n\n        // Consult RAG system\n        async function consultRAG() {\n            const question = document.getElementById('ragQuestion').value.trim();\n            const martialArt = document.getElementById('ragMartialArt').value;\n            const level = document.getElementById('ragLevel').value;\n            \n            if (!question) {\n                showToast('Digite uma pergunta primeiro', 'error');\n                return;\n            }\n            \n            const consultBtn = document.getElementById('consultRAGBtn');\n            const originalText = consultBtn.innerHTML;\n            \n            consultBtn.innerHTML = '<span>ðŸ§ </span> Consultando...';\n            consultBtn.disabled = true;\n            \n            try {\n                // Simulate RAG query\n                const response = await simulateRAGQuery(question, martialArt, level);\n                displayRAGResponse(response);\n                \n            } catch (error) {\n                console.error('Erro na consulta RAG:', error);\n                showToast('Erro na consulta', 'error');\n            } finally {\n                consultBtn.innerHTML = originalText;\n                consultBtn.disabled = false;\n            }\n        }\n\n        // Simulate RAG query (in real implementation, use vector search + LLM)\n        async function simulateRAGQuery(question, martialArt, level) {\n            await sleep(1500);\n            \n            // Find relevant chunks based on keywords\n            const queryWords = question.toLowerCase().split(' ');\n            const relevantChunks = ragChunks.filter(chunk => {\n                const chunkWords = chunk.content.toLowerCase();\n                return queryWords.some(word => chunkWords.includes(word)) ||\n                       (martialArt && chunk.martialArt === martialArt) ||\n                       (level && chunk.level === level);\n            }).slice(0, 3); // Top 3 most relevant chunks\n            \n            if (relevantChunks.length === 0) {\n                return {\n                    answer: 'Desculpe, nÃ£o encontrei informaÃ§Ãµes relevantes na sua base de conhecimento para responder essa pergunta. Considere adicionar mais conteÃºdo relacionado ao tema.',\n                    sources: [],\n                    confidence: 0\n                };\n            }\n            \n            // Simulate LLM response based on retrieved chunks\n            const context = relevantChunks.map(chunk => chunk.content).join('\\n\\n');\n            \n            return {\n                answer: `Baseado na sua base de conhecimento, posso responder: ${generateContextualAnswer(question, context)}`,\n                sources: relevantChunks.map(chunk => ({\n                    title: chunk.sourceTitle,\n                    type: chunk.sourceType,\n                    relevantText: chunk.content.substring(0, 150) + '...'\n                })),\n                confidence: Math.round(Math.random() * 30 + 70) // 70-100%\n            };\n        }\n\n        // Generate contextual answer\n        function generateContextualAnswer(question, context) {\n            const questionLower = question.toLowerCase();\n            \n            if (questionLower.includes('defesa') && questionLower.includes('iniciante')) {\n                return 'Para iniciantes, a defesa deve comeÃ§ar com consciÃªncia situacional e prevenÃ§Ã£o. As tÃ©cnicas bÃ¡sicas incluem posturas defensivas, movimentos naturais e contra-ataques simples. Ã‰ importante sempre priorizar a fuga e buscar ajuda quando possÃ­vel.';\n            }\n            \n            if (questionLower.includes('progressÃ£o') || questionLower.includes('metodologia')) {\n                return 'A progressÃ£o metodolÃ³gica deve seguir uma sequÃªncia lÃ³gica: primeiro os fundamentos (postura, distÃ¢ncia), depois tÃ©cnicas bÃ¡sicas (golpes simples), defesas contra ataques comuns, e por fim combinaÃ§Ãµes mais complexas. Cada etapa deve ser dominada antes de avanÃ§ar.';\n            }\n            \n            if (questionLower.includes('ensinar') || questionLower.includes('instrutor')) {\n                return 'Para ensinar efetivamente, utilize demonstraÃ§Ã£o clara, prÃ¡tica repetitiva, correÃ§Ã£o individual e progressÃ£o gradual. Adapte as tÃ©cnicas conforme a capacidade de cada aluno e sempre enfatize a seguranÃ§a e os princÃ­pios fundamentais.';\n            }\n            \n            return 'Baseado no contexto da sua base de conhecimento, esta informaÃ§Ã£o estÃ¡ relacionada aos princÃ­pios e metodologias que vocÃª documentou. Recomendo revisar os documentos especÃ­ficos para detalhes mais aprofundados.';\n        }\n\n        // Display RAG response\n        function displayRAGResponse(response) {\n            const resultsDiv = document.getElementById('ragResults');\n            \n            resultsDiv.innerHTML = `\n                <div style=\"display: grid; gap: 1rem;\">\n                    <!-- Answer -->\n                    <div style=\"background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #10B981;\">\n                        <h4 style=\"color: #10B981; margin-bottom: 0.5rem;\">ðŸ¤– Resposta da IA</h4>\n                        <div style=\"color: #F8FAFC; line-height: 1.6;\">${response.answer}</div>\n                    </div>\n                    \n                    <!-- Confidence -->\n                    <div style=\"background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px;\">\n                        <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                            <span style=\"color: #3B82F6; font-weight: bold;\">ConfianÃ§a da Resposta:</span>\n                            <span style=\"color: #F8FAFC; font-size: 1.1rem;\">${response.confidence}%</span>\n                        </div>\n                        <div style=\"background: #374151; height: 6px; border-radius: 3px; margin-top: 0.5rem; overflow: hidden;\">\n                            <div style=\"background: #3B82F6; height: 100%; width: ${response.confidence}%; transition: width 0.3s;\"></div>\n                        </div>\n                    </div>\n                    \n                    <!-- Sources -->\n                    ${response.sources.length > 0 ? `\n                        <div style=\"background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px;\">\n                            <h4 style=\"color: #F59E0B; margin-bottom: 0.5rem;\">ðŸ“š Fontes Consultadas</h4>\n                            ${response.sources.map(source => `\n                                <div style=\"background: rgba(55, 65, 81, 0.5); padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 6px;\">\n                                    <div style=\"font-weight: bold; color: #F8FAFC; margin-bottom: 0.25rem;\">\n                                        ${getTypeIcon(source.type)} ${source.title}\n                                    </div>\n                                    <div style=\"color: #CBD5E1; font-size: 0.9rem;\">${source.relevantText}</div>\n                                </div>\n                            `).join('')}\n                        </div>\n                    ` : ''}\n                </div>\n            `;\n        }\n\n        // Get type icon\n        function getTypeIcon(type) {\n            const icons = {\n                'DOCUMENT': 'ðŸ“„',\n                'TEXT': 'ðŸ“',\n                'LINK': 'ðŸ”—',\n                'YOUTUBE': 'ðŸ“º'\n            };\n            return icons[type] || 'ðŸ“„';\n        }\n\n        // Reindex knowledge base\n        async function reindexKnowledgeBase() {\n            const reindexBtn = document.querySelector('#knowledgeBasePanel .btn-success');\n            const originalText = reindexBtn.innerHTML;\n            \n            reindexBtn.innerHTML = '<span>âš¡</span> Reindexando...';\n            reindexBtn.disabled = true;\n            \n            try {\n                await sleep(2000);\n                generateRAGChunks();\n                updateKnowledgeBaseStats();\n                \n                showToast('Base de conhecimento reindexada com sucesso!', 'success');\n                \n            } catch (error) {\n                console.error('Erro na reindexaÃ§Ã£o:', error);\n                showToast('Erro durante a reindexaÃ§Ã£o', 'error');\n            } finally {\n                reindexBtn.innerHTML = originalText;\n                reindexBtn.disabled = false;\n            }\n        }\n\n        // Edit knowledge item (placeholder)\n        function editKnowledgeItem(itemId) {\n            showToast('Funcionalidade de ediÃ§Ã£o serÃ¡ implementada', 'info');\n        }\n\n        // Delete knowledge item\n        function deleteKnowledgeItem(itemId) {\n            if (confirm('Tem certeza que deseja remover este item da base de conhecimento?')) {\n                knowledgeBase = knowledgeBase.filter(item => item.id !== itemId);\n                generateRAGChunks();\n                updateKnowledgeBaseStats();\n                displayKnowledgeContent();\n                showToast('Item removido da base de conhecimento', 'success');\n            }\n        }\n\n        // RAG-Enhanced audit helper functions\n        function analyzeQualityWithRAG(techniques, ragGuidance) {\n            const qualityIssues = [];\n            \n            // Extract quality criteria from RAG if available\n            const ragCriteria = extractQualityCriteria(ragGuidance);\n            \n            techniques.forEach(tech => {\n                let score = 100;\n                const issues = [];\n                \n                // Standard quality checks\n                if (tech.name.length < 3) {\n                    score -= 20;\n                    issues.push('Nome muito curto');\n                }\n                \n                if (!tech.description || tech.description.length < 10) {\n                    score -= 15;\n                    issues.push('DescriÃ§Ã£o insuficiente');\n                }\n                \n                if (tech.level === 'ADVANCED' && !tech.prerequisites) {\n                    score -= 10;\n                    issues.push('TÃ©cnica avanÃ§ada sem prÃ©-requisitos');\n                }\n                \n                // RAG-Enhanced quality checks\n                if (ragCriteria.length > 0) {\n                    ragCriteria.forEach(criterion => {\n                        if (!evaluateCriterion(tech, criterion)) {\n                            score -= criterion.penalty;\n                            issues.push(`ðŸ§  RAG: ${criterion.message}`);\n                        }\n                    });\n                }\n                \n                // Check consistency with RAG standards\n                if (ragGuidance.success) {\n                    if (tech.description && !containsKeyElements(tech.description, ragGuidance)) {\n                        score -= 5;\n                        issues.push('ðŸ§  RAG: DescriÃ§Ã£o nÃ£o segue padrÃµes documentados');\n                    }\n                }\n                \n                if (issues.length > 0) {\n                    qualityIssues.push({\n                        type: 'QUALITY',\n                        technique: tech,\n                        severity: score < 60 ? 'HIGH' : (score < 80 ? 'MEDIUM' : 'LOW'),\n                        score: score,\n                        issues: issues,\n                        message: `TÃ©cnica \"${tech.name}\" - Score: ${score}/100`,\n                        ragEnhanced: ragGuidance.success\n                    });\n                }\n            });\n            \n            return qualityIssues;\n        }\n        \n        // Extract quality criteria from RAG guidance\n        function extractQualityCriteria(ragGuidance) {\n            if (!ragGuidance || !ragGuidance.success) {\n                return [];\n            }\n            \n            const criteria = [];\n            const content = ragGuidance.answer.toLowerCase();\n            \n            // Look for common quality indicators in RAG content\n            if (content.includes('seguranca') || content.includes('seguranÃ§a')) {\n                criteria.push({\n                    field: 'safetyNotes',\n                    required: true,\n                    penalty: 15,\n                    message: 'Faltam consideraÃ§Ãµes de seguranÃ§a'\n                });\n            }\n            \n            if (content.includes('prerequisito') || content.includes('prÃ©-requisito')) {\n                criteria.push({\n                    field: 'prerequisites',\n                    required: true,\n                    penalty: 10,\n                    message: 'PrÃ©-requisitos nÃ£o especificados'\n                });\n            }\n            \n            if (content.includes('progressao') || content.includes('progressÃ£o')) {\n                criteria.push({\n                    field: 'progressionNotes',\n                    required: false,\n                    penalty: 5,\n                    message: 'Notas de progressÃ£o ausentes'\n                });\n            }\n            \n            return criteria;\n        }\n        \n        // Evaluate a criterion against a technique\n        function evaluateCriterion(technique, criterion) {\n            const field = technique[criterion.field];\n            \n            if (criterion.required) {\n                return field && field.length > 0;\n            }\n            \n            return true; // Non-required criteria pass by default\n        }\n        \n        // Check if description contains key elements from RAG\n        function containsKeyElements(description, ragGuidance) {\n            const content = ragGuidance.answer.toLowerCase();\n            const desc = description.toLowerCase();\n            \n            // Extract key terms from RAG guidance\n            const keyTerms = ['tecnica', 'movimento', 'posicao', 'defensiva', 'ataque'];\n            const foundTerms = keyTerms.filter(term => content.includes(term) && desc.includes(term));\n            \n            return foundTerms.length >= 2; // At least 2 key terms should match\n        }\n        \n        // Global RAG query function for any agent\n        async function queryRAGForAgent(query, agentType, context = {}) {\n            const fullContext = {\n                ...context,\n                agent: agentType\n            };\n            \n            return await centralRAG.queryKnowledge(query, fullContext);\n        }\n        \n        // ==========================================\n        // KNOWLEDGE BASE FRONTEND FUNCTIONS\n        // ==========================================\n        \n        // Open knowledge uploader modal (Global function)\n        window.openKnowledgeUploader = function() {\n            console.log('ðŸ“š Abrindo base de conhecimento...');\n            // Call the existing document uploader function\n            openDocumentUploader();\n        };\n        \n        // Test RAG system (Global function)\n        window.testRAGSystem = function() {\n            document.getElementById('ragTestModal').classList.add('active');\n            // Reset the form\n            document.getElementById('ragQuestion').value = '';\n            document.getElementById('ragMartialArt').value = '';\n            document.getElementById('ragLevel').value = '';\n            document.getElementById('ragResults').innerHTML = `\n                <div style=\"text-align: center; color: #9CA3AF; padding: 2rem;\">\n                    Digite sua pergunta e clique em \"Consultar RAG\" para ver a resposta\n                </div>\n            `;\n        };\n        \n        // Enhanced reindex function (Global function)\n        window.reindexKnowledgeBase = function() {\n            const btn = event.target;\n            const originalText = btn.innerHTML;\n            \n            btn.innerHTML = '<span>âš¡</span> Reindexando...';\n            btn.disabled = true;\n            \n            setTimeout(() => {\n                generateRAGChunks();\n                updateKnowledgeBaseStats();\n                displayKnowledgeContentInMain();\n                \n                showToast('Base de conhecimento reindexada com sucesso!', 'success');\n                \n                btn.innerHTML = originalText;\n                btn.disabled = false;\n            }, 2000);\n        };\n        \n        // Search knowledge base (Global function)\n        window.searchKnowledgeBase = function() {\n            const query = document.getElementById('knowledgeSearchInput').value.trim();\n            if (query) {\n                searchKnowledgeContentInMain(query);\n            } else {\n                displayKnowledgeContentInMain();\n            }\n        };\n        \n        // Search function specifically for main section\n        function searchKnowledgeContentInMain(query) {\n            const results = knowledgeBase.filter(item => {\n                const searchText = `${item.title} ${item.content} ${item.tags.join(' ')}`.toLowerCase();\n                return searchText.includes(query.toLowerCase());\n            });\n            \n            const contentDiv = document.getElementById('knowledgeContentDisplay');\n            if (!contentDiv) return;\n            \n            if (results.length === 0) {\n                contentDiv.innerHTML = `\n                    <div style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                        <div style=\"font-size: 1.5rem; margin-bottom: 0.5rem;\">ðŸ”</div>\n                        Nenhum resultado encontrado para \"${query}\"\n                        <div style=\"margin-top: 1rem;\">\n                            <button class=\"btn btn-secondary\" onclick=\"displayKnowledgeContentInMain()\">\n                                ðŸ“‹ Mostrar Tudo\n                            </button>\n                        </div>\n                    </div>\n                `;\n                return;\n            }\n            \n            let html = `\n                <div style=\"margin-bottom: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px;\">\n                    <h3 style=\"color: #3B82F6; margin-bottom: 0.5rem;\">ðŸ” Resultados da Busca</h3>\n                    <div style=\"color: #CBD5E1;\">Encontrados ${results.length} resultado(s) para \"${query}\"</div>\n                    <button class=\"btn btn-sm btn-secondary\" onclick=\"displayKnowledgeContentInMain()\" style=\"margin-top: 0.5rem;\">\n                        ðŸ“‹ Mostrar Tudo\n                    </button>\n                </div>\n            `;\n            \n            results.forEach(item => {\n                const typeInfo = {\n                    'DOCUMENT': { icon: 'ðŸ“„', color: '#8B5CF6' },\n                    'TEXT': { icon: 'ðŸ“', color: '#10B981' },\n                    'LINK': { icon: 'ðŸ”—', color: '#3B82F6' },\n                    'YOUTUBE': { icon: 'ðŸ“º', color: '#EF4444' }\n                };\n                \n                const info = typeInfo[item.type];\n                \n                // Highlight query in text\n                const highlightedContent = item.content.substring(0, 200).replace(\n                    new RegExp(`(${query})`, 'gi'),\n                    '<mark style=\"background: #F59E0B; color: #000;\">$1</mark>'\n                );\n                \n                html += `\n                    <div style=\"background: rgba(55, 65, 81, 0.3); padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border-left: 4px solid ${info.color};\">\n                        <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;\">\n                            <div style=\"font-weight: bold; color: #F8FAFC;\">\n                                ${info.icon} ${item.title}\n                            </div>\n                            <div style=\"display: flex; gap: 0.5rem;\">\n                                <button onclick=\"editKnowledgeItem('${item.id}')\" style=\"background: none; border: none; color: #3B82F6; cursor: pointer; padding: 0.25rem; font-size: 1rem;\" title=\"Editar\">âœï¸</button>\n                                <button onclick=\"deleteKnowledgeItem('${item.id}')\" style=\"background: none; border: none; color: #EF4444; cursor: pointer; padding: 0.25rem; font-size: 1rem;\" title=\"Excluir\">âŒ</button>\n                            </div>\n                        </div>\n                        <div style=\"color: #CBD5E1; margin-bottom: 0.5rem; font-size: 0.9rem;\">\n                            ${highlightedContent}${item.content.length > 200 ? '...' : ''}\n                        </div>\n                        <div style=\"display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;\">\n                            ${item.tags.map(tag => {\n                                const highlightedTag = tag.replace(new RegExp(`(${query})`, 'gi'), '<mark style=\"background: rgba(255,255,255,0.3); color: white;\">$1</mark>');\n                                return `<span style=\"background: ${info.color}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;\">${highlightedTag}</span>`;\n                            }).join('')}\n                        </div>\n                        <div style=\"font-size: 0.75rem; color: #9CA3AF;\">\n                            Adicionado: ${new Date(item.createdAt).toLocaleDateString('pt-BR')}\n                        </div>\n                    </div>\n                `;\n            });\n            \n            contentDiv.innerHTML = html;\n        }\n        \n        // Update knowledge base stats in the main section\n        function updateKnowledgeBaseStats() {\n            const documentsCount = knowledgeBase.length;\n            const chunksCount = ragChunks.length;\n            const lastUpdate = documentsCount > 0 ? 'Agora mesmo' : 'Nunca';\n            const status = documentsCount > 0 ? 'Ativo' : 'Vazio';\n            \n            // Main section stats\n            const documentsEl = document.getElementById('knowledgeStatsDocuments');\n            const chunksEl = document.getElementById('knowledgeStatsChunks');\n            const lastUpdateEl = document.getElementById('knowledgeStatsLastUpdate');\n            const statusEl = document.getElementById('knowledgeStatsStatus');\n            \n            if (documentsEl) documentsEl.textContent = documentsCount;\n            if (chunksEl) chunksEl.textContent = chunksCount;\n            if (lastUpdateEl) lastUpdateEl.textContent = lastUpdate;\n            if (statusEl) statusEl.textContent = status;\n            \n            // Update badge\n            const badge = document.getElementById('knowledge-base-badge');\n            if (badge) {\n                if (documentsCount > 0) {\n                    badge.textContent = documentsCount.toString();\n                    badge.style.background = '#10B981';\n                } else {\n                    badge.textContent = 'RAG';\n                    badge.style.background = '#8B5CF6';\n                }\n            }\n        }\n        \n        // Display knowledge base content in the main section\n        function displayKnowledgeContentInMain() {\n            const contentDiv = document.getElementById('knowledgeContentDisplay');\n            if (!contentDiv) return;\n            \n            if (knowledgeBase.length === 0) {\n                contentDiv.innerHTML = `\n                    <div style=\"text-align: center; color: #9CA3AF; padding: 3rem;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“š</div>\n                        <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Base de Conhecimento Vazia</div>\n                        <div style=\"font-size: 0.9rem;\">Adicione documentos, textos, links ou vÃ­deos para comeÃ§ar</div>\n                        <div style=\"margin-top: 1rem;\">\n                            <button class=\"btn btn-primary\" onclick=\"openKnowledgeUploader()\">\n                                âž• Adicionar Primeiro ConteÃºdo\n                            </button>\n                        </div>\n                    </div>\n                `;\n                return;\n            }\n            \n            let html = '';\n            \n            knowledgeBase.forEach(item => {\n                const typeInfo = {\n                    'DOCUMENT': { icon: 'ðŸ“„', color: '#8B5CF6' },\n                    'TEXT': { icon: 'ðŸ“', color: '#10B981' },\n                    'LINK': { icon: 'ðŸ”—', color: '#3B82F6' },\n                    'YOUTUBE': { icon: 'ðŸ“º', color: '#EF4444' }\n                };\n                \n                const info = typeInfo[item.type];\n                \n                html += `\n                    <div style=\"background: rgba(55, 65, 81, 0.3); padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border-left: 4px solid ${info.color};\">\n                        <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;\">\n                            <div style=\"font-weight: bold; color: #F8FAFC;\">\n                                ${info.icon} ${item.title}\n                            </div>\n                            <div style=\"display: flex; gap: 0.5rem;\">\n                                <button onclick=\"editKnowledgeItem('${item.id}')\" style=\"background: none; border: none; color: #3B82F6; cursor: pointer; padding: 0.25rem; font-size: 1rem;\" title=\"Editar\">âœï¸</button>\n                                <button onclick=\"deleteKnowledgeItem('${item.id}')\" style=\"background: none; border: none; color: #EF4444; cursor: pointer; padding: 0.25rem; font-size: 1rem;\" title=\"Excluir\">âŒ</button>\n                            </div>\n                        </div>\n                        <div style=\"color: #CBD5E1; margin-bottom: 0.5rem; font-size: 0.9rem;\">\n                            ${item.content.substring(0, 200)}${item.content.length > 200 ? '...' : ''}\n                        </div>\n                        <div style=\"display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;\">\n                            ${item.tags.map(tag => `\n                                <span style=\"background: ${info.color}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;\">\n                                    ${tag}\n                                </span>\n                            `).join('')}\n                        </div>\n                        <div style=\"font-size: 0.75rem; color: #9CA3AF;\">\n                            Adicionado: ${new Date(item.createdAt).toLocaleDateString('pt-BR')}\n                        </div>\n                    </div>\n                `;\n            });\n            \n            contentDiv.innerHTML = html;\n        }\n        \n        // Override existing upload function to update main section\n        const originalUploadContent = uploadContent;\n        if (typeof uploadContent === 'function') {\n            uploadContent = function() {\n                const result = originalUploadContent.apply(this, arguments);\n                setTimeout(() => {\n                    updateKnowledgeBaseStats();\n                    displayKnowledgeContentInMain();\n                }, 500);\n                return result;\n            };\n        }\n        \n        // Override delete function to update main section\n        const originalDeleteKnowledgeItem = deleteKnowledgeItem;\n        if (typeof deleteKnowledgeItem === 'function') {\n            deleteKnowledgeItem = function(itemId) {\n                const result = originalDeleteKnowledgeItem.apply(this, arguments);\n                setTimeout(() => {\n                    updateKnowledgeBaseStats();\n                    displayKnowledgeContentInMain();\n                }, 100);\n                return result;\n            };\n        }\n        \n        // Enhanced showSection to handle knowledge base\n        const originalShowSection = showSection;\n        window.showSection = function(sectionName) {\n            originalShowSection(sectionName);\n            \n            if (sectionName === 'knowledge-base') {\n                setTimeout(() => {\n                    updateKnowledgeBaseStats();\n                    displayKnowledgeContentInMain();\n                }, 100);\n            }\n        };\n        \n        // Test function for debugging\n        function testKnowledgeBase() {\n            console.log('ðŸ§ª Testando base de conhecimento...');\n            console.log('ðŸ“ Base atual:', knowledgeBase);\n            console.log('ðŸ•°ï¸ Chunks atuais:', ragChunks);\n            \n            // Add test item\n            const testItem = {\n                id: 'test-' + Date.now(),\n                type: 'TEXT',\n                title: 'Teste de Funcionamento',\n                content: 'Este Ã© um item de teste para verificar se a base de conhecimento estÃ¡ funcionando.',\n                tags: ['teste', 'debug'],\n                category: 'TEST',\n                martialArt: 'GENERAL',\n                level: 'BEGINNER',\n                createdAt: new Date().toISOString(),\n                chunked: false\n            };\n            \n            knowledgeBase.push(testItem);\n            generateRAGChunks();\n            updateKnowledgeBaseStats();\n            displayKnowledgeContentInMain();\n            \n            console.log('âœ… Item de teste adicionado!');\n            console.log('ðŸ“ Base apÃ³s teste:', knowledgeBase);\n            \n            // Add clear storage button for testing\n            setTimeout(() => {\n                const clearBtn = document.createElement('button');\n                clearBtn.className = 'btn btn-danger';\n                clearBtn.innerHTML = 'ðŸ—‘ï¸ Limpar Storage';\n                clearBtn.onclick = function() {\n                    if (confirm('Limpar toda a base de conhecimento do localStorage?')) {\n                        clearKnowledgeBaseStorage();\n                        updateKnowledgeBaseStats();\n                        displayKnowledgeContentInMain();\n                        showToast('Base de conhecimento limpa!', 'success');\n                    }\n                };\n                clearBtn.style.margin = '1rem';\n                clearBtn.style.marginLeft = '0.5rem';\n                \n                const knowledgeSection = document.getElementById('knowledge-base');\n                if (knowledgeSection) {\n                    knowledgeSection.appendChild(clearBtn);\n                }\n            }, 100);\n        }\n        \n        // Initialize knowledge base on page load\n        document.addEventListener('DOMContentLoaded', function() {\n            console.log('ðŸš€ Inicializando base de conhecimento...');\n            \n            // Test basic functionality first\n            try {\n                updateKnowledgeBaseStats();\n                console.log('âœ… updateKnowledgeBaseStats executado com sucesso');\n            } catch (error) {\n                console.error('âŒ Erro em updateKnowledgeBaseStats:', error);\n            }\n            \n            // Test if functions are available\n            console.log('ðŸ” Verificando funÃ§Ãµes...');\n            console.log('openKnowledgeUploader:', typeof window.openKnowledgeUploader);\n            console.log('testRAGSystem:', typeof window.testRAGSystem);\n            console.log('reindexKnowledgeBase:', typeof window.reindexKnowledgeBase);\n            console.log('searchKnowledgeBase:', typeof window.searchKnowledgeBase);\n            \n            // Add test button for debugging (remove in production)\n            setTimeout(() => {\n                const knowledgeSection = document.getElementById('knowledge-base');\n                if (knowledgeSection) {\n                    const testBtn = document.createElement('button');\n                    testBtn.className = 'btn btn-warning';\n                    testBtn.innerHTML = 'ðŸ§ª Teste Debug';\n                    testBtn.onclick = testKnowledgeBase;\n                    testBtn.style.margin = '1rem';\n                    knowledgeSection.appendChild(testBtn);\n                    console.log('ðŸ§ª BotÃ£o de teste adicionado');\n                } else {\n                    console.log('âš ï¸ SeÃ§Ã£o knowledge-base nÃ£o encontrada');\n                }\n            }, 1000);\n        });\n        \n        // Functions now defined at the top of the script\n        \n        // Generate unique ID\n        function generateId() {\n            return 'kb_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n        }\n        \n        // Delete knowledge item\n        function deleteKnowledgeItem(itemId) {\n            if (!confirm('Tem certeza que deseja excluir este item da base de conhecimento?')) {\n                return;\n            }\n            \n            try {\n                const index = knowledgeBase.findIndex(item => item.id === itemId);\n                if (index !== -1) {\n                    const deletedItem = knowledgeBase.splice(index, 1)[0];\n                    console.log('ðŸ—‘ï¸ Item removido:', deletedItem.title);\n                    \n                    // Regenerate chunks and save\n                    generateRAGChunks();\n                    \n                    // Update display\n                    updateKnowledgeBaseStats();\n                    displayKnowledgeContentInMain();\n                    \n                    showToast('Item removido da base de conhecimento', 'success');\n                } else {\n                    console.error('âŒ Item nÃ£o encontrado:', itemId);\n                    showToast('Item nÃ£o encontrado', 'error');\n                }\n            } catch (error) {\n                console.error('âŒ Erro ao excluir item:', error);\n                showToast('Erro ao excluir item', 'error');\n            }\n        }\n        \n        // Edit knowledge item (placeholder for future implementation)\n        function editKnowledgeItem(itemId) {\n            const item = knowledgeBase.find(item => item.id === itemId);\n            if (item) {\n                // For now, show item details in alert (can be enhanced with a modal later)\n                const details = `\nTÃ­tulo: ${item.title}\nTipo: ${item.type}\nConteÃºdo: ${item.content.substring(0, 200)}...\nTags: ${item.tags.join(', ')}\nCategoria: ${item.category}\nArte Marcial: ${item.martialArt}\nNÃ­vel: ${item.level}\n                `.trim();\n                \n                alert(`EdiÃ§Ã£o de itens serÃ¡ implementada em breve.\\n\\nDetalhes do item:\\n${details}`);\n            } else {\n                showToast('Item nÃ£o encontrado', 'error');\n            }\n        }\n        \n        // Initialize knowledge base on page load\n        window.addEventListener('load', function() {\n            console.log('ðŸš€ Inicializando sistema de persistÃªncia...');\n            \n            // Load knowledge base from storage\n            const hasData = loadKnowledgeBaseFromStorage();\n            \n            if (hasData) {\n                console.log('âœ… Dados carregados do localStorage');\n                // Update UI if knowledge base section is visible\n                setTimeout(() => {\n                    updateKnowledgeBaseStats();\n                    displayKnowledgeContentInMain();\n                }, 500);\n            } else {\n                console.log('ðŸ“ Nenhum dado encontrado no localStorage');\n            }\n        });\n\n    </script>\n\n    <!-- Simple Widgets Sidebar -->\n    <aside class=\"dashboard-widgets\" id=\"dashboardWidgets\">\n            <!-- Quick Actions Widget -->\n            <div class=\"widget\">\n                <div class=\"widget-header\">\n                    <div class=\"widget-title\">\n                        <span>âš¡</span>\n                        AÃ§Ãµes RÃ¡pidas\n                    </div>\n                </div>\n                <div style=\"display: flex; flex-direction: column; gap: 0.75rem;\">\n                    <button class=\"btn btn-primary\" onclick=\"openKnowledgeUploader()\" style=\"width: 100%; justify-content: center;\">\n                        ðŸ“š Upload RAG\n                    </button>\n                    <button class=\"btn btn-secondary\" onclick=\"testRAGSystem()\" style=\"width: 100%; justify-content: center;\">\n                        ðŸ§  Testar IA\n                    </button>\n                </div>\n            </div>\n\n            <!-- Students Info -->\n            <div class=\"widget\">\n                <div class=\"widget-header\">\n                    <div class=\"widget-title\">\n                        <span>ðŸ‘¥</span>\n                        Resumo Alunos\n                    </div>\n                </div>\n                <div style=\"display: flex; flex-direction: column; gap: 1rem;\">\n                    <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                        <span style=\"color: #CBD5E1; font-size: 0.875rem;\">Total</span>\n                        <span style=\"color: #3B82F6; font-weight: 600;\" id=\"widget-total-students\">0</span>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                        <span style=\"color: #CBD5E1; font-size: 0.875rem;\">Ativos</span>\n                        <span style=\"color: #10B981; font-weight: 600;\" id=\"widget-active-students\">0</span>\n                    </div>\n                </div>\n            </div>\n        </aside>\n    </div>\n\n    <!-- Enhanced JavaScript Functions -->\n    <script>\n        // UX-Enhanced Navigation Functions\n        function toggleSidebar() {\n            const container = document.getElementById('dashboardContainer');\n            const sidebar = document.getElementById('dashboardSidebar');\n            \n            if (window.innerWidth <= 768) {\n                sidebar.classList.toggle('open');\n            } else {\n                container.classList.toggle('collapsed');\n            }\n        }\n\n        // Simple Section Navigation\n        function showSection(sectionName) {\n            // Update navigation state\n            document.querySelectorAll('.nav-link').forEach(link => {\n                link.classList.remove('active');\n            });\n            \n            document.querySelector(`[data-page=\"${sectionName}\"]`).classList.add('active');\n\n            // Update main content header\n            updateMainHeader(sectionName);\n\n            // Show/hide content sections\n            document.querySelectorAll('.content-section').forEach(section => {\n                section.classList.remove('active');\n            });\n            \n            document.getElementById(sectionName)?.classList.add('active');\n\n            // Load section-specific data\n            loadSectionData(sectionName);\n        }\n\n        // Update main header based on current section\n        function updateMainHeader(sectionName) {\n            const titles = {\n                'dashboard': { title: 'Dashboard', subtitle: 'VisÃ£o geral da academia' },\n                'students': { title: 'GestÃ£o de Alunos', subtitle: 'Cadastro e acompanhamento de alunos' },\n                'courses': { title: 'Cursos', subtitle: 'GestÃ£o de cursos e turmas' },\n                'quick-checkin': { title: 'Check-in RÃ¡pido', subtitle: 'Sistema de presenÃ§a simplificado' },\n                'course-creator': { title: 'Criador de Cursos', subtitle: 'Ferramenta de criaÃ§Ã£o de conteÃºdo' },\n                'knowledge-base': { title: 'Base de Conhecimento', subtitle: 'Documentos e recursos' },\n                'attendance': { title: 'Controle de FrequÃªncia', subtitle: 'GestÃ£o de presenÃ§a' },\n                'evaluations': { title: 'AvaliaÃ§Ãµes', subtitle: 'Sistema de avaliaÃ§Ãµes' }\n            };\n\n            const config = titles[sectionName] || { title: 'Academia', subtitle: 'Sistema de gestÃ£o' };\n            \n            document.getElementById('mainTitle').textContent = config.title;\n            document.getElementById('mainSubtitle').textContent = config.subtitle;\n        }\n\n        // Generate AI insights for current section\n        function generateSectionInsight(sectionName) {\n            const insights = {\n                'dashboard': [\n                    'IA detectou aumento de 15% no engajamento dos alunos nas Ãºltimas 2 semanas',\n                    'RecomendaÃ§Ã£o: Maria Silva estÃ¡ pronta para tÃ©cnicas avanÃ§adas',\n                    'TendÃªncia positiva: Taxa de retenÃ§Ã£o subiu para 94% este mÃªs'\n                ],\n                'students': [\n                    'IA identificou 2 alunos com padrÃ£o de baixa frequÃªncia - intervenÃ§Ã£o recomendada',\n                    'Carlos Rodrigues mostra aptidÃ£o excepcional para contra-ataques',\n                    'SugestÃ£o: Ana Oliveira pode ser mentora para novos alunos'\n                ],\n                'courses': [\n                    'IA sugere ajuste no mÃ³dulo de defesas bÃ¡sicas baseado no feedback dos alunos',\n                    'Novo curso \"Defesa Feminina\" recomendado pela anÃ¡lise de demanda',\n                    'ProgressÃ£o Ã³tima detectada: 85% dos alunos dominam fundamentos'\n                ]\n            };\n\n            const sectionInsights = insights[sectionName] || insights['dashboard'];\n            const randomInsight = sectionInsights[Math.floor(Math.random() * sectionInsights.length)];\n            \n            const aiInsightElement = document.getElementById('aiInsightText');\n            if (aiInsightElement) {\n                aiInsightElement.textContent = randomInsight;\n            }\n        }\n\n        // Generate AI insight on demand\n        function generateAIInsight() {\n            const insights = [\n                'IA detectou padrÃ£o: alunos respondem melhor a tÃ©cnicas demonstradas em duplas',\n                'RecomendaÃ§Ã£o: implementar aquecimento especÃ­fico para joelho direito (3 alunos)',\n                'TendÃªncia: horÃ¡rio das 19h tem 20% mais engajamento que o das 18h',\n                'IA sugere: quebra de 5 minutos a cada 25 minutos melhora retenÃ§Ã£o em 30%',\n                'Insight comportamental: mÃºsica instrumental aumenta foco durante tÃ©cnicas complexas'\n            ];\n\n            const randomInsight = insights[Math.floor(Math.random() * insights.length)];\n            const aiInsightElement = document.getElementById('aiInsightText');\n            if (aiInsightElement) {\n                aiInsightElement.textContent = randomInsight;\n            }\n            \n            // Show brief animation\n            const banner = document.getElementById('aiInsightsBanner');\n            if (banner) {\n                banner.style.transform = 'scale(1.02)';\n                setTimeout(() => {\n                    banner.style.transform = 'scale(1)';\n                }, 200);\n            }\n        }\n\n        // Load section-specific data\n        function loadSectionData(sectionName) {\n            if (sectionName === 'students') {\n                loadStudents();\n            } else if (sectionName === 'knowledge-base') {\n                displayKnowledgeContentInMain();\n                updateKnowledgeBaseStats();\n            }\n            \n            // Update RAG items count in widget\n            document.getElementById('ragItemsCount').textContent = `${knowledgeBase.length} itens`;\n        }\n\n        // Enhanced page initialization\n        document.addEventListener('DOMContentLoaded', function() {\n            // Initialize dashboard\n            generateSectionInsight('dashboard');\n            \n            // Set up responsive behavior\n            window.addEventListener('resize', function() {\n                const container = document.getElementById('dashboardContainer');\n                if (window.innerWidth <= 768) {\n                    container.classList.add('mobile');\n                } else {\n                    container.classList.remove('mobile');\n                    document.getElementById('dashboardSidebar').classList.remove('open');\n                }\n            });\n\n            // Initialize mobile state if needed\n            if (window.innerWidth <= 768) {\n                document.getElementById('dashboardContainer').classList.add('mobile');\n            }\n\n            // Update RAG items count\n            setTimeout(() => {\n                const ragItemsElement = document.getElementById('ragItemsCount');\n                if (ragItemsElement) {\n                    ragItemsElement.textContent = `${knowledgeBase.length} itens`;\n                }\n            }, 1000);\n            \n            // Load financial data when page loads\n            loadFinancialData();\n        });\n\n        // ===== FINANCIAL MODULE FUNCTIONS =====\n        \n        // Global financial data\n        let allPlans = [];\n        let allSubscriptions = [];\n        let allPayments = [];\n\n        // Tab switching function\n        function switchFinancialTab(tabName) {\n            // Remove active class from all tabs\n            document.querySelectorAll('.financial-tab').forEach(tab => {\n                tab.classList.remove('active');\n            });\n            document.querySelectorAll('.financial-tab-content').forEach(content => {\n                content.classList.remove('active');\n                content.style.display = 'none';\n            });\n            \n            // Add active class to clicked tab\n            event.target.classList.add('active');\n            const contentElement = document.getElementById(`financial-${tabName}`);\n            contentElement.classList.add('active');\n            contentElement.style.display = 'block';\n            \n            // Load data for the selected tab\n            switch(tabName) {\n                case 'plans':\n                    loadPlans();\n                    break;\n                case 'expenses':\n                    // Load expenses data - to be implemented\n                    console.log('Loading expenses data...');\n                    break;\n                case 'payments':\n                    loadPayments();\n                    break;\n                case 'settings':\n                    // Load financial settings - to be implemented\n                    console.log('Loading financial settings...');\n                    break;\n            }\n        }\n\n        // Load all financial data\n        async function loadFinancialData() {\n            await Promise.all([\n                loadPlans(),\n                loadPayments()\n                // loadSubscriptions removed - replaced with expenses\n            ]);\n            updateFinancialOverview();\n        }\n\n        // Load billing plans\n        async function loadPlans() {\n            try {\n                const response = await fetch('/api/billing-plans');\n                const data = await response.json();\n                \n                if (data.success) {\n                    allPlans = data.data || [];\n                    updatePlansTable();\n                } else {\n                    console.error('Erro ao carregar planos:', data.message);\n                    // Show empty state\n                    allPlans = [];\n                    updatePlansTable();\n                }\n            } catch (error) {\n                console.error('Erro ao carregar planos:', error);\n                // Show empty state on error\n                allPlans = [];\n                updatePlansTable();\n            }\n        }\n\n        // Update plans table\n        function updatePlansTable() {\n            const tbody = document.getElementById('plansTableBody');\n            \n            if (!tbody) {\n                console.error('plansTableBody element not found');\n                return;\n            }\n            \n            if (!allPlans || !Array.isArray(allPlans) || allPlans.length === 0) {\n                tbody.innerHTML = `\n                    <tr>\n                        <td colspan=\"7\" style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                            Nenhum plano cadastrado. Clique em \"Novo Plano\" para comeÃ§ar.\n                        </td>\n                    </tr>\n                `;\n                return;\n            }\n            \n            tbody.innerHTML = allPlans.map(plan => {\n                const billingTypeMap = {\n                    'MONTHLY': 'Mensal',\n                    'QUARTERLY': 'Trimestral', \n                    'YEARLY': 'Anual'\n                };\n                \n                const categoryMap = {\n                    'ADULT': 'Adulto',\n                    'INICIANTE1': 'Iniciante 1',\n                    'INICIANTE2': 'Iniciante 2',\n                    'INICIANTE3': 'Iniciante 3'\n                };\n                \n                return `\n                    <tr>\n                        <td>\n                            <div style=\"font-weight: 600; color: #E2E8F0;\">${plan.name}</div>\n                            ${plan.description ? `<div style=\"font-size: 0.75rem; color: #94A3B8; margin-top: 0.25rem;\">${plan.description}</div>` : ''}\n                        </td>\n                        <td>\n                            <span style=\"font-weight: 600; color: #10B981;\">R$ ${parseFloat(plan.price).toFixed(2)}</span>\n                        </td>\n                        <td>${billingTypeMap[plan.billingType] || plan.billingType}</td>\n                        <td>${plan.classesPerWeek}x/semana</td>\n                        <td>${categoryMap[plan.category] || 'Todas'}</td>\n                        <td>\n                            <span class=\"badge ${plan.isActive ? 'success' : 'inactive'}\">\n                                ${plan.isActive ? 'Ativo' : 'Inativo'}\n                            </span>\n                        </td>\n                        <td>\n                            <button class=\"action-btn edit\" onclick=\"editPlan('${plan.id}')\" title=\"Editar Plano\">\n                                âœï¸ Editar\n                            </button>\n                        </td>\n                    </tr>\n                `;\n            }).join('');\n        }\n\n        // Load subscriptions from API (DEPRECATED - replaced with expenses)\n        async function loadSubscriptions() {\n            try {\n                console.log('loadSubscriptions called - function deprecated, expenses section used instead');\n                \n                // Set empty data to prevent errors\n                allSubscriptions = [];\n                \n                // Don't try to update table that no longer exists\n                return;\n            } catch (error) {\n                console.error('Erro ao carregar assinaturas:', error);\n                allSubscriptions = [];\n                // Don't call updateSubscriptionsTable - function deprecated\n            }\n        }\n\n        // Update subscriptions table (DEPRECATED - now using expenses)\n        function updateSubscriptionsTable() {\n            // This function is deprecated since subscriptions section was replaced with expenses\n            console.log('updateSubscriptionsTable called - function deprecated, using expenses section instead');\n            return;\n            \n            tbody.innerHTML = allSubscriptions.map(sub => {\n                const studentName = sub.student?.name || 'Nome nÃ£o informado';\n                const planName = sub.plan?.name || 'Plano nÃ£o informado';\n                const price = parseFloat(sub.currentPrice || 0);\n                const nextBilling = sub.nextBillingDate ? new Date(sub.nextBillingDate).toLocaleDateString('pt-BR') : 'NÃ£o definido';\n                \n                // Status mapping\n                const statusMap = {\n                    'ACTIVE': { text: 'Ativa', class: 'success' },\n                    'INACTIVE': { text: 'Inativa', class: 'inactive' },\n                    'CANCELLED': { text: 'Cancelada', class: 'warning' },\n                    'EXPIRED': { text: 'Expirada', class: 'warning' },\n                    'SUSPENDED': { text: 'Suspensa', class: 'warning' }\n                };\n                \n                const statusInfo = statusMap[sub.status] || { text: sub.status, class: 'inactive' };\n                \n                return `\n                    <tr>\n                        <td>\n                            <div style=\"font-weight: 600; color: #E2E8F0;\">${studentName}</div>\n                            ${sub.student?.email ? `<div style=\"font-size: 0.75rem; color: #94A3B8; margin-top: 0.25rem;\">${sub.student.email}</div>` : ''}\n                        </td>\n                        <td>\n                            <div style=\"font-weight: 500; color: #E2E8F0;\">${planName}</div>\n                            ${sub.plan?.classesPerWeek ? `<div style=\"font-size: 0.75rem; color: #94A3B8; margin-top: 0.25rem;\">${sub.plan.classesPerWeek}x/semana</div>` : ''}\n                        </td>\n                        <td>\n                            <span style=\"font-weight: 600; color: #10B981;\">R$ ${price.toFixed(2)}</span>\n                        </td>\n                        <td>${nextBilling}</td>\n                        <td>\n                            <span class=\"badge ${statusInfo.class}\">\n                                ${statusInfo.text}\n                            </span>\n                        </td>\n                        <td>\n                            <button class=\"action-btn edit\" onclick=\"editSubscription('${sub.id}')\" title=\"Editar Assinatura\">\n                                âœï¸ Editar\n                            </button>\n                            <button class=\"action-btn view\" onclick=\"viewSubscriptionDetails('${sub.id}')\" title=\"Ver Detalhes\">\n                                ðŸ‘ï¸ Ver\n                            </button>\n                        </td>\n                    </tr>\n        }\n\n        // Load payments \n        async function loadPayments() {\n            // No mock data - show empty state\n            allPayments = [];\n            updatePaymentsTable();\n        }\n\n        // Update payments table\n        function updatePaymentsTable() {\n            const tbody = document.getElementById('paymentsTableBody');\n            \n            if (!tbody) {\n                console.error('paymentsTableBody element not found');\n                return;\n            }\n            \n            if (!allPayments || allPayments.length === 0) {\n                tbody.innerHTML = `\n                    <tr>\n                        <td colspan=\"5\" style=\"text-align: center; color: #CBD5E1; padding: 2rem;\">\n                            Nenhum pagamento encontrado\n                        </td>\n                    </tr>\n                `;\n                return;\n            }\n            \n            tbody.innerHTML = allPayments.map(payment => `\n                <tr>\n                    <td>${new Date(payment.date).toLocaleDateString('pt-BR')}</td>\n                    <td>${payment.student.name}</td>\n                    <td>R$ ${parseFloat(payment.amount).toFixed(2)}</td>\n                    <td>\n                        <span class=\"badge ${payment.status === 'PAID' ? 'success' : 'warning'}\">\n                            ${payment.status === 'PAID' ? 'Pago' : 'Pendente'}\n                        </span>\n                    </td>\n                    <td>${payment.method}</td>\n                    <td>\n                        <button class=\"action-btn view\" onclick=\"viewPayment('${payment.id}')\" title=\"Ver Detalhes\">\n                            ðŸ‘ï¸ Ver\n                        </button>\n                    </td>\n                </tr>\n            `).join('');\n        }\n\n        // Load reports (mock)\n        function loadFinancialSettings() {\n            // Load financial settings - placeholder\n            console.log('Financial settings loaded');\n        }\n\n        // Update financial overview\n        function updateFinancialOverview() {\n            const totalRevenue = allPayments.reduce((sum, payment) => \n                payment.status === 'PAID' ? sum + payment.amount : sum, 0\n            );\n            \n            document.getElementById('total-revenue').textContent = `R$ ${totalRevenue.toFixed(2)}`;\n            document.getElementById('active-subscriptions').textContent = allSubscriptions.filter(s => s.status === 'ACTIVE').length;\n            document.getElementById('pending-payments').textContent = allPayments.filter(p => p.status !== 'PAID').length;\n            document.getElementById('total-plans').textContent = allPlans.filter(p => p.isActive).length;\n            document.getElementById('financial-count').textContent = allSubscriptions.length;\n        }\n\n        // Modal functions\n\n        function openAddSubscriptionModal() {\n            // Load students and plans for selection\n            loadStudentsForSubscription();\n            loadPlansForSubscription();\n            document.getElementById('addSubscriptionModal').classList.add('active');\n        }\n\n        // Load students for subscription modal\n        async function loadStudentsForSubscription() {\n            try {\n                const response = await fetch('/api/students');\n                const data = await response.json();\n                \n                if (data.success) {\n                    const select = document.getElementById('subscriptionStudent');\n                    select.innerHTML = '<option value=\"\">Selecione um aluno...</option>' +\n                        data.data.map(student => {\n                            const user = student.user || {};\n                            const firstName = user.firstName || 'N';\n                            const lastName = user.lastName || 'A';\n                            const name = `${firstName} ${lastName}`;\n                            return `<option value=\"${student.id}\">${name}</option>`;\n                        }).join('');\n                }\n            } catch (error) {\n                console.error('Erro ao carregar alunos:', error);\n            }\n        }\n\n        // Load plans for subscription modal\n        function loadPlansForSubscription() {\n            const select = document.getElementById('subscriptionPlan');\n            select.innerHTML = '<option value=\"\">Selecione um plano...</option>' +\n                allPlans.filter(plan => plan.isActive).map(plan => \n                    `<option value=\"${plan.id}\">${plan.name} - R$ ${parseFloat(plan.price).toFixed(2)}</option>`\n                ).join('');\n        }\n\n        // Form handlers\n        document.getElementById('addSubscriptionForm').addEventListener('submit', async function(e) {\n            e.preventDefault();\n            \n            const formData = {\n                studentId: document.getElementById('subscriptionStudent').value,\n                planId: document.getElementById('subscriptionPlan').value,\n                startDate: document.getElementById('subscriptionStartDate').value,\n                customPrice: document.getElementById('subscriptionCustomPrice').value || null\n            };\n            \n            if (!formData.studentId || !formData.planId) {\n                alert('Por favor, selecione um aluno e um plano');\n                return;\n            }\n            \n            try {\n                const response = await fetch('/api/subscriptions', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(formData)\n                });\n                \n                const data = await response.json();\n                \n                if (data.success) {\n                    alert('Assinatura criada com sucesso!');\n                    closeModal('addSubscriptionModal');\n                    loadSubscriptions();\n                    updateFinancialOverview();\n                } else {\n                    alert('Erro ao criar assinatura: ' + data.message);\n                }\n            } catch (error) {\n                console.error('Erro:', error);\n                alert('Erro ao criar assinatura');\n            }\n        });\n\n\n        // Subscription details function\n        function viewSubscriptionDetails(subId) {\n            const subscription = allSubscriptions.find(sub => sub.id === subId);\n            if (!subscription) {\n                alert('Assinatura nÃ£o encontrada');\n                return;\n            }\n            \n            const details = `\nDETALHES DA ASSINATURA\n\nðŸ‘¤ Aluno: ${subscription.student.name}\nðŸ“§ Email: ${subscription.student.email || 'NÃ£o informado'}\n\nðŸ“‹ Plano: ${subscription.plan.name}\nðŸ’° Valor: R$ ${parseFloat(subscription.currentPrice).toFixed(2)}\nðŸ“… Tipo: ${subscription.plan.billingType === 'MONTHLY' ? 'Mensal' : subscription.plan.billingType === 'QUARTERLY' ? 'Trimestral' : 'Anual'}\nðŸ¥‹ Aulas: ${subscription.plan.classesPerWeek}x por semana\n\nðŸ“… Data de InÃ­cio: ${new Date(subscription.startDate).toLocaleDateString('pt-BR')}\nðŸ”„ PrÃ³ximo Vencimento: ${subscription.nextBillingDate ? new Date(subscription.nextBillingDate).toLocaleDateString('pt-BR') : 'NÃ£o definido'}\nðŸ“Š Status: ${subscription.status === 'ACTIVE' ? 'Ativa' : subscription.status}\n\n${subscription.financialResponsible ? `ðŸ’³ ResponsÃ¡vel Financeiro: ${subscription.financialResponsible.name}` : 'ðŸ’³ ResponsÃ¡vel: PrÃ³prio aluno'}\n            `;\n            \n            alert(details);\n        }\n\n        // Placeholder functions  \n        // editPlan function moved to avoid duplicates - see line 16469\n\n        function editSubscription(subId) {\n            alert('Funcionalidade de ediÃ§Ã£o de assinatura em desenvolvimento.\\n\\nAssinatura ID: ' + subId);\n        }\n\n        function viewPayment(paymentId) {\n            alert('VisualizaÃ§Ã£o de pagamento em desenvolvimento');\n        }\n\n        // ==========================================\n        // FINANCIAL RESPONSIBLES MANAGEMENT\n        // ==========================================\n\n        let allResponsibles = [];\n\n        // Load financial responsibles\n        async function loadFinancialResponsiblesList() {\n            try {\n                document.getElementById('responsiblesLoadingState').style.display = 'block';\n                document.getElementById('responsiblesEmptyState').style.display = 'none';\n                \n                const response = await fetch('/api/financial-responsibles');\n                const result = await response.json();\n                \n                if (result.success) {\n                    allResponsibles = result.data;\n                    updateResponsiblesTable(allResponsibles);\n                    updateResponsiblesStats(allResponsibles);\n                    \n                    if (allResponsibles.length === 0) {\n                        document.getElementById('responsiblesLoadingState').style.display = 'none';\n                        document.getElementById('responsiblesEmptyState').style.display = 'block';\n                    } else {\n                        document.getElementById('responsiblesLoadingState').style.display = 'none';\n                    }\n                } else {\n                    throw new Error(result.message || 'Failed to load responsibles');\n                }\n            } catch (error) {\n                console.error('Erro ao carregar responsÃ¡veis:', error);\n                document.getElementById('responsiblesLoadingState').innerHTML = `\n                    <div style=\"text-align: center; color: #EF4444; padding: 3rem;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">âš ï¸</div>\n                        <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Erro ao carregar responsÃ¡veis</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7;\">${error.message}</div>\n                    </div>\n                `;\n            }\n        }\n\n        // Update responsibles table\n        function updateResponsiblesTable(responsibles) {\n            const tbody = document.getElementById('responsiblesTableBody');\n            \n            tbody.innerHTML = responsibles.map(responsible => `\n                <tr>\n                    <td>\n                        <div class=\"student-name\">${responsible.name}</div>\n                    </td>\n                    <td>\n                        <span class=\"student-cpf\">${formatCPF(responsible.cpfCnpj)}</span>\n                    </td>\n                    <td>\n                        <span class=\"student-email\">${responsible.email}</span>\n                    </td>\n                    <td>\n                        <span class=\"student-phone\">${responsible.phone || 'N/A'}</span>\n                    </td>\n                    <td>\n                        <span class=\"badge ${responsible.relationshipType === 'PARENT' ? 'success' : 'info'}\">\n                            ${responsible.relationshipType || 'N/A'}\n                        </span>\n                    </td>\n                    <td>\n                        <span class=\"badge info\">${responsible.studentsCount || 0}</span>\n                    </td>\n                    <td>\n                        <div class=\"action-buttons\">\n                            <button class=\"action-btn edit\" onclick=\"openEditResponsibleModal('${responsible.id}')\" title=\"Editar\">\n                                âœï¸\n                            </button>\n                            <button class=\"action-btn delete\" onclick=\"deleteResponsible('${responsible.id}')\" title=\"Excluir\">\n                                ðŸ—‘ï¸\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `).join('');\n        }\n\n        // Update responsibles stats\n        function updateResponsiblesStats(responsibles) {\n            document.getElementById('totalResponsibles').textContent = responsibles.length;\n            document.getElementById('activeResponsibles').textContent = responsibles.length;\n            \n            const totalStudents = responsibles.reduce((sum, r) => sum + (r.studentsCount || 0), 0);\n            document.getElementById('studentsWithResponsibles').textContent = totalStudents;\n            \n            const avgStudents = responsibles.length > 0 ? (totalStudents / responsibles.length).toFixed(1) : '0';\n            document.getElementById('avgStudentsPerResponsible').textContent = avgStudents;\n            \n            // Update badge count\n            document.getElementById('responsibles-count').textContent = responsibles.length;\n        }\n\n        // Filter responsibles\n        function filterResponsibles() {\n            const searchTerm = document.getElementById('responsibleSearch').value.toLowerCase();\n            const filtered = allResponsibles.filter(responsible => \n                responsible.name.toLowerCase().includes(searchTerm) ||\n                responsible.cpfCnpj.includes(searchTerm) ||\n                responsible.email.toLowerCase().includes(searchTerm)\n            );\n            updateResponsiblesTable(filtered);\n        }\n\n        // Open add responsible modal\n        function openAddResponsibleModal() {\n            document.getElementById('addResponsibleForm').reset();\n            document.getElementById('addResponsibleModal').classList.add('active');\n        }\n\n        // Open edit responsible modal\n        async function openEditResponsibleModal(responsibleId) {\n            const responsible = allResponsibles.find(r => r.id === responsibleId);\n            if (!responsible) {\n                alert('ResponsÃ¡vel nÃ£o encontrado');\n                return;\n            }\n            \n            // Populate form\n            document.getElementById('editResponsibleId').value = responsible.id;\n            document.getElementById('editResponsibleName').value = responsible.name;\n            document.getElementById('editResponsibleCpfCnpj').value = responsible.cpfCnpj;\n            document.getElementById('editResponsibleEmail').value = responsible.email;\n            document.getElementById('editResponsiblePhone').value = responsible.phone || '';\n            document.getElementById('editResponsibleBirthDate').value = responsible.birthDate ? responsible.birthDate.split('T')[0] : '';\n            document.getElementById('editResponsibleRelationType').value = responsible.relationshipType || '';\n            \n            document.getElementById('editResponsibleModal').classList.add('active');\n        }\n\n        // Delete responsible\n        async function deleteResponsible(responsibleId) {\n            const responsible = allResponsibles.find(r => r.id === responsibleId);\n            if (!responsible) return;\n            \n            if (!confirm(`Tem certeza que deseja excluir o responsÃ¡vel \"${responsible.name}\"?`)) {\n                return;\n            }\n            \n            try {\n                const response = await fetch(`/api/financial-responsibles/${responsibleId}`, {\n                    method: 'DELETE'\n                });\n                \n                if (response.ok) {\n                    showToast('ResponsÃ¡vel excluÃ­do com sucesso!', 'success');\n                    loadFinancialResponsiblesList();\n                } else {\n                    throw new Error('Erro ao excluir responsÃ¡vel');\n                }\n            } catch (error) {\n                console.error('Erro:', error);\n                showToast('Erro ao excluir responsÃ¡vel', 'error');\n            }\n        }\n\n        \n        // ==========================================\n        // PAYMENT PLANS MANAGEMENT (CONTINUATION)\n        // ==========================================\n\n        // Load payment plans\n        async function loadPaymentPlansList() {\n            console.log('ðŸ”„ Loading payment plans list...');\n            try {\n                const loadingElement = document.getElementById('plansLoadingState');\n                const emptyElement = document.getElementById('plansEmptyState');\n                \n                if (loadingElement) loadingElement.style.display = 'block';\n                if (emptyElement) emptyElement.style.display = 'none';\n                \n                console.log('ðŸ“¡ Fetching billing plans from API...');\n                const response = await fetch('/api/billing-plans');\n                const result = await response.json();\n                \n                console.log('ðŸ“Š API Response:', result);\n                \n                if (result.success) {\n                    allPlans = result.data || [];\n                    console.log('ðŸ“‹ Plans loaded:', allPlans.length, 'plans');\n                    \n                    updatePaymentPlansTable(allPlans);\n                    updatePlansStats(allPlans);\n                    \n                    if (allPlans.length === 0) {\n                        if (loadingElement) loadingElement.style.display = 'none';\n                        if (emptyElement) emptyElement.style.display = 'block';\n                        console.log('âš ï¸ No plans found - showing empty state');\n                    } else {\n                        if (loadingElement) loadingElement.style.display = 'none';\n                        console.log('âœ… Plans table updated successfully');\n                    }\n                } else {\n                    throw new Error(result.message || 'Failed to load plans');\n                }\n            } catch (error) {\n                console.error('Erro ao carregar planos:', error);\n                \n                // Initialize allPlans as empty array to prevent undefined errors\n                allPlans = [];\n                updatePaymentPlansTable(allPlans);\n                updatePlansStats(allPlans);\n                \n                document.getElementById('plansLoadingState').innerHTML = `\n                    <div style=\"text-align: center; color: #EF4444; padding: 3rem;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">âš ï¸</div>\n                        <div style=\"font-size: 1.1rem; margin-bottom: 0.5rem;\">Erro ao carregar planos</div>\n                        <div style=\"font-size: 0.9rem; opacity: 0.7;\">${error.message}</div>\n                    </div>\n                `;\n            }\n        }\n\n        // Load courses for plan modal\n        async function loadCoursesForPlanModal() {\n            try {\n                console.log('ðŸ“š Carregando cursos para modal de planos...');\n                const response = await fetch('/api/courses');\n                const result = await response.json();\n                \n                if (result.success && result.data) {\n                    allCourses = result.data;\n                    const select = document.getElementById('planCourse');\n                    \n                    // Para seleÃ§Ã£o mÃºltipla, nÃ£o incluÃ­mos opÃ§Ã£o vazia\n                    // Cada curso Ã© uma opÃ§Ã£o selecionÃ¡vel independente\n                    select.innerHTML = allCourses.map(course => {\n                        const level = course.level || 'BEGINNER';\n                        const duration = course.duration || 24;\n                        const category = course.category || 'ADULT';\n                        \n                        return `<option value=\"${course.id}\" title=\"${course.description || course.name}\">\n                            ${course.name} (${level} - ${duration} semanas - ${category})\n                        </option>`;\n                    }).join('');\n                    \n                    console.log(`âœ… ${allCourses.length} cursos carregados para seleÃ§Ã£o mÃºltipla`);\n                } else {\n                    console.error('âŒ Nenhum curso encontrado:', result);\n                    const select = document.getElementById('planCourse');\n                    select.innerHTML = '<option value=\"\" disabled>Nenhum curso disponÃ­vel</option>';\n                }\n            } catch (error) {\n                console.error('âŒ Erro ao carregar cursos:', error);\n                const select = document.getElementById('planCourse');\n                select.innerHTML = '<option value=\"\" disabled>Erro ao carregar cursos</option>';\n            }\n        }\n\n        // Update plans table (for payment plans section)\n        function updatePaymentPlansTable(plans) {\n            console.log('ðŸ”„ Updating payment plans table with', plans?.length, 'plans');\n            const tbody = document.getElementById('plansTableBody');\n            \n            // Check if tbody exists and plans is an array\n            if (!tbody) {\n                console.error('âŒ plansTableBody element not found in DOM');\n                return;\n            }\n            \n            if (!plans || !Array.isArray(plans)) {\n                console.warn('âš ï¸ Plans data is undefined or not an array:', plans);\n                tbody.innerHTML = '<tr><td colspan=\"7\" style=\"text-align: center; color: #94A3B8; padding: 2rem;\">Nenhum plano encontrado</td></tr>';\n                return;\n            }\n            \n            console.log('ðŸ“‹ Processing', plans.length, 'plans for table');\n            \n            tbody.innerHTML = plans.map(plan => {\n                const courseName = (allCourses && Array.isArray(allCourses)) \n                    ? allCourses.find(c => c.id === plan.courseId)?.name || 'Geral'\n                    : 'Geral';\n                \n                return `\n                <tr ondblclick=\"openPlanEditPage('${plan.id}')\" style=\"cursor: pointer;\">\n                    <td>\n                        <div class=\"student-name\">${plan.name}</div>\n                        <div style=\"font-size: 0.8rem; color: #94A3B8;\">${plan.description || ''}</div>\n                    </td>\n                    <td>\n                        <span class=\"student-email\">${courseName}</span>\n                    </td>\n                    <td>\n                        <span class=\"badge ${plan.category === 'ADULT' ? 'success' : 'info'}\">\n                            ${plan.category}\n                        </span>\n                    </td>\n                    <td>\n                        <span class=\"metric-value\" style=\"color: #10B981; font-weight: bold;\">\n                            R$ ${parseFloat(plan.price).toFixed(2)}\n                        </span>\n                    </td>\n                    <td>\n                        <span class=\"badge ${plan.billingType === 'MONTHLY' ? 'info' : 'warning'}\">\n                            ${plan.billingType === 'MONTHLY' ? 'Mensal' : plan.billingType}\n                        </span>\n                    </td>\n                    <td>\n                        <span class=\"badge info\">${plan.activeSubscriptions || 0}</span>\n                    </td>\n                    <td>\n                        <span class=\"badge ${plan.isActive ? 'success' : 'danger'}\">\n                            ${plan.isActive ? 'Ativo' : 'Inativo'}\n                        </span>\n                    </td>\n                    <td>\n                        <div class=\"action-buttons\">\n                            <button class=\"action-btn edit\" onclick=\"editPlan('${plan.id}')\" title=\"Editar\">\n                                âœï¸\n                            </button>\n                            <button class=\"action-btn delete\" onclick=\"deletePlan('${plan.id}')\" title=\"Excluir\">\n                                ðŸ—‘ï¸\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `;\n            }).join('');\n            \n            console.log('âœ… Table HTML updated. Rows in tbody:', tbody.children.length);\n        }\n\n        // Update plans stats\n        function updatePlansStats(plans) {\n            // Check if plans is an array\n            if (!plans || !Array.isArray(plans)) {\n                console.warn('Plans data is undefined or not an array for stats:', plans);\n                const totalElement = document.getElementById('totalPlansCount');\n                const activeElement = document.getElementById('activePlansCount');\n                if (totalElement) totalElement.textContent = '0';\n                if (activeElement) activeElement.textContent = '0';\n                return;\n            }\n            \n            const totalElement = document.getElementById('totalPlansCount');\n            const activeElement = document.getElementById('activePlansCount');\n            \n            if (totalElement) totalElement.textContent = plans.length;\n            if (activeElement) activeElement.textContent = plans.filter(p => p.isActive !== false).length;\n            \n            const avgPrice = plans.length > 0 ? \n                (plans.reduce((sum, p) => sum + parseFloat(p.price || 0), 0) / plans.length).toFixed(2) : '0.00';\n            const avgPriceElement = document.getElementById('avgPlanPrice');\n            if (avgPriceElement) avgPriceElement.textContent = `R$ ${avgPrice}`;\n            \n            const monthlyPlans = plans.filter(p => p.billingType === 'MONTHLY').length;\n            const monthlyElement = document.getElementById('monthlyPlansCount');\n            if (monthlyElement) monthlyElement.textContent = monthlyPlans;\n            \n            // Update badge count (if exists)\n            const countElement = document.getElementById('plans-count');\n            if (countElement) countElement.textContent = plans.length;\n        }\n\n        // Open add plan modal\n        function openAddPlanModal() {\n            loadCoursesForPlanModal();\n            document.getElementById('addPlanForm').reset();\n            \n            // Reset modal to create mode\n            document.querySelector('#addPlanModal .modal-title').textContent = 'Novo Plano de Pagamento';\n            document.querySelector('#addPlanModal button[type=\"submit\"]').textContent = 'Criar Plano';\n            delete document.getElementById('addPlanForm').dataset.editingPlanId;\n            \n            // Reset to first tab\n            switchPlanTab('basic');\n            \n            document.getElementById('addPlanModal').classList.add('active');\n        }\n\n        // Switch between plan modal tabs\n        function switchPlanTab(tabName) {\n            // Remove active class from all tabs and content\n            document.querySelectorAll('.plan-tab').forEach(tab => tab.classList.remove('active'));\n            document.querySelectorAll('.plan-tab-content').forEach(content => content.classList.remove('active'));\n            \n            // Add active class to selected tab and content\n            const selectedTab = document.querySelector(`.plan-tab[data-tab=\"${tabName}\"]`);\n            const selectedContent = document.getElementById(`planTab-${tabName}`);\n            \n            if (selectedTab && selectedContent) {\n                selectedTab.classList.add('active');\n                selectedContent.classList.add('active');\n            }\n            \n            // Load content for specific tabs\n            if (tabName === 'courses') {\n                loadCoursesForPlanSelection();\n            } else if (tabName === 'preview') {\n                updatePlanPreview();\n            }\n        }\n\n        // Load courses for plan selection (enhanced version)\n        async function loadCoursesForPlanSelection() {\n            const coursesGrid = document.getElementById('coursesGrid');\n            \n            try {\n                // Show loading state\n                coursesGrid.innerHTML = `\n                    <div class=\"loading-state\">\n                        <div class=\"spinner\"></div>\n                        <p>Carregando cursos disponÃ­veis...</p>\n                    </div>\n                `;\n                \n                const response = await fetch('/api/courses');\n                const result = await response.json();\n                \n                if (result.success && result.data.length > 0) {\n                    const courses = result.data;\n                    \n                    // Update stats\n                    document.getElementById('coursesTotalCount').textContent = `${courses.length} cursos disponÃ­veis`;\n                    updateSelectedCoursesCount();\n                    \n                    // Render courses grid\n                    coursesGrid.innerHTML = courses.map(course => `\n                        <div class=\"course-card\" onclick=\"toggleCourseSelection('${course.id}', this)\">\n                            <div class=\"course-card-header\">\n                                <div>\n                                    <h4 style=\"color: #E2E8F0; margin: 0 0 0.5rem 0; font-size: 1.1rem;\">${course.name}</h4>\n                                    <p style=\"color: #94A3B8; margin: 0; font-size: 0.875rem;\">${course.description || 'DescriÃ§Ã£o nÃ£o disponÃ­vel'}</p>\n                                </div>\n                                <input type=\"checkbox\" class=\"course-checkbox\" data-course-id=\"${course.id}\">\n                            </div>\n                            <div style=\"margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(148, 163, 184, 0.2);\">\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">\n                                    <div>ðŸŽ“ ${course.totalLessons || 48} aulas</div>\n                                    <div>â±ï¸ ${course.duration || '12 meses'}</div>\n                                    <div>ðŸ‘¥ ${course.maxStudents || 20} alunos max</div>\n                                </div>\n                            </div>\n                        </div>\n                    `).join('');\n                } else {\n                    coursesGrid.innerHTML = `\n                        <div style=\"text-align: center; color: #94A3B8; padding: 3rem;\">\n                            <h4>ðŸ“š Nenhum curso disponÃ­vel</h4>\n                            <p>Crie cursos primeiro para associÃ¡-los aos planos.</p>\n                        </div>\n                    `;\n                }\n            } catch (error) {\n                console.error('Erro ao carregar cursos:', error);\n                coursesGrid.innerHTML = `\n                    <div style=\"text-align: center; color: #EF4444; padding: 3rem;\">\n                        <h4>âŒ Erro ao carregar cursos</h4>\n                        <p>Tente novamente ou verifique a conexÃ£o.</p>\n                    </div>\n                `;\n            }\n        }\n\n        // Toggle course selection\n        function toggleCourseSelection(courseId, cardElement) {\n            const checkbox = cardElement.querySelector('.course-checkbox');\n            const isSelected = checkbox.checked;\n            \n            // Toggle selection\n            checkbox.checked = !isSelected;\n            \n            // Update visual state\n            if (!isSelected) {\n                cardElement.classList.add('selected');\n            } else {\n                cardElement.classList.remove('selected');\n            }\n            \n            // Update legacy multi-select field\n            updateLegacyPlanCourseField();\n            updateSelectedCoursesCount();\n            updatePlanPreview();\n        }\n\n        // Select all courses\n        function selectAllCourses() {\n            document.querySelectorAll('.course-card').forEach(card => {\n                const checkbox = card.querySelector('.course-checkbox');\n                checkbox.checked = true;\n                card.classList.add('selected');\n            });\n            updateLegacyPlanCourseField();\n            updateSelectedCoursesCount();\n            updatePlanPreview();\n        }\n\n        // Clear all course selections\n        function clearAllCourses() {\n            document.querySelectorAll('.course-card').forEach(card => {\n                const checkbox = card.querySelector('.course-checkbox');\n                checkbox.checked = false;\n                card.classList.remove('selected');\n            });\n            updateLegacyPlanCourseField();\n            updateSelectedCoursesCount();\n            updatePlanPreview();\n        }\n\n        // Update selected courses count\n        function updateSelectedCoursesCount() {\n            const selectedCount = document.querySelectorAll('.course-checkbox:checked').length;\n            document.getElementById('coursesSelectedCount').textContent = `${selectedCount} cursos selecionados`;\n        }\n\n        // Update legacy plan course field for compatibility\n        function updateLegacyPlanCourseField() {\n            const legacySelect = document.getElementById('planCourse');\n            const selectedCourses = document.querySelectorAll('.course-checkbox:checked');\n            \n            // Clear existing options\n            legacySelect.innerHTML = '';\n            \n            // Add selected courses as options\n            selectedCourses.forEach(checkbox => {\n                const courseId = checkbox.dataset.courseId;\n                const card = checkbox.closest('.course-card');\n                const courseName = card.querySelector('h4').textContent;\n                \n                const option = document.createElement('option');\n                option.value = courseId;\n                option.textContent = courseName;\n                option.selected = true;\n                legacySelect.appendChild(option);\n            });\n        }\n\n        // Update plan preview (Enhanced for new tab system)\n        function updatePlanPreview() {\n            const courseSelect = document.getElementById('planCourse');\n            const categorySelect = document.getElementById('planCategory');\n            const billingTypeSelect = document.getElementById('planBillingType');\n            const classesPerWeekSelect = document.getElementById('planClassesPerWeek');\n            \n            const selectedCourses = Array.from(courseSelect.selectedOptions).map(option => option.text);\n            const courseName = selectedCourses.length > 0 ? selectedCourses.join(', ') : 'Nenhum curso selecionado';\n            const category = categorySelect.value;\n            const billingType = billingTypeSelect?.value || 'MONTHLY';\n            const classesPerWeek = classesPerWeekSelect?.value || '2';\n            \n            // Suggested category prices mapping (not enforced)\n            const suggestedCategoryPrices = {\n                'ADULT': '180.00',\n                'FEMALE': '170.00',\n                'SENIOR': '130.00',\n                'CHILD': '120.00',\n                'INICIANTE1': '120.00',\n                'INICIANTE2': '130.00',\n                'INICIANTE3': '140.00',\n                'HEROI1': '160.00',\n                'HEROI2': '170.00',\n                'HEROI3': '180.00',\n                'MASTER_1': '200.00',\n                'MASTER_2': '220.00',\n                'MASTER_3': '250.00'\n            };\n            \n            const selectedCount = courseSelect.selectedOptions.length;\n            const planName = selectedCount === 0 ? 'Novo Plano' :\n                selectedCount === 1 ? `${courseName} - ${category}` : \n                `Multi-Curso (${selectedCount} cursos) - ${category}`;\n            \n            const customPrice = document.getElementById('planCustomPrice').value;\n            \n            // Only suggest price if field is completely empty, don't enforce it\n            if (!customPrice && category) {\n                const suggestedPrice = suggestedCategoryPrices[category] || '150.00';\n                const adjustedPrice = selectedCount > 1 ? \n                    (parseFloat(suggestedPrice) * 1.5).toFixed(2) : suggestedPrice;\n                \n                // Set placeholder instead of value, so user can choose\n                document.getElementById('planCustomPrice').placeholder = `SugestÃ£o: R$ ${adjustedPrice}`;\n            }\n            \n            const price = customPrice || '0.00';\n            \n            // Update preview elements\n            document.getElementById('previewPlanName').textContent = planName;\n            document.getElementById('previewPlanPrice').textContent = `R$ ${parseFloat(price || 0).toFixed(2)}`;\n            \n            const description = selectedCount === 0 ? 'Selecione pelo menos um curso para continuar' :\n                selectedCount === 1 ? `Plano ${category.toLowerCase()} para ${courseName}` :\n                `Plano ${category.toLowerCase()} com acesso a ${selectedCount} cursos: ${courseName}`;\n            document.getElementById('previewPlanDescription').textContent = description;\n            \n            // Update detailed preview information\n            const categoryNames = {\n                'ADULT': 'Adulto',\n                'FEMALE': 'Feminino',\n                'SENIOR': 'Senior/Idoso',\n                'CHILD': 'Infantil/CrianÃ§a',\n                'INICIANTE1': 'Iniciante 1',\n                'INICIANTE2': 'Iniciante 2',\n                'INICIANTE3': 'Iniciante 3',\n                'HEROI1': 'HerÃ³i 1',\n                'HEROI2': 'HerÃ³i 2',\n                'HEROI3': 'HerÃ³i 3',\n                'MASTER_1': 'Master 1',\n                'MASTER_2': 'Master 2',\n                'MASTER_3': 'Master 3'\n            };\n            \n            const billingTypeNames = {\n                'MONTHLY': 'Mensal',\n                'WEEKLY': 'Semanal',\n                'QUARTERLY': 'Trimestral',\n                'YEARLY': 'Anual'\n            };\n            \n            document.getElementById('previewCategory').textContent = categoryNames[category] || category || 'NÃ£o definida';\n            document.getElementById('previewBillingType').textContent = billingTypeNames[billingType] || billingType;\n            document.getElementById('previewCourses').textContent = selectedCount > 0 ? courseName : 'Nenhum curso selecionado';\n            document.getElementById('previewClassesPerWeek').textContent = classesPerWeek === 'unlimited' ? 'Ilimitado' : `${classesPerWeek} aulas`;\n            \n            // Auto-fill form fields\n            if (!document.getElementById('planName').value) {\n                document.getElementById('planName').value = planName;\n            }\n            if (!document.getElementById('planDescription').value && selectedCount > 0) {\n                document.getElementById('planDescription').value = description;\n            }\n        }\n\n        // Edit plan\n        async function editPlan(planId) {\n            try {\n                console.log('ðŸ”§ Editando plano:', planId);\n                \n                // Fetch plan data from server\n                const response = await fetch(`/api/billing-plans/${planId}`);\n                const result = await response.json();\n                \n                if (!result.success) {\n                    console.error('âŒ Erro ao buscar plano:', result.error);\n                    showToast('Erro ao carregar dados do plano: ' + result.message, 'error');\n                    return;\n                }\n                \n                const plan = result.data;\n                console.log('ðŸ“‹ Dados do plano carregados:', plan);\n                \n                // Load courses first and wait for completion\n                await loadCoursesForPlanModal();\n                \n                // Fill form with plan data\n                const courseSelect = document.getElementById('planCourse');\n                \n                // Handle multiple course selection for editing\n                if (plan.courseIds && Array.isArray(plan.courseIds)) {\n                    // Clear all selections first\n                    for (let option of courseSelect.options) {\n                        option.selected = false;\n                    }\n                    // Select the courses associated with this plan\n                    plan.courseIds.forEach(courseId => {\n                        const option = courseSelect.querySelector(`option[value=\"${courseId}\"]`);\n                        if (option) option.selected = true;\n                    });\n                } else if (plan.courseId) {\n                    // Backward compatibility for single course\n                    courseSelect.value = plan.courseId;\n                }\n            \n            document.getElementById('planCategory').value = plan.category || '';\n            document.getElementById('planName').value = plan.name || '';\n            document.getElementById('planCustomPrice').value = plan.price || '';\n            document.getElementById('planDescription').value = plan.description || '';\n            document.getElementById('planBillingType').value = plan.billingType || 'MONTHLY';\n            document.getElementById('planClassesPerWeek').value = plan.classesPerWeek || 2;\n            \n            // Update modal title and button\n            document.querySelector('#addPlanModal .modal-title').textContent = 'Editar Plano de Pagamento';\n            document.querySelector('#addPlanModal button[type=\"submit\"]').textContent = 'Atualizar Plano';\n            \n            // Store plan ID for update\n            document.getElementById('addPlanForm').dataset.editingPlanId = planId;\n            \n            // Show modal\n            document.getElementById('addPlanModal').classList.add('active');\n            \n                // Update preview\n                setTimeout(() => updatePlanPreview(), 100);\n                \n            } catch (error) {\n                console.error('âŒ Erro ao editar plano:', error);\n                showToast('Erro ao carregar plano para ediÃ§Ã£o: ' + error.message, 'error');\n            }\n        }\n\n        // Delete plan\n        async function deletePlan(planId) {\n            console.log('ðŸ—‘ï¸ Attempting to delete plan:', planId);\n            console.log('ðŸ“Š Available plans:', allPlans);\n            \n            const plan = allPlans.find(p => p.id == planId || p.id === planId);\n            if (!plan) {\n                console.error('âŒ Plan not found in allPlans array');\n                console.error('ðŸ” Searched for ID:', planId, 'Type:', typeof planId);\n                console.error('ðŸ“‹ Available IDs:', allPlans.map(p => ({id: p.id, type: typeof p.id})));\n                showNotification('Plano nÃ£o encontrado', 'error');\n                return;\n            }\n            \n            if (!confirm(`Tem certeza que deseja excluir o plano \"${plan.name}\"?`)) {\n                return;\n            }\n            \n            try {\n                console.log('ðŸ—‘ï¸ Deleting plan via API...');\n                \n                const response = await fetch(`/api/billing-plans/${planId}`, {\n                    method: 'DELETE'\n                });\n                \n                const data = await response.json();\n                \n                if (response.ok && data.success) {\n                    // Remove from local array\n                    const planIndex = allPlans.findIndex(p => p.id == planId || p.id === planId);\n                    if (planIndex !== -1) {\n                        allPlans.splice(planIndex, 1);\n                    }\n                    \n                    // Update display\n                    updatePaymentPlansTable(allPlans);\n                    updatePlansStats(allPlans);\n                    \n                    showToast('Plano excluÃ­do com sucesso!', 'success');\n                } else {\n                    throw new Error(data.message || data.error || 'Erro ao excluir plano');\n                }\n                \n            } catch (error) {\n                console.error('Erro:', error);\n                showToast(`Erro ao excluir plano: ${error.message}`, 'error');\n            }\n        }\n\n        // ==========================================\n        // ADVANCED PLAN FORM CONTROLS\n        // ==========================================\n        \n        // Toggle installment options based on billing type\n        function toggleInstallmentOptions() {\n            const billingType = document.getElementById('planBillingType').value;\n            const installmentOptions = document.getElementById('installmentOptions');\n            const recurringOptions = document.getElementById('recurringOptions');\n            \n            if (billingType === 'CREDIT_CARD_INSTALLMENT') {\n                installmentOptions.style.display = 'block';\n                recurringOptions.style.display = 'none';\n            } else if (billingType === 'RECURRING') {\n                installmentOptions.style.display = 'none';\n                recurringOptions.style.display = 'block';\n            } else {\n                installmentOptions.style.display = 'none';\n                recurringOptions.style.display = 'none';\n            }\n        }\n        \n        // Toggle unlimited access options\n        function toggleUnlimitedOptions() {\n            const accessType = document.getElementById('planAccessType').value;\n            const limitedOptions = document.getElementById('limitedAccessOptions');\n            \n            if (accessType === 'unlimited') {\n                limitedOptions.style.display = 'none';\n                // Set unlimited values\n                document.getElementById('planClassesPerWeek').value = '7';\n                document.getElementById('planMaxClasses').value = '';\n            } else {\n                limitedOptions.style.display = 'block';\n            }\n        }\n        \n        // Enhanced category pricing with new categories\n        const categoryPricing = {\n            'ADULT': { price: 180.00, name: 'Adulto' },\n            'FEMALE': { price: 170.00, name: 'Feminino' },\n            'SENIOR': { price: 130.00, name: 'Senior/Idoso' },\n            'CHILD': { price: 120.00, name: 'Infantil/CrianÃ§a' },\n            'INICIANTE1': { price: 120.00, name: 'Iniciante 1' },\n            'INICIANTE2': { price: 130.00, name: 'Iniciante 2' },\n            'INICIANTE3': { price: 140.00, name: 'Iniciante 3' },\n            'HEROI1': { price: 160.00, name: 'HerÃ³i 1' },\n            'HEROI2': { price: 170.00, name: 'HerÃ³i 2' },\n            'HEROI3': { price: 180.00, name: 'HerÃ³i 3' },\n            'MASTER_1': { price: 200.00, name: 'Master 1' },\n            'MASTER_2': { price: 220.00, name: 'Master 2' },\n            'MASTER_3': { price: 250.00, name: 'Master 3' }\n        };\n        \n        // Billing type translations\n        const billingTypeNames = {\n            'MONTHLY': 'Mensal',\n            'QUARTERLY': 'Trimestral', \n            'YEARLY': 'Anual',\n            'CREDIT_CARD_INSTALLMENT': 'CartÃ£o Parcelado',\n            'RECURRING': 'Assinatura Recorrente',\n            'LIFETIME': 'VitalÃ­cio'\n        };\n\n        // ==========================================\n        // NAVIGATION AND INITIALIZATION\n        // ==========================================\n\n        // Enhanced navigation handling\n        document.addEventListener('DOMContentLoaded', function() {\n            // Add navigation click handlers\n            document.querySelectorAll('.nav-link[data-page]').forEach(link => {\n                link.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    const page = this.getAttribute('data-page');\n                    showSection(page);\n                });\n            });\n\n            // Initial page load\n            showSection('dashboard');\n        });\n\n        // Show section function\n        function showSection(sectionName) {\n            // Hide all sections\n            document.querySelectorAll('.content-section').forEach(section => {\n                section.classList.remove('active');\n                section.style.display = 'none';\n            });\n\n            // Update navigation\n            document.querySelectorAll('.nav-link').forEach(link => {\n                link.classList.remove('active');\n            });\n            \n            const activeLink = document.querySelector(`[data-page=\"${sectionName}\"]`);\n            if (activeLink) {\n                activeLink.classList.add('active');\n            }\n\n            // Show selected section\n            const section = document.getElementById(sectionName);\n            if (section) {\n                section.style.display = 'block';\n                section.classList.add('active');\n                \n                // Load section-specific data\n                loadSectionData(sectionName);\n            }\n        }\n\n        // Load section-specific data\n        function loadSectionData(sectionName) {\n            switch (sectionName) {\n                case 'students':\n                    loadStudents();\n                    break;\n                case 'financial-responsibles':\n                    loadFinancialResponsiblesList();\n                    break;\n                case 'payment-plans':\n                    loadPaymentPlansList();\n                    break;\n                case 'financial':\n                    if (typeof loadFinancialData === 'function') {\n                        loadFinancialData();\n                    }\n                    break;\n                case 'attendance':\n                    if (typeof loadAttendanceList === 'function') {\n                        loadAttendanceList();\n                    }\n                    break;\n                case 'quick-checkin':\n                    if (typeof loadStudentsForCheckin === 'function') {\n                        loadStudentsForCheckin();\n                    }\n                    break;\n                case 'public-checkin':\n                    if (typeof loadStudentsForPublicCheckin === 'function') {\n                        loadStudentsForPublicCheckin();\n                    }\n                    break;\n                default:\n                    // No specific loading needed\n                    break;\n            }\n        }\n\n        // ==========================================\n        // STUDENT ENROLLMENT WITH AUTOMATIC PLAN PREVIEW\n        // ==========================================\n\n        // Load courses for student modal\n        async function loadCoursesForStudentModal() {\n            try {\n                const response = await fetch('/api/courses');\n                const result = await response.json();\n                \n                if (result.success) {\n                    const select = document.getElementById('studentCourse');\n                    select.innerHTML = '<option value=\"\">Selecione um curso (opcional)</option>' +\n                        result.data.map(course => \n                            `<option value=\"${course.id}\">${course.name}</option>`\n                        ).join('');\n                }\n            } catch (error) {\n                console.error('Erro ao carregar cursos:', error);\n            }\n        }\n\n        // Update student plan preview based on category and course\n        function updateStudentPlanPreview() {\n            const courseSelect = document.getElementById('studentCourse');\n            const categorySelect = document.getElementById('studentCategory');\n            const courseName = courseSelect.options[courseSelect.selectedIndex]?.text || '';\n            const category = categorySelect.value;\n            \n            if (courseSelect.value && category) {\n                const planName = `${courseName} - ${category}`;\n                // Use flexible pricing instead of hardcoded values\n                const price = '0.00'; // Let user set their own price\n                \n                document.getElementById('previewStudentPlanName').textContent = planName;\n                document.getElementById('previewStudentPlanPrice').textContent = `R$ ${parseFloat(price).toFixed(2)}`;\n                document.getElementById('previewStudentPlanDescription').textContent = \n                    `Plano automÃ¡tico para ${courseName} categoria ${category}`;\n                \n                document.getElementById('studentPlanPreview').style.display = 'block';\n            } else {\n                document.getElementById('studentPlanPreview').style.display = 'none';\n            }\n        }\n\n        function updateEditStudentPlanPreview() {\n            const courseSelect = document.getElementById('editStudentCourse');\n            const categorySelect = document.getElementById('editStudentCategory');\n            const courseName = courseSelect.options[courseSelect.selectedIndex]?.text || '';\n            const category = categorySelect.value;\n            \n            if (courseSelect.value && category) {\n                const planName = `${courseName} - ${category}`;\n                // Use flexible pricing instead of hardcoded values\n                const price = '0.00'; // Let user set their own price\n                \n                document.getElementById('previewEditStudentPlanName').textContent = planName;\n                document.getElementById('previewEditStudentPlanPrice').textContent = `R$ ${parseFloat(price).toFixed(2)}`;\n                document.getElementById('previewEditStudentPlanDescription').textContent = \n                    `Plano automÃ¡tico para ${courseName} categoria ${category}`;\n                \n                document.getElementById('editStudentPlanPreview').style.display = 'block';\n            } else {\n                document.getElementById('editStudentPlanPreview').style.display = 'none';\n            }\n        }\n\n        // Enhanced switch between tabs in edit modal with UX improvements\n        function switchEditTab(tabName) {\n            // Hide all tab contents with fade effect\n            const tabContents = document.querySelectorAll('.edit-tab-content');\n            tabContents.forEach(tab => {\n                tab.style.opacity = '0';\n                setTimeout(() => tab.style.display = 'none', 150);\n            });\n\n            // Remove active class from all tab buttons\n            const tabButtons = document.querySelectorAll('.edit-tab-btn');\n            tabButtons.forEach(btn => {\n                btn.classList.remove('active');\n                if (btn.classList.contains('primary')) {\n                    btn.style.background = 'transparent';\n                    btn.style.color = '#94A3B8';\n                } else {\n                    btn.style.color = '#94A3B8';\n                    btn.style.borderBottomColor = 'transparent';\n                }\n            });\n\n            // Show selected tab content with fade in\n            setTimeout(() => {\n                const selectedTab = document.getElementById(`edit-tab-${tabName}`);\n                if (selectedTab) {\n                    selectedTab.style.display = 'block';\n                    setTimeout(() => selectedTab.style.opacity = '1', 50);\n                }\n            }, 150);\n\n            // Add active class to selected tab button\n            const selectedBtn = document.querySelector(`[data-tab=\"${tabName}\"]`);\n            if (selectedBtn) {\n                selectedBtn.classList.add('active');\n                if (selectedBtn.classList.contains('primary')) {\n                    selectedBtn.style.background = 'linear-gradient(135deg, #3B82F6, #1D4ED8)';\n                    selectedBtn.style.color = 'white';\n                } else {\n                    selectedBtn.style.color = '#3B82F6';\n                    selectedBtn.style.borderBottomColor = '#3B82F6';\n                }\n            }\n\n            // Load content and populate overview tab\n            if (tabName === 'overview') {\n                populateOverviewTab();\n            }\n        }\n\n        // Form progress tracking\n        function updateFormProgress() {\n            const form = document.getElementById('editStudentForm');\n            const inputs = form.querySelectorAll('input[required], select[required]');\n            let completed = 0;\n            \n            inputs.forEach(input => {\n                if (input.value && input.value.trim() !== '') {\n                    completed++;\n                }\n            });\n            \n            const progress = Math.round((completed / inputs.length) * 100);\n            const progressBar = document.getElementById('editFormProgress');\n            if (progressBar) {\n                progressBar.style.width = `${progress}%`;\n            }\n        }\n\n        // Auto-fill demo data\n        function autoFillDemo() {\n            document.getElementById('editFirstName').value = 'JoÃ£o';\n            document.getElementById('editLastName').value = 'Silva';\n            document.getElementById('editEmail').value = 'joao.silva@email.com';\n            document.getElementById('editPhone').value = '(11) 99999-9999';\n            document.getElementById('editCpf').value = '123.456.789-00';\n            document.getElementById('editBirthDate').value = '1985-05-15';\n            document.getElementById('editCategory').value = 'ADULT';\n            document.getElementById('editGender').value = 'MASCULINO';\n            \n            updateFormProgress();\n            showToast('âœ… Dados demo preenchidos com sucesso!', 'success');\n        }\n\n        // Populate overview tab with current data\n        function populateOverviewTab() {\n            const firstName = document.getElementById('editFirstName').value;\n            const lastName = document.getElementById('editLastName').value;\n            const email = document.getElementById('editEmail').value;\n            const phone = document.getElementById('editPhone').value;\n            const cpf = document.getElementById('editCpf').value;\n            const category = document.getElementById('editCategory').value;\n            \n            // Update overview fields\n            document.getElementById('overviewFullName').textContent = `${firstName} ${lastName}`.trim() || '-';\n            document.getElementById('overviewEmail').textContent = email || '-';\n            document.getElementById('overviewPhone').textContent = phone || '-';\n            document.getElementById('overviewCpf').textContent = cpf || '-';\n            document.getElementById('overviewCategory').textContent = category || '-';\n            document.getElementById('overviewStatus').textContent = 'Ativo';\n            document.getElementById('overviewEnrollment').textContent = new Date().toLocaleDateString('pt-BR');\n            document.getElementById('overviewPhysical').textContent = 'IntermediÃ¡rio';\n        }\n\n        // Update student summary card\n        function updateStudentSummary(student) {\n            const user = student.user || {};\n            const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();\n            \n            document.getElementById('editStudentSummaryName').textContent = fullName || 'Nome do Aluno';\n            document.getElementById('editStudentSummaryId').textContent = `ID: ${student.id || '-'}`;\n            document.getElementById('editStudentSummaryCategory').textContent = `Categoria: ${student.category || '-'}`;\n            document.getElementById('editStudentLastModified').textContent = 'agora mesmo';\n        }\n\n        // Placeholder functions for tab content loading\n        function loadStudentProgressTab() {\n            const progressTab = document.getElementById('edit-tab-progress');\n            if (progressTab) {\n                progressTab.innerHTML = `\n                    <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“ˆ</div>\n                        <p>Funcionalidade de progresso em desenvolvimento...</p>\n                    </div>\n                `;\n            }\n        }\n\n        async function loadStudentFinancialTab() {\n            const studentId = document.getElementById('editStudentForm')?.dataset.editingStudentId;\n            if (!studentId) {\n                console.error('Student ID not found for financial tab');\n                return;\n            }\n            \n            try {\n                // Load current plan information\n                await loadStudentCurrentPlan(studentId);\n                \n                // Load payment status\n                await loadStudentPaymentStatus(studentId);\n                \n                // Load payment history  \n                await loadStudentPaymentHistory(studentId);\n                \n                // Load available plans for upgrade\n                await loadAvailablePlansForUpgrade(studentId);\n                \n            } catch (error) {\n                console.error('Error loading student financial data:', error);\n                showToast('Erro ao carregar informaÃ§Ãµes financeiras', 'error');\n            }\n        }\n\n        // Load student's current plan\n        async function loadStudentCurrentPlan(studentId) {\n            const container = document.getElementById('currentPlanContainer');\n            \n            try {\n                // First try to get student subscription\n                const subscriptionResponse = await fetch(`/api/students/${studentId}/subscription`);\n                let subscription = null;\n                \n                if (subscriptionResponse.ok) {\n                    const subscriptionResult = await subscriptionResponse.json();\n                    if (subscriptionResult.success) {\n                        subscription = subscriptionResult.data;\n                    }\n                }\n                \n                if (subscription && subscription.plan) {\n                    // Student has an active subscription\n                    const plan = subscription.plan;\n                    container.innerHTML = `\n                        <div style=\"display: grid; grid-template-columns: 1fr auto; gap: 2rem; align-items: start;\">\n                            <div>\n                                <h4 style=\"color: #3B82F6; margin: 0 0 1rem 0; font-size: 1.2rem;\">${plan.name}</h4>\n                                <div style=\"color: #CBD5E1; margin-bottom: 1rem;\">\n                                    <div style=\"margin-bottom: 0.5rem;\"><strong>Valor:</strong> R$ ${parseFloat(plan.price).toFixed(2)}/${plan.billingType === 'MONTHLY' ? 'mÃªs' : plan.billingType.toLowerCase()}</div>\n                                    <div style=\"margin-bottom: 0.5rem;\"><strong>Categoria:</strong> ${plan.category}</div>\n                                    <div style=\"margin-bottom: 0.5rem;\"><strong>Aulas/Semana:</strong> ${plan.classesPerWeek || 'NÃ£o definido'}</div>\n                                    <div style=\"margin-bottom: 0.5rem;\"><strong>Status:</strong> \n                                        <span style=\"color: ${subscription.status === 'ACTIVE' ? '#10B981' : '#EF4444'};\">\n                                            ${subscription.status === 'ACTIVE' ? 'âœ… Ativo' : 'âŒ Inativo'}\n                                        </span>\n                                    </div>\n                                </div>\n                                ${plan.description ? `<p style=\"color: #94A3B8; font-size: 0.875rem; margin: 0;\">${plan.description}</p>` : ''}\n                            </div>\n                            <div style=\"text-align: center;\">\n                                <div style=\"background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; border-radius: 12px; padding: 1.5rem; min-width: 120px;\">\n                                    <div style=\"color: #3B82F6; font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;\">R$ ${parseFloat(plan.price).toFixed(2)}</div>\n                                    <div style=\"color: #94A3B8; font-size: 0.75rem;\">${plan.billingType === 'MONTHLY' ? 'Mensal' : plan.billingType}</div>\n                                </div>\n                            </div>\n                        </div>\n                    `;\n                } else {\n                    // Student doesn't have a subscription\n                    container.innerHTML = `\n                        <div style=\"text-align: center; padding: 2rem;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;\">ðŸ“„</div>\n                            <h4 style=\"color: #94A3B8; margin: 0 0 0.5rem 0;\">Nenhum plano ativo</h4>\n                            <p style=\"color: #6B7280; margin: 0 0 1.5rem 0; font-size: 0.875rem;\">Este aluno ainda nÃ£o possui um plano de pagamento associado.</p>\n                            <button class=\"btn btn-primary\" onclick=\"assignPlanToStudent('${studentId}')\" style=\"padding: 0.75rem 1.5rem;\">\n                                ðŸ“‹ Atribuir Plano\n                            </button>\n                        </div>\n                    `;\n                }\n            } catch (error) {\n                console.error('Error loading current plan:', error);\n                container.innerHTML = `\n                    <div style=\"text-align: center; padding: 2rem; color: #EF4444;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">âŒ</div>\n                        <p>Erro ao carregar informaÃ§Ãµes do plano</p>\n                    </div>\n                `;\n            }\n        }\n\n        // Load student payment status\n        async function loadStudentPaymentStatus(studentId) {\n            const container = document.getElementById('paymentStatusContainer');\n            \n            try {\n                // Mock payment status for now - replace with real API call\n                const paymentStatus = {\n                    status: 'NO_PLAN',\n                    lastPayment: null,\n                    nextDueDate: null,\n                    amount: 0.00\n                };\n                \n                const statusColor = paymentStatus.status === 'UP_TO_DATE' ? '#10B981' : \n                                  paymentStatus.status === 'OVERDUE' ? '#EF4444' : '#F59E0B';\n                \n                const statusText = paymentStatus.status === 'UP_TO_DATE' ? 'âœ… Em dia' :\n                                 paymentStatus.status === 'OVERDUE' ? 'âŒ Em atraso' : 'âš ï¸ Vencendo';\n                \n                container.innerHTML = `\n                    <div style=\"margin-bottom: 0.5rem;\"><strong>Ãšltimo Pagamento:</strong> ${new Date(paymentStatus.lastPayment).toLocaleDateString('pt-BR')}</div>\n                    <div style=\"margin-bottom: 0.5rem;\"><strong>PrÃ³ximo Vencimento:</strong> ${new Date(paymentStatus.nextDueDate).toLocaleDateString('pt-BR')}</div>\n                    <div style=\"margin-bottom: 0.5rem;\"><strong>Valor:</strong> R$ ${paymentStatus.amount.toFixed(2)}</div>\n                    <div style=\"margin-bottom: 0.5rem;\"><strong>Status:</strong> <span style=\"color: ${statusColor};\">${statusText}</span></div>\n                `;\n            } catch (error) {\n                console.error('Error loading payment status:', error);\n                container.innerHTML = `<p style=\"color: #EF4444;\">Erro ao carregar status de pagamento</p>`;\n            }\n        }\n\n        // Load student payment history\n        async function loadStudentPaymentHistory(studentId) {\n            const container = document.getElementById('paymentHistoryContainer');\n            \n            try {\n                // Mock payment history for now - replace with real API call\n                const paymentHistory = [\n                    // No hardcoded payments - will load from API when implemented\n                ];\n                \n                if (paymentHistory.length > 0) {\n                    container.innerHTML = paymentHistory.map(payment => {\n                        const statusIcon = payment.status === 'PAID' ? 'âœ…' : payment.status === 'PENDING' ? 'â³' : 'âŒ';\n                        const statusColor = payment.status === 'PAID' ? '#10B981' : payment.status === 'PENDING' ? '#F59E0B' : '#EF4444';\n                        \n                        return `\n                            <div style=\"display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid rgba(148, 163, 184, 0.1);\">\n                                <span>${new Date(payment.date).toLocaleDateString('pt-BR')}</span>\n                                <span style=\"color: ${statusColor};\">${statusIcon} R$ ${payment.amount.toFixed(2)}</span>\n                            </div>\n                        `;\n                    }).join('');\n                } else {\n                    container.innerHTML = '<p style=\"color: #94A3B8; text-align: center;\">Nenhum pagamento registrado</p>';\n                }\n            } catch (error) {\n                console.error('Error loading payment history:', error);\n                container.innerHTML = `<p style=\"color: #EF4444;\">Erro ao carregar histÃ³rico</p>`;\n            }\n        }\n\n        // Load available plans for upgrade\n        async function loadAvailablePlansForUpgrade(studentId) {\n            const container = document.getElementById('availablePlansContainer');\n            \n            try {\n                const response = await fetch('/api/billing-plans');\n                const result = await response.json();\n                \n                if (result.success && result.data.length > 0) {\n                    const plans = result.data.slice(0, 3); // Show top 3 plans\n                    \n                    container.innerHTML = `\n                        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;\">\n                            ${plans.map(plan => `\n                                <div style=\"background: rgba(59, 130, 246, 0.05); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 8px; padding: 1.5rem; text-align: center;\">\n                                    <h5 style=\"color: #3B82F6; margin: 0 0 0.5rem 0; font-size: 1rem;\">${plan.name}</h5>\n                                    <div style=\"color: #E2E8F0; font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;\">R$ ${parseFloat(plan.price).toFixed(2)}</div>\n                                    <div style=\"color: #94A3B8; font-size: 0.75rem; margin-bottom: 1rem;\">${plan.billingType === 'MONTHLY' ? 'Mensal' : plan.billingType}</div>\n                                    <button class=\"btn btn-sm btn-outline\" onclick=\"upgradeToPlan('${studentId}', '${plan.id}')\" style=\"width: 100%; padding: 0.5rem;\">\n                                        Upgrade\n                                    </button>\n                                </div>\n                            `).join('')}\n                        </div>\n                    `;\n                } else {\n                    container.innerHTML = `\n                        <div style=\"text-align: center; color: #94A3B8;\">\n                            <p>Nenhum plano disponÃ­vel para upgrade</p>\n                        </div>\n                    `;\n                }\n            } catch (error) {\n                console.error('Error loading available plans:', error);\n                container.innerHTML = `\n                    <div style=\"text-align: center; color: #EF4444;\">\n                        <p>Erro ao carregar planos disponÃ­veis</p>\n                    </div>\n                `;\n            }\n        }\n\n        // Open edit student plan modal\n        function openEditStudentPlan() {\n            const studentId = document.getElementById('editStudentForm')?.dataset.editingStudentId;\n            if (!studentId) {\n                showToast('ID do aluno nÃ£o encontrado', 'error');\n                return;\n            }\n            \n            showToast('Funcionalidade de ediÃ§Ã£o de plano em desenvolvimento', 'info');\n            // TODO: Implement plan editing modal\n        }\n\n        // Assign plan to student\n        function assignPlanToStudent(studentId) {\n            showToast('Funcionalidade de atribuiÃ§Ã£o de plano em desenvolvimento', 'info');\n            // TODO: Implement plan assignment modal\n        }\n\n        // Upgrade student to new plan\n        function upgradeToPlan(studentId, planId) {\n            showToast(`Upgrade para plano ${planId} em desenvolvimento`, 'info');\n            // TODO: Implement plan upgrade functionality\n        }\n\n        function loadStudentAttendanceTab() {\n            const attendanceTab = document.getElementById('edit-tab-attendance');\n            if (attendanceTab) {\n                attendanceTab.innerHTML = `\n                    <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“Š</div>\n                        <p>HistÃ³rico de frequÃªncia em desenvolvimento...</p>\n                    </div>\n                `;\n            }\n        }\n\n        function loadStudentCoursesTab() {\n            const coursesTab = document.getElementById('edit-tab-courses');\n            if (coursesTab) {\n                coursesTab.innerHTML = `\n                    <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“š</div>\n                        <p>InformaÃ§Ãµes de cursos em desenvolvimento...</p>\n                    </div>\n                `;\n            }\n        }\n\n        function loadStudentClassesTab() {\n            const classesTab = document.getElementById('edit-tab-classes');\n            if (classesTab) {\n                classesTab.innerHTML = `\n                    <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ«</div>\n                        <p>InformaÃ§Ãµes de turmas em desenvolvimento...</p>\n                    </div>\n                `;\n            }\n        }\n\n        function loadStudentHistoryTab() {\n            const historyTab = document.getElementById('edit-tab-history');\n            if (historyTab) {\n                historyTab.innerHTML = `\n                    <div style=\"text-align: center; padding: 3rem; color: #6B7280;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“œ</div>\n                        <p>HistÃ³rico do aluno em desenvolvimento...</p>\n                    </div>\n                `;\n            }\n        }\n\n        // NOTE: openAddStudentModal is defined earlier in the file, this is a duplicate - removed\n\n        // Form submission handlers\n        document.getElementById('addResponsibleForm').addEventListener('submit', async function(e) {\n            e.preventDefault();\n            \n            const formData = {\n                name: document.getElementById('responsibleName').value,\n                cpfCnpj: document.getElementById('responsibleCpfCnpj').value,\n                email: document.getElementById('responsibleEmail').value,\n                phone: document.getElementById('responsiblePhone').value,\n                birthDate: document.getElementById('responsibleBirthDate').value,\n                address: document.getElementById('responsibleAddress').value,\n                addressNumber: document.getElementById('responsibleAddressNumber').value,\n                complement: document.getElementById('responsibleComplement').value,\n                neighborhood: document.getElementById('responsibleNeighborhood').value,\n                city: document.getElementById('responsibleCity').value,\n                state: document.getElementById('responsibleState').value,\n                zipCode: document.getElementById('responsibleZipCode').value,\n                relationshipType: document.getElementById('responsibleRelationType').value\n            };\n            \n            try {\n                const response = await fetch('/api/financial-responsibles', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(formData)\n                });\n                \n                const result = await response.json();\n                \n                if (result.success) {\n                    showToast('ResponsÃ¡vel criado com sucesso!', 'success');\n                    closeModal('addResponsibleModal');\n                    loadFinancialResponsiblesList();\n                } else {\n                    throw new Error(result.message || 'Erro ao criar responsÃ¡vel');\n                }\n            } catch (error) {\n                console.error('Erro:', error);\n                showToast('Erro ao criar responsÃ¡vel: ' + error.message, 'error');\n            }\n        });\n\n        document.getElementById('addPlanForm').addEventListener('submit', async function(e) {\n            e.preventDefault();\n            \n            const form = e.target;\n            const isEditing = form.dataset.editingPlanId;\n            \n            const courseSelect = document.getElementById('planCourse');\n            const selectedCourseIds = Array.from(courseSelect.selectedOptions).map(option => option.value);\n            \n            const formData = {\n                courseIds: selectedCourseIds,\n                // Backward compatibility: if only one course selected, also send courseId\n                courseId: selectedCourseIds.length === 1 ? selectedCourseIds[0] : null,\n                category: document.getElementById('planCategory').value,\n                name: document.getElementById('planName').value,\n                customPrice: document.getElementById('planCustomPrice').value,\n                description: document.getElementById('planDescription').value,\n                billingType: document.getElementById('planBillingType').value,\n                classesPerWeek: parseInt(document.getElementById('planClassesPerWeek').value)\n            };\n            \n            try {\n                let response, result;\n                \n                if (isEditing) {\n                    // Update existing plan\n                    response = await fetch(`/api/billing-plans/${isEditing}`, {\n                        method: 'PUT',\n                        headers: { 'Content-Type': 'application/json' },\n                        body: JSON.stringify({\n                            name: formData.name,\n                            description: formData.description,\n                            price: parseFloat(formData.customPrice),\n                            billingType: formData.billingType,\n                            classesPerWeek: formData.classesPerWeek,\n                            category: formData.category,\n                            courseIds: selectedCourseIds,\n                            courseId: selectedCourseIds.length === 1 ? selectedCourseIds[0] : null\n                        })\n                    });\n                    result = await response.json();\n                    \n                    if (result.success) {\n                        showToast('Plano atualizado com sucesso!', 'success');\n                        closeModal('addPlanModal');\n                        loadPaymentPlansList();\n                    } else {\n                        throw new Error(result.message || 'Erro ao atualizar plano');\n                    }\n                } else {\n                    // Create new plan\n                    response = await fetch('/api/payment-plans', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json' },\n                        body: JSON.stringify(formData)\n                    });\n                    result = await response.json();\n                    \n                    if (result.success) {\n                        const message = result.data.isExisting ? \n                            'Plano existente encontrado!' : \n                            'Plano criado com sucesso!';\n                        showToast(message, 'success');\n                        closeModal('addPlanModal');\n                        loadPaymentPlansList();\n                    } else {\n                        throw new Error(result.message || 'Erro ao criar plano');\n                    }\n                }\n            } catch (error) {\n                console.error('Erro:', error);\n                const action = isEditing ? 'atualizar' : 'criar';\n                showToast(`Erro ao ${action} plano: ` + error.message, 'error');\n            }\n        });\n\n        // ========================================\n        // ðŸŽ¯ NOVO SISTEMA UX DE CURSOS - FUNÃ‡Ã•ES JAVASCRIPT\n        // ========================================\n\n        // Global variables for new courses interface\n        let currentCourseData = null;\n        let currentCoursesTab = 'overview';\n        let lessonsData = [];\n        let techniquesData = [];\n        let ragDocuments = [];\n\n        // Tab Management\n        function switchCourseTab(tabName) {\n            // Update active tab button\n            document.querySelectorAll('.tab-btn').forEach(btn => {\n                btn.classList.remove('active');\n                btn.style.background = 'transparent';\n                btn.style.color = '#CBD5E1';\n            });\n            \n            const activeBtn = document.querySelector(`[data-tab=\"${tabName}\"]`);\n            if (activeBtn) {\n                activeBtn.classList.add('active');\n                activeBtn.style.background = 'linear-gradient(135deg, #3B82F6, #1D4ED8)';\n                activeBtn.style.color = 'white';\n            }\n\n            // Hide all tab content\n            document.querySelectorAll('.tab-content').forEach(content => {\n                content.style.display = 'none';\n            });\n\n            // Show selected tab content\n            const tabContent = document.getElementById(`tab-${tabName}`);\n            if (tabContent) {\n                tabContent.style.display = 'block';\n                currentCoursesTab = tabName;\n                \n                // Load content based on tab\n                switch(tabName) {\n                    case 'lessons':\n                        loadLessonsTable();\n                        break;\n                    case 'techniques':\n                        loadTechniquesDisplay();\n                        break;\n                    case 'evaluations':\n                        loadEvaluationsDisplay();\n                        break;\n                    case 'ai-rag':\n                        loadRAGInterface();\n                        break;\n                }\n            }\n        }\n\n        // Lessons Table Management\n        async function loadLessonsTable() {\n            try {\n                lessonsData = generateMockLessons();\n                renderLessonsTable();\n            } catch (error) {\n                console.error('Error loading lessons:', error);\n                lessonsData = generateMockLessons();\n                renderLessonsTable();\n            }\n        }\n\n        function generateMockLessons() {\n            const lessons = [];\n            const units = {\n                1: { name: 'Fundamentos', color: '#10B981' },\n                2: { name: 'Golpes BÃ¡sicos', color: '#3B82F6' },\n                3: { name: 'Defesas BÃ¡sicas', color: '#8B5CF6' },\n                4: { name: 'Defesas AvanÃ§adas', color: '#F59E0B' },\n                5: { name: 'IntegraÃ§Ã£o', color: '#EF4444' }\n            };\n\n            const techniquesPool = [\n                ['Guarda de Boxe', 'MovimentaÃ§Ã£o BÃ¡sica'],\n                ['Jab', 'Cross'],\n                ['Hook', 'Uppercut'],\n                ['Joelhada Frontal', 'Chute Frontal'],\n                ['Defesa 360Â° Interior', 'Defesa 360Â° Exterior'],\n                ['Esquiva Lateral', 'Bloqueio Ativo'],\n                ['Combo Jab-Cross', 'Contra-ataque'],\n                ['Defesa contra Estrangulamento', 'LiberaÃ§Ã£o de Pegada'],\n                ['IntegraÃ§Ã£o TÃ©cnicas', 'CenÃ¡rio Real']\n            ];\n\n            for (let i = 1; i <= 48; i++) {\n                const unitNum = Math.ceil(i / 10);\n                const unit = units[Math.min(unitNum, 5)];\n                const isCompleted = i <= 15;\n                const isCurrent = i === 16;\n                \n                lessons.push({\n                    number: i,\n                    status: isCompleted ? 'completed' : (isCurrent ? 'current' : 'upcoming'),\n                    unit: unit.name,\n                    unitColor: unit.color,\n                    techniques: techniquesPool[Math.floor((i-1) / 5) % techniquesPool.length],\n                    objectives: [\n                        'Desenvolver coordenaÃ§Ã£o motora',\n                        'Aplicar tÃ©cnica em cenÃ¡rio real',\n                        'Melhorar precisÃ£o e timing'\n                    ],\n                    sequence: `Aula ${i} de 48`,\n                    tacticalModule: ['RegulaÃ§Ã£o Emocional', 'ConsciÃªncia Situacional', 'Tomada de DecisÃ£o'][Math.floor(i / 4) % 3]\n                });\n            }\n\n            return lessons;\n        }\n\n        function renderLessonsTable() {\n            const tbody = document.getElementById('lessonsTableBody');\n            if (!tbody) return;\n\n            const filteredLessons = filterLessonsData();\n            \n            tbody.innerHTML = filteredLessons.map(lesson => `\n                <tr style=\"border-bottom: 1px solid #374151; transition: background-color 0.2s;\" \n                    onmouseover=\"this.style.backgroundColor='rgba(59, 130, 246, 0.05)'\" \n                    onmouseout=\"this.style.backgroundColor='transparent'\">\n                    <td style=\"padding: 1rem; color: #F8FAFC; font-weight: 600;\">\n                        <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                            <span style=\"background: ${lesson.unitColor}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;\">\n                                ${lesson.number}\n                            </span>\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem;\">\n                        ${getStatusBadge(lesson.status)}\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1;\">\n                        <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                            <div style=\"width: 8px; height: 8px; background: ${lesson.unitColor}; border-radius: 50%;\"></div>\n                            ${lesson.unit}\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1;\">\n                        <div style=\"display: flex; flex-wrap: wrap; gap: 0.25rem;\">\n                            ${lesson.techniques.map(tech => `\n                                <span style=\"background: rgba(59, 130, 246, 0.1); color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;\">\n                                    ${tech}\n                                </span>\n                            `).join('')}\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1; font-size: 0.875rem;\">\n                        <div>${lesson.objectives[0]}</div>\n                        <div style=\"color: #94A3B8; margin-top: 0.25rem;\">+ ${lesson.objectives.length - 1} mais</div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #94A3B8; font-size: 0.875rem;\">\n                        <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                            <span style=\"background: rgba(59, 130, 246, 0.1); color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;\">\n                                ${lesson.sequence}\n                            </span>\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem;\">\n                        <div style=\"display: flex; gap: 0.5rem;\">\n                            <button onclick=\"viewLessonDetails(${lesson.number})\" \n                                    class=\"btn btn-small btn-secondary\" \n                                    style=\"padding: 0.25rem 0.5rem; font-size: 0.75rem;\">\n                                ðŸ‘ï¸ Ver\n                            </button>\n                            <button onclick=\"editLesson(${lesson.number})\" \n                                    class=\"btn btn-small btn-primary\" \n                                    style=\"padding: 0.25rem 0.5rem; font-size: 0.75rem;\">\n                                âœï¸ Editar\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `).join('');\n        }\n\n        function getStatusBadge(status) {\n            const badges = {\n                completed: '<span style=\"background: #059669; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">âœ… ConcluÃ­da</span>',\n                current: '<span style=\"background: #3B82F6; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">ðŸ”„ Atual</span>',\n                upcoming: '<span style=\"background: #6B7280; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">â³ PrÃ³xima</span>'\n            };\n            return badges[status] || badges.upcoming;\n        }\n\n        function filterLessonsData() {\n            const unitFilter = document.getElementById('unitFilter')?.value || 'all';\n            const statusFilter = document.getElementById('statusFilter')?.value || 'all';\n            const searchTerm = document.getElementById('searchLessons')?.value.toLowerCase() || '';\n\n            return lessonsData.filter(lesson => {\n                const unitMatch = unitFilter === 'all' || lesson.unit.includes(unitFilter);\n                const statusMatch = statusFilter === 'all' || lesson.status === statusFilter;\n                const searchMatch = searchTerm === '' || \n                    lesson.techniques.some(tech => tech.toLowerCase().includes(searchTerm)) ||\n                    lesson.objectives.some(obj => obj.toLowerCase().includes(searchTerm));\n                \n                return unitMatch && statusMatch && searchMatch;\n            });\n        }\n\n        // Filter functions\n        function filterLessonsByUnit() { renderLessonsTable(); }\n        function filterLessonsByStatus() { renderLessonsTable(); }\n        function searchLessons() { renderLessonsTable(); }\n\n        // Techniques Management\n        async function loadTechniquesDisplay() {\n            techniquesData = generateMockTechniques();\n            renderTechniquesDisplay();\n        }\n\n        function generateMockTechniques() {\n            return [\n                {\n                    name: 'Fundamentos',\n                    color: '#10B981',\n                    techniques: [\n                        { name: 'Guarda de Boxe', description: 'PosiÃ§Ã£o bÃ¡sica de defesa', difficulty: 1 },\n                        { name: 'MovimentaÃ§Ã£o BÃ¡sica', description: 'Deslocamentos fundamentais', difficulty: 1 },\n                        { name: 'Postura de Combate', description: 'Stance ideal para defesa', difficulty: 1 }\n                    ]\n                },\n                {\n                    name: 'Golpes BÃ¡sicos',\n                    color: '#3B82F6',\n                    techniques: [\n                        { name: 'Jab', description: 'Soco direto com a mÃ£o da frente', difficulty: 2 },\n                        { name: 'Cross', description: 'Soco cruzado com forÃ§a', difficulty: 2 },\n                        { name: 'Hook', description: 'Gancho lateral potente', difficulty: 3 }\n                    ]\n                },\n                {\n                    name: 'Defesas BÃ¡sicas',\n                    color: '#8B5CF6',\n                    techniques: [\n                        { name: 'Defesa 360Â°', description: 'Bloqueio circular universal', difficulty: 3 },\n                        { name: 'Esquiva Lateral', description: 'Desvio do corpo para os lados', difficulty: 2 },\n                        { name: 'Defesa contra Estrangulamento', description: 'LiberaÃ§Ã£o de pegada no pescoÃ§o', difficulty: 4 }\n                    ]\n                }\n            ];\n        }\n\n        function renderTechniquesDisplay() {\n            const container = document.getElementById('techniquesContainer');\n            if (!container) return;\n\n            container.innerHTML = techniquesData.map(unit => `\n                <div style=\"margin-bottom: 2rem;\">\n                    <h4 style=\"color: ${unit.color}; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: rgba(${hexToRgb(unit.color)}, 0.1); border-radius: 8px;\">\n                        <div style=\"width: 10px; height: 10px; background: ${unit.color}; border-radius: 50%;\"></div>\n                        ${unit.name} (${unit.techniques.length} tÃ©cnicas)\n                    </h4>\n                    <div style=\"display: flex; flex-direction: column; gap: 0.5rem;\">\n                        ${unit.techniques.map(technique => `\n                            <div onclick=\"showTechniqueDetails('${technique.name}')\" \n                                 style=\"padding: 1rem; background: rgba(59, 130, 246, 0.05); border-radius: 8px; cursor: pointer; transition: all 0.2s; border: 1px solid transparent;\"\n                                 onmouseover=\"this.style.borderColor='${unit.color}'; this.style.background='rgba(${hexToRgb(unit.color)}, 0.1)'\"\n                                 onmouseout=\"this.style.borderColor='transparent'; this.style.background='rgba(59, 130, 246, 0.05)'\">\n                                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                    <div>\n                                        <div style=\"color: #F8FAFC; font-weight: 600; margin-bottom: 0.25rem;\">${technique.name}</div>\n                                        <div style=\"color: #CBD5E1; font-size: 0.875rem;\">${technique.description}</div>\n                                    </div>\n                                    <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                                        <div style=\"color: #F59E0B;\">\n                                            ${'â­'.repeat(technique.difficulty)}\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        `).join('')}\n                    </div>\n                </div>\n            `).join('');\n        }\n\n        function showTechniqueDetails(techniqueName) {\n            const detailsContainer = document.getElementById('techniqueDetails');\n            if (!detailsContainer) return;\n\n            // Find technique in data\n            let foundTechnique = null;\n            let foundUnit = null;\n            \n            for (const unit of techniquesData) {\n                const technique = unit.techniques.find(t => t.name === techniqueName);\n                if (technique) {\n                    foundTechnique = technique;\n                    foundUnit = unit;\n                    break;\n                }\n            }\n\n            if (!foundTechnique) return;\n\n            detailsContainer.innerHTML = `\n                <div style=\"padding: 1rem;\">\n                    <div style=\"display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; background: rgba(${hexToRgb(foundUnit.color)}, 0.1); border-radius: 8px;\">\n                        <div style=\"width: 40px; height: 40px; background: ${foundUnit.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;\">\n                            ðŸ¥Š\n                        </div>\n                        <div>\n                            <h3 style=\"color: #F8FAFC; margin: 0; margin-bottom: 0.25rem;\">${foundTechnique.name}</h3>\n                            <div style=\"color: ${foundUnit.color}; font-size: 0.875rem; font-weight: 600;\">${foundUnit.name}</div>\n                        </div>\n                    </div>\n\n                    <div style=\"margin-bottom: 1.5rem;\">\n                        <h4 style=\"color: #F8FAFC; margin-bottom: 0.75rem;\">ðŸ“‹ DescriÃ§Ã£o</h4>\n                        <p style=\"color: #CBD5E1; line-height: 1.6;\">${foundTechnique.description}</p>\n                    </div>\n\n                    <div style=\"margin-bottom: 1.5rem;\">\n                        <h4 style=\"color: #F8FAFC; margin-bottom: 0.75rem;\">â­ Dificuldade</h4>\n                        <div style=\"color: #F59E0B; font-size: 1.25rem;\">\n                            ${'â­'.repeat(foundTechnique.difficulty)} (${foundTechnique.difficulty}/5)\n                        </div>\n                    </div>\n\n                    <div style=\"display: flex; gap: 0.75rem;\">\n                        <button onclick=\"editTechnique('${foundTechnique.name}')\" class=\"btn btn-primary\" style=\"flex: 1;\">\n                            <span>âœï¸</span> Editar TÃ©cnica\n                        </button>\n                        <button onclick=\"addToLesson('${foundTechnique.name}')\" class=\"btn btn-secondary\" style=\"flex: 1;\">\n                            <span>âž•</span> Adicionar Ã  Aula\n                        </button>\n                    </div>\n                </div>\n            `;\n        }\n\n        // Evaluations Management\n        function loadEvaluationsDisplay() {\n            const container = document.getElementById('evaluationsContainer');\n            if (!container) return;\n\n            const evaluations = [\n                { module: 1, name: 'Fundamentos', lesson: 8, status: 'completed', date: '15/06/2025', average: 8.5 },\n                { module: 2, name: 'Golpes BÃ¡sicos', lesson: 16, status: 'completed', date: '29/06/2025', average: 7.8 },\n                { module: 3, name: 'Defesas BÃ¡sicas', lesson: 24, status: 'upcoming', date: '13/07/2025', average: null },\n                { module: 4, name: 'Defesas AvanÃ§adas', lesson: 32, status: 'upcoming', date: '27/07/2025', average: null },\n                { module: 5, name: 'IntegraÃ§Ã£o Final', lesson: 40, status: 'upcoming', date: '10/08/2025', average: null }\n            ];\n\n            container.innerHTML = evaluations.map(eval => `\n                <div style=\"background: rgba(59, 130, 246, 0.05); border-radius: 12px; padding: 1.5rem; border: 1px solid #374151;\">\n                    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;\">\n                        <h4 style=\"color: #F8FAFC; margin: 0;\">MÃ³dulo ${eval.module}: ${eval.name}</h4>\n                        ${eval.status === 'completed' ? \n                            `<span style=\"background: #059669; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem;\">âœ… Realizada</span>` :\n                            `<span style=\"background: #6B7280; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem;\">â³ Pendente</span>`\n                        }\n                    </div>\n                    \n                    <div style=\"color: #CBD5E1; margin-bottom: 1rem;\">\n                        <div style=\"margin-bottom: 0.5rem;\"><strong>ðŸ“… Data:</strong> ${eval.date}</div>\n                        <div style=\"margin-bottom: 0.5rem;\"><strong>ðŸ“‹ Aula:</strong> ${eval.lesson}/48</div>\n                        ${eval.average ? \n                            `<div><strong>ðŸ“Š MÃ©dia da Turma:</strong> <span style=\"color: #10B981; font-weight: bold;\">${eval.average}/10</span></div>` :\n                            `<div><strong>ðŸ“Š MÃ©dia:</strong> <span style=\"color: #6B7280;\">Pendente</span></div>`\n                        }\n                    </div>\n\n                    <div style=\"display: flex; gap: 0.75rem;\">\n                        ${eval.status === 'completed' ? \n                            `<button onclick=\"viewEvaluationResults(${eval.module})\" class=\"btn btn-secondary\" style=\"flex: 1; font-size: 0.875rem;\">\n                                <span>ðŸ“Š</span> Ver Resultados\n                            </button>` :\n                            `<button onclick=\"scheduleEvaluation(${eval.module})\" class=\"btn btn-primary\" style=\"flex: 1; font-size: 0.875rem;\">\n                                <span>ðŸ“…</span> Agendar\n                            </button>`\n                        }\n                        <button onclick=\"editEvaluation(${eval.module})\" class=\"btn btn-secondary\" style=\"flex: 1; font-size: 0.875rem;\">\n                            <span>âœï¸</span> Editar\n                        </button>\n                    </div>\n                </div>\n            `).join('');\n        }\n\n        // RAG Interface\n        function loadRAGInterface() {\n            initializeRAGDocuments();\n        }\n\n        function initializeRAGDocuments() {\n            ragDocuments = [\n                {\n                    id: 'agenda',\n                    name: 'Agenda do Aluno Faixa Branca.pdf',\n                    description: 'Estrutura pedagÃ³gica e cronograma',\n                    type: 'pdf',\n                    indexed: true\n                },\n                {\n                    id: 'plano',\n                    name: 'Plano de Curso Faixa Branca.pdf', \n                    description: 'Metodologia e tÃ©cnicas detalhadas',\n                    type: 'pdf',\n                    indexed: true\n                }\n            ];\n        }\n\n        async function sendRAGQuery() {\n            const input = document.getElementById('ragChatInput');\n            const chatContainer = document.getElementById('ragChatContainer');\n            \n            if (!input || !chatContainer || !input.value.trim()) return;\n\n            const query = input.value.trim();\n            input.value = '';\n\n            // Add user message\n            addChatMessage(chatContainer, query, 'user');\n            \n            // Add loading message\n            const loadingId = addChatMessage(chatContainer, 'Processando consulta com IA...', 'assistant', true);\n\n            try {\n                // Simulate RAG query processing\n                await new Promise(resolve => setTimeout(resolve, 2000));\n                \n                // Remove loading message\n                document.getElementById(loadingId)?.remove();\n                \n                // Add AI response\n                const response = generateRAGResponse(query);\n                addChatMessage(chatContainer, response, 'assistant');\n                \n            } catch (error) {\n                document.getElementById(loadingId)?.remove();\n                addChatMessage(chatContainer, 'Erro ao processar consulta. Tente novamente.', 'error');\n            }\n        }\n\n        function addChatMessage(container, message, type, isLoading = false) {\n            const messageId = 'msg-' + Date.now();\n            const colors = {\n                user: { bg: 'rgba(59, 130, 246, 0.1)', text: '#3B82F6', icon: 'ðŸ‘¤' },\n                assistant: { bg: 'rgba(16, 185, 129, 0.1)', text: '#10B981', icon: 'ðŸ¤–' },\n                error: { bg: 'rgba(239, 68, 68, 0.1)', text: '#EF4444', icon: 'âŒ' }\n            };\n            \n            const style = colors[type] || colors.assistant;\n            \n            const messageDiv = document.createElement('div');\n            messageDiv.id = messageId;\n            messageDiv.style.cssText = `\n                display: flex; gap: 0.75rem; margin-bottom: 1rem; padding: 1rem; \n                background: ${style.bg}; border-radius: 8px; align-items: flex-start;\n            `;\n            \n            messageDiv.innerHTML = `\n                <div style=\"color: ${style.text}; font-size: 1.25rem;\">${style.icon}</div>\n                <div style=\"flex: 1; color: #CBD5E1; line-height: 1.6;\">\n                    ${message}\n                </div>\n            `;\n            \n            container.appendChild(messageDiv);\n            container.scrollTop = container.scrollHeight;\n            \n            return messageId;\n        }\n\n        function generateRAGResponse(query) {\n            const responses = {\n                'tea': 'Para alunos com TEA, recomendo: 1) DemonstraÃ§Ãµes visuais claras e repetitivas, 2) Ambiente com menos estÃ­mulos sonoros, 3) Rotina previsÃ­vel e sinais visuais, 4) Pausas quando necessÃ¡rio.',\n                'adaptaÃ§Ã£o': 'AdaptaÃ§Ãµes incluem: modificar intensidade, usar apoios visuais, ajustar tempo de execuÃ§Ã£o, e personalizar instruÃ§Ãµes conforme necessidades especiais.',\n                'tÃ©cnica': 'Baseado nos documentos, cada tÃ©cnica deve seguir: explicaÃ§Ã£o clara, demonstraÃ§Ã£o, prÃ¡tica supervisionada, correÃ§Ã£o individual, e aplicaÃ§Ã£o em cenÃ¡rio.',\n                'avaliaÃ§Ã£o': 'O sistema de avaliaÃ§Ã£o modular inclui 5 etapas: Fundamentos (aula 8), Golpes (16), Defesas bÃ¡sicas (24), Defesas avanÃ§adas (32), e IntegraÃ§Ã£o (40).'\n            };\n\n            const lowQuery = query.toLowerCase();\n            for (const [key, response] of Object.entries(responses)) {\n                if (lowQuery.includes(key)) {\n                    return response;\n                }\n            }\n\n            return 'Com base nos documentos RAG, posso ajudar com informaÃ§Ãµes sobre estrutura pedagÃ³gica, adaptaÃ§Ãµes para necessidades especiais, metodologia de ensino, e sistema de avaliaÃ§Ãµes. Poderia ser mais especÃ­fico sobre sua dÃºvida?';\n        }\n\n        // Course Generator\n        async function generateCourseWithRAG(event) {\n            event.preventDefault();\n            \n            const formData = new FormData(event.target);\n            const courseData = {\n                martialArt: formData.get('martialArt'),\n                level: formData.get('level'),\n                targetAudience: formData.get('targetAudience'),\n                duration: formData.get('duration'),\n                objectives: formData.get('objectives'),\n                document: formData.get('document')\n            };\n\n            // Show loading state\n            const generateBtn = event.target.querySelector('button[type=\"submit\"]');\n            const originalText = generateBtn.innerHTML;\n            generateBtn.innerHTML = '<span>â³</span> Gerando...';\n            generateBtn.disabled = true;\n\n            try {\n                // Simulate course generation\n                await new Promise(resolve => setTimeout(resolve, 3000));\n                \n                // Success message\n                showNotification('Curso gerado com sucesso! ðŸŽ‰', 'success');\n                \n                // Reset form\n                event.target.reset();\n                \n            } catch (error) {\n                showNotification('Erro ao gerar curso. Tente novamente.', 'error');\n            } finally {\n                generateBtn.innerHTML = originalText;\n                generateBtn.disabled = false;\n            }\n        }\n\n        // ========================================\n        // SIMPLE COURSE CREATOR FUNCTIONS\n        // ========================================\n\n        // Store course preview data globally\n        let coursePreviewData = null;\n\n        // Open simple course creator (show the interface)\n        function openSimpleCourseCreator() {\n            const simpleCourseCreator = document.getElementById('simpleCourseCreator');\n            const advancedForm = document.getElementById('courseGeneratorForm');\n            \n            // Show simple creator, hide advanced form\n            simpleCourseCreator.style.display = 'block';\n            advancedForm.style.display = 'none';\n            \n            // Focus on the course name input\n            document.getElementById('quickCourseName').focus();\n            \n            showNotification('âœ¨ Modo de criaÃ§Ã£o rÃ¡pida ativado! Digite apenas o nome do curso.', 'success');\n        }\n\n        // Show advanced course form\n        function showAdvancedCourseForm() {\n            const simpleCourseCreator = document.getElementById('simpleCourseCreator');\n            const advancedForm = document.getElementById('courseGeneratorForm');\n            \n            // Hide simple creator, show advanced form\n            simpleCourseCreator.style.display = 'none';\n            advancedForm.style.display = 'block';\n            \n            showNotification('ðŸŽ›ï¸ Modo avanÃ§ado ativado! Personalize todos os detalhes do curso.', 'info');\n        }\n\n        // Create course automatically with AI\n        async function createQuickCourse() {\n            const courseName = document.getElementById('quickCourseName').value.trim();\n            \n            if (!courseName) {\n                showNotification('âŒ Por favor, digite o nome do curso.', 'error');\n                return;\n            }\n\n            try {\n                showNotification('ðŸ¤– IA analisando e gerando curso automaticamente...', 'info');\n                \n                // Generate course data using AI\n                const courseData = await generateCourseDataFromName(courseName);\n                \n                // Create course via API\n                await createCourseViaAPI(courseData);\n                \n                // Clear input and show success\n                document.getElementById('quickCourseName').value = '';\n                document.getElementById('coursePreviewArea').style.display = 'none';\n                \n                showNotification('ðŸŽ‰ Curso criado com sucesso!', 'success');\n                \n                // Refresh courses list if function exists\n                if (typeof updateCoursesTable === 'function') {\n                    updateCoursesTable();\n                }\n                \n            } catch (error) {\n                showNotification('âŒ Erro ao criar curso: ' + error.message, 'error');\n            }\n        }\n\n        // Preview course before creating\n        async function previewQuickCourse() {\n            const courseName = document.getElementById('quickCourseName').value.trim();\n            \n            if (!courseName) {\n                showNotification('âŒ Por favor, digite o nome do curso para gerar preview.', 'error');\n                return;\n            }\n\n            try {\n                showNotification('ðŸ” Gerando preview do curso...', 'info');\n                \n                // Generate course data\n                const courseData = await generateCourseDataFromName(courseName);\n                coursePreviewData = courseData;\n                \n                // Show preview\n                displayCoursePreview(courseData);\n                \n            } catch (error) {\n                showNotification('âŒ Erro ao gerar preview: ' + error.message, 'error');\n            }\n        }\n\n        // Generate course data from just the name using AI\n        async function generateCourseDataFromName(courseName) {\n            // Smart parsing of course name\n            const lowerName = courseName.toLowerCase();\n            \n            // Detect martial art\n            let martialArt = 'krav-maga'; // default\n            let martialArtDisplay = 'Krav Maga';\n            \n            if (lowerName.includes('jiu-jitsu') || lowerName.includes('jiujitsu')) {\n                martialArt = 'jiu-jitsu';\n                martialArtDisplay = 'Jiu-Jitsu';\n            } else if (lowerName.includes('boxe')) {\n                martialArt = 'boxe';\n                martialArtDisplay = 'Boxe';\n            } else if (lowerName.includes('muay thai')) {\n                martialArt = 'muay-thai';\n                martialArtDisplay = 'Muay Thai';\n            } else if (lowerName.includes('karate') || lowerName.includes('karatÃª')) {\n                martialArt = 'karate';\n                martialArtDisplay = 'KaratÃª';\n            } else if (lowerName.includes('taekwondo')) {\n                martialArt = 'taekwondo';\n                martialArtDisplay = 'Taekwondo';\n            } else if (lowerName.includes('judo') || lowerName.includes('judÃ´')) {\n                martialArt = 'judo';\n                martialArtDisplay = 'JudÃ´';\n            } else if (lowerName.includes('mma')) {\n                martialArt = 'mma';\n                martialArtDisplay = 'MMA';\n            }\n            \n            // Detect level/belt and map to CourseLevel enum\n            let level = 'BEGINNER';\n            let levelDisplay = 'Faixa Branca';\n            \n            if (lowerName.includes('amarela') || lowerName.includes('yellow')) {\n                level = 'BEGINNER';\n                levelDisplay = 'Faixa Amarela';\n            } else if (lowerName.includes('laranja') || lowerName.includes('orange')) {\n                level = 'INTERMEDIATE';\n                levelDisplay = 'Faixa Laranja';\n            } else if (lowerName.includes('verde') || lowerName.includes('green')) {\n                level = 'INTERMEDIATE';\n                levelDisplay = 'Faixa Verde';\n            } else if (lowerName.includes('azul') || lowerName.includes('blue')) {\n                level = 'INTERMEDIATE';\n                levelDisplay = 'Faixa Azul';\n            } else if (lowerName.includes('roxa') || lowerName.includes('purple')) {\n                level = 'ADVANCED';\n                levelDisplay = 'Faixa Roxa';\n            } else if (lowerName.includes('marrom') || lowerName.includes('brown')) {\n                level = 'ADVANCED';\n                levelDisplay = 'Faixa Marrom';\n            } else if (lowerName.includes('preta') || lowerName.includes('black')) {\n                level = 'EXPERT';\n                levelDisplay = 'Faixa Preta';\n            } else if (lowerName.includes('master') || lowerName.includes('mestre')) {\n                level = 'MASTER';\n                levelDisplay = 'Mestre';\n            }\n            \n            // Detect audience\n            let audience = 'adultos';\n            let ageGroup = '18-65';\n            \n            if (lowerName.includes('crianÃ§a') || lowerName.includes('infantil') || lowerName.includes('kids')) {\n                audience = 'crianÃ§as';\n                ageGroup = '6-12';\n            } else if (lowerName.includes('adolescent') || lowerName.includes('teen')) {\n                audience = 'adolescentes';\n                ageGroup = '13-17';\n            } else if (lowerName.includes('senior') || lowerName.includes('idoso')) {\n                audience = 'seniors';\n                ageGroup = '65+';\n            }\n            \n            // Generate course structure\n            const courseData = {\n                name: courseName,\n                martialArt: martialArt,\n                level: level,\n                description: `Curso de ${martialArtDisplay} - ${levelDisplay} para ${audience}. Metodologia adaptada e progressiva focada em tÃ©cnicas fundamentais, desenvolvimento fÃ­sico e mental, com Ãªnfase em aplicaÃ§Ã£o prÃ¡tica e seguranÃ§a.`,\n                ageGroup: ageGroup,\n                duration: audience === 'crianÃ§as' ? 16 : 24, // weeks\n                totalLessons: audience === 'crianÃ§as' ? 32 : 48,\n                objectives: [\n                    'Desenvolver tÃ©cnicas fundamentais de ' + martialArtDisplay,\n                    'Melhorar condicionamento fÃ­sico e flexibilidade',\n                    'Aumentar consciÃªncia situacional e autoconfianÃ§a',\n                    'Promover disciplina e respeito',\n                    'Preparar para evoluÃ§Ã£o para prÃ³ximo nÃ­vel'\n                ],\n                evaluationCriteria: [\n                    'ExecuÃ§Ã£o correta das tÃ©cnicas bÃ¡sicas',\n                    'Conhecimento teÃ³rico dos princÃ­pios',\n                    'ProgressÃ£o fÃ­sica e mental',\n                    'FrequÃªncia e dedicaÃ§Ã£o nas aulas',\n                    'DemonstraÃ§Ã£o prÃ¡tica em situaÃ§Ãµes controladas'\n                ]\n            };\n            \n            return courseData;\n        }\n\n        // Display course preview\n        function displayCoursePreview(courseData) {\n            const previewArea = document.getElementById('coursePreviewArea');\n            const previewContent = document.getElementById('coursePreviewContent');\n            \n            previewContent.innerHTML = `\n                <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;\">\n                    <div>\n                        <strong style=\"color: #3B82F6;\">ðŸ“š Nome:</strong><br>\n                        <span style=\"color: #CBD5E1;\">${courseData.name}</span>\n                    </div>\n                    <div>\n                        <strong style=\"color: #3B82F6;\">ðŸ¥‹ Arte Marcial:</strong><br>\n                        <span style=\"color: #CBD5E1;\">${courseData.martialArt}</span>\n                    </div>\n                    <div>\n                        <strong style=\"color: #3B82F6;\">ðŸŽ¯ NÃ­vel:</strong><br>\n                        <span style=\"color: #CBD5E1;\">${courseData.level}</span>\n                    </div>\n                    <div>\n                        <strong style=\"color: #3B82F6;\">ðŸ‘¥ Faixa EtÃ¡ria:</strong><br>\n                        <span style=\"color: #CBD5E1;\">${courseData.ageGroup} anos</span>\n                    </div>\n                    <div>\n                        <strong style=\"color: #3B82F6;\">â±ï¸ DuraÃ§Ã£o:</strong><br>\n                        <span style=\"color: #CBD5E1;\">${courseData.duration} semanas</span>\n                    </div>\n                    <div>\n                        <strong style=\"color: #3B82F6;\">ðŸ“‹ Aulas:</strong><br>\n                        <span style=\"color: #CBD5E1;\">${courseData.totalLessons} aulas (${courseData.lessonDuration}min cada)</span>\n                    </div>\n                </div>\n                \n                <div style=\"margin-bottom: 1rem;\">\n                    <strong style=\"color: #3B82F6;\">ðŸ“ DescriÃ§Ã£o:</strong><br>\n                    <span style=\"color: #CBD5E1; font-size: 0.9rem; line-height: 1.4;\">${courseData.description}</span>\n                </div>\n                \n                <div>\n                    <strong style=\"color: #3B82F6;\">ðŸŽ¯ Objetivos:</strong><br>\n                    <ul style=\"color: #CBD5E1; font-size: 0.9rem; margin: 0.5rem 0; padding-left: 1.2rem;\">\n                        ${courseData.objectives.map(obj => `<li>${obj}</li>`).join('')}\n                    </ul>\n                </div>\n            `;\n            \n            previewArea.style.display = 'block';\n            showNotification('ðŸ‘ï¸ Preview gerado! Revise os detalhes antes de criar.', 'success');\n        }\n\n        // Confirm and create course from preview\n        async function confirmCreateCourse() {\n            if (!coursePreviewData) {\n                showNotification('âŒ Nenhum curso para confirmar. Gere um preview primeiro.', 'error');\n                return;\n            }\n\n            try {\n                await createCourseViaAPI(coursePreviewData);\n                \n                // Clear everything\n                document.getElementById('quickCourseName').value = '';\n                document.getElementById('coursePreviewArea').style.display = 'none';\n                coursePreviewData = null;\n                \n                showNotification('ðŸŽ‰ Curso confirmado e criado com sucesso!', 'success');\n                \n                // Refresh courses list\n                if (typeof updateCoursesTable === 'function') {\n                    updateCoursesTable();\n                }\n                \n            } catch (error) {\n                showNotification('âŒ Erro ao confirmar criaÃ§Ã£o: ' + error.message, 'error');\n            }\n        }\n\n        // Edit course details (switch to advanced form)\n        function editCourseDetails() {\n            if (!coursePreviewData) {\n                showNotification('âŒ Nenhum curso para editar. Gere um preview primeiro.', 'error');\n                return;\n            }\n\n            // Fill advanced form with preview data\n            fillAdvancedFormWithData(coursePreviewData);\n            \n            // Switch to advanced form\n            showAdvancedCourseForm();\n            \n            showNotification('âœï¸ Dados carregados no formulÃ¡rio avanÃ§ado para ediÃ§Ã£o.', 'info');\n        }\n\n        // Fill advanced form with course data\n        function fillAdvancedFormWithData(courseData) {\n            // Fill form fields if they exist\n            const fields = {\n                'martialArtSelect': courseData.martialArt,\n                'courseLevelSelect': courseData.level,\n                'courseNameInput': courseData.name,\n                'courseDescriptionInput': courseData.description,\n                'courseDurationInput': courseData.duration,\n                'totalLessonsInput': courseData.totalLessons,\n                'courseObjectivesInput': courseData.objectives.join('\\\\n'),\n                'evaluationCriteriaInput': courseData.evaluationCriteria.join('\\\\n')\n            };\n            \n            for (const [fieldId, value] of Object.entries(fields)) {\n                const field = document.getElementById(fieldId);\n                if (field) {\n                    field.value = value;\n                }\n            }\n        }\n\n        // Create course via API\n        async function createCourseViaAPI(courseData) {\n            try {\n                const response = await fetch('/api/courses', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(courseData)\n                });\n\n                if (!response.ok) {\n                    throw new Error(`HTTP error! status: ${response.status}`);\n                }\n\n                const result = await response.json();\n                \n                if (!result.success) {\n                    throw new Error(result.message || 'Erro desconhecido ao criar curso');\n                }\n\n                return result.data;\n                \n            } catch (error) {\n                console.error('Error creating course via API:', error);\n                throw error;\n            }\n        }\n\n        // Utility Functions\n        function hexToRgb(hex) {\n            const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n            return result ? \n                `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : \n                '59, 130, 246';\n        }\n\n        function showNotification(message, type = 'info') {\n            const colors = {\n                success: '#10B981',\n                error: '#EF4444',\n                info: '#3B82F6',\n                warning: '#F59E0B'\n            };\n\n            const notification = document.createElement('div');\n            notification.style.cssText = `\n                position: fixed; top: 20px; right: 20px; z-index: 1000;\n                background: ${colors[type]}; color: white; padding: 1rem 1.5rem;\n                border-radius: 8px; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n                transform: translateX(100%); transition: transform 0.3s ease;\n            `;\n            notification.textContent = message;\n            \n            document.body.appendChild(notification);\n            \n            // Slide in\n            setTimeout(() => notification.style.transform = 'translateX(0)', 100);\n            \n            // Auto remove\n            setTimeout(() => {\n                notification.style.transform = 'translateX(100%)';\n                setTimeout(() => notification.remove(), 300);\n            }, 3000);\n        }\n\n        // Placeholder functions for buttons\n        function loadSelectedCourse() { console.log('Loading selected course...'); }\n        function editCourseDetails() { showNotification('Funcionalidade em desenvolvimento', 'info'); }\n        function openLessonPlanManager() { switchCourseTab('lessons'); }\n        function openTechniquesLibrary() { switchCourseTab('techniques'); }\n        function generateProgressReport() { showNotification('Gerando relatÃ³rio...', 'info'); }\n        function openRAGInterface() { switchCourseTab('ai-rag'); }\n        function viewLessonDetails(num) { showNotification(`Visualizando aula ${num}`, 'info'); }\n        function editLesson(num) { showNotification(`Editando aula ${num}`, 'info'); }\n        function editTechnique(name) { showNotification(`Editando tÃ©cnica: ${name}`, 'info'); }\n        function addToLesson(name) { showNotification(`Adicionando ${name} Ã  aula`, 'success'); }\n        function viewEvaluationResults(module) { showNotification(`Resultados do mÃ³dulo ${module}`, 'info'); }\n        function scheduleEvaluation(module) { showNotification(`Agendando avaliaÃ§Ã£o mÃ³dulo ${module}`, 'info'); }\n        function editEvaluation(module) { showNotification(`Editando mÃ³dulo ${module}`, 'info'); }\n        function uploadRAGDocument() { showNotification('Funcionalidade de upload em desenvolvimento', 'info'); }\n        function viewRAGDocument(id) { showNotification(`Visualizando documento: ${id}`, 'info'); }\n        function exportLessonPlans() { showNotification('Exportando planos de aula...', 'info'); }\n        function useExistingTemplate() { showNotification('Usando template do Faixa Branca...', 'info'); }\n        function openRAGCourseCreator() { switchCourseTab('ai-rag'); }\n        function importCourseDocument() { document.getElementById('courseDocument')?.click(); }\n\n        // Initialize courses interface when tab is switched\n        function showCourses() {\n            showSection('courses');\n            // Initialize default tab when courses section is opened\n            setTimeout(() => switchCourseTab('overview'), 100);\n        }\n\n        // Add CSS animations for courses interface\n        const coursesStyle = document.createElement('style');\n        coursesStyle.textContent = `\n            @keyframes pulse {\n                0%, 100% { opacity: 0.4; }\n                50% { opacity: 1; }\n            }\n            .tab-btn:hover {\n                background: rgba(59, 130, 246, 0.1) !important;\n                color: #3B82F6 !important;\n            }\n            .tab-content {\n                animation: fadeIn 0.3s ease-in-out;\n            }\n            @keyframes fadeIn {\n                from { opacity: 0; transform: translateY(10px); }\n                to { opacity: 1; transform: translateY(0); }\n            }\n        `;\n        document.head.appendChild(coursesStyle);\n\n        // ===============================\n        // CLASSES (TURMAS) FUNCTIONS\n        // ===============================\n        \n        function createNewClass() {\n            alert('ðŸš§ FunÃ§Ã£o em desenvolvimento: Criar Nova Turma\\n\\nEsta funcionalidade permitirÃ¡:\\nâ€¢ Selecionar curso base\\nâ€¢ Definir horÃ¡rios\\nâ€¢ Configurar capacidade\\nâ€¢ Agendar inÃ­cio');\n        }\n        \n        function viewClassSchedule() {\n            alert('ðŸš§ FunÃ§Ã£o em desenvolvimento: Cronograma de Turmas\\n\\nExibirÃ¡:\\nâ€¢ CalendÃ¡rio completo\\nâ€¢ Aulas agendadas\\nâ€¢ Conflitos de horÃ¡rio\\nâ€¢ Feriados e pausas');\n        }\n        \n        function viewClassDetails(classId) {\n            alert(`ðŸš§ Visualizando detalhes da Turma ${classId}\\n\\nInformaÃ§Ãµes disponÃ­veis:\\nâ€¢ Lista de alunos\\nâ€¢ Progresso da turma\\nâ€¢ HistÃ³rico de frequÃªncia\\nâ€¢ AvaliaÃ§Ãµes realizadas`);\n        }\n        \n        function manageClassSchedule(classId) {\n            alert(`ðŸš§ Gerenciando agenda da Turma ${classId}\\n\\nFuncionalidades:\\nâ€¢ Reagendar aulas\\nâ€¢ Marcar faltas do instrutor\\nâ€¢ Aulas de reposiÃ§Ã£o\\nâ€¢ AlteraÃ§Ãµes de horÃ¡rio`);\n        }\n        \n        function filterClasses() {\n            const filter = document.getElementById('classStatusFilter').value;\n            console.log('Filtering classes by:', filter);\n            // Implementar filtragem das turmas\n        }\n        \n        // Update classes count in sidebar\n        function updateClassesCount() {\n            // No hardcoded data - will be populated by real API calls\n        }\n        \n        // Initialize classes data when page loads\n        document.addEventListener('DOMContentLoaded', function() {\n            updateClassesCount();\n        });\n\n        // ===============================\n        // COURSE GENERATION FUNCTIONS\n        // ===============================\n        \n        function generateCourseWithRAG(event) {\n            event.preventDefault();\n            \n            // Collect form data\n            const formData = {\n                martialArt: document.getElementById('martialArtSelect').value,\n                courseLevel: document.getElementById('courseLevelSelect').value,\n                courseName: document.getElementById('courseName').value,\n                courseDescription: document.getElementById('courseDescription').value,\n                targetAudience: document.getElementById('targetAudienceSelect').value,\n                genderTarget: document.getElementById('genderTargetSelect').value,\n                context: document.getElementById('contextSelect').value,\n                courseDuration: document.getElementById('courseDuration').value,\n                totalLessons: document.getElementById('totalLessons').value,\n                lessonDuration: document.getElementById('lessonDuration').value,\n                courseObjectives: document.getElementById('courseObjectives').value,\n                evaluationCriteria: document.getElementById('evaluationCriteria').value,\n                teachingStyle: document.getElementById('teachingStyle').value,\n                aiInstructions: document.getElementById('aiInstructions').value,\n                \n                // Special adaptations\n                adaptations: {\n                    TEA: document.getElementById('adaptTEA').checked,\n                    TDAH: document.getElementById('adaptTDH').checked,\n                    mobility: document.getElementById('adaptMobility').checked,\n                    visual: document.getElementById('adaptVisual').checked,\n                    auditory: document.getElementById('adaptAuditory').checked,\n                    cardiac: document.getElementById('adaptCardiac').checked\n                }\n            };\n\n            // Validate required fields\n            if (!formData.martialArt || !formData.courseLevel || !formData.courseName || \n                !formData.courseDescription || !formData.targetAudience || !formData.courseObjectives) {\n                showToast('âš ï¸ Preencha todos os campos obrigatÃ³rios', 'warning');\n                return;\n            }\n\n            // Show loading state\n            const submitBtn = event.target.querySelector('button[type=\"submit\"]');\n            const originalText = submitBtn.innerHTML;\n            submitBtn.innerHTML = '<span>â³</span> Gerando com IA...';\n            submitBtn.disabled = true;\n\n            // Simulate RAG-powered course generation\n            setTimeout(() => {\n                console.log('Course data to be sent to RAG system:', formData);\n                \n                // Create course based on form data\n                const generatedCourse = createCourseFromRAG(formData);\n                \n                // Add to courses list (simulate API call)\n                addNewCourseToInterface(generatedCourse);\n                \n                // Show success message\n                showToast(`âœ… Curso \"${formData.courseName}\" gerado com sucesso usando IA + RAG!`, 'success');\n                \n                // Reset form\n                document.getElementById('courseGeneratorForm').reset();\n                \n                // Restore button\n                submitBtn.innerHTML = originalText;\n                submitBtn.disabled = false;\n                \n            }, 3000);\n        }\n\n        function createCourseFromRAG(formData) {\n            // Simulate RAG processing using knowledge base\n            const course = {\n                id: Date.now(),\n                name: formData.courseName,\n                description: formData.courseDescription,\n                martialArt: formData.martialArt,\n                level: formData.courseLevel,\n                targetAudience: formData.targetAudience,\n                duration: parseInt(formData.courseDuration),\n                totalLessons: parseInt(formData.totalLessons),\n                lessonDuration: parseInt(formData.lessonDuration),\n                objectives: formData.courseObjectives.split(',').map(obj => obj.trim()),\n                evaluationCriteria: formData.evaluationCriteria,\n                teachingStyle: formData.teachingStyle,\n                adaptations: formData.adaptations,\n                \n                // Generate lesson structure based on RAG knowledge\n                lessons: generateLessonsFromRAG(formData),\n                \n                // Generate techniques based on RAG\n                techniques: generateTechniquesFromRAG(formData),\n                \n                createdAt: new Date().toISOString(),\n                status: 'active'\n            };\n            \n            return course;\n        }\n\n        function generateLessonsFromRAG(formData) {\n            // Base knowledge from RAG (simulated)\n            const baseStructure = {\n                'krav-maga': {\n                    'branca': ['Fundamentos', 'Golpes BÃ¡sicos', 'Defesas BÃ¡sicas', 'Defesas AvanÃ§adas', 'IntegraÃ§Ã£o'],\n                    'amarela': ['RevisÃ£o', 'CombinaÃ§Ãµes', 'CenÃ¡rios RealÃ­sticos', 'Defesas Complexas', 'Condicionamento'],\n                    'laranja': ['TÃ©cnicas AvanÃ§adas', 'MÃºltiplos Atacantes', 'Armas Brancas', 'SituaÃ§Ãµes Extremas', 'LideranÃ§a']\n                }\n            };\n            \n            const totalLessons = parseInt(formData.totalLessons);\n            const modules = baseStructure[formData.martialArt]?.[formData.courseLevel] || \n                           ['MÃ³dulo 1', 'MÃ³dulo 2', 'MÃ³dulo 3', 'MÃ³dulo 4', 'MÃ³dulo 5'];\n            \n            const lessons = [];\n            const lessonsPerModule = Math.floor(totalLessons / modules.length);\n            \n            modules.forEach((module, moduleIndex) => {\n                for (let i = 0; i < lessonsPerModule; i++) {\n                    const lessonNumber = moduleIndex * lessonsPerModule + i + 1;\n                    lessons.push({\n                        number: lessonNumber,\n                        module: module,\n                        title: `${module} - Aula ${i + 1}`,\n                        objectives: [`Objetivo especÃ­fico da aula ${lessonNumber}`],\n                        techniques: [`TÃ©cnica ${lessonNumber}A`, `TÃ©cnica ${lessonNumber}B`],\n                        duration: parseInt(formData.lessonDuration)\n                    });\n                }\n            });\n            \n            return lessons;\n        }\n\n        function generateTechniquesFromRAG(formData) {\n            // RAG-based technique generation (simulated)\n            const baseTechniques = {\n                'krav-maga': {\n                    'branca': ['Guarda de Boxe', 'Jab', 'Cross', 'Joelhada Frontal', 'Chute Frontal', 'Defesa 360Â°'],\n                    'amarela': ['Hook', 'Uppercut', 'CombinaÃ§Ã£o Jab-Cross', 'Defesa Dupla', 'Contra-ataque'],\n                    'laranja': ['TÃ©cnicas de Solo', 'Defesa vs Faca', 'Defesa vs BastÃ£o', 'MÃºltiplos Atacantes']\n                }\n            };\n            \n            return baseTechniques[formData.martialArt]?.[formData.courseLevel] || \n                   ['TÃ©cnica 1', 'TÃ©cnica 2', 'TÃ©cnica 3', 'TÃ©cnica 4', 'TÃ©cnica 5'];\n        }\n\n        function addNewCourseToInterface(course) {\n            // Update courses count in header\n            const coursesCount = document.getElementById('totalCoursesCount');\n            if (coursesCount) {\n                const currentCount = parseInt(coursesCount.textContent) || 0;\n                coursesCount.textContent = currentCount + 1;\n            }\n            \n            // Add to course selector\n            const courseSelector = document.getElementById('courseSelector');\n            if (courseSelector) {\n                const option = document.createElement('option');\n                option.value = course.id;\n                option.textContent = course.name;\n                courseSelector.appendChild(option);\n            }\n            \n            // Store in local storage (simulate backend)\n            const existingCourses = JSON.parse(localStorage.getItem('generatedCourses') || '[]');\n            existingCourses.push(course);\n            localStorage.setItem('generatedCourses', JSON.stringify(existingCourses));\n            \n            console.log('Course added to interface:', course);\n        }\n\n        function useExistingTemplate() {\n            const templates = [\n                'Krav Maga Faixa Branca - Defesa Pessoal 1',\n                'Krav Maga Faixa Amarela - Defesa Pessoal 2',\n                'Jiu-Jitsu Fundamentos - Faixa Branca',\n                'Boxe Iniciante - TÃ©cnicas BÃ¡sicas'\n            ];\n            \n            const selectedTemplate = prompt('Escolha um template:\\n' + \n                templates.map((t, i) => `${i + 1}. ${t}`).join('\\n'));\n            \n            if (selectedTemplate && selectedTemplate > 0 && selectedTemplate <= templates.length) {\n                const template = templates[selectedTemplate - 1];\n                showToast(`ðŸ“‹ Template \"${template}\" carregado!`, 'info');\n                \n                // Auto-fill form with template data (simplified)\n                if (template.includes('Krav Maga Faixa Branca')) {\n                    document.getElementById('martialArtSelect').value = 'krav-maga';\n                    document.getElementById('courseLevelSelect').value = 'branca';\n                    document.getElementById('courseName').value = template;\n                    document.getElementById('targetAudienceSelect').value = 'adultos';\n                    document.getElementById('courseObjectives').value = 'Desenvolver defesa pessoal, melhorar condicionamento fÃ­sico, construir autoconfianÃ§a';\n                }\n            }\n        }\n\n        function previewCourse() {\n            // Collect current form data\n            const formData = {\n                name: document.getElementById('courseName').value || 'Novo Curso',\n                martialArt: document.getElementById('martialArtSelect').value || 'NÃ£o especificado',\n                level: document.getElementById('courseLevelSelect').value || 'NÃ£o especificado',\n                duration: document.getElementById('courseDuration').value || '0',\n                totalLessons: document.getElementById('totalLessons').value || '0'\n            };\n            \n            const previewContent = `\nðŸ“š PREVIEW DO CURSO\n\nðŸ¥‹ Nome: ${formData.name}\nðŸŽ¯ Arte Marcial: ${formData.martialArt}\nðŸŽ–ï¸ NÃ­vel: ${formData.level}\nâ±ï¸ DuraÃ§Ã£o: ${formData.duration} semanas\nðŸ“– Total de Aulas: ${formData.totalLessons}\n\nðŸ§  GeraÃ§Ã£o com RAG:\nâ€¢ Base de conhecimento: Agenda + Plano Faixa Branca\nâ€¢ IA adaptarÃ¡ metodologia para seus parÃ¢metros\nâ€¢ Estrutura pedagÃ³gica comprovada\nâ€¢ AdaptaÃ§Ãµes automÃ¡ticas por pÃºblico-alvo\n\nðŸ’¡ PrÃ³ximos passos:\n1. Complete todos os campos\n2. Clique em \"Gerar com IA + RAG\"\n3. Aguarde processamento (3-5s)\n4. Curso serÃ¡ adicionado Ã  biblioteca\n            `;\n            \n            alert(previewContent);\n        }\n\n        // Edit existing course template\n        function editCourseTemplate(courseId) {\n            showToast('ðŸš§ FunÃ§Ã£o em desenvolvimento: Editar Template de Curso\\n\\nPermitirÃ¡:\\nâ€¢ Modificar estrutura do curso\\nâ€¢ Alterar sequÃªncia de tÃ©cnicas\\nâ€¢ Adaptar planos de aula\\nâ€¢ Personalizar avaliaÃ§Ãµes', 'info');\n        }\n\n        // Duplicate existing course\n        function duplicateCourse() {\n            const selectedCourse = document.getElementById('courseSelector').value;\n            const courseName = document.getElementById('courseSelector').selectedOptions[0].text;\n            \n            const newCourseName = prompt(`Digite o nome para o curso duplicado:\\n\\nOriginal: ${courseName}`, `${courseName} - CÃ³pia`);\n            \n            if (newCourseName && newCourseName.trim()) {\n                showToast(`ðŸ“‹ Curso \"${newCourseName}\" duplicado com sucesso!\\n\\nAgora vocÃª pode editÃ¡-lo independentemente.`, 'success');\n                \n                // Add the duplicated course to selector\n                const courseSelector = document.getElementById('courseSelector');\n                const option = document.createElement('option');\n                option.value = `curso-${Date.now()}`;\n                option.textContent = newCourseName.trim();\n                courseSelector.appendChild(option);\n                courseSelector.value = option.value;\n                \n                // Update courses count\n                const coursesCount = document.getElementById('totalCoursesCount');\n                if (coursesCount) {\n                    const currentCount = parseInt(coursesCount.textContent) || 0;\n                    coursesCount.textContent = currentCount + 1;\n                }\n            }\n        }\n\n        // ==========================================\n        // STUDENT EDIT PAGE (DEDICATED) FUNCTIONS\n        // ==========================================\n        // (Function moved to top of file for proper scope)\n\n        function saveStudentEdit(studentId) {\n            const firstName = document.getElementById('editFirstName').value;\n            const lastName = document.getElementById('editLastName').value;\n            const email = document.getElementById('editEmail').value;\n            const phone = document.getElementById('editPhone').value;\n            const cpf = document.getElementById('editCpf').value;\n            \n            const updateData = {\n                firstName,\n                lastName,\n                email,\n                phone,\n                cpf\n            };\n            \n            fetch(`/api/students/${studentId}`, {\n                method: 'PUT',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(updateData)\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    showToast('âœ… Aluno atualizado com sucesso!', 'success');\n                    closeEditToast();\n                    // Reload students data\n                    if (typeof loadStudents === 'function') {\n                        loadStudents();\n                    } else {\n                        loadData(); // fallback\n                    }\n                } else {\n                    showToast('âŒ Erro ao atualizar aluno: ' + (data.message || 'Erro desconhecido'), 'error');\n                }\n            })\n            .catch(error => {\n                console.error('Erro ao atualizar aluno:', error);\n                showToast('âŒ Erro ao atualizar aluno: ' + error.message, 'error');\n            });\n        }\n\n        function showCustomToast(content, type = 'info', duration = 3000) {\n            const existingToast = document.querySelector('.custom-toast');\n            if (existingToast) {\n                existingToast.remove();\n            }\n\n            const toast = document.createElement('div');\n            toast.className = 'custom-toast';\n            toast.innerHTML = content;\n            toast.style.cssText = `\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                z-index: 10000;\n                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\n                border: 1px solid #374151;\n                animation: slideIn 0.3s ease-out;\n            `;\n\n            document.body.appendChild(toast);\n\n            if (duration > 0) {\n                setTimeout(() => {\n                    if (toast && toast.parentNode) {\n                        toast.remove();\n                    }\n                }, duration);\n            }\n        }\n\n        function closeEditToast() {\n            const toast = document.querySelector('.custom-toast');\n            if (toast) {\n                toast.remove();\n            }\n        }\n\n        // OLD COMPLEX FUNCTION BELOW - REPLACED WITH SIMPLE VERSION ABOVE\n        async function openStudentEditPage_OLD(studentId) {\n            try {\n                console.log('ðŸ”„ Abrindo pÃ¡gina de ediÃ§Ã£o do aluno:', studentId);\n                currentEditingStudentId = studentId;\n\n                // Fetch student data\n                const response = await fetch(`/api/students`);\n                const data = await response.json();\n                \n                if (!data.success) {\n                    throw new Error(data.message || 'Erro ao carregar dados do estudante');\n                }\n                \n                // Find the specific student\n                const student = data.data.find(s => s.id === studentId);\n                if (!student) {\n                    throw new Error('Estudante nÃ£o encontrado');\n                }\n\n                currentEditingStudent = student;\n                \n                // Hide students list and show edit page\n                document.getElementById('students').style.display = 'none';\n                document.getElementById('student-edit-page').style.display = 'block';\n                \n                // Update page header with student info\n                updateEditPageHeader(student);\n                \n                // Load the edit form\n                loadEditPageForm(student);\n                \n                // Update sidebar with student stats\n                updateEditPageSidebar(student);\n                \n                // Set active tab to edit\n                switchPageTab('edit');\n                \n                console.log('âœ… PÃ¡gina de ediÃ§Ã£o carregada com sucesso');\n                \n            } catch (error) {\n                console.error('âŒ Erro ao abrir pÃ¡gina de ediÃ§Ã£o:', error);\n                showNotification(`Erro: ${error.message}`, 'error');\n            }\n        }\n\n\n        // Load overview tab content\n        function loadOverviewTabContent() {\n            const overviewTab = document.getElementById('page-tab-overview');\n            const student = currentEditingStudent;\n            const user = student.user || {};\n\n            overviewTab.innerHTML = `\n                <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;\">\n                    <div>\n                        <h4 style=\"color: #F8FAFC; margin: 0 0 1rem 0;\">ðŸ‘¤ Dados Pessoais</h4>\n                        <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 8px; padding: 1rem; border: 1px solid #334155;\">\n                            <div style=\"margin-bottom: 0.75rem;\">\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">Nome Completo</div>\n                                <div style=\"color: #F8FAFC; font-weight: 600;\">${user.firstName || ''} ${user.lastName || ''}</div>\n                            </div>\n                            <div style=\"margin-bottom: 0.75rem;\">\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">Email</div>\n                                <div style=\"color: #F8FAFC;\">${user.email || 'NÃ£o informado'}</div>\n                            </div>\n                            <div style=\"margin-bottom: 0.75rem;\">\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">Telefone</div>\n                                <div style=\"color: #F8FAFC;\">${user.phone || 'NÃ£o informado'}</div>\n                            </div>\n                        </div>\n                    </div>\n                    <div>\n                        <h4 style=\"color: #F8FAFC; margin: 0 0 1rem 0;\">ðŸ¥‹ Dados AcadÃªmicos</h4>\n                        <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 8px; padding: 1rem; border: 1px solid #334155;\">\n                            <div style=\"margin-bottom: 0.75rem;\">\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">Categoria</div>\n                                <div style=\"color: #F8FAFC; font-weight: 600;\">${student.category || 'N/A'}</div>\n                            </div>\n                            <div style=\"margin-bottom: 0.75rem;\">\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">NÃ­vel</div>\n                                <div style=\"color: #F8FAFC;\">NÃ­vel ${student.globalLevel || '1'}</div>\n                            </div>\n                            <div style=\"margin-bottom: 0.75rem;\">\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">XP Total</div>\n                                <div style=\"color: #F8FAFC;\">${student.totalXP || '0'} pontos</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n        }\n\n        // Progress tab with detailed content\n        function loadProgressTabContent() {\n            const progressTab = document.getElementById('progressContent');\n            progressTab.innerHTML = `\n                <!-- Overall Progress -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; margin-bottom: 2rem;\">\n                    <h4 style=\"color: #10B981; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                        ðŸ“Š Progresso Geral\n                        <div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.7rem; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                            EM ALTA\n                        </div>\n                    </h4>\n                    <div style=\"display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;\">\n                        <div style=\"text-align: center;\">\n                            <div style=\"position: relative; display: inline-block; margin-bottom: 1rem;\">\n                                <svg width=\"140\" height=\"140\" viewBox=\"0 0 140 140\">\n                                    <circle cx=\"70\" cy=\"70\" r=\"60\" fill=\"none\" stroke=\"#334155\" stroke-width=\"12\"/>\n                                    <circle cx=\"70\" cy=\"70\" r=\"60\" fill=\"none\" stroke=\"#10B981\" stroke-width=\"12\"\n                                            stroke-dasharray=\"377\" stroke-dashoffset=\"260\" stroke-linecap=\"round\"\n                                            transform=\"rotate(-90 70 70)\"/>\n                                </svg>\n                                <div style=\"position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);\">\n                                    <div style=\"color: #10B981; font-size: 1.75rem; font-weight: bold;\">31%</div>\n                                    <div style=\"color: #94A3B8; font-size: 0.8rem;\">COMPLETO</div>\n                                </div>\n                            </div>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">Aula 15 de 48</div>\n                        </div>\n                        <div style=\"display: grid; gap: 1rem;\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                <span style=\"color: #CBD5E1;\">FrequÃªncia mÃ©dia:</span>\n                                <span style=\"color: #10B981; font-weight: 600;\">95%</span>\n                            </div>\n                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                <span style=\"color: #CBD5E1;\">TÃ©cnicas dominadas:</span>\n                                <span style=\"color: #F8FAFC; font-weight: 600;\">13 de 42</span>\n                            </div>\n                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                <span style=\"color: #CBD5E1;\">XP total acumulado:</span>\n                                <span style=\"color: #8B5CF6; font-weight: 600;\">1,250 XP</span>\n                            </div>\n                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                <span style=\"color: #CBD5E1;\">Ranking na turma:</span>\n                                <span style=\"color: #F59E0B; font-weight: 600;\">3Âº de 15</span>\n                            </div>\n                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                <span style=\"color: #CBD5E1;\">Tempo atÃ© prÃ³xima faixa:</span>\n                                <span style=\"color: #3B82F6; font-weight: 600;\">~8 semanas</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- TÃ©cnicas por Categoria -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; margin-bottom: 2rem;\">\n                    <h4 style=\"color: #3B82F6; margin: 0 0 1rem 0;\">ðŸ¥‹ Progresso por Categoria de TÃ©cnica</h4>\n                    <div style=\"display: grid; gap: 1rem;\">\n                        <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 8px; padding: 1rem; border: 1px solid #475569;\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                <span style=\"color: #F8FAFC; font-weight: 600;\">ðŸ‘Š Golpes BÃ¡sicos</span>\n                                <span style=\"color: #10B981;\">85%</span>\n                            </div>\n                            <div style=\"background: #1E293B; border-radius: 4px; height: 6px; width: 100%; overflow: hidden;\">\n                                <div style=\"background: linear-gradient(90deg, #10B981, #059669); height: 100%; width: 85%; transition: width 0.3s ease;\"></div>\n                            </div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem; margin-top: 0.25rem;\">Socos, chutes, cotoveladas â€¢ 6 de 7 tÃ©cnicas</div>\n                        </div>\n                        <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 8px; padding: 1rem; border: 1px solid #475569;\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                <span style=\"color: #F8FAFC; font-weight: 600;\">ðŸ›¡ï¸ Defesas BÃ¡sicas</span>\n                                <span style=\"color: #F59E0B;\">65%</span>\n                            </div>\n                            <div style=\"background: #1E293B; border-radius: 4px; height: 6px; width: 100%; overflow: hidden;\">\n                                <div style=\"background: linear-gradient(90deg, #F59E0B, #D97706); height: 100%; width: 65%; transition: width 0.3s ease;\"></div>\n                            </div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem; margin-top: 0.25rem;\">Bloqueios, esquivas â€¢ 4 de 6 tÃ©cnicas</div>\n                        </div>\n                        <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 8px; padding: 1rem; border: 1px solid #475569;\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                <span style=\"color: #F8FAFC; font-weight: 600;\">ðŸ¤¸ MovimentaÃ§Ã£o</span>\n                                <span style=\"color: #10B981;\">90%</span>\n                            </div>\n                            <div style=\"background: #1E293B; border-radius: 4px; height: 6px; width: 100%; overflow: hidden;\">\n                                <div style=\"background: linear-gradient(90deg, #10B981, #059669); height: 100%; width: 90%; transition: width 0.3s ease;\"></div>\n                            </div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem; margin-top: 0.25rem;\">Postura, deslocamento â€¢ 3 de 3 tÃ©cnicas</div>\n                        </div>\n                        <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 8px; padding: 1rem; border: 1px solid #475569;\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                <span style=\"color: #F8FAFC; font-weight: 600;\">âš”ï¸ TÃ©cnicas AvanÃ§adas</span>\n                                <span style=\"color: #64748B;\">0%</span>\n                            </div>\n                            <div style=\"background: #1E293B; border-radius: 4px; height: 6px; width: 100%; overflow: hidden;\">\n                                <div style=\"background: #64748B; height: 100%; width: 0%; transition: width 0.3s ease;\"></div>\n                            </div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem; margin-top: 0.25rem;\">NÃ£o iniciado â€¢ 0 de 26 tÃ©cnicas</div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- EvoluÃ§Ã£o Temporal -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; margin-bottom: 2rem;\">\n                    <h4 style=\"color: #8B5CF6; margin: 0 0 1rem 0;\">ðŸ“ˆ EvoluÃ§Ã£o nas Ãšltimas Semanas</h4>\n                    <div style=\"display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.5rem; align-items: end; height: 120px; padding: 1rem; background: rgba(15, 23, 42, 0.5); border-radius: 8px; border: 1px solid #475569;\">\n                        <div style=\"text-align: center;\">\n                            <div style=\"background: #10B981; height: 60px; width: 100%; border-radius: 4px 4px 0 0; margin-bottom: 0.5rem;\"></div>\n                            <div style=\"color: #94A3B8; font-size: 0.7rem;\">S1</div>\n                        </div>\n                        <div style=\"text-align: center;\">\n                            <div style=\"background: #10B981; height: 75px; width: 100%; border-radius: 4px 4px 0 0; margin-bottom: 0.5rem;\"></div>\n                            <div style=\"color: #94A3B8; font-size: 0.7rem;\">S2</div>\n                        </div>\n                        <div style=\"text-align: center;\">\n                            <div style=\"background: #F59E0B; height: 45px; width: 100%; border-radius: 4px 4px 0 0; margin-bottom: 0.5rem;\"></div>\n                            <div style=\"color: #94A3B8; font-size: 0.7rem;\">S3</div>\n                        </div>\n                        <div style=\"text-align: center;\">\n                            <div style=\"background: #10B981; height: 85px; width: 100%; border-radius: 4px 4px 0 0; margin-bottom: 0.5rem;\"></div>\n                            <div style=\"color: #94A3B8; font-size: 0.7rem;\">S4</div>\n                        </div>\n                        <div style=\"text-align: center;\">\n                            <div style=\"background: #10B981; height: 90px; width: 100%; border-radius: 4px 4px 0 0; margin-bottom: 0.5rem;\"></div>\n                            <div style=\"color: #94A3B8; font-size: 0.7rem;\">S5</div>\n                        </div>\n                        <div style=\"text-align: center;\">\n                            <div style=\"background: #3B82F6; height: 70px; width: 100%; border-radius: 4px 4px 0 0; margin-bottom: 0.5rem;\"></div>\n                            <div style=\"color: #94A3B8; font-size: 0.7rem;\">S6</div>\n                        </div>\n                        <div style=\"text-align: center;\">\n                            <div style=\"background: #10B981; height: 95px; width: 100%; border-radius: 4px 4px 0 0; margin-bottom: 0.5rem;\"></div>\n                            <div style=\"color: #94A3B8; font-size: 0.7rem;\">S7</div>\n                        </div>\n                        <div style=\"text-align: center;\">\n                            <div style=\"background: #8B5CF6; height: 100px; width: 100%; border-radius: 4px 4px 0 0; margin-bottom: 0.5rem;\"></div>\n                            <div style=\"color: #94A3B8; font-size: 0.7rem;\">S8</div>\n                        </div>\n                    </div>\n                    <div style=\"display: flex; justify-content: center; gap: 2rem; margin-top: 1rem;\">\n                        <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                            <div style=\"width: 12px; height: 12px; background: #10B981; border-radius: 2px;\"></div>\n                            <span style=\"color: #CBD5E1; font-size: 0.875rem;\">Excelente (90%+)</span>\n                        </div>\n                        <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                            <div style=\"width: 12px; height: 12px; background: #3B82F6; border-radius: 2px;\"></div>\n                            <span style=\"color: #CBD5E1; font-size: 0.875rem;\">Bom (70-89%)</span>\n                        </div>\n                        <div style=\"display: flex; align-items: center; gap: 0.5rem;\">\n                            <div style=\"width: 12px; height: 12px; background: #F59E0B; border-radius: 2px;\"></div>\n                            <span style=\"color: #CBD5E1; font-size: 0.875rem;\">Regular (50-69%)</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Achievements -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;\">\n                    <h4 style=\"color: #F59E0B; margin: 0 0 1rem 0;\">ðŸ† Conquistas e Badges</h4>\n                    <div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;\">\n                        <div style=\"background: rgba(16, 185, 129, 0.1); border-radius: 8px; padding: 1rem; text-align: center; border: 1px solid rgba(16, 185, 129, 0.2);\">\n                            <div style=\"font-size: 2rem; margin-bottom: 0.5rem;\">ðŸŽ¯</div>\n                            <div style=\"color: #10B981; font-weight: 600; font-size: 0.875rem;\">FrequÃªncia Exemplar</div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem;\">95% nas Ãºltimas 4 semanas</div>\n                        </div>\n                        <div style=\"background: rgba(139, 92, 246, 0.1); border-radius: 8px; padding: 1rem; text-align: center; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                            <div style=\"font-size: 2rem; margin-bottom: 0.5rem;\">ðŸ”¥</div>\n                            <div style=\"color: #8B5CF6; font-weight: 600; font-size: 0.875rem;\">SequÃªncia de Ouro</div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem;\">7 aulas consecutivas</div>\n                        </div>\n                        <div style=\"background: rgba(245, 158, 11, 0.1); border-radius: 8px; padding: 1rem; text-align: center; border: 1px solid rgba(245, 158, 11, 0.2);\">\n                            <div style=\"font-size: 2rem; margin-bottom: 0.5rem;\">âš¡</div>\n                            <div style=\"color: #F59E0B; font-weight: 600; font-size: 0.875rem;\">Progresso RÃ¡pido</div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem;\">31% em 6 semanas</div>\n                        </div>\n                        <div style=\"background: rgba(71, 85, 105, 0.1); border-radius: 8px; padding: 1rem; text-align: center; border: 1px solid rgba(71, 85, 105, 0.2); opacity: 0.6;\">\n                            <div style=\"font-size: 2rem; margin-bottom: 0.5rem;\">ðŸ¥‹</div>\n                            <div style=\"color: #94A3B8; font-weight: 600; font-size: 0.875rem;\">Primeiro Sparring</div>\n                            <div style=\"color: #64748B; font-size: 0.75rem;\">Em breve</div>\n                        </div>\n                    </div>\n                </div>\n            `;\n        }\n\n        // ===== NOVAS FUNÃ‡Ã•ES DAS ABAS =====\n\n        // AI Dashboard Tab\n        function loadAIDashboardContent() {\n            const aiTab = document.getElementById('aiDashboardContent');\n            aiTab.innerHTML = `\n                <!-- AI Dashboard Grid -->\n                <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;\">\n                    <!-- Performance Score -->\n                    <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;\">\n                        <h4 style=\"color: #10B981; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                            ðŸŽ¯ Score de Performance IA\n                        </h4>\n                        <div style=\"text-align: center;\">\n                            <div style=\"position: relative; display: inline-block;\">\n                                <svg width=\"120\" height=\"120\" viewBox=\"0 0 120 120\">\n                                    <circle cx=\"60\" cy=\"60\" r=\"54\" fill=\"none\" stroke=\"#334155\" stroke-width=\"8\"/>\n                                    <circle cx=\"60\" cy=\"60\" r=\"54\" fill=\"none\" stroke=\"#10B981\" stroke-width=\"8\"\n                                            stroke-dasharray=\"339\" stroke-dashoffset=\"82\" stroke-linecap=\"round\"\n                                            transform=\"rotate(-90 60 60)\"/>\n                                </svg>\n                                <div style=\"position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);\">\n                                    <div style=\"color: #10B981; font-size: 1.5rem; font-weight: bold;\">87%</div>\n                                    <div style=\"color: #94A3B8; font-size: 0.7rem;\">EXCELENTE</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div style=\"margin-top: 1rem; color: #94A3B8; font-size: 0.875rem; text-align: center;\">\n                            Baseado em frequÃªncia, evoluÃ§Ã£o tÃ©cnica e engajamento\n                        </div>\n                    </div>\n\n                    <!-- Risk Assessment -->\n                    <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;\">\n                        <h4 style=\"color: #F59E0B; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                            âš ï¸ AnÃ¡lise de Risco\n                        </h4>\n                        <div style=\"display: grid; gap: 1rem;\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                <span style=\"color: #CBD5E1; font-size: 0.875rem;\">Risco de Abandono</span>\n                                <div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                                    BAIXO (15%)\n                                </div>\n                            </div>\n                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                <span style=\"color: #CBD5E1; font-size: 0.875rem;\">Pontualidade</span>\n                                <div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                                    Ã“TIMA\n                                </div>\n                            </div>\n                            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                                <span style=\"color: #CBD5E1; font-size: 0.875rem;\">EvoluÃ§Ã£o TÃ©cnica</span>\n                                <div style=\"background: rgba(245, 158, 11, 0.1); color: #F59E0B; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem; border: 1px solid rgba(245, 158, 11, 0.3);\">\n                                    ACIMA DA MÃ‰DIA\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- AI Insights -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; margin-bottom: 2rem;\">\n                    <h4 style=\"color: #8B5CF6; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                        ðŸ§  Insights IA Personalizados\n                    </h4>\n                    <div style=\"display: grid; gap: 1rem;\">\n                        <div style=\"background: rgba(139, 92, 246, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                            <div style=\"color: #C4B5FD; font-weight: 600; margin-bottom: 0.5rem;\">âœ¨ Pontos Fortes</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">\n                                â€¢ Excelente frequÃªncia (95% nas Ãºltimas 4 semanas)<br>\n                                â€¢ EvoluÃ§Ã£o consistente em tÃ©cnicas de defesa<br>\n                                â€¢ Alta motivaÃ§Ã£o em treinamentos de sparring\n                            </div>\n                        </div>\n                        <div style=\"background: rgba(245, 158, 11, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(245, 158, 11, 0.2);\">\n                            <div style=\"color: #FCD34D; font-weight: 600; margin-bottom: 0.5rem;\">ðŸ’¡ Oportunidades</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">\n                                â€¢ Focar em tÃ©cnicas de ground fighting (score atual: 65%)<br>\n                                â€¢ Participar mais dos desafios semanais<br>\n                                â€¢ Considerar treinamento adicional de flexibilidade\n                            </div>\n                        </div>\n                        <div style=\"background: rgba(16, 185, 129, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(16, 185, 129, 0.2);\">\n                            <div style=\"color: #6EE7B7; font-weight: 600; margin-bottom: 0.5rem;\">ðŸŽ¯ RecomendaÃ§Ã£o IA</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">\n                                Aluno modelo com evoluÃ§Ã£o exemplar. SugestÃ£o: promover para instrutor assistente voluntÃ¡rio para motivar outros alunos iniciantes.\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Recent Activity Prediction -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;\">\n                    <h4 style=\"color: #3B82F6; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                        ðŸ“ˆ PrediÃ§Ãµes e TendÃªncias\n                    </h4>\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;\">\n                        <div style=\"text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                            <div style=\"color: #60A5FA; font-size: 1.25rem; font-weight: bold;\">92%</div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem;\">Chance de completar faixa</div>\n                        </div>\n                        <div style=\"text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.2);\">\n                            <div style=\"color: #34D399; font-size: 1.25rem; font-weight: bold;\">4.8</div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem;\">Score satisfaÃ§Ã£o (IA)</div>\n                        </div>\n                        <div style=\"text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border: 1px solid rgba(245, 158, 11, 0.2);\">\n                            <div style=\"color: #FBBF24; font-size: 1.25rem; font-weight: bold;\">8 sem</div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem;\">Tempo para prÃ³xima faixa</div>\n                        </div>\n                    </div>\n                </div>\n            `;\n        }\n\n        // Plans Tab - Dynamic version with real data\n        async function loadPlansTabContent() {\n            const plansTab = document.getElementById('plansContent');\n            plansTab.innerHTML = `<div style=\"text-align: center; padding: 2rem; color: #94A3B8;\">ðŸ”„ Carregando dados do plano...</div>`;\n            \n            if (!currentEditingStudentId) {\n                plansTab.innerHTML = `<div style=\"text-align: center; padding: 2rem; color: #EF4444;\">âŒ Erro: ID do aluno nÃ£o encontrado</div>`;\n                return;\n            }\n\n            try {\n                // Load student subscription data\n                const subscriptionResponse = await fetch(`/api/students/${currentEditingStudentId}/subscription`);\n                const subscriptionData = await subscriptionResponse.json();\n                \n                // Load available billing plans\n                const plansResponse = await fetch('/api/billing-plans');\n                const plansData = await plansResponse.json();\n                \n                let currentPlan = null;\n                let hasActiveSubscription = false;\n                \n                if (subscriptionData.success && subscriptionData.data) {\n                    currentPlan = subscriptionData.data.plan;\n                    hasActiveSubscription = true;\n                }\n                \n                const availablePlans = plansData.success ? plansData.data : [];\n                \n                plansTab.innerHTML = `\n                    <!-- Current Plan Section -->\n                    <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; margin-bottom: 2rem;\">\n                        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;\">\n                            <h4 style=\"color: ${hasActiveSubscription ? '#10B981' : '#F59E0B'}; margin: 0; display: flex; align-items: center; gap: 0.5rem;\">\n                                ðŸ’³ ${hasActiveSubscription ? 'Plano Atual' : 'Sem Plano Ativo'}\n                                ${hasActiveSubscription ? \n                                    `<div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.7rem; border: 1px solid rgba(16, 185, 129, 0.3);\">ATIVO</div>` :\n                                    `<div style=\"background: rgba(245, 158, 11, 0.1); color: #F59E0B; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.7rem; border: 1px solid rgba(245, 158, 11, 0.3);\">INATIVO</div>`\n                                }\n                            </h4>\n                            ${hasActiveSubscription ? \n                                `<button onclick=\"editStudentPlan()\" style=\"background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; color: #3B82F6; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.875rem;\">\n                                    âœï¸ Editar Plano\n                                </button>` :\n                                `<button onclick=\"assignStudentPlan()\" style=\"background: rgba(16, 185, 129, 0.1); border: 1px solid #10B981; color: #10B981; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.875rem;\">\n                                    âž• Atribuir Plano\n                                </button>`\n                            }\n                        </div>\n                        \n                        ${hasActiveSubscription && currentPlan ? `\n                            <div style=\"display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;\">\n                                <div>\n                                    <div style=\"background: rgba(16, 185, 129, 0.1); border-radius: 8px; padding: 1.5rem; text-align: center; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                                        <div style=\"color: #10B981; font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;\">R$ ${currentPlan.price}</div>\n                                        <div style=\"color: #CBD5E1; font-size: 0.875rem;\">${currentPlan.billingCycle === 'MONTHLY' ? 'por mÃªs' : currentPlan.billingCycle === 'YEARLY' ? 'por ano' : 'Ãºnico'}</div>\n                                        <div style=\"color: #94A3B8; font-size: 0.75rem; margin-top: 0.5rem;\">${currentPlan.name || 'Plano sem nome'}</div>\n                                    </div>\n                                </div>\n                                <div>\n                                    <div style=\"display: grid; gap: 1rem;\">\n                                        <div style=\"display: flex; justify-content: space-between;\">\n                                            <span style=\"color: #CBD5E1;\">Categoria:</span>\n                                            <span style=\"color: #F8FAFC; font-weight: 600;\">${currentPlan.category || 'N/A'}</span>\n                                        </div>\n                                        <div style=\"display: flex; justify-content: space-between;\">\n                                            <span style=\"color: #CBD5E1;\">Aulas por semana:</span>\n                                            <span style=\"color: #F8FAFC; font-weight: 600;\">${currentPlan.weeklyLimit || 'Ilimitadas'}</span>\n                                        </div>\n                                        <div style=\"display: flex; justify-content: space-between;\">\n                                            <span style=\"color: #CBD5E1;\">Tipo de cobranÃ§a:</span>\n                                            <span style=\"color: #F8FAFC; font-weight: 600;\">${currentPlan.billingCycle || 'N/A'}</span>\n                                        </div>\n                                        <div style=\"display: flex; justify-content: space-between;\">\n                                            <span style=\"color: #CBD5E1;\">Status:</span>\n                                            <div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                                                ATIVO\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        ` : `\n                            <div style=\"text-align: center; padding: 3rem; color: #94A3B8;\">\n                                <div style=\"font-size: 3rem; margin-bottom: 1rem;\">ðŸ’³</div>\n                                <div style=\"font-size: 1.125rem; color: #CBD5E1; margin-bottom: 0.5rem;\">Nenhum plano ativo</div>\n                                <div style=\"font-size: 0.875rem;\">Este aluno precisa de um plano de pagamento para acessar as aulas</div>\n                            </div>\n                        `}\n                    </div>\n\n                    <!-- Available Plans -->\n                    <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;\">\n                        <h4 style=\"color: #3B82F6; margin: 0 0 1rem 0;\">ðŸ“‹ Planos DisponÃ­veis</h4>\n                        ${availablePlans.length > 0 ? `\n                            <div style=\"display: grid; gap: 1rem;\">\n                                ${availablePlans.map(plan => `\n                                    <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 8px; padding: 1rem; border: 1px solid #475569; display: grid; grid-template-columns: 1fr auto auto; gap: 1rem; align-items: center;\">\n                                        <div>\n                                            <div style=\"color: #F8FAFC; font-weight: 600; margin-bottom: 0.25rem;\">${plan.name || 'Plano sem nome'}</div>\n                                            <div style=\"color: #94A3B8; font-size: 0.875rem;\">\n                                                ${plan.category || 'Categoria N/A'} â€¢ ${plan.billingCycle || 'N/A'} â€¢ ${plan.weeklyLimit || 'Ilimitado'} aulas/semana\n                                            </div>\n                                        </div>\n                                        <div style=\"color: #10B981; font-weight: bold; font-size: 1.125rem;\">R$ ${plan.price || '0'}</div>\n                                        <button onclick=\"assignPlanToStudent('${plan.id}')\" style=\"background: rgba(16, 185, 129, 0.1); border: 1px solid #10B981; color: #10B981; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.75rem;\">\n                                            ${hasActiveSubscription && currentPlan && currentPlan.id === plan.id ? 'âœ… Atual' : 'â†’ Atribuir'}\n                                        </button>\n                                    </div>\n                                `).join('')}\n                            </div>\n                        ` : `\n                            <div style=\"text-align: center; padding: 2rem; color: #94A3B8;\">\n                                <div style=\"font-size: 2rem; margin-bottom: 1rem;\">ðŸ“‹</div>\n                                <div>Nenhum plano de pagamento cadastrado</div>\n                                <div style=\"font-size: 0.875rem; margin-top: 0.5rem;\">Configure planos na seÃ§Ã£o de GestÃ£o Financeira</div>\n                            </div>\n                        `}\n                    </div>\n                `;\n                \n                // Update sidebar financial status\n                updateSidebarFinancialStatus(hasActiveSubscription, currentPlan);\n                \n            } catch (error) {\n                console.error('Erro ao carregar dados do plano:', error);\n                plansTab.innerHTML = `\n                    <div style=\"text-align: center; padding: 2rem; color: #EF4444;\">\n                        <div style=\"font-size: 2rem; margin-bottom: 1rem;\">âŒ</div>\n                        <div>Erro ao carregar dados do plano</div>\n                        <div style=\"font-size: 0.875rem; margin-top: 0.5rem;\">${error.message}</div>\n                        <button onclick=\"loadPlansTabContent()\" style=\"background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; color: #3B82F6; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; margin-top: 1rem;\">\n                            ðŸ”„ Tentar Novamente\n                        </button>\n                    </div>\n                `;\n                \n                // Update sidebar to show error\n                updateSidebarFinancialStatus(false, null);\n            }\n        }\n\n        // Function to update sidebar financial status\n        function updateSidebarFinancialStatus(hasActiveSubscription, currentPlan) {\n            const sidebarFinancial = document.getElementById('sidebarFinancialStatus');\n            if (!sidebarFinancial) return;\n            \n            if (hasActiveSubscription && currentPlan) {\n                sidebarFinancial.innerHTML = `\n                    <div style=\"color: #10B981; font-weight: bold; margin-bottom: 0.5rem;\">âœ… Plano Ativo</div>\n                    <div style=\"color: #CBD5E1; font-size: 0.875rem;\">R$ ${currentPlan.price || '0'}${currentPlan.billingCycle === 'MONTHLY' ? '/mÃªs' : currentPlan.billingCycle === 'YEARLY' ? '/ano' : ''}</div>\n                    <div style=\"color: #94A3B8; font-size: 0.75rem; margin-top: 0.25rem;\">${currentPlan.name || 'Plano sem nome'}</div>\n                `;\n                sidebarFinancial.style.background = 'rgba(16, 185, 129, 0.1)';\n                sidebarFinancial.style.borderColor = 'rgba(16, 185, 129, 0.3)';\n            } else {\n                sidebarFinancial.innerHTML = `\n                    <div style=\"color: #F59E0B; font-weight: bold; margin-bottom: 0.5rem;\">âš ï¸ Sem Plano</div>\n                    <div style=\"color: #CBD5E1; font-size: 0.875rem;\">Atribuir plano de pagamento</div>\n                    <div style=\"color: #94A3B8; font-size: 0.75rem; margin-top: 0.25rem;\">Acesso limitado</div>\n                `;\n                sidebarFinancial.style.background = 'rgba(245, 158, 11, 0.1)';\n                sidebarFinancial.style.borderColor = 'rgba(245, 158, 11, 0.3)';\n            }\n        }\n\n        // Function to assign a plan to the current student\n        async function assignPlanToStudent(planId) {\n            if (!currentEditingStudentId) {\n                showToast('Erro: ID do aluno nÃ£o encontrado', 'error');\n                return;\n            }\n            \n            try {\n                const response = await fetch('/api/financial/subscriptions', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        studentId: currentEditingStudentId,\n                        planId: planId,\n                        startDate: new Date().toISOString(),\n                        status: 'ACTIVE',\n                        isActive: true\n                    })\n                });\n                \n                const data = await response.json();\n                \n                if (data.success) {\n                    showToast('Plano atribuÃ­do com sucesso!', 'success');\n                    loadPlansTabContent(); // Reload the tab content\n                } else {\n                    throw new Error(data.message || 'Erro ao atribuir plano');\n                }\n                \n            } catch (error) {\n                console.error('Erro ao atribuir plano:', error);\n                showToast('Erro ao atribuir plano: ' + error.message, 'error');\n            }\n        }\n\n        // Function to edit current student plan\n        function editStudentPlan() {\n            showToast('Funcionalidade de ediÃ§Ã£o de plano em desenvolvimento', 'info');\n        }\n\n        // Function to assign plan when student has none\n        function assignStudentPlan() {\n            showToast('Selecione um plano disponÃ­vel abaixo para atribuir ao aluno', 'info');\n        }\n\n        // Classes Tab\n        function loadClassesTabContent() {\n            const classesTab = document.getElementById('classesContent');\n            classesTab.innerHTML = `\n                <!-- Current Classes -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; margin-bottom: 2rem;\">\n                    <h4 style=\"color: #10B981; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                        ðŸ• Turmas Ativas\n                        <div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.7rem; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                            2 TURMAS\n                        </div>\n                    </h4>\n                    <div style=\"display: grid; gap: 1rem;\">\n                        <div style=\"background: rgba(59, 130, 246, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;\">\n                                <div style=\"color: #60A5FA; font-weight: 600;\">Turma 1 - ManhÃ£</div>\n                                <div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                                    PRINCIPAL\n                                </div>\n                            </div>\n                            <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;\">\n                                <div>\n                                    <div style=\"color: #94A3B8; font-size: 0.875rem;\">HorÃ¡rio</div>\n                                    <div style=\"color: #F8FAFC; font-weight: 600;\">Ter/Qui 08:00</div>\n                                </div>\n                                <div>\n                                    <div style=\"color: #94A3B8; font-size: 0.875rem;\">Instrutor</div>\n                                    <div style=\"color: #F8FAFC; font-weight: 600;\">Prof. Silva</div>\n                                </div>\n                                <div>\n                                    <div style=\"color: #94A3B8; font-size: 0.875rem;\">Alunos</div>\n                                    <div style=\"color: #F8FAFC; font-weight: 600;\">15/20</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div style=\"background: rgba(139, 92, 246, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;\">\n                                <div style=\"color: #C4B5FD; font-weight: 600;\">Turma 2 - Noite</div>\n                                <div style=\"background: rgba(245, 158, 11, 0.1); color: #F59E0B; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem; border: 1px solid rgba(245, 158, 11, 0.3);\">\n                                    SECUNDÃRIA\n                                </div>\n                            </div>\n                            <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;\">\n                                <div>\n                                    <div style=\"color: #94A3B8; font-size: 0.875rem;\">HorÃ¡rio</div>\n                                    <div style=\"color: #F8FAFC; font-weight: 600;\">Seg/Qua 19:00</div>\n                                </div>\n                                <div>\n                                    <div style=\"color: #94A3B8; font-size: 0.875rem;\">Instrutor</div>\n                                    <div style=\"color: #F8FAFC; font-weight: 600;\">Prof. Costa</div>\n                                </div>\n                                <div>\n                                    <div style=\"color: #94A3B8; font-size: 0.875rem;\">Alunos</div>\n                                    <div style=\"color: #F8FAFC; font-weight: 600;\">12/20</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Schedule View -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; margin-bottom: 2rem;\">\n                    <h4 style=\"color: #3B82F6; margin: 0 0 1rem 0;\">ðŸ“… Cronograma Semanal</h4>\n                    <div style=\"display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem;\">\n                        <div style=\"text-align: center; padding: 0.5rem; color: #94A3B8; font-weight: 600; font-size: 0.875rem;\">DOM</div>\n                        <div style=\"text-align: center; padding: 0.5rem; color: #94A3B8; font-weight: 600; font-size: 0.875rem;\">SEG</div>\n                        <div style=\"text-align: center; padding: 0.5rem; color: #94A3B8; font-weight: 600; font-size: 0.875rem;\">TER</div>\n                        <div style=\"text-align: center; padding: 0.5rem; color: #94A3B8; font-weight: 600; font-size: 0.875rem;\">QUA</div>\n                        <div style=\"text-align: center; padding: 0.5rem; color: #94A3B8; font-weight: 600; font-size: 0.875rem;\">QUI</div>\n                        <div style=\"text-align: center; padding: 0.5rem; color: #94A3B8; font-weight: 600; font-size: 0.875rem;\">SEX</div>\n                        <div style=\"text-align: center; padding: 0.5rem; color: #94A3B8; font-weight: 600; font-size: 0.875rem;\">SÃB</div>\n                        \n                        <div style=\"text-align: center; padding: 1rem; background: rgba(15, 23, 42, 0.5); border-radius: 8px;\">-</div>\n                        <div style=\"text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 8px; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                            <div style=\"color: #C4B5FD; font-size: 0.75rem;\">19:00</div>\n                            <div style=\"color: #F8FAFC; font-size: 0.75rem; font-weight: 600;\">T2</div>\n                        </div>\n                        <div style=\"text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                            <div style=\"color: #60A5FA; font-size: 0.75rem;\">08:00</div>\n                            <div style=\"color: #F8FAFC; font-size: 0.75rem; font-weight: 600;\">T1</div>\n                        </div>\n                        <div style=\"text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 8px; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                            <div style=\"color: #C4B5FD; font-size: 0.75rem;\">19:00</div>\n                            <div style=\"color: #F8FAFC; font-size: 0.75rem; font-weight: 600;\">T2</div>\n                        </div>\n                        <div style=\"text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                            <div style=\"color: #60A5FA; font-size: 0.75rem;\">08:00</div>\n                            <div style=\"color: #F8FAFC; font-size: 0.75rem; font-weight: 600;\">T1</div>\n                        </div>\n                        <div style=\"text-align: center; padding: 1rem; background: rgba(15, 23, 42, 0.5); border-radius: 8px;\">-</div>\n                        <div style=\"text-align: center; padding: 1rem; background: rgba(15, 23, 42, 0.5); border-radius: 8px;\">-</div>\n                    </div>\n                </div>\n\n                <!-- Class Actions -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;\">\n                    <h4 style=\"color: #F59E0B; margin: 0 0 1rem 0;\">âš¡ AÃ§Ãµes de Turma</h4>\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;\">\n                        <button onclick=\"transferClassActions()\" style=\"background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; color: #3B82F6; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: 600;\">\n                            ðŸ”„ Transferir Turma\n                        </button>\n                        <button onclick=\"pauseClassActions()\" style=\"background: rgba(245, 158, 11, 0.1); border: 1px solid #F59E0B; color: #F59E0B; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: 600;\">\n                            â¸ï¸ Pausar Temporariamente\n                        </button>\n                        <button onclick=\"addClassActions()\" style=\"background: rgba(16, 185, 129, 0.1); border: 1px solid #10B981; color: #10B981; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: 600;\">\n                            âž• Adicionar Turma Extra\n                        </button>\n                    </div>\n                </div>\n            `;\n        }\n\n        // Courses Tab\n        function loadCoursesTabContent() {\n            const coursesTab = document.getElementById('coursesContent');\n            coursesTab.innerHTML = `\n                <!-- Current Course -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; margin-bottom: 2rem;\">\n                    <h4 style=\"color: #10B981; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;\">\n                        ðŸ“š Curso Atual\n                        <div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.7rem; border: 1px solid rgba(16, 185, 129, 0.3);\">\n                            EM PROGRESSO\n                        </div>\n                    </h4>\n                    <div style=\"background: rgba(15, 23, 42, 0.5); border-radius: 8px; padding: 1.5rem; border: 1px solid #475569;\">\n                        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;\">\n                            <h5 style=\"color: #F8FAFC; margin: 0; font-size: 1.125rem;\">Krav Maga Faixa Branca - Defesa Pessoal 1</h5>\n                            <div style=\"color: #10B981; font-weight: 600;\">31% completo</div>\n                        </div>\n                        <div style=\"background: #1E293B; border-radius: 6px; height: 8px; width: 100%; overflow: hidden; margin-bottom: 1rem;\">\n                            <div style=\"background: linear-gradient(90deg, #10B981, #059669); height: 100%; width: 31%; transition: width 0.3s ease;\"></div>\n                        </div>\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 1rem;\">\n                            <div>\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">Aula Atual</div>\n                                <div style=\"color: #F8FAFC; font-weight: 600;\">15 de 48</div>\n                            </div>\n                            <div>\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">TÃ©cnicas Aprendidas</div>\n                                <div style=\"color: #F8FAFC; font-weight: 600;\">13 de 42</div>\n                            </div>\n                            <div>\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">InÃ­cio</div>\n                                <div style=\"color: #F8FAFC; font-weight: 600;\">01/06/2025</div>\n                            </div>\n                            <div>\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">PrevisÃ£o ConclusÃ£o</div>\n                                <div style=\"color: #F8FAFC; font-weight: 600;\">15/12/2025</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Course Modules -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; margin-bottom: 2rem;\">\n                    <h4 style=\"color: #3B82F6; margin: 0 0 1rem 0;\">ðŸ“– MÃ³dulos do Curso</h4>\n                    <div style=\"display: grid; gap: 1rem;\">\n                        <div style=\"background: rgba(16, 185, 129, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(16, 185, 129, 0.2);\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                <div style=\"color: #6EE7B7; font-weight: 600;\">âœ… MÃ³dulo 1: Fundamentos</div>\n                                <div style=\"background: rgba(16, 185, 129, 0.2); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem;\">\n                                    COMPLETO\n                                </div>\n                            </div>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">Postura, distÃ¢ncia, movimentaÃ§Ã£o bÃ¡sica â€¢ 8 aulas</div>\n                        </div>\n                        <div style=\"background: rgba(59, 130, 246, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(59, 130, 246, 0.2);\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                <div style=\"color: #60A5FA; font-weight: 600;\">ðŸ”„ MÃ³dulo 2: Golpes BÃ¡sicos</div>\n                                <div style=\"background: rgba(59, 130, 246, 0.2); color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem;\">\n                                    EM PROGRESSO\n                                </div>\n                            </div>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem;\">Socos, chutes, joelhadas e cotoveladas â€¢ 7 de 12 aulas</div>\n                        </div>\n                        <div style=\"background: rgba(71, 85, 105, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(71, 85, 105, 0.2);\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                <div style=\"color: #94A3B8; font-weight: 600;\">â³ MÃ³dulo 3: Defesas BÃ¡sicas</div>\n                                <div style=\"background: rgba(71, 85, 105, 0.2); color: #94A3B8; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem;\">\n                                    PENDENTE\n                                </div>\n                            </div>\n                            <div style=\"color: #64748B; font-size: 0.875rem;\">Defesas contra socos e agarrÃµes â€¢ 12 aulas</div>\n                        </div>\n                        <div style=\"background: rgba(71, 85, 105, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(71, 85, 105, 0.2);\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                <div style=\"color: #94A3B8; font-weight: 600;\">â³ MÃ³dulo 4: TÃ©cnicas AvanÃ§adas</div>\n                                <div style=\"background: rgba(71, 85, 105, 0.2); color: #94A3B8; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem;\">\n                                    PENDENTE\n                                </div>\n                            </div>\n                            <div style=\"color: #64748B; font-size: 0.875rem;\">Defesas no solo e mÃºltiplos atacantes â€¢ 10 aulas</div>\n                        </div>\n                        <div style=\"background: rgba(71, 85, 105, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(71, 85, 105, 0.2);\">\n                            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n                                <div style=\"color: #94A3B8; font-weight: 600;\">â³ MÃ³dulo 5: IntegraÃ§Ã£o e Sparring</div>\n                                <div style=\"background: rgba(71, 85, 105, 0.2); color: #94A3B8; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.75rem;\">\n                                    PENDENTE\n                                </div>\n                            </div>\n                            <div style=\"color: #64748B; font-size: 0.875rem;\">AplicaÃ§Ã£o prÃ¡tica e simulaÃ§Ãµes â€¢ 8 aulas</div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Available Courses -->\n                <div style=\"background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;\">\n                    <h4 style=\"color: #F59E0B; margin: 0 0 1rem 0;\">ðŸŽ¯ PrÃ³ximos Cursos DisponÃ­veis</h4>\n                    <div style=\"display: grid; gap: 1rem;\">\n                        <div style=\"background: rgba(139, 92, 246, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(139, 92, 246, 0.2);\">\n                            <div style=\"color: #C4B5FD; font-weight: 600; margin-bottom: 0.5rem;\">ðŸ¥‹ Krav Maga Faixa Amarela - Defesa Pessoal 2</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem; margin-bottom: 0.5rem;\">\n                                TÃ©cnicas avanÃ§adas, defesa contra armas brancas, mÃºltiplos atacantes\n                            </div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem;\">\n                                Prerequisito: Completar Faixa Branca â€¢ DuraÃ§Ã£o: 6 meses\n                            </div>\n                        </div>\n                        <div style=\"background: rgba(245, 158, 11, 0.1); border-radius: 8px; padding: 1rem; border: 1px solid rgba(245, 158, 11, 0.2);\">\n                            <div style=\"color: #FCD34D; font-weight: 600; margin-bottom: 0.5rem;\">ðŸ† Curso de Instrutor Assistente</div>\n                            <div style=\"color: #CBD5E1; font-size: 0.875rem; margin-bottom: 0.5rem;\">\n                                Metodologia de ensino, gestÃ£o de turma, primeiros socorros\n                            </div>\n                            <div style=\"color: #94A3B8; font-size: 0.75rem;\">\n                                Prerequisito: Faixa Amarela â€¢ DuraÃ§Ã£o: 3 meses\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n        }\n\n        // Financial tab placeholder\n        function loadFinancialTabContent() {\n            const financialTab = document.getElementById('page-tab-financial');\n            financialTab.innerHTML = `\n                <div style=\"text-align: center; padding: 3rem; color: #94A3B8;\">\n                    <div style=\"font-size: 3rem; margin-bottom: 1rem;\">ðŸ’°</div>\n                    <h3 style=\"color: #F8FAFC; margin-bottom: 0.5rem;\">Financeiro em Desenvolvimento</h3>\n                    <p>Esta funcionalidade serÃ¡ implementada em breve.</p>\n                </div>\n            `;\n        }\n\n        // Activity tab placeholder\n        function loadActivityTabContent() {\n            const activityTab = document.getElementById('page-tab-activity');\n            activityTab.innerHTML = `\n                <div style=\"text-align: center; padding: 3rem; color: #94A3B8;\">\n                    <div style=\"font-size: 3rem; margin-bottom: 1rem;\">ðŸ“ˆ</div>\n                    <h3 style=\"color: #F8FAFC; margin-bottom: 0.5rem;\">Atividades em Desenvolvimento</h3>\n                    <p>Esta funcionalidade serÃ¡ implementada em breve.</p>\n                </div>\n            `;\n        }\n\n\n        // Back to students list\n        function backToStudentsList() {\n            document.getElementById('student-edit-page').style.display = 'none';\n            document.getElementById('students').style.display = 'block';\n            \n            currentEditingStudentId = null;\n            currentEditingStudent = null;\n        }\n\n        // Cancel student edit\n        function cancelStudentEdit() {\n            if (confirm('Tem certeza que deseja cancelar? Todas as alteraÃ§Ãµes nÃ£o salvas serÃ£o perdidas.')) {\n                backToStudentsList();\n            }\n        }\n\n        // Save student from page\n        async function saveStudentPage() {\n            if (!currentEditingStudentId) {\n                showNotification('Erro: ID do aluno nÃ£o encontrado', 'error');\n                return;\n            }\n\n            const saveBtn = document.querySelector('button[onclick=\"saveStudentPage()\"]');\n            const originalText = saveBtn.innerHTML;\n            \n            try {\n                // Show loading state\n                saveBtn.innerHTML = 'â³ Salvando...';\n                saveBtn.disabled = true;\n                \n                // Collect form data\n                const formData = {\n                    firstName: document.getElementById('pageFirstName').value.trim(),\n                    lastName: document.getElementById('pageLastName').value.trim(),\n                    email: document.getElementById('pageEmail').value.trim(),\n                    phone: document.getElementById('pagePhone').value.trim(),\n                    category: document.getElementById('pageCategory').value,\n                    gender: document.getElementById('pageGender').value,\n                    physicalCondition: document.getElementById('pagePhysicalCondition').value,\n                    emergencyContact: document.getElementById('pageEmergencyContact').value.trim(),\n                    medicalConditions: document.getElementById('pageMedicalConditions').value.trim(),\n                    isActive: true\n                };\n                \n                // Enhanced validation\n                if (!formData.firstName || !formData.lastName || !formData.email) {\n                    throw new Error('Nome, sobrenome e email sÃ£o obrigatÃ³rios');\n                }\n                \n                if (formData.email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n                    throw new Error('Email deve ter um formato vÃ¡lido');\n                }\n                \n                console.log('ðŸ“¤ Enviando dados do estudante:', formData);\n                \n                // Update student via API\n                const response = await fetch(`/api/students/${currentEditingStudentId}`, {\n                    method: 'PUT',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(formData)\n                });\n                \n                const result = await response.json();\n                \n                if (!response.ok) {\n                    throw new Error(result.message || `Erro ${response.status}: ${response.statusText}`);\n                }\n                \n                if (!result.success) {\n                    throw new Error(result.message || 'Erro ao atualizar dados');\n                }\n                \n                console.log('âœ… Estudante atualizado com sucesso:', result);\n                \n                // Show success feedback\n                saveBtn.innerHTML = 'âœ… Salvo!';\n                saveBtn.style.background = '#10B981';\n                \n                // Update header with new data\n                updateEditPageHeader({\n                    id: currentEditingStudentId,\n                    category: formData.category,\n                    user: {\n                        firstName: formData.firstName,\n                        lastName: formData.lastName\n                    }\n                });\n                \n                // Go back to students list after success\n                setTimeout(() => {\n                    backToStudentsList();\n                    loadStudents(); // Reload students to show updated data\n                    showNotification('Dados do aluno atualizados com sucesso! ðŸŽ‰', 'success');\n                }, 1000);\n                \n            } catch (error) {\n                console.error('âŒ Erro ao salvar estudante:', error);\n                \n                // Show error feedback\n                saveBtn.innerHTML = 'âŒ Erro';\n                saveBtn.style.background = '#EF4444';\n                \n                showNotification(`Erro ao salvar: ${error.message}`, 'error');\n                \n                // Restore button after error\n                setTimeout(() => {\n                    saveBtn.innerHTML = originalText;\n                    saveBtn.style.background = '';\n                    saveBtn.disabled = false;\n                }, 2000);\n            }\n        }\n\n        // Quick actions from edit page\n        function quickCheckinFromEdit() {\n            showNotification('Check-in rÃ¡pido em desenvolvimento', 'info');\n        }\n\n        function viewStudentProgress() {\n            switchPageTab('progress');\n        }\n\n        function managePayments() {\n            switchPageTab('financial');\n        }\n\n        // Update the existing openStudentEdit function to use the dedicated page\n        async function openStudentEdit(studentId) {\n            console.log('âœï¸ Redirecionando para pÃ¡gina de ediÃ§Ã£o:', studentId);\n            await openStudentEditPage(studentId);\n        }\n\n        // ==========================================\n        // UNIFIED STUDENT INTERACTION SYSTEM\n        // ==========================================\n\n        // Central function for all student interactions\n        function handleStudentInteraction(studentId, action, event = null) {\n            switch (action) {\n                case 'view':\n                    openStudentDetails(studentId);\n                    break;\n                case 'edit':\n                    openStudentEditPage(studentId);\n                    break;\n                case 'doubleclick':\n                    if (event) {\n                        handleStudentDoubleClick(event, studentId);\n                    } else {\n                        openStudentEditPage(studentId);\n                    }\n                    break;\n                case 'checkin':\n                    quickCheckin(studentId);\n                    break;\n                default:\n                    console.warn('AÃ§Ã£o nÃ£o reconhecida:', action);\n                    openStudentDetails(studentId);\n            }\n        }\n\n        // Enhanced function to handle all edit actions consistently\n        function openStudentEditAction(studentId) {\n            console.log('ðŸŽ¯ AÃ§Ã£o unificada de ediÃ§Ã£o para aluno:', studentId);\n            openStudentEditPage(studentId);\n        }\n\n        // ==========================================\n        // CLEAN UX - SIMPLIFIED STUDENT INTERACTION\n        // ==========================================\n\n        // Unified clean function - ONE action for everything\n        function openStudentEditor(studentId) {\n            console.log('ðŸš€ UX Limpa: Abrindo editor de aluno:', studentId);\n            showNotification('ðŸ“ Carregando editor...', 'info');\n            openStudentEditPage(studentId);\n        }\n\n        // Redirect old functions to new clean UX\n        function openStudentDetails(studentId) {\n            console.log('ðŸ”„ Redirecionando visualizaÃ§Ã£o para ediÃ§Ã£o direta:', studentId);\n            openStudentEditPage(studentId);\n        }\n\n        // Simplified student interaction - No more double click complexity\n        function handleStudentClick(studentId) {\n            console.log('ðŸŽ¯ UX Limpa: Abrindo editor direto para aluno:', studentId);\n            showNotification('ðŸ“ Carregando editor de aluno...', 'info');\n            openStudentEditPage(studentId);\n        }\n\n        // Add visual feedback for double click\n        function addDoubleClickFeedback(event) {\n            const card = event.currentTarget;\n            \n            // Create ripple effect\n            const ripple = document.createElement('div');\n            ripple.style.cssText = `\n                position: absolute;\n                width: 100px;\n                height: 100px;\n                background: radial-gradient(circle, rgba(59, 130, 246, 0.6) 0%, transparent 70%);\n                border-radius: 50%;\n                transform: translate(-50%, -50%) scale(0);\n                pointer-events: none;\n                animation: ripple 0.6s ease-out;\n                left: ${event.offsetX}px;\n                top: ${event.offsetY}px;\n                z-index: 10;\n            `;\n            \n            card.style.position = 'relative';\n            card.appendChild(ripple);\n            \n            // Remove ripple after animation\n            setTimeout(() => {\n                if (card.contains(ripple)) {\n                    card.removeChild(ripple);\n                }\n            }, 600);\n        }\n\n        // Add ripple animation CSS\n        const style = document.createElement('style');\n        style.textContent = `\n            @keyframes ripple {\n                0% {\n                    transform: translate(-50%, -50%) scale(0);\n                    opacity: 1;\n                }\n                100% {\n                    transform: translate(-50%, -50%) scale(4);\n                    opacity: 0;\n                }\n            }\n        `;\n        document.head.appendChild(style);\n\n        // ==========================================\n        // INFRASTRUCTURE MANAGEMENT FUNCTIONS\n        // ==========================================\n\n        // Global variables for infrastructure data\n        let allUnits = [];\n        let allMats = [];\n        let allInstructors = [];\n\n        // ==========================================\n        // UNITS MANAGEMENT\n        // ==========================================\n\n        // Load units data\n        async function loadUnits() {\n            try {\n                document.getElementById('unitsLoadingState').style.display = 'block';\n                document.getElementById('unitsEmptyState').style.display = 'none';\n                \n                const response = await fetch('/api/units');\n                const data = await response.json();\n                \n                if (data.success) {\n                    allUnits = data.data;\n                    displayUnits(allUnits);\n                    updateUnitsStats();\n                } else {\n                    throw new Error(data.message || 'Erro ao carregar unidades');\n                }\n            } catch (error) {\n                console.error('Erro ao carregar unidades:', error);\n                showToast('Erro ao carregar unidades: ' + error.message, 'error');\n                document.getElementById('unitsEmptyState').style.display = 'block';\n            } finally {\n                document.getElementById('unitsLoadingState').style.display = 'none';\n            }\n        }\n\n        // Display units in table\n        function displayUnits(units) {\n            const tbody = document.getElementById('unitsTableBody');\n            \n            if (!units || units.length === 0) {\n                document.getElementById('unitsEmptyState').style.display = 'block';\n                tbody.innerHTML = '';\n                return;\n            }\n            \n            document.getElementById('unitsEmptyState').style.display = 'none';\n            \n            tbody.innerHTML = units.map(unit => `\n                <tr style=\"border-bottom: 1px solid #334155;\">\n                    <td style=\"padding: 1rem; color: #F8FAFC;\">\n                        <div style=\"font-weight: 600;\">${unit.name}</div>\n                        <div style=\"font-size: 0.875rem; color: #94A3B8;\">${unit.description || 'Sem descriÃ§Ã£o'}</div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1;\">\n                        <div style=\"font-size: 0.875rem;\">${unit.address}</div>\n                        <div style=\"font-size: 0.75rem; color: #94A3B8;\">${unit.city}, ${unit.state}</div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1; text-align: center;\">\n                        <div style=\"background: rgba(139, 92, 246, 0.1); color: #8B5CF6; padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: 600; display: inline-block;\">\n                            ${unit._count?.mats || 0}\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1; text-align: center;\">\n                        <div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: 600; display: inline-block;\">\n                            ${unit.capacity}\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1; text-align: center;\">\n                        <div style=\"background: rgba(59, 130, 246, 0.1); color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: 600; display: inline-block;\">\n                            ${unit._count?.classes || 0}\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1;\">\n                        ${unit.responsibleName || 'NÃ£o informado'}\n                    </td>\n                    <td style=\"padding: 1rem; text-align: center;\">\n                        <span style=\"background: ${unit.isActive ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; color: ${unit.isActive ? '#10B981' : '#EF4444'}; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: bold;\">\n                            ${unit.isActive ? 'ATIVO' : 'INATIVO'}\n                        </span>\n                    </td>\n                    <td style=\"padding: 1rem;\">\n                        <div style=\"display: flex; gap: 0.5rem;\">\n                            <button onclick=\"editUnit('${unit.id}')\" style=\"background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;\">\n                                âœï¸ Editar\n                            </button>\n                            <button onclick=\"viewUnitDetails('${unit.id}')\" style=\"background: rgba(139, 92, 246, 0.1); border: 1px solid #8B5CF6; color: #8B5CF6; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;\">\n                                ðŸ‘ï¸ Ver\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `).join('');\n        }\n\n        // Update units statistics\n        function updateUnitsStats() {\n            const totalUnits = allUnits.length;\n            const totalMats = allUnits.reduce((sum, unit) => sum + (unit._count?.mats || 0), 0);\n            const totalCapacity = allUnits.reduce((sum, unit) => sum + unit.capacity, 0);\n            const totalClasses = allUnits.reduce((sum, unit) => sum + (unit._count?.classes || 0), 0);\n            \n            document.getElementById('totalUnitsCount').textContent = totalUnits;\n            document.getElementById('totalMatsCount').textContent = totalMats;\n            document.getElementById('totalCapacityCount').textContent = totalCapacity;\n            document.getElementById('activeClassesCount').textContent = totalClasses;\n        }\n\n        // Search units\n        function searchUnits() {\n            const searchTerm = document.getElementById('unitsSearchInput').value.toLowerCase();\n            const filteredUnits = allUnits.filter(unit => \n                unit.name.toLowerCase().includes(searchTerm) ||\n                unit.description?.toLowerCase().includes(searchTerm) ||\n                unit.address.toLowerCase().includes(searchTerm) ||\n                unit.city.toLowerCase().includes(searchTerm)\n            );\n            displayUnits(filteredUnits);\n        }\n\n        // Modal functions for units\n        function openAddUnitModal() {\n            showToast('Modal de adicionar unidade em desenvolvimento', 'info');\n        }\n\n        function editUnit(unitId) {\n            showToast(`Editando unidade ${unitId}`, 'info');\n        }\n\n        function viewUnitDetails(unitId) {\n            showToast(`Visualizando detalhes da unidade ${unitId}`, 'info');\n        }\n\n        function exportUnitsReport() {\n            showToast('RelatÃ³rio de unidades em desenvolvimento', 'info');\n        }\n\n        // ==========================================\n        // MATS MANAGEMENT\n        // ==========================================\n\n        // Load mats data\n        async function loadMats() {\n            try {\n                document.getElementById('matsLoadingState').style.display = 'block';\n                document.getElementById('matsEmptyState').style.display = 'none';\n                \n                const response = await fetch('/api/mats');\n                const data = await response.json();\n                \n                if (data.success) {\n                    allMats = data.data;\n                    displayMats(allMats);\n                    updateMatsStats();\n                    loadUnitFilterOptions();\n                } else {\n                    throw new Error(data.message || 'Erro ao carregar tatames');\n                }\n            } catch (error) {\n                console.error('Erro ao carregar tatames:', error);\n                showToast('Erro ao carregar tatames: ' + error.message, 'error');\n                document.getElementById('matsEmptyState').style.display = 'block';\n            } finally {\n                document.getElementById('matsLoadingState').style.display = 'none';\n            }\n        }\n\n        // Display mats in table\n        function displayMats(mats) {\n            const tbody = document.getElementById('matsTableBody');\n            \n            if (!mats || mats.length === 0) {\n                document.getElementById('matsEmptyState').style.display = 'block';\n                tbody.innerHTML = '';\n                return;\n            }\n            \n            document.getElementById('matsEmptyState').style.display = 'none';\n            \n            tbody.innerHTML = mats.map(mat => `\n                <tr style=\"border-bottom: 1px solid #334155;\">\n                    <td style=\"padding: 1rem; color: #F8FAFC;\">\n                        <div style=\"font-weight: 600;\">${mat.name}</div>\n                        <div style=\"font-size: 0.875rem; color: #94A3B8;\">${mat.description || 'Sem descriÃ§Ã£o'}</div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1;\">\n                        ${mat.unit?.name || 'Sem unidade'}\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1; text-align: center;\">\n                        <div style=\"background: rgba(16, 185, 129, 0.1); color: #10B981; padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: 600; display: inline-block;\">\n                            ${mat.capacity}\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1;\">\n                        ${mat.dimensions || 'NÃ£o informado'}\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1;\">\n                        <div style=\"font-size: 0.875rem;\">${mat.equipment?.join(', ') || 'Nenhum'}</div>\n                    </td>\n                    <td style=\"padding: 1rem; color: #CBD5E1; text-align: center;\">\n                        <div style=\"background: rgba(59, 130, 246, 0.1); color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: 600; display: inline-block;\">\n                            ${mat._count?.classes || 0}\n                        </div>\n                    </td>\n                    <td style=\"padding: 1rem; text-align: center;\">\n                        <span style=\"background: ${mat.isActive ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; color: ${mat.isActive ? '#10B981' : '#EF4444'}; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: bold;\">\n                            ${mat.isActive ? 'ATIVO' : 'INATIVO'}\n                        </span>\n                    </td>\n                    <td style=\"padding: 1rem;\">\n                        <div style=\"display: flex; gap: 0.5rem;\">\n                            <button onclick=\"editMat('${mat.id}')\" style=\"background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;\">\n                                âœï¸ Editar\n                            </button>\n                            <button onclick=\"viewMatDetails('${mat.id}')\" style=\"background: rgba(139, 92, 246, 0.1); border: 1px solid #8B5CF6; color: #8B5CF6; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;\">\n                                ðŸ‘ï¸ Ver\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `).join('');\n        }\n\n        // Update mats statistics\n        function updateMatsStats() {\n            const totalMats = allMats.length;\n            const totalCapacity = allMats.reduce((sum, mat) => sum + mat.capacity, 0);\n            const matsInUse = allMats.filter(mat => mat._count?.classes > 0).length;\n            const matsAvailable = allMats.filter(mat => mat.isActive && !mat._count?.classes).length;\n            \n            document.getElementById('matsCount').textContent = totalMats;\n            document.getElementById('matsCapacity').textContent = totalCapacity;\n            document.getElementById('matsInUse').textContent = matsInUse;\n            document.getElementById('matsAvailable').textContent = matsAvailable;\n        }\n\n        // Load unit filter options\n        function loadUnitFilterOptions() {\n            const select = document.getElementById('unitFilter');\n            if (!select) return;\n            \n            const units = [...new Set(allMats.map(mat => mat.unit?.name).filter(Boolean))];\n            const optionsHTML = '<option value=\"\">Todas as Unidades</option>' +\n                units.map(unitName => `<option value=\"${unitName}\">${unitName}</option>`).join('');\n            \n            select.innerHTML = optionsHTML;\n        }\n\n        // Filter mats by unit\n        function filterMatsByUnit() {\n            const selectedUnit = document.getElementById('unitFilter').value;\n            const filteredMats = selectedUnit \n                ? allMats.filter(mat => mat.unit?.name === selectedUnit)\n                : allMats;\n            displayMats(filteredMats);\n        }\n\n        // Clear mat filters\n        function clearMatFilters() {\n            document.getElementById('unitFilter').value = '';\n            document.getElementById('matsSearchInput').value = '';\n            displayMats(allMats);\n        }\n\n        // Search mats\n        function searchMats() {\n            const searchTerm = document.getElementById('matsSearchInput').value.toLowerCase();\n            const filteredMats = allMats.filter(mat => \n                mat.name.toLowerCase().includes(searchTerm) ||\n                mat.description?.toLowerCase().includes(searchTerm) ||\n                mat.unit?.name.toLowerCase().includes(searchTerm)\n            );\n            displayMats(filteredMats);\n        }\n\n        // Modal functions for mats\n        function openAddMatModal() {\n            showToast('Modal de adicionar tatame em desenvolvimento', 'info');\n        }\n\n        function editMat(matId) {\n            showToast(`Editando tatame ${matId}`, 'info');\n        }\n\n        function viewMatDetails(matId) {\n            showToast(`Visualizando detalhes do tatame ${matId}`, 'info');\n        }\n\n        function exportMatsReport() {\n            showToast('RelatÃ³rio de tatames em desenvolvimento', 'info');\n        }\n\n        // ==========================================\n        // INSTRUCTORS MANAGEMENT\n        // ==========================================\n\n        // Load instructors data\n        async function loadInstructors() {\n            try {\n                document.getElementById('instructorsLoadingState').style.display = 'block';\n                document.getElementById('instructorsEmptyState').style.display = 'none';\n                \n                const response = await fetch('/api/instructors');\n                const data = await response.json();\n                \n                if (data.success) {\n                    allInstructors = data.data;\n                    displayInstructors(allInstructors);\n                    updateInstructorsStats();\n                } else {\n                    throw new Error(data.message || 'Erro ao carregar professores');\n                }\n            } catch (error) {\n                console.error('Erro ao carregar professores:', error);\n                showToast('Erro ao carregar professores: ' + error.message, 'error');\n                document.getElementById('instructorsEmptyState').style.display = 'block';\n            } finally {\n                document.getElementById('instructorsLoadingState').style.display = 'none';\n            }\n        }\n\n        // Display instructors in table\n        function displayInstructors(instructors) {\n            const tbody = document.getElementById('instructorsTableBody');\n            \n            if (!instructors || instructors.length === 0) {\n                document.getElementById('instructorsEmptyState').style.display = 'block';\n                tbody.innerHTML = '';\n                return;\n            }\n            \n            document.getElementById('instructorsEmptyState').style.display = 'none';\n            \n            tbody.innerHTML = instructors.map(instructor => {\n                const user = instructor.user || {};\n                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();\n                \n                return `\n                    <tr style=\"border-bottom: 1px solid #334155;\">\n                        <td style=\"padding: 1rem; color: #F8FAFC;\">\n                            <div style=\"font-weight: 600;\">${fullName || 'Nome nÃ£o informado'}</div>\n                            <div style=\"font-size: 0.875rem; color: #94A3B8;\">${instructor.bio ? instructor.bio.substring(0, 50) + '...' : 'Sem biografia'}</div>\n                        </td>\n                        <td style=\"padding: 1rem; color: #CBD5E1;\">\n                            ${user.email || 'Email nÃ£o informado'}\n                        </td>\n                        <td style=\"padding: 1rem; color: #CBD5E1;\">\n                            <div style=\"font-size: 0.875rem;\">${instructor.specializations?.join(', ') || 'Nenhuma'}</div>\n                        </td>\n                        <td style=\"padding: 1rem; color: #CBD5E1;\">\n                            <div style=\"font-size: 0.875rem;\">${instructor.martialArts?.join(', ') || 'Nenhuma'}</div>\n                        </td>\n                        <td style=\"padding: 1rem; color: #CBD5E1; text-align: center;\">\n                            <div style=\"background: rgba(245, 158, 11, 0.1); color: #F59E0B; padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: 600; display: inline-block;\">\n                                ${instructor.experience || 0} anos\n                            </div>\n                        </td>\n                        <td style=\"padding: 1rem; color: #CBD5E1; text-align: center;\">\n                            <div style=\"background: rgba(59, 130, 246, 0.1); color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: 600; display: inline-block;\">\n                                ${instructor._count?.classes || 0}\n                            </div>\n                        </td>\n                        <td style=\"padding: 1rem; color: #CBD5E1; text-align: center;\">\n                            ${instructor.hourlyRate ? `R$ ${instructor.hourlyRate.toFixed(2)}` : 'NÃ£o informado'}\n                        </td>\n                        <td style=\"padding: 1rem; text-align: center;\">\n                            <span style=\"background: ${instructor.isActive ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; color: ${instructor.isActive ? '#10B981' : '#EF4444'}; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: bold;\">\n                                ${instructor.isActive ? 'ATIVO' : 'INATIVO'}\n                            </span>\n                        </td>\n                        <td style=\"padding: 1rem;\">\n                            <div style=\"display: flex; gap: 0.5rem;\">\n                                <button onclick=\"editInstructor('${instructor.id}')\" style=\"background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; color: #3B82F6; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;\">\n                                    âœï¸ Editar\n                                </button>\n                                <button onclick=\"viewInstructorDetails('${instructor.id}')\" style=\"background: rgba(139, 92, 246, 0.1); border: 1px solid #8B5CF6; color: #8B5CF6; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;\">\n                                    ðŸ‘ï¸ Ver\n                                </button>\n                            </div>\n                        </td>\n                    </tr>\n                `;\n            }).join('');\n        }\n\n        // Update instructors statistics\n        function updateInstructorsStats() {\n            const totalInstructors = allInstructors.length;\n            const activeInstructors = allInstructors.filter(inst => inst.isActive).length;\n            const instructorsWithClasses = allInstructors.filter(inst => inst._count?.classes > 0).length;\n            const avgExperience = allInstructors.length > 0 \n                ? Math.round(allInstructors.reduce((sum, inst) => sum + (inst.experience || 0), 0) / allInstructors.length)\n                : 0;\n            \n            document.getElementById('instructorsCount').textContent = totalInstructors;\n            document.getElementById('instructorsActive').textContent = activeInstructors;\n            document.getElementById('instructorsWithClasses').textContent = instructorsWithClasses;\n            document.getElementById('avgExperience').textContent = avgExperience;\n        }\n\n        // Search instructors\n        function searchInstructors() {\n            const searchTerm = document.getElementById('instructorsSearchInput').value.toLowerCase();\n            const filteredInstructors = allInstructors.filter(instructor => {\n                const user = instructor.user || {};\n                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase();\n                return fullName.includes(searchTerm) ||\n                       user.email?.toLowerCase().includes(searchTerm) ||\n                       instructor.specializations?.some(spec => spec.toLowerCase().includes(searchTerm)) ||\n                       instructor.martialArts?.some(art => art.toLowerCase().includes(searchTerm));\n            });\n            displayInstructors(filteredInstructors);\n        }\n\n        // Modal functions for instructors\n        function openAddInstructorModal() {\n            showToast('Modal de adicionar professor em desenvolvimento', 'info');\n        }\n\n        function editInstructor(instructorId) {\n            showToast(`Editando professor ${instructorId}`, 'info');\n        }\n\n        function viewInstructorDetails(instructorId) {\n            showToast(`Visualizando detalhes do professor ${instructorId}`, 'info');\n        }\n\n        function exportInstructorsReport() {\n            showToast('RelatÃ³rio de professores em desenvolvimento', 'info');\n        }\n\n        // ==========================================\n        // PAYMENT PLANS MISSING FUNCTIONS\n        // ==========================================\n\n        // Open Add Plan Page (full screen instead of modal)\n        function openAddPlanPage() {\n            console.log('ðŸ†• Opening Add Plan Page...');\n            \n            // Navigate to full-screen plan edit page in creation mode\n            clearPlanEditForm();\n            updatePlanEditPageTitle('Criar Novo Plano', 'Preencha as informaÃ§Ãµes para criar um novo plano');\n            showSection('plan-edit');\n            \n            // Set form to creation mode\n            document.getElementById('planEditForm').dataset.mode = 'create';\n            delete document.getElementById('planEditForm').dataset.editingPlanId;\n            \n            // Reset to first tab and load courses\n            switchPlanEditTab('basic');\n            loadCoursesForPlanEdit();\n            \n            showToast('Abrindo formulÃ¡rio de novo plano', 'info');\n        }\n\n        // Switch between plan edit tabs (for full-screen page)\n        function switchPlanEditTab(tabName) {\n            // Remove active class from all tabs and content\n            document.querySelectorAll('.plan-tab').forEach(tab => tab.classList.remove('active'));\n            document.querySelectorAll('.plan-tab-content').forEach(content => content.classList.remove('active'));\n            \n            // Add active class to selected tab and content\n            const selectedTab = document.querySelector(`.plan-tab[data-tab=\"${tabName}\"]`);\n            const selectedContent = document.getElementById(`planEditTab-${tabName}`);\n            \n            if (selectedTab && selectedContent) {\n                selectedTab.classList.add('active');\n                selectedContent.classList.add('active');\n            }\n            \n            // Load content for specific tabs\n            if (tabName === 'courses') {\n                loadCoursesForPlanEdit();\n            } else if (tabName === 'preview') {\n                updatePlanEditPreview();\n            }\n        }\n\n        // Load courses for plan edit selection\n        async function loadCoursesForPlanEdit() {\n            const coursesGrid = document.getElementById('editCoursesGrid');\n            \n            try {\n                // Show loading state\n                coursesGrid.innerHTML = `\n                    <div class=\"loading-state\">\n                        <div class=\"spinner\"></div>\n                        <p>Carregando cursos disponÃ­veis...</p>\n                    </div>\n                `;\n                \n                const response = await fetch('/api/courses');\n                const result = await response.json();\n                \n                if (result.success && result.data.length > 0) {\n                    const courses = result.data;\n                    \n                    // Update stats\n                    document.getElementById('editCoursesTotalCount').textContent = `${courses.length} cursos disponÃ­veis`;\n                    updateSelectedEditCoursesCount();\n                    \n                    // Render courses grid\n                    coursesGrid.innerHTML = courses.map(course => `\n                        <div class=\"course-card\" onclick=\"toggleEditCourseSelection('${course.id}', this)\">\n                            <div class=\"course-card-header\">\n                                <div>\n                                    <h4 style=\"color: #E2E8F0; margin: 0 0 0.5rem 0; font-size: 1.1rem;\">${course.name}</h4>\n                                    <p style=\"color: #94A3B8; margin: 0; font-size: 0.875rem;\">${course.description || 'DescriÃ§Ã£o nÃ£o disponÃ­vel'}</p>\n                                </div>\n                                <input type=\"checkbox\" class=\"course-checkbox\" data-course-id=\"${course.id}\">\n                            </div>\n                            <div style=\"margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(148, 163, 184, 0.2);\">\n                                <div style=\"color: #94A3B8; font-size: 0.875rem;\">\n                                    <div>ðŸŽ“ ${course.totalLessons || 48} aulas</div>\n                                    <div>â±ï¸ ${course.duration || '12 meses'}</div>\n                                    <div>ðŸ‘¥ ${course.maxStudents || 20} alunos max</div>\n                                </div>\n                            </div>\n                        </div>\n                    `).join('');\n                } else {\n                    coursesGrid.innerHTML = `\n                        <div style=\"text-align: center; color: #94A3B8; padding: 3rem;\">\n                            <h4>ðŸ“š Nenhum curso disponÃ­vel</h4>\n                            <p>Crie cursos primeiro para associÃ¡-los aos planos.</p>\n                        </div>\n                    `;\n                }\n            } catch (error) {\n                console.error('Erro ao carregar cursos:', error);\n                coursesGrid.innerHTML = `\n                    <div style=\"text-align: center; color: #EF4444; padding: 3rem;\">\n                        <h4>âŒ Erro ao carregar cursos</h4>\n                        <p>Tente novamente ou verifique a conexÃ£o.</p>\n                    </div>\n                `;\n            }\n        }\n\n        // Toggle course selection in edit page\n        function toggleEditCourseSelection(courseId, cardElement) {\n            const checkbox = cardElement.querySelector('.course-checkbox');\n            const isSelected = checkbox.checked;\n            \n            // Toggle selection\n            checkbox.checked = !isSelected;\n            \n            // Update visual state\n            if (!isSelected) {\n                cardElement.classList.add('selected');\n            } else {\n                cardElement.classList.remove('selected');\n            }\n            \n            // Update legacy multi-select field\n            updateLegacyEditPlanCourseField();\n            updateSelectedEditCoursesCount();\n            updatePlanEditPreview();\n        }\n\n        // Select all courses in edit page\n        function selectAllEditCourses() {\n            document.querySelectorAll('#editCoursesGrid .course-card').forEach(card => {\n                const checkbox = card.querySelector('.course-checkbox');\n                checkbox.checked = true;\n                card.classList.add('selected');\n            });\n            updateLegacyEditPlanCourseField();\n            updateSelectedEditCoursesCount();\n            updatePlanEditPreview();\n        }\n\n        // Clear all course selections in edit page\n        function clearAllEditCourses() {\n            document.querySelectorAll('#editCoursesGrid .course-card').forEach(card => {\n                const checkbox = card.querySelector('.course-checkbox');\n                checkbox.checked = false;\n                card.classList.remove('selected');\n            });\n            updateLegacyEditPlanCourseField();\n            updateSelectedEditCoursesCount();\n            updatePlanEditPreview();\n        }\n\n        // Update selected courses count in edit page\n        function updateSelectedEditCoursesCount() {\n            const selectedCount = document.querySelectorAll('#editCoursesGrid .course-checkbox:checked').length;\n            document.getElementById('editCoursesSelectedCount').textContent = `${selectedCount} cursos selecionados`;\n        }\n\n        // Update legacy plan course field for compatibility in edit page\n        function updateLegacyEditPlanCourseField() {\n            const legacySelect = document.getElementById('editPlanCourse');\n            const selectedCourses = document.querySelectorAll('#editCoursesGrid .course-checkbox:checked');\n            \n            // Clear existing options\n            legacySelect.innerHTML = '';\n            \n            // Add selected courses as options\n            selectedCourses.forEach(checkbox => {\n                const courseId = checkbox.dataset.courseId;\n                const card = checkbox.closest('.course-card');\n                const courseName = card.querySelector('h4').textContent;\n                \n                const option = document.createElement('option');\n                option.value = courseId;\n                option.textContent = courseName;\n                option.selected = true;\n                legacySelect.appendChild(option);\n            });\n        }\n\n        // Update plan preview in edit page (Enhanced for new tab system)\n        function updatePlanEditPreview() {\n            const courseSelect = document.getElementById('editPlanCourse');\n            const categorySelect = document.getElementById('editPlanCategory');\n            const billingTypeSelect = document.getElementById('editPlanBillingType');\n            const classesPerWeekSelect = document.getElementById('editPlanClassesPerWeek');\n            \n            const selectedCourses = Array.from(courseSelect.selectedOptions).map(option => option.text);\n            const courseName = selectedCourses.length > 0 ? selectedCourses.join(', ') : 'Nenhum curso selecionado';\n            const category = categorySelect.value;\n            const billingType = billingTypeSelect?.value || 'MONTHLY';\n            const classesPerWeek = classesPerWeekSelect?.value || '2';\n            \n            // Suggested category prices mapping (not enforced)\n            const suggestedCategoryPrices = {\n                'ADULT': '180.00',\n                'FEMALE': '170.00',\n                'SENIOR': '130.00',\n                'CHILD': '120.00',\n                'INICIANTE1': '120.00',\n                'INICIANTE2': '130.00',\n                'INICIANTE3': '140.00',\n                'HEROI1': '160.00',\n                'HEROI2': '170.00',\n                'HEROI3': '180.00',\n                'MASTER_1': '200.00',\n                'MASTER_2': '220.00',\n                'MASTER_3': '250.00'\n            };\n            \n            const selectedCount = courseSelect.selectedOptions.length;\n            const planName = selectedCount === 0 ? 'Novo Plano' :\n                selectedCount === 1 ? `${courseName} - ${category}` : \n                `Multi-Curso (${selectedCount} cursos) - ${category}`;\n            \n            const customPrice = document.getElementById('editPlanPrice').value;\n            \n            // Only suggest price if field is completely empty, don't enforce it\n            if (!customPrice && category) {\n                const suggestedPrice = suggestedCategoryPrices[category] || '150.00';\n                const adjustedPrice = selectedCount > 1 ? \n                    (parseFloat(suggestedPrice) * 1.5).toFixed(2) : suggestedPrice;\n                \n                // Set placeholder instead of value, so user can choose\n                document.getElementById('editPlanPrice').placeholder = `SugestÃ£o: R$ ${adjustedPrice}`;\n            }\n            \n            const price = customPrice || '0.00';\n            \n            // Update preview elements\n            document.getElementById('editPreviewPlanName').textContent = planName;\n            document.getElementById('editPreviewPlanPrice').textContent = `R$ ${parseFloat(price || 0).toFixed(2)}`;\n            \n            const description = selectedCount === 0 ? 'Selecione pelo menos um curso para continuar' :\n                selectedCount === 1 ? `Plano ${category.toLowerCase()} para ${courseName}` :\n                `Plano ${category.toLowerCase()} com acesso a ${selectedCount} cursos: ${courseName}`;\n            document.getElementById('editPreviewPlanDescription').textContent = description;\n            \n            // Update detailed preview information\n            const categoryNames = {\n                'ADULT': 'Adulto',\n                'FEMALE': 'Feminino',\n                'SENIOR': 'Senior/Idoso',\n                'CHILD': 'Infantil/CrianÃ§a',\n                'INICIANTE1': 'Iniciante 1',\n                'INICIANTE2': 'Iniciante 2',\n                'INICIANTE3': 'Iniciante 3',\n                'HEROI1': 'HerÃ³i 1',\n                'HEROI2': 'HerÃ³i 2',\n                'HEROI3': 'HerÃ³i 3',\n                'MASTER_1': 'Master 1',\n                'MASTER_2': 'Master 2',\n                'MASTER_3': 'Master 3'\n            };\n            \n            const billingTypeNames = {\n                'MONTHLY': 'Mensal',\n                'WEEKLY': 'Semanal',\n                'QUARTERLY': 'Trimestral',\n                'YEARLY': 'Anual'\n            };\n            \n            document.getElementById('editPreviewCategory').textContent = categoryNames[category] || category || 'NÃ£o definida';\n            document.getElementById('editPreviewBillingType').textContent = billingTypeNames[billingType] || billingType;\n            document.getElementById('editPreviewCourses').textContent = selectedCount > 0 ? courseName : 'Nenhum curso selecionado';\n            document.getElementById('editPreviewClassesPerWeek').textContent = classesPerWeek === 'unlimited' ? 'Ilimitado' : `${classesPerWeek} aulas`;\n            \n            // Auto-fill form fields\n            if (!document.getElementById('editPlanName').value) {\n                document.getElementById('editPlanName').value = planName;\n            }\n            if (!document.getElementById('editPlanDescription').value && selectedCount > 0) {\n                document.getElementById('editPlanDescription').value = description;\n            }\n        }\n\n        // Edit Plan function - open plan edit page in edit mode\n        function editPlan(planId) {\n            console.log('âœï¸ Opening edit plan page for:', planId);\n            \n            // Find the plan to edit\n            const plan = allPlans.find(p => p.id === planId);\n            if (!plan) {\n                showToast('Plano nÃ£o encontrado', 'error');\n                return;\n            }\n            \n            // Clear form and populate with existing data\n            clearPlanEditForm();\n            populatePlanEditForm(plan);\n            \n            // Update page title\n            updatePlanEditPageTitle('Editar Plano', `Editando: ${plan.name}`);\n            \n            // Navigate to plan edit page\n            showSection('plan-edit');\n            \n            // Set form to edit mode\n            const form = document.getElementById('planEditForm');\n            form.dataset.mode = 'edit';\n            form.dataset.editingPlanId = planId;\n            \n            // Store current plan ID globally\n            currentPlanId = planId;\n            \n            showToast('Carregando dados do plano...', 'info');\n        }\n\n        // Populate plan edit form with existing data\n        function populatePlanEditForm(plan) {\n            console.log('ðŸ“ Populating form with plan data:', plan);\n            \n            document.getElementById('editPlanName').value = plan.name || '';\n            document.getElementById('editPlanDescription').value = plan.description || '';\n            document.getElementById('editPlanCourse').value = plan.courseId || '';\n            document.getElementById('editPlanCategory').value = plan.category || '';\n            document.getElementById('editPlanPrice').value = plan.price || '';\n            document.getElementById('editPlanBillingType').value = plan.billingType || 'MONTHLY';\n            document.getElementById('editPlanWeeklyClasses').value = plan.classesPerWeek || 2;\n            \n            // Set checkbox features\n            if (plan.hasPersonalTraining) {\n                const personalCheckbox = document.getElementById('editPlanFeaturePersonal');\n                if (personalCheckbox) personalCheckbox.checked = true;\n            }\n            \n            if (plan.hasNutrition) {\n                const nutritionCheckbox = document.getElementById('editPlanFeatureNutrition');\n                if (nutritionCheckbox) nutritionCheckbox.checked = true;\n            }\n        }\n\n        // Filter Plans function\n        function filterPlans() {\n            console.log('ðŸ” Filtering payment plans...');\n            \n            const searchTerm = document.getElementById('planSearchInput')?.value.toLowerCase() || '';\n            const categoryFilter = document.getElementById('categoryFilterSelect')?.value || '';\n            const billingTypeFilter = document.getElementById('billingTypeFilter')?.value || '';\n            \n            // Make sure allPlans is available\n            if (!allPlans || !Array.isArray(allPlans)) {\n                console.log('No plans data available for filtering');\n                return;\n            }\n            \n            // Filter the plans based on criteria\n            const filteredPlans = allPlans.filter(plan => {\n                // Search term filter (check name, description, course name)\n                const matchesSearch = !searchTerm || \n                    plan.name?.toLowerCase().includes(searchTerm) ||\n                    plan.description?.toLowerCase().includes(searchTerm) ||\n                    (plan.course?.name || '').toLowerCase().includes(searchTerm);\n                \n                // Category filter\n                const matchesCategory = !categoryFilter || plan.category === categoryFilter;\n                \n                // Billing type filter\n                const matchesBillingType = !billingTypeFilter || plan.billingType === billingTypeFilter;\n                \n                return matchesSearch && matchesCategory && matchesBillingType;\n            });\n            \n            console.log(`Filtered ${filteredPlans.length} plans from ${allPlans.length} total`);\n            \n            // Update the table with filtered results\n            updatePaymentPlansTable(filteredPlans);\n            \n            // Update the count text\n            document.getElementById('plansCountText').textContent = \n                `${filteredPlans.length} plano(s) encontrado(s) ${filteredPlans.length !== allPlans.length ? `(filtrado de ${allPlans.length})` : ''}`;\n        }\n\n        // Edit Plan function\n        function editPlan(planId) {\n            console.log(`âœï¸ Editing plan ${planId}`);\n            showToast(`EdiÃ§Ã£o do plano ${planId} em desenvolvimento`, 'info');\n            \n            // TODO: Implement plan editing functionality\n            // This would typically:\n            // 1. Fetch plan details from API\n            // 2. Populate form with current values\n            // 3. Switch modal to edit mode\n            // 4. Handle update submission\n        }\n\n        // Delete Plan function for table (REMOVED - using deletePlanFromTable instead)\n\n        // ==========================================\n        // REMOVED DUPLICATE FUNCTION - USING VERSION ABOVE\n        // ==========================================\n\n        // ==========================================\n        // AUTO-LOAD DATA FOR INFRASTRUCTURE SECTIONS (Already handled above)\n        // ==========================================\n\n        // ==========================================\n        // STUDENT TABLE INITIALIZATION (PERMANENT FIX)\n        // ==========================================\n        \n        // Initialize student table event delegation when page loads\n        document.addEventListener('DOMContentLoaded', function() {\n            console.log('ðŸš€ Initializing student table event delegation...');\n            \n            // Setup event delegation after a small delay to ensure DOM is ready\n            setTimeout(() => {\n                setupStudentTableEventDelegation();\n                console.log('âœ… Student table event delegation initialized on page load');\n            }, 500);\n        });\n        \n        // Backup initialization for cases where DOMContentLoaded already fired\n        if (document.readyState === 'loading') {\n            // DOMContentLoaded will handle it\n        } else {\n            // DOM is already ready\n            setTimeout(() => {\n                setupStudentTableEventDelegation();\n                console.log('âœ… Student table event delegation initialized (DOM already ready)');\n            }, 100);\n        }\n\n        // Plan Edit Functions\n        let currentPlanId = null;\n\n        function openPlanEditPage(planId) {\n            currentPlanId = planId;\n            \n            // Find the plan data\n            const plan = allPlans.find(p => p.id == planId || p.id === planId);\n            if (!plan) {\n                console.error('âŒ Plan not found for edit page:', planId);\n                console.error('ðŸ“‹ Available plans:', allPlans.map(p => ({id: p.id, name: p.name})));\n                showNotification('Plano nÃ£o encontrado', 'error');\n                return;\n            }\n            \n            // Hide all sections and show plan edit\n            document.querySelectorAll('.content-section').forEach(section => {\n                section.style.display = 'none';\n            });\n            document.getElementById('plan-edit').style.display = 'block';\n            \n            // Update page subtitle with plan name\n            document.getElementById('planEditSubtitle').textContent = `Editando: ${plan.name}`;\n            \n            // Populate form fields\n            populatePlanEditForm(plan);\n            \n            showNotification(`Editando plano: ${plan.name}`, 'info');\n        }\n\n        function populatePlanEditForm(plan) {\n            // Basic information\n            document.getElementById('editPlanName').value = plan.name || '';\n            document.getElementById('editPlanDescription').value = plan.description || '';\n            document.getElementById('editPlanCourse').value = plan.courseId || '';\n            document.getElementById('editPlanCategory').value = plan.category || '';\n            \n            // Financial settings\n            document.getElementById('editPlanPrice').value = plan.price || '';\n            document.getElementById('editPlanBillingType').value = plan.billingType || 'MONTHLY';\n            document.getElementById('editPlanWeeklyClasses').value = plan.weeklyClasses || 2;\n            document.getElementById('editPlanDuration').value = plan.duration || 12;\n            document.getElementById('editPlanGracePeriod').value = plan.gracePeriod || 0;\n            \n            // Features (default to checked for demonstration)\n            document.getElementById('editPlanFeatureAccess').checked = true;\n            document.getElementById('editPlanFeatureEquipment').checked = plan.category === 'ADULT';\n            document.getElementById('editPlanFeatureNutrition').checked = plan.category === 'ADULT';\n            document.getElementById('editPlanFeaturePersonal').checked = false;\n            document.getElementById('editPlanFeatureEvents').checked = true;\n            document.getElementById('editPlanFeatureMaterial').checked = true;\n            \n            // Status and configurations\n            document.getElementById('editPlanIsActive').checked = plan.isActive !== false;\n            document.getElementById('editPlanAllowUpgrade').checked = true;\n            document.getElementById('editPlanAutoRenewal').checked = true;\n            document.getElementById('editPlanStudentLimit').value = plan.studentLimit || '';\n            document.getElementById('editPlanNotes').value = plan.notes || '';\n        }\n\n        function backToPlans() {\n            // Hide plan edit and show plans section\n            document.getElementById('plan-edit').style.display = 'none';\n            document.getElementById('payment-plans').style.display = 'block';\n            currentPlanId = null;\n            \n            showNotification('Voltou para lista de planos', 'info');\n        }\n\n        // Clear plan edit form for creation mode\n        function clearPlanEditForm() {\n            console.log('ðŸ§¹ Clearing plan edit form...');\n            \n            // Clear all form fields\n            document.getElementById('editPlanName').value = '';\n            document.getElementById('editPlanDescription').value = '';\n            document.getElementById('editPlanCourse').value = '';\n            document.getElementById('editPlanCategory').value = '';\n            document.getElementById('editPlanPrice').value = '';\n            document.getElementById('editPlanBillingType').value = 'MONTHLY';\n            document.getElementById('editPlanWeeklyClasses').value = '2';\n            document.getElementById('editPlanDuration').value = '30';\n            document.getElementById('editPlanGracePeriod').value = '5';\n            document.getElementById('editPlanIsActive').checked = true;\n            document.getElementById('editPlanAllowUpgrade').checked = true;\n            document.getElementById('editPlanAutoRenewal').checked = false;\n            document.getElementById('editPlanStudentLimit').value = '';\n            document.getElementById('editPlanNotes').value = '';\n        }\n\n        // Update plan edit page title and subtitle\n        function updatePlanEditPageTitle(title, subtitle) {\n            console.log('ðŸ“ Updating plan edit page title:', title);\n            \n            const titleElement = document.querySelector('#plan-edit h1');\n            const subtitleElement = document.getElementById('planEditSubtitle');\n            \n            if (titleElement) {\n                titleElement.innerHTML = title.includes('âœï¸') ? title : `âœï¸ ${title}`;\n            }\n            \n            if (subtitleElement) {\n                subtitleElement.textContent = subtitle;\n            }\n        }\n\n        // Back to plans function\n        function backToPlans() {\n            console.log('ðŸ”™ Returning to plans list...');\n            showSection('payment-plans');\n            showToast('Voltou para lista de planos', 'info');\n        }\n\n        async function savePlanChanges() {\n            const form = document.getElementById('planEditForm');\n            const isCreateMode = form.dataset.mode === 'create';\n            \n            // Collect form data with correct field IDs\n            const formData = {\n                name: document.getElementById('editPlanName').value,\n                description: document.getElementById('editPlanDescription').value,\n                courseId: document.getElementById('editPlanCourse').value || 'eceecf0a-d348-4256-9d56-592adeaa01d4', // Default course\n                category: document.getElementById('editPlanCategory').value,\n                price: parseFloat(document.getElementById('editPlanPrice').value),\n                billingType: document.getElementById('editPlanBillingType').value,\n                classesPerWeek: parseInt(document.getElementById('editPlanWeeklyClasses').value) || 2,\n                maxClasses: null, // Unlimited for now\n                isUnlimitedAccess: true,\n                hasPersonalTraining: document.getElementById('editPlanFeaturePersonal')?.checked || false,\n                hasNutrition: document.getElementById('editPlanFeatureNutrition')?.checked || false,\n                allowInstallments: false,\n                maxInstallments: 1,\n                isRecurring: document.getElementById('editPlanBillingType').value === 'MONTHLY',\n                recurringInterval: document.getElementById('editPlanBillingType').value === 'MONTHLY' ? 30 : null,\n                accessAllModalities: true,\n                allowFreeze: true,\n                freezeMaxDays: 30,\n                isActive: true\n            };\n            \n            // Validate required fields\n            if (!formData.name || !formData.category || !formData.price) {\n                showToast('Preencha todos os campos obrigatÃ³rios', 'error');\n                return;\n            }\n            \n            try {\n                if (isCreateMode) {\n                    showToast('Criando novo plano...', 'info');\n                    \n                    // Create new plan via API\n                    const response = await fetch('/api/billing-plans', {\n                        method: 'POST',\n                        headers: {\n                            'Content-Type': 'application/json'\n                        },\n                        body: JSON.stringify(formData)\n                    });\n                    \n                    const result = await response.json();\n                    \n                    if (response.ok && result.success) {\n                        // Add to local array\n                        allPlans.push(result.data);\n                        showToast('Plano criado com sucesso!', 'success');\n                    } else {\n                        throw new Error(result.message || result.error || 'Erro ao criar plano');\n                    }\n                    \n                } else {\n                    showToast('Atualizando plano...', 'info');\n                    \n                    // Update existing plan via API (not implemented yet)\n                    const response = await fetch(`/api/billing-plans/${currentPlanId}`, {\n                        method: 'PUT',\n                        headers: {\n                            'Content-Type': 'application/json'\n                        },\n                        body: JSON.stringify(formData)\n                    });\n                    \n                    if (response.ok) {\n                        const result = await response.json();\n                        if (result.success) {\n                            // Update local data\n                            const planIndex = allPlans.findIndex(p => p.id === currentPlanId);\n                            if (planIndex !== -1) {\n                                allPlans[planIndex] = { ...allPlans[planIndex], ...formData };\n                            }\n                            showToast('Plano atualizado com sucesso!', 'success');\n                        } else {\n                            throw new Error(result.message || 'Erro ao atualizar plano');\n                        }\n                    } else {\n                        throw new Error('Erro na API ao atualizar plano');\n                    }\n                }\n                \n                // Go back to plans list and refresh\n                backToPlans();\n                await loadPaymentPlans(); // Reload from API\n                \n            } catch (error) {\n                console.error('Error saving plan:', error);\n                showToast(`Erro ao salvar plano: ${error.message}`, 'error');\n            }\n        }\n\n        async function deleteCurrentPlan() {\n            if (!currentPlanId) {\n                showNotification('Erro: ID do plano nÃ£o encontrado', 'error');\n                return;\n            }\n            \n            const plan = allPlans.find(p => p.id == currentPlanId || p.id === currentPlanId);\n            if (!plan) {\n                console.error('âŒ Current plan not found in allPlans array');\n                console.error('ðŸ” Searched for ID:', currentPlanId, 'Type:', typeof currentPlanId);\n                console.error('ðŸ“‹ Available IDs:', allPlans.map(p => ({id: p.id, type: typeof p.id})));\n                showNotification('Plano nÃ£o encontrado', 'error');\n                return;\n            }\n            \n            if (!confirm(`Tem certeza que deseja excluir o plano \"${plan.name}\"?`)) {\n                return;\n            }\n            \n            try {\n                showNotification('Excluindo plano...', 'info');\n                \n                // Simulate API call\n                await new Promise(resolve => setTimeout(resolve, 1000));\n                \n                // Remove from local data\n                const planIndex = allPlans.findIndex(p => p.id === currentPlanId);\n                if (planIndex !== -1) {\n                    allPlans.splice(planIndex, 1);\n                }\n                \n                showNotification('Plano excluÃ­do com sucesso!', 'success');\n                \n                // Go back to plans list and refresh\n                backToPlans();\n                updatePaymentPlansTable(allPlans);\n                updatePlansStats(allPlans);\n                \n            } catch (error) {\n                console.error('Error deleting plan:', error);\n                showNotification('Erro ao excluir plano', 'error');\n            }\n        }\n\n    </script>\n</body>\n</html>"
}