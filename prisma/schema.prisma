generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows", "linux-musl"]
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  directUrl         = env("DIRECT_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Organization {
  id                    String                 @id @default(uuid())
  name                  String
  slug                  String                 @unique
  description           String?
  logoUrl               String?
  website               String?
  phone                 String?
  email                 String?
  address               String?
  city                  String?
  state                 String?
  country               String                 @default("Brazil")
  zipCode               String?
  subscriptionPlan      SubscriptionPlan       @default(BASIC)
  maxStudents           Int                    @default(100)
  maxStaff              Int                    @default(10)
  isActive              Boolean                @default(true)
  primaryColor          String                 @default("#1f2937")
  secondaryColor        String                 @default("#3b82f6")
  customDomain          String?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  achievements          Achievement[]
  activities            Activity[]
  asaasCustomers        AsaasCustomer[]
  attendances           Attendance[]
  badges                Badge[]
  billingPlans          BillingPlan[]
  challenges            Challenge[]
  classes               Class[]
  courseTemplates       CourseTemplate[]
  courses               Course[]
  financialResponsibles FinancialResponsible[]
  financialSettings     FinancialSettings?
  instructors           Instructor[]
  martialArts           MartialArt[]
  mats                  Mat[]
  organizationSettings  OrganizationSettings?
  payments              Payment[]
  subscriptions         StudentSubscription[]
  students              Student[]
  techniqueLibraries    TechniqueLibrary[]
  turmas                Turma[]
  units                 Unit[]
  users                 User[]

  @@map("organizations")
}

model OrganizationSettings {
  id                      String       @id @default(uuid())
  organizationId          String       @unique
  enableGamification      Boolean      @default(true)
  enableVideoAnalysis     Boolean      @default(false)
  enableAIRecommendations Boolean      @default(true)
  enableMultipleArts      Boolean      @default(true)
  aiProvider              AIProvider   @default(CLAUDE)
  openaiApiKey            String?
  anthropicApiKey         String?
  geminiApiKey            String?
  openRouterApiKey        String?
  timezone                String       @default("America/Sao_Paulo")
  currency                String       @default("BRL")
  language                String       @default("pt-BR")
  allowQRCheckin          Boolean      @default(true)
  allowManualCheckin      Boolean      @default(true)
  allowFacialCheckin      Boolean      @default(false)
  checkinWindowStart      Int          @default(30)
  checkinWindowEnd        Int          @default(15)
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @default(now())
  organization            Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@map("organization_settings")
}

model MartialArt {
  id             String               @id @default(uuid())
  organizationId String
  name           String
  description    String?
  imageUrl       String?
  hasGrading     Boolean              @default(true)
  gradingSystem  GradingSystem        @default(BELT)
  maxLevel       Int                  @default(10)
  isActive       Boolean              @default(true)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @default(now())
  achievements   Achievement[]
  courses        Course[]
  organization   Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  progressions   StudentProgression[]
  techniques     Technique[]

  @@unique([organizationId, name])
  @@map("martial_arts")
}

model Course {
  id                    String                 @id @default(uuid())
  organizationId        String
  martialArtId          String?
  courseTemplateId      String?
  name                  String
  description           String?
  level                 CourseLevel
  duration              Int
  classesPerWeek        Int                    @default(2)
  totalClasses          Int
  minAge                Int                    @default(16)
  maxAge                Int?
  category              StudentCategory        @default(ADULT)
  orderIndex            Int                    @default(1)
  nextCourseId          String?                @unique
  prerequisites         String[]
  objectives            String[]
  requirements          String[]
  imageUrl              String?
  isActive              Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @default(now())
  assessmentDefinitions AssessmentDefinition[]
  attendanceRecords     AttendanceRecord[]
  primaryBillingPlans   BillingPlan[]          @relation("BillingPlanPrimaryCourse")
  classes               Class[]
  challenges            CourseChallenge[]
  enrollments           CourseEnrollment[]
  techniques            CourseTechnique[]
  template              CourseTemplate?        @relation(fields: [courseTemplateId], references: [id])
  martialArt            MartialArt?            @relation(fields: [martialArtId], references: [id], onDelete: Cascade)
  nextCourse            Course?                @relation("CourseProgression", fields: [nextCourseId], references: [id])
  previousCourse        Course?                @relation("CourseProgression")
  organization          Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  evaluationRecords     EvaluationRecord[]
  lessonPlans           LessonPlan[]
  planCourses           PlanCourse[]
  progressRecords       Progress[]
  studentCourses        StudentCourse[]
  teacherEvaluations    TeacherEvaluation[]
  techniqueDetails      TechniqueDetail[]
  turmasCourses         TurmaCourse[]
  turmas                Turma[]
  weeklyChallenges      WeeklyChallenge[]

  @@unique([organizationId, name])
  @@map("courses")
}

model CourseTemplate {
  id               String         @id @default(uuid())
  organizationId   String
  name             String
  description      String?
  category         CourseCategory
  duration         Int
  classesPerWeek   Int            @default(2)
  totalClasses     Int
  minAge           Int            @default(16)
  maxAge           Int?
  objectives       String[]
  requirements     String[]
  structure        Json
  ragSettings      Json?
  isSystemTemplate Boolean        @default(false)
  isActive         Boolean        @default(true)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @default(now())
  organization     Organization   @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  courses          Course[]

  @@unique([organizationId, name])
  @@map("course_templates")
}

model TechniqueLibrary {
  id                String            @id @default(uuid())
  organizationId    String
  name              String
  description       String?
  category          TechniqueCategory
  content           Json
  ragEmbeddings     Json?
  prerequisites     String[]
  relatedTechniques String[]
  difficulty        Int               @default(1)
  isActive          Boolean           @default(true)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @default(now())
  organization      Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, name])
  @@map("technique_libraries")
}

model LessonPlan {
  id               String                 @id @default(uuid())
  courseId         String
  title            String
  description      String?
  lessonNumber     Int
  weekNumber       Int
  unit             String?
  level            Int                    @default(1)
  warmup           Json
  techniques       Json
  simulations      Json
  cooldown         Json
  mentalModule     Json?
  tacticalModule   String?
  adaptations      Json?
  duration         Int                    @default(60)
  difficulty       Int                    @default(1)
  objectives       String[]
  equipment        String[]
  activities       String[]
  videoUrl         String?
  thumbnailUrl     String?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @default(now())
  classes          Class[]
  activityItems    LessonPlanActivity[]
  techniqueLinks   LessonPlanTechniques[]
  course           Course                 @relation(fields: [courseId], references: [id], onDelete: Cascade)
  techniqueRecords TechniqueRecord[]
  turmaLessons     TurmaLesson[]

  @@unique([courseId, lessonNumber])
  @@map("lesson_plans")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model Technique {
  id                     String                      @id @default(uuid())
  martialArtId           String?
  name                   String
  description            String?
  difficulty             Int?
  prerequisites          String[]
  videoUrl               String?
  imageUrl               String?
  baseXP                 Int?
  masteryXP              Int?
  badgeIcon              String?
  createdAt              DateTime                    @default(now())
  updatedAt              DateTime                    @updatedAt
  slug                   String?                     @unique
  shortDescription       String?
  subcategory            String?
  modality               String?
  complexity             String?
  durationMin            Int?
  durationMax            Int?
  groupSizeMin           Int?
  groupSizeMax           Int?
  ageRangeMin            Int?
  ageRangeMax            Int?
  objectives             String[]
  resources              String[]
  assessmentCriteria     String[]
  risksMitigation        String[]
  tags                   String[]
  references             String[]
  bnccCompetenciesText   String?                     @default("")
  category               String?
  instructions           Json[]
  stepByStep             Json[]
  bnccCompetencies       Json[]
  referencedByActivities Activity[]                  @relation("ActivityTechniqueRef")
  courseTechniques       CourseTechnique[]
  educationalLinks       EducationalPlanTechniques[]
  lessonLinks            LessonPlanTechniques[]
  requiredByEdges        TechniquePrerequisite[]     @relation("TechniquePrerequisitesPrerequisite")
  prerequisitesEdges     TechniquePrerequisite[]     @relation("TechniquePrerequisitesTechnique")
  techniqueProgress      TechniqueProgress[]
  techniqueRecords       TechniqueRecord[]
  martialArt             MartialArt?                 @relation(fields: [martialArtId], references: [id], onDelete: Cascade)

  @@map("techniques")
}

model CourseTechnique {
  id           String    @id @default(uuid())
  courseId     String
  techniqueId  String
  orderIndex   Int
  weekNumber   Int?
  lessonNumber Int?
  isRequired   Boolean   @default(true)
  course       Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  technique    Technique @relation(fields: [techniqueId], references: [id], onDelete: Cascade)

  @@unique([courseId, techniqueId])
  @@unique([courseId, orderIndex])
  @@map("course_techniques")
}

model User {
  id               String            @id @default(uuid())
  organizationId   String
  email            String
  password         String
  role             UserRole          @default(STUDENT)
  firstName        String
  lastName         String
  avatarUrl        String?
  phone            String?
  cpf              String?
  birthDate        DateTime?
  isActive         Boolean           @default(true)
  emailVerified    Boolean           @default(false)
  lastLoginAt      DateTime?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @default(now())
  instructor       Instructor?
  student          Student?
  attendanceChecks TurmaAttendance[] @relation("AttendanceChecker")
  turmas           Turma[]
  organization     Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, email])
  @@map("users")
}

model Student {
  id                     String                @id @default(uuid())
  organizationId         String
  userId                 String                @unique
  emergencyContact       String?
  medicalConditions      String?
  category               StudentCategory       @default(ADULT)
  gender                 Gender?               @default(MASCULINO)
  age                    Int?
  physicalCondition      PhysicalCondition?    @default(INICIANTE)
  specialNeeds           SpecialNeed[]
  totalXP                Int                   @default(0)
  globalLevel            Int                   @default(1)
  currentStreak          Int                   @default(0)
  longestStreak          Int                   @default(0)
  lastCheckinDate        DateTime?
  preferredDays          String[]
  preferredTimes         String[]
  notifications          Boolean               @default(true)
  enrollmentDate         DateTime              @default(now())
  isActive               Boolean               @default(true)
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @default(now())
  financialResponsibleId String?
  registrationNumber     String?               @unique
  asaasCustomer          AsaasCustomer?
  assessmentAttempts     AssessmentAttempt[]
  attendancePatterns     AttendancePattern?
  attendanceRecords      AttendanceRecord[]
  attendances            Attendance[]
  badgeUnlocks           BadgeUnlock[]
  challengeProgress      ChallengeProgress[]
  enrollments            CourseEnrollment[]
  evaluationRecords      EvaluationRecord[]
  evaluations            Evaluation[]
  feedbackActivities     FeedbackActivity[]
  feedbackLessons        FeedbackLesson[]
  payments               Payment[]
  physicalTestAttempts   PhysicalTestAttempt[]
  pointsTransactions     PointsTransaction[]
  progressRecords        Progress[]
  achievements           StudentAchievement[]
  studentCourses         StudentCourse[]
  progressions           StudentProgression[]
  subscriptions          StudentSubscription[]
  financialResponsible   FinancialResponsible? @relation(fields: [financialResponsibleId], references: [id])
  organization           Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user                   User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  teacherEvaluations     TeacherEvaluation[]
  techniqueRecords       TechniqueRecord[]
  turmaAttendances       TurmaAttendance[]
  turmaStudents          TurmaStudent[]

  @@map("students")
}

model EducationalPlanTechniques {
  educationalPlanId String
  techniqueId       String
  order             Int       @default(0)
  notes             String?
  technique         Technique @relation(fields: [techniqueId], references: [id], onDelete: Cascade)

  @@id([educationalPlanId, techniqueId])
  @@map("educational_plan_techniques")
}

model LessonPlanTechniques {
  lessonPlanId      String
  techniqueId       String
  order             Int        @default(0)
  allocationMinutes Int        @default(0)
  objectiveMapping  String[]
  lessonPlan        LessonPlan @relation(fields: [lessonPlanId], references: [id], onDelete: Cascade)
  technique         Technique  @relation(fields: [techniqueId], references: [id], onDelete: Cascade)

  @@id([lessonPlanId, techniqueId])
  @@map("lesson_plan_techniques")
}

model FinancialResponsible {
  id               String                @id @default(uuid())
  organizationId   String
  name             String
  cpfCnpj          String
  email            String
  phone            String?
  birthDate        DateTime?
  address          String?
  addressNumber    String?
  complement       String?
  neighborhood     String?
  city             String?
  state            String?
  zipCode          String?
  relationshipType String?
  asaasId          String?
  isActive         Boolean               @default(true)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @default(now())
  asaasCustomer    AsaasCustomer?
  organization     Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  payments         Payment[]
  subscriptions    StudentSubscription[]
  students         Student[]

  @@unique([organizationId, cpfCnpj])
  @@unique([organizationId, email])
  @@map("financial_responsibles")
}

model TechniqueRecord {
  id             String               @id @default(uuid())
  studentId      String
  techniqueId    String
  lessonPlanId   String?
  proficiency    TechniqueProficiency @default(LEARNING)
  practiceCount  Int                  @default(1)
  masteryScore   Int                  @default(0)
  firstPracticed DateTime             @default(now())
  lastPracticed  DateTime             @default(now())
  masteredAt     DateTime?
  videoUrl       String?
  aiAnalysis     Json?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @default(now())
  lessonPlan     LessonPlan?          @relation(fields: [lessonPlanId], references: [id])
  student        Student              @relation(fields: [studentId], references: [id], onDelete: Cascade)
  technique      Technique            @relation(fields: [techniqueId], references: [id], onDelete: Cascade)

  @@unique([studentId, techniqueId])
  @@map("technique_records")
}

model Unit {
  id              String         @id @default(uuid())
  organizationId  String
  name            String
  description     String?
  address         String
  addressNumber   String?
  complement      String?
  neighborhood    String?
  city            String
  state           String
  zipCode         String
  phone           String?
  email           String?
  capacity        Int            @default(100)
  totalMats       Int            @default(1)
  responsibleName String?
  isActive        Boolean        @default(true)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @default(now())
  classes         Class[]
  mats            Mat[]
  trainingAreas   TrainingArea[]
  turmas          Turma[]
  organization    Organization   @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, name])
  @@map("units")
}

model TrainingArea {
  id          String   @id @default(uuid())
  unitId      String
  name        String
  description String?
  capacity    Int      @default(20)
  areaType    String
  dimensions  String?
  equipment   String[]
  flooring    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
  classes     Class[]  @relation("ClassTrainingArea")
  unit        Unit     @relation(fields: [unitId], references: [id], onDelete: Cascade)
  turmas      Turma[]  @relation("TurmaTrainingArea")

  @@unique([unitId, name])
  @@map("training_areas")
}

model Mat {
  id             String       @id @default(uuid())
  organizationId String
  unitId         String
  name           String
  description    String?
  capacity       Int          @default(20)
  dimensions     String?
  equipment      String[]
  materialType   String?
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now())
  classes        Class[]
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  unit           Unit         @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@unique([unitId, name])
  @@map("mats")
}

model Instructor {
  id                  String              @id @default(uuid())
  organizationId      String
  userId              String              @unique
  specializations     String[]
  certifications      String[]
  bio                 String?
  martialArts         String[]
  maxStudentsPerClass Int                 @default(20)
  experience          String?
  availability        Json?
  hourlyRate          Decimal?            @db.Decimal(10, 2)
  preferredUnits      String[]
  hireDate            DateTime            @default(now())
  isActive            Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @default(now())
  classes             Class[]
  evaluations         Evaluation[]
  organization        Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user                User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  teacherEvaluations  TeacherEvaluation[]

  @@map("instructors")
}

model ClassSchedule {
  id          String   @id @default(uuid())
  dayOfWeek   Int
  startTime   DateTime
  endTime     DateTime
  maxStudents Int      @default(20)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
  classes     Class[]

  @@map("class_schedules")
}

model Class {
  id                   String                @id @default(uuid())
  organizationId       String
  unitId               String?
  matId                String?
  scheduleId           String?
  instructorId         String
  courseId             String
  lessonPlanId         String?
  date                 DateTime
  startTime            DateTime
  endTime              DateTime
  title                String?
  description          String?
  status               ClassStatus           @default(SCHEDULED)
  actualStudents       Int                   @default(0)
  maxStudents          Int                   @default(20)
  agenda               Json?
  notes                String?
  qrCode               String?               @unique
  qrCodeExpiry         DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @default(now())
  location             String?
  trainingAreaId       String?
  assessmentAttempts   AssessmentAttempt[]
  attendanceRecords    AttendanceRecord[]
  attendances          Attendance[]
  activities           ClassActivity[]
  course               Course                @relation(fields: [courseId], references: [id])
  instructor           Instructor            @relation(fields: [instructorId], references: [id])
  lessonPlan           LessonPlan?           @relation(fields: [lessonPlanId], references: [id])
  mat                  Mat?                  @relation(fields: [matId], references: [id])
  organization         Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  schedule             ClassSchedule?        @relation(fields: [scheduleId], references: [id])
  trainingArea         TrainingArea?         @relation("ClassTrainingArea", fields: [trainingAreaId], references: [id])
  unit                 Unit?                 @relation(fields: [unitId], references: [id])
  feedbackLessons      FeedbackLesson[]
  physicalTestAttempts PhysicalTestAttempt[]
  studentCourses       StudentCourse[]
  teacherEvaluations   TeacherEvaluation[]

  @@map("classes")
}

model Attendance {
  id             String           @id @default(uuid())
  organizationId String
  studentId      String
  classId        String
  status         AttendanceStatus @default(PRESENT)
  checkInTime    DateTime?
  checkInMethod  CheckInMethod?
  location       String?
  notes          String?
  xpEarned       Int              @default(0)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now())
  class          Class            @relation(fields: [classId], references: [id], onDelete: Cascade)
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  student        Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, classId])
  @@map("attendances")
}

model CourseEnrollment {
  id                String              @id @default(uuid())
  studentId         String
  courseId          String
  enrolledAt        DateTime            @default(now())
  completedAt       DateTime?
  expectedEndDate   DateTime
  status            EnrollmentStatus    @default(ACTIVE)
  category          StudentCategory     @default(ADULT)
  gender            String
  currentLesson     Int                 @default(1)
  lessonsCompleted  Int                 @default(0)
  attendanceRate    Float               @default(0)
  currentXP         Int                 @default(0)
  currentLevel      Int                 @default(1)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @default(now())
  challengeProgress ChallengeProgress[]
  course            Course              @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student           Student             @relation(fields: [studentId], references: [id], onDelete: Cascade)
  evaluations       Evaluation[]
  techniqueProgress TechniqueProgress[]

  @@unique([studentId, courseId])
  @@map("course_enrollments")
}

model TechniqueProgress {
  id                  String               @id @default(uuid())
  enrollmentId        String
  techniqueId         String
  status              TechniqueProficiency @default(LEARNING)
  accuracy            Float?
  attempts            Int                  @default(0)
  practiceCount       Int                  @default(0)
  masteredAt          DateTime?
  videoUrl            String?
  aiAnalysis          Json?
  instructorValidated Boolean              @default(false)
  validatedBy         String?
  validatedAt         DateTime?
  instructorNotes     String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now())
  enrollment          CourseEnrollment     @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  technique           Technique            @relation(fields: [techniqueId], references: [id], onDelete: Cascade)

  @@unique([enrollmentId, techniqueId])
  @@map("technique_progress")
}

model CourseChallenge {
  id                String              @id @default(uuid())
  courseId          String
  weekNumber        Int
  type              ChallengeType
  baseActivity      String
  baseMetric        Int
  baseTime          Int?
  description       String?
  xpReward          Int                 @default(15)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @default(now())
  challengeProgress ChallengeProgress[]
  course            Course              @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([courseId, weekNumber])
  @@map("course_challenges")
}

model ChallengeProgress {
  id                  String           @id @default(uuid())
  studentId           String
  enrollmentId        String
  challengeId         String
  attempted           Boolean          @default(false)
  completed           Boolean          @default(false)
  actualMetric        Int?
  actualTime          Int?
  videoUrl            String?
  imageUrl            String?
  instructorValidated Boolean          @default(false)
  validatedBy         String?
  validatedAt         DateTime?
  instructorNotes     String?
  xpEarned            Int              @default(0)
  completedAt         DateTime?
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @default(now())
  challenge           CourseChallenge  @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  enrollment          CourseEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  student             Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([enrollmentId, challengeId])
  @@map("challenge_progress")
}

model Evaluation {
  id                 String           @id @default(uuid())
  studentId          String
  instructorId       String
  enrollmentId       String
  type               EvaluationType
  lessonNumber       Int
  techniqueseTested  Json
  physicalTest       Json?
  overallScore       Float
  passed             Boolean          @default(false)
  instructorNotes    String?
  videoUrl           String?
  recommendedActions String[]
  evaluatedBy        String
  evaluatedAt        DateTime         @default(now())
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @default(now())
  enrollment         CourseEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  instructor         Instructor       @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  student            Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@map("evaluations")
}

model StudentProgression {
  id                   String     @id @default(uuid())
  studentId            String
  martialArtId         String
  currentLevel         Int        @default(1)
  currentGrade         String     @default("White Belt")
  totalXP              Int        @default(0)
  techniquesLearned    Int        @default(0)
  techniquesTotal      Int        @default(0)
  classesAttended      Int        @default(0)
  evaluationsCompleted Int        @default(0)
  nextGrade            String?
  progressToNextGrade  Float      @default(0)
  estimatedTimeToNext  String?
  lastUpdated          DateTime   @default(now())
  createdAt            DateTime   @default(now())
  updatedAt            DateTime   @default(now())
  martialArt           MartialArt @relation(fields: [martialArtId], references: [id], onDelete: Cascade)
  student              Student    @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, martialArtId])
  @@map("student_progressions")
}

model Achievement {
  id                  String               @id @default(uuid())
  organizationId      String
  martialArtId        String?
  name                String
  description         String
  category            AchievementCategory
  criteria            Json
  xpReward            Int                  @default(0)
  badgeImageUrl       String?
  rarity              AchievementRarity    @default(COMMON)
  isHidden            Boolean              @default(false)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now())
  martialArt          MartialArt?          @relation(fields: [martialArtId], references: [id])
  organization        Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  studentAchievements StudentAchievement[]

  @@map("achievements")
}

model StudentAchievement {
  id            String      @id @default(uuid())
  studentId     String
  achievementId String
  unlockedAt    DateTime    @default(now())
  progress      Float       @default(100)
  createdAt     DateTime    @default(now())
  achievement   Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)
  student       Student     @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, achievementId])
  @@map("student_achievements")
}

model Challenge {
  id             String              @id @default(uuid())
  organizationId String
  title          String
  description    String
  type           ChallengeType
  difficulty     ChallengeDifficulty @default(EASY)
  startDate      DateTime
  endDate        DateTime
  isRecurring    Boolean             @default(false)
  recurringType  RecurringType?
  xpReward       Int                 @default(0)
  badgeReward    String?
  criteria       Json
  targetValue    Int                 @default(1)
  isActive       Boolean             @default(true)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @default(now())
  organization   Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@map("challenges")
}

model StudentCourse {
  id              String           @id @default(uuid())
  studentId       String
  courseId        String
  classId         String
  paymentPlanId   String?
  startDate       DateTime         @default(now())
  expectedEndDate DateTime?
  completedDate   DateTime?
  status          EnrollmentStatus @default(ACTIVE)
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @default(now())
  class           Class            @relation(fields: [classId], references: [id], onDelete: Cascade)
  course          Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  paymentPlan     BillingPlan?     @relation("BillingPlanStudentCourses", fields: [paymentPlanId], references: [id])
  student         Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, courseId, classId])
  @@map("student_courses")
}

model AttendanceRecord {
  id           String   @id @default(uuid())
  studentId    String
  classId      String
  courseId     String
  lessonNumber Int
  date         DateTime
  present      Boolean  @default(false)
  arrived_late Boolean  @default(false)
  left_early   Boolean  @default(false)
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now())
  class        Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  course       Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student      Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, classId, lessonNumber])
  @@map("attendance_records")
}

model Progress {
  id                  String   @id @default(uuid())
  studentId           String
  courseId            String
  lessonNumber        Int
  techniquesLearned   String[]
  challengesCompleted String[]
  points              Int      @default(0)
  reflections         String?
  progressDate        DateTime @default(now())
  createdAt           DateTime @default(now())
  updatedAt           DateTime @default(now())
  course              Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student             Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, courseId, lessonNumber])
  @@map("progress_records")
}

model TechniqueDetail {
  id            String            @id @default(uuid())
  courseId      String
  name          String
  description   String?
  category      TechniqueCategory
  lessonNumber  Int
  instructions  String[]
  objectives    String[]
  adaptations   Json?
  orderInLesson Int               @default(1)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @default(now())
  course        Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([courseId, lessonNumber, orderInLesson])
  @@map("technique_details")
}

model WeeklyChallenge {
  id              String   @id @default(uuid())
  courseId        String
  weekNumber      Int
  name            String
  description     String
  baseRepetitions Json
  baseTime        Int?
  pointsReward    Int      @default(15)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now())
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([courseId, weekNumber])
  @@map("weekly_challenges")
}

model EvaluationRecord {
  id                  String           @id @default(uuid())
  studentId           String
  courseId            String
  lessonNumber        Int
  techniquesEvaluated String[]
  physicalTest        String?
  physicalTestResult  String?
  simulationScenarios String[]
  simulationResults   String[]
  precision           Float?
  status              EvaluationStatus
  certificateIssued   Boolean          @default(false)
  certificateUrl      String?
  instructorNotes     String?
  evaluationDate      DateTime         @default(now())
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @default(now())
  course              Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student             Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, courseId, lessonNumber])
  @@map("evaluation_records")
}

model AttendancePattern {
  id                  String          @id @default(uuid())
  studentId           String          @unique
  totalClasses        Int             @default(0)
  attendedClasses     Int             @default(0)
  attendanceRate      Float           @default(0)
  consecutiveAbsences Int             @default(0)
  averageCheckInTime  String?
  preferredDays       String[]
  preferredTimeSlots  String[]
  recentTrend         AttendanceTrend @default(STABLE)
  trendConfidence     Float           @default(0)
  dropoutRisk         DropoutRisk     @default(LOW)
  riskFactors         String[]
  recommendations     String[]
  aiInsights          Json?
  lastAnalyzed        DateTime        @default(now())
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @default(now())
  student             Student         @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@map("attendance_patterns")
}

model AsaasCustomer {
  id                     String                @id @default(uuid())
  organizationId         String
  studentId              String?               @unique
  financialResponsibleId String?               @unique
  asaasId                String                @unique
  name                   String
  cpfCnpj                String
  email                  String?
  phone                  String?
  mobilePhone            String?
  postalCode             String?
  address                String?
  addressNumber          String?
  complement             String?
  province               String?
  city                   String?
  state                  String?
  externalReference      String?
  isActive               Boolean               @default(true)
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @default(now())
  financialResponsible   FinancialResponsible? @relation(fields: [financialResponsibleId], references: [id])
  organization           Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  student                Student?              @relation(fields: [studentId], references: [id], onDelete: Cascade)
  payments               Payment[]
  subscriptions          StudentSubscription[]

  @@map("asaas_customers")
}

model BillingPlan {
  id                      String                @id @default(uuid())
  organizationId          String
  courseId                String?
  name                    String
  description             String?
  category                StudentCategory?
  price                   Decimal               @db.Decimal(10, 2)
  billingType             BillingType           @default(MONTHLY)
  classesPerWeek          Int                   @default(2)
  maxClasses              Int?
  duration                Int?
  isUnlimitedAccess       Boolean               @default(false)
  hasPersonalTraining     Boolean               @default(false)
  hasNutrition            Boolean               @default(false)
  allowInstallments       Boolean               @default(false)
  maxInstallments         Int                   @default(1)
  installmentInterestRate Decimal?              @db.Decimal(5, 2)
  isRecurring             Boolean               @default(false)
  recurringInterval       Int?
  accessAllModalities     Boolean               @default(false)
  allowFreeze             Boolean               @default(true)
  freezeMaxDays           Int                   @default(30)
  features                Json?
  isActive                Boolean               @default(true)
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @default(now())
  creditsValidity         Int?
  pricePerClass           Decimal?              @db.Decimal(10, 2)
  course                  Course?               @relation("BillingPlanPrimaryCourse", fields: [courseId], references: [id])
  organization            Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  planCourses             PlanCourse[]          @relation("PlanCourseToPlan")
  studentCourses          StudentCourse[]       @relation("BillingPlanStudentCourses")
  subscriptions           StudentSubscription[] @relation("BillingPlanSubscriptions")

  @@map("billing_plans")
}

model StudentSubscription {
  id                     String                @id @default(uuid())
  organizationId         String
  studentId              String
  planId                 String
  asaasCustomerId        String?
  financialResponsibleId String?
  status                 SubscriptionStatus    @default(ACTIVE)
  startDate              DateTime              @default(now())
  endDate                DateTime?
  currentPrice           Decimal               @db.Decimal(10, 2)
  billingType            BillingType
  nextBillingDate        DateTime?
  asaasSubscriptionId    String?
  isActive               Boolean               @default(true)
  autoRenew              Boolean               @default(true)
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @default(now())
  payments               Payment[]
  asaasCustomer          AsaasCustomer?        @relation(fields: [asaasCustomerId], references: [id])
  financialResponsible   FinancialResponsible? @relation(fields: [financialResponsibleId], references: [id])
  organization           Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  plan                   BillingPlan           @relation("BillingPlanSubscriptions", fields: [planId], references: [id])
  student                Student               @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@map("student_subscriptions")
}

model Payment {
  id                     String                @id @default(uuid())
  organizationId         String
  studentId              String
  subscriptionId         String?
  asaasCustomerId        String?
  financialResponsibleId String?
  amount                 Decimal               @db.Decimal(10, 2)
  description            String
  dueDate                DateTime
  paidDate               DateTime?
  status                 PaymentStatus         @default(PENDING)
  paymentMethod          PaymentMethod?
  asaasPaymentId         String?               @unique
  asaasChargeUrl         String?
  pixCode                String?
  webhookData            Json?
  notes                  String?
  isManual               Boolean               @default(false)
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @default(now())
  asaasCustomer          AsaasCustomer?        @relation(fields: [asaasCustomerId], references: [id])
  financialResponsible   FinancialResponsible? @relation(fields: [financialResponsibleId], references: [id])
  organization           Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  student                Student               @relation(fields: [studentId], references: [id], onDelete: Cascade)
  subscription           StudentSubscription?  @relation(fields: [subscriptionId], references: [id])

  @@map("payments")
}

model FinancialSettings {
  id                 String       @id @default(uuid())
  organizationId     String       @unique
  asaasApiKey        String?
  asaasWebhookUrl    String?
  asaasWebhookToken  String?
  isSandbox          Boolean      @default(true)
  defaultBillingType BillingType  @default(MONTHLY)
  lateFeePercentage  Decimal      @default(2.0) @db.Decimal(5, 2)
  interestRate       Decimal      @default(1.0) @db.Decimal(5, 2)
  sendReminders      Boolean      @default(true)
  reminderDaysBefore Int          @default(3)
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @default(now())
  organization       Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@map("financial_settings")
}

model PlanCourse {
  planId    String
  courseId  String
  createdAt DateTime    @default(now())
  course    Course      @relation(fields: [courseId], references: [id], onDelete: Cascade)
  plan      BillingPlan @relation("PlanCourseToPlan", fields: [planId], references: [id], onDelete: Cascade)

  @@id([planId, courseId])
  @@map("plan_courses")
}

model TechniquePrerequisite {
  techniqueId             String
  prerequisiteTechniqueId String
  createdAt               DateTime  @default(now())
  prerequisite            Technique @relation("TechniquePrerequisitesPrerequisite", fields: [prerequisiteTechniqueId], references: [id], onDelete: Cascade)
  technique               Technique @relation("TechniquePrerequisitesTechnique", fields: [techniqueId], references: [id], onDelete: Cascade)

  @@id([techniqueId, prerequisiteTechniqueId])
  @@map("technique_prerequisite")
}

model MentalModule {
  id               String   @id @default(uuid())
  name             String   @unique
  objective        String
  recommendedPhase String?
  durationMin      Int?
  tags             String[]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now())

  @@map("mental_modules")
}

model AdaptationSnippet {
  id          String   @id @default(uuid())
  audienceTag String
  text        String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())

  @@index([audienceTag])
  @@map("adaptation_snippets")
}

model RagChunk {
  id             String        @id @default(uuid())
  organizationId String?
  type           String
  sourceType     String?
  sourceId       String?
  version        Int           @default(1)
  lang           String        @default("pt-BR")
  tags           String[]
  text           String
  hash           String        @unique
  embedding      Bytes?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now())
  embeddings     RagEmbedding?

  @@index([organizationId, type])
  @@index([type, version])
  @@map("rag_chunks")
}

model RagEmbedding {
  id           String   @id @default(uuid())
  chunkId      String   @unique
  provider     String
  modelVersion String
  dim          Int
  createdAt    DateTime @default(now())
  chunk        RagChunk @relation(fields: [chunkId], references: [id], onDelete: Cascade)

  @@map("rag_embeddings")
}

model Activity {
  id              String               @id @default(uuid())
  organizationId  String
  type            ActivityType
  title           String
  description     String?
  equipment       String[]             @default([])
  safety          String?
  adaptations     String[]             @default([])
  difficulty      Int?
  refTechniqueId  String?
  defaultParams   Json?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @default(now())
  organization    Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  refTechnique    Technique?           @relation("ActivityTechniqueRef", fields: [refTechniqueId], references: [id], onDelete: Cascade)
  classItems      ClassActivity[]
  lessonPlanItems LessonPlanActivity[]

  @@map("activities")
}

model LessonPlanActivity {
  id           String        @id @default(uuid())
  lessonPlanId String
  activityId   String
  segment      LessonSegment
  ord          Int           @default(1)
  params       Json?
  objectives   String?
  safetyNotes  String?
  adaptations  String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now())
  activity     Activity      @relation(fields: [activityId], references: [id], onDelete: Cascade)
  lessonPlan   LessonPlan    @relation(fields: [lessonPlanId], references: [id], onDelete: Cascade)

  @@unique([lessonPlanId, ord])
  @@map("lesson_plan_activities")
}

model ClassActivity {
  id              String             @id @default(uuid())
  classId         String
  activityId      String
  segment         LessonSegment
  ord             Int                @default(1)
  paramsUsed      Json?
  completed       Boolean            @default(false)
  adaptationsUsed String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @default(now())
  activity        Activity           @relation(fields: [activityId], references: [id], onDelete: Cascade)
  class           Class              @relation(fields: [classId], references: [id], onDelete: Cascade)
  feedbacks       FeedbackActivity[]

  @@unique([classId, ord])
  @@map("class_activities")
}

model Rubric {
  id          String                 @id @default(uuid())
  name        String
  minScore    Int                    @default(0)
  maxScore    Int                    @default(100)
  assessments AssessmentDefinition[]
  criteria    RubricCriterion[]

  @@map("rubrics")
}

model RubricCriterion {
  id          String  @id @default(uuid())
  rubricId    String
  name        String
  description String?
  weight      Int     @default(1)
  rubric      Rubric  @relation(fields: [rubricId], references: [id], onDelete: Cascade)

  @@map("rubric_criteria")
}

model AssessmentDefinition {
  id       String              @id @default(uuid())
  courseId String
  name     String
  type     AssessmentType
  when     String?
  rubricId String?
  attempts AssessmentAttempt[]
  course   Course              @relation(fields: [courseId], references: [id], onDelete: Cascade)
  rubric   Rubric?             @relation(fields: [rubricId], references: [id], onDelete: Cascade)

  @@map("assessment_definitions")
}

model AssessmentAttempt {
  id           String               @id @default(uuid())
  assessmentId String
  studentId    String
  classId      String?
  evaluatorId  String?
  startedAt    DateTime?
  completedAt  DateTime?
  scoreTotal   Int?
  details      Json?
  assessment   AssessmentDefinition @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  class        Class?               @relation(fields: [classId], references: [id])
  student      Student              @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@map("assessment_attempts")
}

model PhysicalTestDefinition {
  id            String                @id @default(uuid())
  name          String
  metric        Metric
  targetValue   Float?
  passThreshold Float?
  attempts      PhysicalTestAttempt[]

  @@map("physical_test_definitions")
}

model PhysicalTestAttempt {
  id        String                 @id @default(uuid())
  testId    String
  studentId String
  classId   String?
  value     Float
  passed    Boolean?
  comment   String?
  class     Class?                 @relation(fields: [classId], references: [id])
  student   Student                @relation(fields: [studentId], references: [id], onDelete: Cascade)
  test      PhysicalTestDefinition @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@map("physical_test_attempts")
}

model FeedbackLesson {
  id        String   @id @default(uuid())
  classId   String
  studentId String
  rating    Int
  mood      String?
  comment   String?
  createdAt DateTime @default(now())
  class     Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([classId, studentId])
  @@map("feedback_lessons")
}

model FeedbackActivity {
  id                  String        @id @default(uuid())
  classActivityId     String
  studentId           String
  rating              Int
  perceivedDifficulty Int?
  comment             String?
  createdAt           DateTime      @default(now())
  classActivity       ClassActivity @relation(fields: [classActivityId], references: [id], onDelete: Cascade)
  student             Student       @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([classActivityId, studentId])
  @@map("feedback_activities")
}

model TeacherEvaluation {
  id           String     @id @default(uuid())
  classId      String?
  courseId     String?
  studentId    String
  instructorId String
  rating       Int
  criteria     Json?
  comment      String?
  createdAt    DateTime   @default(now())
  class        Class?     @relation(fields: [classId], references: [id])
  course       Course?    @relation(fields: [courseId], references: [id])
  instructor   Instructor @relation(fields: [instructorId], references: [id])
  student      Student    @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@map("teacher_evaluations")
}

model Badge {
  id             String        @id @default(uuid())
  organizationId String
  name           String
  criteria       Json?
  iconUrl        String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now())
  unlocks        BadgeUnlock[]
  organization   Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, name])
  @@map("badges")
}

model BadgeUnlock {
  id         String   @id @default(uuid())
  badgeId    String
  studentId  String
  unlockedAt DateTime @default(now())
  reason     String?
  badge      Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  student    Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([badgeId, studentId])
  @@map("badge_unlocks")
}

model PointsTransaction {
  id         String   @id @default(uuid())
  studentId  String
  amount     Int
  source     String
  refType    String?
  refId      String?
  occurredAt DateTime @default(now())
  student    Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@map("points_transactions")
}

model Turma {
  id             String            @id @default(uuid())
  organizationId String
  courseId       String
  name           String
  description    String?
  classType      ClassType         @default(COLLECTIVE)
  status         TurmaStatus       @default(SCHEDULED)
  instructorId   String
  maxStudents    Int               @default(20)
  startDate      DateTime
  endDate        DateTime?
  schedule       Json
  unitId         String?
  room           String?
  price          Decimal?          @db.Decimal(10, 2)
  isActive       Boolean           @default(true)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now())
  trainingAreaId String?
  attendances    TurmaAttendance[]
  courses        TurmaCourse[]
  lessons        TurmaLesson[]
  students       TurmaStudent[]
  course         Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  instructor     User              @relation(fields: [instructorId], references: [id])
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  trainingArea   TrainingArea?     @relation("TurmaTrainingArea", fields: [trainingAreaId], references: [id])
  unit           Unit?             @relation(fields: [unitId], references: [id])

  @@unique([organizationId, name])
  @@map("turmas")
}

model TurmaLesson {
  id            String            @id @default(uuid())
  turmaId       String
  lessonPlanId  String?
  lessonNumber  Int
  title         String
  scheduledDate DateTime
  actualDate    DateTime?
  status        TurmaStatus       @default(SCHEDULED)
  duration      Int               @default(60)
  notes         String?
  materials     String[]          @default([])
  objectives    String[]          @default([])
  techniques    Json?
  isActive      Boolean           @default(true)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @default(now())
  attendances   TurmaAttendance[]
  lessonPlan    LessonPlan?       @relation(fields: [lessonPlanId], references: [id])
  turma         Turma             @relation(fields: [turmaId], references: [id], onDelete: Cascade)

  @@unique([turmaId, lessonNumber])
  @@map("turma_lessons")
}

model TurmaStudent {
  id            String            @id @default(uuid())
  turmaId       String
  studentId     String
  enrolledAt    DateTime          @default(now())
  status        String            @default("ACTIVE")
  paymentStatus String            @default("PENDING")
  notes         String?
  isActive      Boolean           @default(true)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @default(now())
  attendances   TurmaAttendance[]
  student       Student           @relation(fields: [studentId], references: [id], onDelete: Cascade)
  turma         Turma             @relation(fields: [turmaId], references: [id], onDelete: Cascade)

  @@unique([turmaId, studentId])
  @@map("turma_students")
}

model TurmaAttendance {
  id             String       @id @default(uuid())
  turmaId        String
  turmaLessonId  String
  turmaStudentId String
  studentId      String
  present        Boolean      @default(false)
  late           Boolean      @default(false)
  justified      Boolean      @default(false)
  notes          String?
  checkedAt      DateTime?
  checkedBy      String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now())
  checker        User?        @relation("AttendanceChecker", fields: [checkedBy], references: [id])
  student        Student      @relation(fields: [studentId], references: [id], onDelete: Cascade)
  turma          Turma        @relation(fields: [turmaId], references: [id], onDelete: Cascade)
  lesson         TurmaLesson  @relation(fields: [turmaLessonId], references: [id], onDelete: Cascade)
  turmaStudent   TurmaStudent @relation(fields: [turmaStudentId], references: [id], onDelete: Cascade)

  @@unique([turmaLessonId, studentId])
  @@map("turma_attendances")
}

model TurmaCourse {
  id        String   @id @default(cuid())
  turmaId   String
  courseId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  turma     Turma    @relation(fields: [turmaId], references: [id], onDelete: Cascade)

  @@unique([turmaId, courseId])
  @@map("turma_courses")
}

enum CourseCategory {
  MARTIAL_ARTS
  DANCE
  FITNESS
  LANGUAGE
  MUSIC
  OTHER
}

enum SubscriptionPlan {
  BASIC
  STANDARD
  PREMIUM
  ENTERPRISE
}

enum AIProvider {
  CLAUDE
  GEMINI
  OPENAI
  OPENROUTER
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  MANAGER
  INSTRUCTOR
  STUDENT
}

enum GradingSystem {
  BELT
  LEVEL
  STRIPE
  CUSTOM
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
  MASTER
}

enum StudentCategory {
  ADULT
  FEMALE
  SENIOR
  CHILD
  INICIANTE1
  INICIANTE2
  INICIANTE3
  HEROI1
  HEROI2
  HEROI3
  MASTER_1
  MASTER_2
  MASTER_3
}

enum Gender {
  MASCULINO
  FEMININO
  OUTRO
}

enum PhysicalCondition {
  INICIANTE
  REGULAR
  AVANCADO
}

enum SpecialNeed {
  TEA
  TDAH
  MOBILIDADE_REDUZIDA
  AUDITIVA
  VISUAL
}

enum EvaluationStatus {
  AUTONOMIA
  EM_DESENVOLVIMENTO
  PRECISA_INTERVENCAO
}

enum TechniqueCategory {
  STRIKING
  GRAPPLING
  DEFENSE
  SUBMISSION
  WEAPON
  FITNESS
}

enum TechniqueProficiency {
  LEARNING
  PRACTICING
  COMPETENT
  PROFICIENT
  EXPERT
  MASTERED
}

enum ClassStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  POSTPONED
}

enum AttendanceStatus {
  PRESENT
  LATE
  ABSENT
  EXCUSED
}

enum CheckInMethod {
  QR_CODE
  MANUAL
  FACIAL_RECOGNITION
  GEOLOCATION
  NFC
}

enum EnrollmentStatus {
  ACTIVE
  COMPLETED
  DROPPED
  SUSPENDED
  TRANSFERRED
}

enum EvaluationType {
  GRADING
  PROGRESS
  TECHNIQUE
  SPARRING
  FITNESS
  KNOWLEDGE
}

enum EvaluationCategory {
  TECHNICAL
  PHYSICAL
  MENTAL
  BEHAVIORAL
}

enum AchievementCategory {
  ATTENDANCE
  TECHNIQUE
  PROGRESSION
  SOCIAL
  CHALLENGE
  SPECIAL
}

enum AchievementRarity {
  COMMON
  UNCOMMON
  RARE
  EPIC
  LEGENDARY
}

enum ChallengeType {
  ATTENDANCE
  TECHNIQUE
  STREAK
  SOCIAL
  FITNESS
  CUSTOM
}

enum ChallengeDifficulty {
  EASY
  MEDIUM
  HARD
  EXTREME
}

enum RecurringType {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
}

enum CertificateType {
  COMPLETION
  ACHIEVEMENT
  PARTICIPATION
  GRADING
}

enum BillingType {
  MONTHLY
  QUARTERLY
  YEARLY
  LIFETIME
  CREDIT_CARD_INSTALLMENT
  RECURRING
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  CANCELLED
  EXPIRED
  SUSPENDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  CANCELLED
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PIX
  BANK_TRANSFER
  CASH
  PAYPAL
  STRIPE
}

enum AttendanceTrend {
  IMPROVING
  DECLINING
  STABLE
  VOLATILE
}

enum DropoutRisk {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ActivityType {
  TECHNIQUE
  STRETCH
  DRILL
  EXERCISE
  GAME
  CHALLENGE
  ASSESSMENT
}

enum LessonSegment {
  WARMUP
  STRETCH
  TECHNIQUE
  DRILL
  SIMULATION
  COOLDOWN
}

enum AssessmentType {
  TECHNICAL
  PHYSICAL
  MIXED
}

enum Metric {
  REPS
  TIME
  DISTANCE
  LOAD
}

enum ClassType {
  COLLECTIVE
  PRIVATE
  SEMI_PRIVATE
}

enum TurmaStatus {
  SCHEDULED
  ACTIVE
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum WeekDay {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}
