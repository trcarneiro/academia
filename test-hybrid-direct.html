<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Direto - Agenda H√≠brida</title>
    <link rel="stylesheet" href="/css/modules/hybrid-agenda.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-main { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        #test-log { background: #f8f9fa; padding: 15px; margin: 20px 0; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
        .test-btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; background: #1976d2; color: white; }
        .test-btn:hover { background: #1565c0; }
        #module-container { margin-top: 20px; min-height: 400px; border: 2px dashed #ccc; padding: 20px; }
        .module-header { margin-bottom: 20px; }
        .module-header h1 { margin: 0; }
        .breadcrumb { color: #666; font-size: 14px; }
    </style>
</head>
<body>
    <div class="test-main">
        <h1>üß™ Teste Direto - Agenda H√≠brida</h1>
        <p>Testando carregamento direto do m√≥dulo sem SPA router...</p>
        
        <div>
            <button class="test-btn" onclick="testDirectLoad()">üöÄ Carregar M√≥dulo Direto</button>
            <button class="test-btn" onclick="clearLog()">üßπ Limpar Log</button>
            <button class="test-btn" onclick="testAPICalls()">üåê Testar API</button>
        </div>
        
        <div id="test-log">
            <strong>Log de Testes:</strong><br>
            <div id="log-content"></div>
        </div>
        
        <div class="module-header">
            <h1>Agenda H√≠brida</h1>
            <div class="breadcrumb">Home / Agenda H√≠brida</div>
        </div>
        
        <div id="module-container">
            <p>Container pronto...</p>
        </div>
    </div>

    <!-- Load dependencies in correct order -->
    <script src="/js/shared/utils/feedback.js"></script>
    <script src="/js/shared/api-client.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            logContent.innerHTML += `[${timestamp}] ${icon} ${message}<br>`;
            logContent.scrollTop = logContent.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log-content').innerHTML = '';
        }

        async function testDirectLoad() {
            log('üîÑ Iniciando teste de carregamento direto...', 'info');
            
            try {
                // Test 1: Check dependencies
                log('üîç Verificando depend√™ncias...', 'info');
                
                if (typeof window.createModuleAPI === 'function') {
                    log('‚úÖ createModuleAPI dispon√≠vel', 'success');
                } else {
                    log('‚ùå createModuleAPI N√ÉO dispon√≠vel', 'error');
                    log('‚ÑπÔ∏è Aguardando carregamento...', 'info');
                    
                    // Wait for it
                    let attempts = 0;
                    while (!window.createModuleAPI && attempts < 50) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        attempts++;
                    }
                    
                    if (window.createModuleAPI) {
                        log('‚úÖ createModuleAPI agora dispon√≠vel', 'success');
                    } else {
                        log('‚ùå createModuleAPI ainda n√£o dispon√≠vel ap√≥s 5s', 'error');
                        return;
                    }
                }
                
                // Test 2: Load hybrid agenda script dynamically
                log('üîÑ Carregando script do m√≥dulo h√≠brido...', 'info');
                
                const script = document.createElement('script');
                script.src = '/js/modules/hybrid-agenda/index.js';
                script.type = 'module';
                
                script.onload = async function() {
                    try {
                        log('‚úÖ Script carregado com sucesso', 'success');
                        
                        // Wait a bit for initialization
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                        // Test 3: Check if module function is available
                        if (typeof window.initHybridAgendaModule === 'function') {
                            log('‚úÖ initHybridAgendaModule dispon√≠vel', 'success');
                            
                            // Test 4: Initialize module
                            log('üöÄ Inicializando m√≥dulo...', 'info');
                            
                            const container = document.getElementById('module-container');
                            await window.initHybridAgendaModule(container);
                            
                            log('üéâ M√≥dulo inicializado com sucesso!', 'success');
                            
                        } else {
                            log('‚ùå initHybridAgendaModule N√ÉO dispon√≠vel', 'error');
                            log(`‚ÑπÔ∏è Fun√ß√µes window dispon√≠veis: ${Object.keys(window).filter(k => k.includes('hybrid') || k.includes('Hybrid')).join(', ')}`, 'info');
                        }
                        
                    } catch (error) {
                        log(`‚ùå Erro na inicializa√ß√£o: ${error.message}`, 'error');
                        console.error('Initialization error:', error);
                    }
                };
                
                script.onerror = function() {
                    log('‚ùå Erro ao carregar script do m√≥dulo', 'error');
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                log(`‚ùå Erro geral: ${error.message}`, 'error');
                console.error('General error:', error);
            }
        }

        async function testAPICalls() {
            log('üåê Testando chamadas de API...', 'info');
            
            try {
                if (window.createModuleAPI) {
                    const api = window.createModuleAPI('HybridAgenda');
                    log('‚úÖ API helper criado', 'success');
                    
                    // Test API call
                    log('üì° Fazendo chamada de teste...', 'info');
                    
                    try {
                        const response = await fetch('/api/hybrid-agenda');
                        log(`üìä Status da API: ${response.status}`, response.ok ? 'success' : 'error');
                        
                        if (response.ok) {
                            const data = await response.text();
                            log(`üìÑ Resposta recebida (${data.length} chars)`, 'success');
                        } else {
                            log(`‚ùå Erro na API: ${response.statusText}`, 'error');
                        }
                    } catch (apiError) {
                        log(`‚ùå Erro na chamada API: ${apiError.message}`, 'error');
                    }
                    
                } else {
                    log('‚ùå createModuleAPI n√£o dispon√≠vel', 'error');
                }
            } catch (error) {
                log(`‚ùå Erro no teste de API: ${error.message}`, 'error');
            }
        }

        // Auto-run basic checks on load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                log('üîç Verifica√ß√£o inicial...', 'info');
                
                log(`API Client: ${window.createModuleAPI ? '‚úÖ' : '‚ùå'}`, window.createModuleAPI ? 'success' : 'error');
                log(`waitForAPIClient: ${window.waitForAPIClient ? '‚úÖ' : '‚ùå'}`, window.waitForAPIClient ? 'success' : 'error');
                
                log('‚ÑπÔ∏è Pronto para testes! Clique em "Carregar M√≥dulo Direto"', 'info');
            }, 1000);
        });
    </script>
</body>
</html>