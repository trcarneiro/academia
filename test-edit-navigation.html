<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Edit Navigation Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-card { 
            background: rgba(255,255,255,0.1); 
            margin: 20px 0; 
            padding: 20px; 
            border-radius: 12px; 
            backdrop-filter: blur(10px);
        }
        button { 
            padding: 12px 24px; 
            margin: 8px; 
            border: none;
            border-radius: 8px;
            cursor: pointer; 
            font-weight: bold;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        .btn-edit { background: linear-gradient(45deg, #007bff, #6f42c1); }
        .btn-new { background: linear-gradient(45deg, #28a745, #20c997); }
        .instructor-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .instructor-info {
            flex: 1;
        }
        .result { 
            margin-top: 15px; 
            padding: 10px; 
            border-radius: 6px; 
            background: rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <h1>üöÄ Edit Navigation Test - Quick Fix</h1>
    <p><strong>Objetivo:</strong> Testar se a edi√ß√£o agora abre a tela corretamente.</p>

    <div class="test-card">
        <h2>üéØ Direct Navigation Tests</h2>
        <button class="btn-new" onclick="testNewInstructor()">
            üìù Test "New Instructor"
        </button>
        <button class="btn-edit" onclick="testEditWithKnownId()">
            ‚úèÔ∏è Test "Edit Instructor" (with known ID)
        </button>
        <button class="btn-edit" onclick="testEditWithSampleId()">
            ‚úèÔ∏è Test "Edit Instructor" (sample ID)
        </button>
        <div id="navigation-result" class="result">
            Click a button to test navigation...
        </div>
    </div>

    <div class="test-card">
        <h2>üìã Current Instructors</h2>
        <button onclick="loadAndTestEdit()">Load Instructors & Test Edit</button>
        <div id="instructors-list"></div>
    </div>

    <div class="test-card">
        <h2>üîß URL Construction Test</h2>
        <button onclick="testUrlConstruction()">Test URL Construction</button>
        <div id="url-test-result" class="result">
            URL construction test results will appear here...
        </div>
    </div>

    <script>
        function testNewInstructor() {
            const resultDiv = document.getElementById('navigation-result');
            resultDiv.innerHTML = 'üîÑ Testing "New Instructor" navigation...';
            
            try {
                const standaloneUrl = `${window.location.origin}/standalone-instructor-editor.html?mode=create`;
                
                resultDiv.innerHTML = `
                    ‚úÖ Navigation prepared!<br>
                    <strong>URL:</strong> ${standaloneUrl}<br>
                    <a href="${standaloneUrl}" target="_blank" style="color: #4ecdc4;">Click here to open editor</a>
                `;
                
                console.log('üöÄ New instructor URL:', standaloneUrl);
                
                // Auto-open in 2 seconds
                setTimeout(() => {
                    window.open(standaloneUrl, '_blank');
                }, 2000);
                
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        function testEditWithKnownId() {
            const resultDiv = document.getElementById('navigation-result');
            resultDiv.innerHTML = 'üîÑ Testing "Edit Instructor" with known ID...';
            
            try {
                // Use one of the known instructor IDs from your previous logs
                const knownId = '7716e2ca-3e60-4515-a3a7-6487dfc923b6'; // Marcus Silva
                const standaloneUrl = `${window.location.origin}/standalone-instructor-editor.html?id=${knownId}&mode=edit`;
                
                resultDiv.innerHTML = `
                    ‚úÖ Edit navigation prepared!<br>
                    <strong>ID:</strong> ${knownId}<br>
                    <strong>URL:</strong> ${standaloneUrl}<br>
                    <a href="${standaloneUrl}" target="_blank" style="color: #4ecdc4;">Click here to open editor</a>
                `;
                
                console.log('‚úèÔ∏è Edit instructor URL:', standaloneUrl);
                
                // Auto-open in 2 seconds
                setTimeout(() => {
                    window.open(standaloneUrl, '_blank');
                }, 2000);
                
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        function testEditWithSampleId() {
            const resultDiv = document.getElementById('navigation-result');
            resultDiv.innerHTML = 'üîÑ Testing "Edit Instructor" with sample ID...';
            
            try {
                const sampleId = 'ff2cb992-208b-4af5-a155-fb60aac34952'; // Second Marcus Silva
                const standaloneUrl = `${window.location.origin}/standalone-instructor-editor.html?id=${sampleId}&mode=edit`;
                
                resultDiv.innerHTML = `
                    ‚úÖ Edit navigation prepared!<br>
                    <strong>ID:</strong> ${sampleId}<br>
                    <strong>URL:</strong> ${standaloneUrl}<br>
                    <a href="${standaloneUrl}" target="_blank" style="color: #4ecdc4;">Click here to open editor</a>
                `;
                
                console.log('‚úèÔ∏è Edit instructor URL (sample):', standaloneUrl);
                
                // Auto-open in 2 seconds
                setTimeout(() => {
                    window.open(standaloneUrl, '_blank');
                }, 2000);
                
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        async function loadAndTestEdit() {
            const listDiv = document.getElementById('instructors-list');
            listDiv.innerHTML = 'üîÑ Loading instructors...';

            try {
                const response = await fetch('/api/instructors');
                const data = await response.json();
                
                if (data.success && data.data && data.data.length > 0) {
                    const instructors = data.data;
                    
                    const instructorsHtml = instructors.map(instructor => `
                        <div class="instructor-card">
                            <div class="instructor-info">
                                <strong>${instructor.name}</strong><br>
                                <small>${instructor.email}</small><br>
                                <small>ID: ${instructor.id}</small>
                            </div>
                            <button class="btn-edit" onclick="directEditTest('${instructor.id}')">
                                ‚úèÔ∏è Edit This
                            </button>
                        </div>
                    `).join('');

                    listDiv.innerHTML = `
                        <div style="color: #4ecdc4; margin-bottom: 15px;">‚úÖ Found ${instructors.length} instructors:</div>
                        ${instructorsHtml}
                    `;
                } else {
                    listDiv.innerHTML = '‚ö†Ô∏è No instructors found';
                }
            } catch (error) {
                listDiv.innerHTML = `‚ùå Error loading instructors: ${error.message}`;
            }
        }

        function directEditTest(id) {
            console.log(`üß™ Direct edit test for ID: ${id}`);
            
            const standaloneUrl = `${window.location.origin}/standalone-instructor-editor.html?id=${id}&mode=edit`;
            
            if (confirm(`Abrir editor para o instrutor?\nID: ${id}`)) {
                window.open(standaloneUrl, '_blank');
            }
        }

        function testUrlConstruction() {
            const resultDiv = document.getElementById('url-test-result');
            
            try {
                const origin = window.location.origin;
                const newUrl = `${origin}/standalone-instructor-editor.html?mode=create`;
                const editUrl = `${origin}/standalone-instructor-editor.html?id=sample-id&mode=edit`;
                
                resultDiv.innerHTML = `
                    ‚úÖ URL Construction Test Results:<br><br>
                    <strong>Origin:</strong> ${origin}<br>
                    <strong>New URL:</strong> ${newUrl}<br>
                    <strong>Edit URL:</strong> ${editUrl}<br><br>
                    <em>URLs are properly formatted!</em>
                `;
                
                console.log('üîß URL construction test passed');
                console.log('Origin:', origin);
                console.log('New URL:', newUrl);
                console.log('Edit URL:', editUrl);
                
            } catch (error) {
                resultDiv.innerHTML = `‚ùå URL construction failed: ${error.message}`;
            }
        }

        // Auto-run URL test on load
        window.addEventListener('load', () => {
            console.log('üöÄ Edit Navigation Test page loaded');
            setTimeout(testUrlConstruction, 500);
        });
    </script>
</body>
</html>
