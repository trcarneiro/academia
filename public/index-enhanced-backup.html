<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥‹ Krav Maga Academy - Dashboard</title>
    
    <!-- Enhanced CSS -->
    <link rel="stylesheet" href="/css/core/reset.css">
    <link rel="stylesheet" href="/css/core/variables.css">
    <link rel="stylesheet" href="/css/dashboard-enhanced.css">
    
    <!-- Preload important resources -->
    <link rel="preload" href="/api/stats" as="fetch" crossorigin>
    
    <!-- Meta tags for better UX -->
    <meta name="description" content="Sistema de gestÃ£o completo para academias de Krav Maga">
    <meta name="theme-color" content="#0f172a">
    
    <!-- Favicon -->
    <link rel="icon" href="data:text/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¥‹</text></svg>">
</head>
<body class="dashboard-enhanced">
    <!-- Enhanced Header -->
    <header class="dashboard-header-enhanced">
        <div class="header-content">
            <div class="header-brand">
                <div class="brand-logo">ğŸ¥‹</div>
                <div>
                    <div class="brand-text">Krav Academy</div>
                    <div class="header-status">
                        <span>ğŸŸ¢</span>
                        <span>Sistema Online</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <div class="header-status">
                    <span>âš¡</span>
                    <span id="currentTime">Carregando...</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard Navigation -->
    <main class="dashboard-nav">
        <!-- Stats Overview -->
        <section class="stats-overview fade-in">
            <div class="stat-card">
                <div class="stat-value" id="totalStudents">
                    <div class="loading-shimmer">---</div>
                </div>
                <div class="stat-label">Total de Alunos</div>
                <div class="stat-trend positive" id="studentsTrend">
                    <span>ğŸ“ˆ</span>
                    <span>+5 este mÃªs</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeClasses">
                    <div class="loading-shimmer">---</div>
                </div>
                <div class="stat-label">Turmas Ativas</div>
                <div class="stat-trend positive" id="classesTrend">
                    <span>ğŸ¯</span>
                    <span>8 turmas</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="attendanceRate">
                    <div class="loading-shimmer">---%</div>
                </div>
                <div class="stat-label">Taxa de PresenÃ§a</div>
                <div class="stat-trend positive" id="attendanceTrend">
                    <span>ğŸ“Š</span>
                    <span>+2% semana</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="monthlyRevenue">
                    <div class="loading-shimmer">R$ ---</div>
                </div>
                <div class="stat-label">Receita Mensal</div>
                <div class="stat-trend positive" id="revenueTrend">
                    <span>ğŸ’°</span>
                    <span>+12% mÃªs</span>
                </div>
            </div>
        </section>

        <!-- Navigation Grid -->
        <section class="nav-grid fade-in">
            <!-- Students Management -->
            <div class="nav-card" onclick="navigateToStudents()">
                <div class="nav-card-badge">Completo</div>
                <div class="nav-card-header">
                    <div class="nav-card-icon">ğŸ‘¥</div>
                    <div>
                        <div class="nav-card-title">GestÃ£o de Alunos</div>
                        <div class="nav-card-subtitle">Cadastro, ediÃ§Ã£o e acompanhamento completo</div>
                    </div>
                </div>
                <div class="nav-card-content">
                    <p>Sistema completo de gerenciamento de alunos com cadastro detalhado, histÃ³rico de presenÃ§a e progresso nas graduaÃ§Ãµes.</p>
                </div>
            </div>

            <!-- Classes Management -->
            <div class="nav-card" onclick="navigateToClasses()">
                <div class="nav-card-badge">Completo</div>
                <div class="nav-card-header">
                    <div class="nav-card-icon">ğŸ«</div>
                    <div>
                        <div class="nav-card-title">GestÃ£o de Turmas</div>
                        <div class="nav-card-subtitle">OrganizaÃ§Ã£o de horÃ¡rios e grupos</div>
                    </div>
                </div>
                <div class="nav-card-content">
                    <p>Organize turmas por nÃ­vel, horÃ¡rio e instrutor. Controle de capacidade e gestÃ£o de conflitos de horÃ¡rio.</p>
                </div>
            </div>

            <!-- Attendance Control -->
            <div class="nav-card" onclick="navigateToAttendance()">
                <div class="nav-card-badge warning">Beta</div>
                <div class="nav-card-header">
                    <div class="nav-card-icon">ğŸ“‹</div>
                    <div>
                        <div class="nav-card-title">Controle de PresenÃ§a</div>
                        <div class="nav-card-subtitle">Registro e acompanhamento de frequÃªncia</div>
                    </div>
                </div>
                <div class="nav-card-content">
                    <p>Sistema de check-in/check-out automÃ¡tico, relatÃ³rios de frequÃªncia e alertas de ausÃªncias.</p>
                </div>
            </div>

            <!-- Financial Management -->
            <div class="nav-card" onclick="navigateToFinancial()">
                <div class="nav-card-badge info">Planejado</div>
                <div class="nav-card-header">
                    <div class="nav-card-icon">ğŸ’°</div>
                    <div>
                        <div class="nav-card-title">GestÃ£o Financeira</div>
                        <div class="nav-card-subtitle">Mensalidades, planos e relatÃ³rios</div>
                    </div>
                </div>
                <div class="nav-card-content">
                    <p>Controle completo de mensalidades, planos de pagamento e relatÃ³rios financeiros detalhados.</p>
                </div>
            </div>

            <!-- Plans Management -->
            <div class="nav-card" onclick="navigateToPlans()">
                <div class="nav-card-badge">Completo</div>
                <div class="nav-card-header">
                    <div class="nav-card-icon">ğŸ“‹</div>
                    <div>
                        <div class="nav-card-title">Planos de Ensino</div>
                        <div class="nav-card-subtitle">CurrÃ­culos e progressÃ£o tÃ©cnica</div>
                    </div>
                </div>
                <div class="nav-card-content">
                    <p>GestÃ£o completa dos planos de ensino, tÃ©cnicas por graduaÃ§Ã£o e acompanhamento de progresso.</p>
                </div>
            </div>

            <!-- Check-in System -->
            <div class="nav-card" onclick="navigateToCheckpoint()">
                <div class="nav-card-badge">Ativo</div>
                <div class="nav-card-header">
                    <div class="nav-card-icon">ğŸ”„</div>
                    <div>
                        <div class="nav-card-title">Check-in RÃ¡pido</div>
                        <div class="nav-card-subtitle">Sistema de entrada e saÃ­da</div>
                    </div>
                </div>
                <div class="nav-card-content">
                    <p>Interface dedicada para check-in/check-out rÃ¡pido dos alunos durante as aulas.</p>
                </div>
            </div>
        </section>

        <!-- Quick Actions -->
        <section class="quick-actions fade-in">
            <div class="quick-actions-header">
                <div class="quick-actions-icon">âš¡</div>
                <div class="quick-actions-title">AÃ§Ãµes RÃ¡pidas</div>
            </div>
            <div class="actions-grid">
                <div class="action-button" onclick="quickAddStudent()">
                    <div class="action-button-icon">ğŸ‘¤</div>
                    <div class="action-button-text">Novo Aluno</div>
                </div>
                <div class="action-button" onclick="quickAddClass()">
                    <div class="action-button-icon">ğŸ«</div>
                    <div class="action-button-text">Nova Turma</div>
                </div>
                <div class="action-button" onclick="quickAttendance()">
                    <div class="action-button-icon">âœ…</div>
                    <div class="action-button-text">Marcar PresenÃ§a</div>
                </div>
                <div class="action-button" onclick="quickReports()">
                    <div class="action-button-icon">ğŸ“Š</div>
                    <div class="action-button-text">RelatÃ³rios</div>
                </div>
            </div>
        </section>
    </main>

    <!-- Enhanced JavaScript -->
    <script>
        // Enhanced Dashboard Controller
        class DashboardController {
            constructor() {
                this.loadStats();
                this.initializeRealTime();
                this.setupAnimations();
            }

            async loadStats() {
                try {
                    const response = await fetch('/api/stats');
                    const data = await response.json();
                    
                    if (data.success) {
                        this.updateStats(data.data);
                    } else {
                        this.showStatsFallback();
                    }
                } catch (error) {
                    console.error('Error loading stats:', error);
                    this.showStatsFallback();
                }
            }

            updateStats(stats) {
                // Remove loading shimmer and update values
                document.getElementById('totalStudents').innerHTML = stats.totalStudents || '0';
                document.getElementById('activeClasses').innerHTML = stats.activeClasses || '0';
                document.getElementById('attendanceRate').innerHTML = (stats.attendanceRate || 0) + '%';
                document.getElementById('monthlyRevenue').innerHTML = 'R$ ' + (stats.monthlyRevenue || '0');
                
                // Update trends
                this.updateTrends(stats);
            }

            updateTrends(stats) {
                if (stats.studentsTrend) {
                    document.getElementById('studentsTrend').innerHTML = 
                        `<span>ğŸ“ˆ</span><span>+${stats.studentsTrend} este mÃªs</span>`;
                }
                
                if (stats.classesTrend) {
                    document.getElementById('classesTrend').innerHTML = 
                        `<span>ğŸ¯</span><span>${stats.classesTrend} turmas</span>`;
                }
                
                if (stats.attendanceTrend) {
                    document.getElementById('attendanceTrend').innerHTML = 
                        `<span>ğŸ“Š</span><span>+${stats.attendanceTrend}% semana</span>`;
                }
                
                if (stats.revenueTrend) {
                    document.getElementById('revenueTrend').innerHTML = 
                        `<span>ğŸ’°</span><span>+${stats.revenueTrend}% mÃªs</span>`;
                }
            }

            showStatsFallback() {
                document.getElementById('totalStudents').innerHTML = '27';
                document.getElementById('activeClasses').innerHTML = '8';
                document.getElementById('attendanceRate').innerHTML = '85%';
                document.getElementById('monthlyRevenue').innerHTML = 'R$ 12.500';
            }

            initializeRealTime() {
                // Update time every second
                setInterval(() => {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('pt-BR', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    document.getElementById('currentTime').textContent = timeString;
                }, 1000);
            }

            setupAnimations() {
                // Add fade-in animation to elements when they come into view
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('fade-in');
                        }
                    });
                });

                document.querySelectorAll('.nav-card, .stat-card, .quick-actions').forEach(el => {
                    observer.observe(el);
                });
            }
        }

        // Navigation Functions
        function navigateToStudents() {
            window.location.href = '/views/students.html';
        }

        function navigateToClasses() {
            window.location.href = '/views/classes.html';
        }

        function navigateToAttendance() {
            window.location.href = '/views/attendance.html';
        }

        function navigateToFinancial() {
            window.location.href = '/views/financial.html';
        }

        function navigateToPlans() {
            window.location.href = '/views/plans.html';
        }

        function navigateToCheckpoint() {
            window.location.href = '/checkpoint.html';
        }

        // Quick Actions
        function quickAddStudent() {
            window.location.href = '/views/student-editor.html';
        }

        function quickAddClass() {
            window.location.href = '/views/class-editor.html';
        }

        function quickAttendance() {
            window.location.href = '/checkpoint.html';
        }

        function quickReports() {
            window.location.href = '/views/reports.html';
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new DashboardController();
        });

        // Service Worker for offline support (if available)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(console.error);
        }
    </script>
</body>
</html>
