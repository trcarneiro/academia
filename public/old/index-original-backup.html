<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•ã Krav Maga Academy - Dashboard</title>

    <!-- üîå CARREGADOR DE M√ìDULOS ISOLADOS - Inline para evitar cache issues -->
    <script>
        // Inline module loader to avoid 404 cache issues
        window.ModuleLoader = {
            loadedModules: new Map(),
            isModuleLoaded: function(moduleName) {
                return this.loadedModules.has(moduleName);
            },
            getLoadedModules: function() {
                return Array.from(this.loadedModules.keys());
            }
        };

    </script>

    <link rel="stylesheet" href="/css/dashboard.css">
    
    <!-- JavaScript Modules -->
    <script src="/js/utils.js"></script>
    <script src="/js/students-management.js"></script>
    <script src="/js/knowledge-base.js"></script>
    <script src="/js/course-creator.js"></script>
</head>
<body>
    <div class="dashboard-container" id="dashboardContainer">
        <!-- Enhanced Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <div class="header-title">
                    <span>ü•ã</span>
                    Krav Academy
                </div>
                <div class="header-ai-status">
                    <span>ü§ñ</span>
                    5 Agentes Ativos
                </div>
            </div>
            <div class="header-actions">
                <button class="quick-action-btn" onclick="toggleSidebar()">
                    ‚ò∞ Menu
                </button>
            </div>
        </header>

        <!-- Enhanced Sidebar -->
        <aside class="dashboard-sidebar" id="dashboardSidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Gest√£o Principal</div>
                <nav>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <button class="nav-link active" data-page="dashboard" data-ai-enabled="true">
                                <span class="nav-icon">üìä</span>
                                Dashboard IA
                            </button>
                        </li>

                        <li class="nav-item">
                            <button class="nav-link" data-page="students" data-ai-enabled="true">
                                <span class="nav-icon">ÔøΩ</span>
                                Gest√£o de Alunos
                                <span class="badge success">INTEGRADO</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="classes" data-ai-enabled="true">
                                <span class="nav-icon">üè´</span>
                                Gest√£o de Turmas
                                <span class="badge success">INTEGRADO</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="evaluations" data-ai-enabled="true">
                                <span class="nav-icon">üìù</span>
                                Avalia√ß√µes
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="progress">
                                <span class="nav-icon">üìà</span>
                                Progresso
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="financial" data-ai-enabled="false">
                                <span class="nav-icon">üí∞</span>
                                Gest√£o Financeira
                                <span class="badge info" id="financial-count">0</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="financial-responsibles" data-ai-enabled="false">
                                <span class="nav-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                                Respons√°veis
                                <span class="badge info" id="responsibles-count">0</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" onclick="window.open('/views/plans.html', '_blank')">
                                <span class="nav-icon">üìÑ</span>
                                Planos da Academia
                                <span class="badge info" id="plans-count">0</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="subscriptions" data-ai-enabled="true">
                                <span class="nav-icon">üí≥</span>
                                Assinaturas
                                <span class="badge info" id="subscriptions-count">0</span>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Infraestrutura</div>
                <nav>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <button class="nav-link" data-page="units" data-ai-enabled="false">
                                <span class="nav-icon">üè¢</span>
                                Unidades
                                <span class="badge info" id="units-count">0</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="mats" data-ai-enabled="false">
                                <span class="nav-icon">ü•ã</span>
                                Tatames
                                <span class="badge info" id="mats-count">0</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="instructors" data-ai-enabled="false">
                                <span class="nav-icon">üë®‚Äçüè´</span>
                                Professores
                                <span class="badge info" id="instructors-count">0</span>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Agentes IA</div>
                <nav>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <button class="nav-link" data-page="course-creator" data-ai-enabled="true">
                                <span class="nav-icon">üéì</span>
                                Course Creator
                                <span class="badge ai-powered">AI</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="lesson-planner" data-ai-enabled="true">
                                <span class="nav-icon">üìã</span>
                                Lesson Planner
                                <span class="badge ai-powered">AI</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="technique-auditor" data-ai-enabled="true">
                                <span class="nav-icon">üîç</span>
                                Tech Auditor
                                <span class="badge ai-powered">AI</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="knowledge-base" data-ai-enabled="true">
                                <span class="nav-icon">üß†</span>
                                Base RAG
                                <span class="badge success">RAG</span>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Ferramentas</div>
                <nav>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <button class="nav-link" data-page="student-portal">
                                <span class="nav-icon">üéØ</span>
                                Portal do Aluno
                                <span class="badge warning">NOVO</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="public-checkin">
                                <span class="nav-icon">üìü</span>
                                Check-in Kiosk
                                <span class="badge warning">KIOSK</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-page="settings">
                                <span class="nav-icon">‚öôÔ∏è</span>
                                Configura√ß√µes
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Enhanced Main Content -->
        <main class="dashboard-main" id="dashboardMain">
            <!-- Dynamic Main Header -->
            <div class="main-header">
                <div>
                    <h1 class="main-title" id="mainTitle">Dashboard</h1>
                    <p class="main-subtitle" id="mainSubtitle">Sistema de gest√£o da academia</p>
                </div>
            </div>

            <!-- Content Sections Container -->
            <div id="contentContainer">
                <!-- Dashboard -->
                <div id="dashboard" class="content-section active">
                    <!-- Enhanced Metrics Grid -->
                    <div class="metric-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="total-students">4</div>
                            <div class="metric-label">Total de Alunos</div>
                            <div class="metric-trend positive">
                                <span>‚Üó</span> +2 este m√™s
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="active-students">4</div>
                            <div class="metric-label">Alunos Ativos</div>
                            <div class="metric-trend positive">
                                <span>‚Üó</span> 100% taxa
                            </div>
                        </div>
                        <div class="metric-card" onclick="toggleAttendanceDetails()" style="cursor: pointer;">
                            <div class="metric-value" id="attendance-rate">85%</div>
                            <div class="metric-label">Taxa de Frequ√™ncia</div>
                            <div class="metric-trend positive">
                                <span>‚Üó</span> +5% vs m√™s anterior
                            </div>
                            <div style="margin-top: 0.5rem; font-size: 0.75rem; color: #CBD5E1;">
                                Clique para ver detalhes
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="current-lesson">15/48</div>
                            <div class="metric-label">Progresso do Curso</div>
                            <div class="metric-trend positive">
                                <span>‚Üó</span> 31% completo
                            </div>
                        </div>
                    </div>

                    <!-- Activity Cards -->
                    <div class="smart-card">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span>üìä</span> Atividades Recentes
                        </h3>
                        <div style="color: #CBD5E1; line-height: 1.6;">
                            <p style="margin: 0.5rem 0;">üéØ <strong>Aula 15 - Defesas B√°sicas</strong> (Hoje)</p>
                            <p style="margin: 0.5rem 0;">üìù <strong>Avalia√ß√£o Maria Silva</strong> - 85.5% (Ontem)</p>
                            <p style="margin: 0.5rem 0;">üë§ <strong>Novo aluno: Carlos Rodrigues</strong> (2 dias atr√°s)</p>
                            <p style="margin: 0.5rem 0;">ü•ã <strong>T√©cnica dominada: Ana Oliveira</strong> - 5 t√©cnicas (3 dias atr√°s)</p>
                        </div>
                    </div>
                </div>

        <!-- Students -->
        <div id="students" class="content-section">
            <!-- Modern Page Header -->
            <div class="page-header" style="background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 style="margin: 0; font-size: 2rem; background: linear-gradient(135deg, #3B82F6, #8B5CF6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üë• Gest√£o de Alunos</h1>
                        <p style="margin: 0.5rem 0 0 0; color: #94A3B8;">Sistema completo de gest√£o de alunos</p>
                    </div>
                    <button onclick="window.location.href='/views/students.html'" class="btn btn-primary" style="background: linear-gradient(135deg, #3B82F6, #8B5CF6); padding: 0.75rem 1.5rem;">
                        <span>‚ûï</span> Novo Aluno
                    </button>
                </div>
            </div>

            <!-- Students Table -->
            <div style="background: #1E293B; border-radius: 12px; padding: 1.5rem; border: 1px solid #374151;">
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid #374151;">
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Nome</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Email</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Telefone</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Turma</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Status</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody">
                            <!-- Students will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Courses -->
        <div id="courses" class="content-section">
            <!-- Modern Page Header -->
            <div class="page-header" style="background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 style="margin: 0; font-size: 2rem; background: linear-gradient(135deg, #3B82F6, #8B5CF6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üìö Gest√£o de Cursos</h1>
                        <p style="margin: 0.5rem 0 0 0; color: #94A3B8; font-size: 1.1rem;">Cadastro, edi√ß√£o e gest√£o de cursos acad√™micos</p>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" onclick="window.location.href='/views/courses.html'" style="background: linear-gradient(135deg, #059669, #10B981); border: none; padding: 0.75rem 1.5rem;">
                            <span>‚ûï</span> Novo Curso
                        </button>
                        <button class="btn btn-secondary" onclick="openRAGCourseCreator()" style="padding: 0.75rem 1.5rem;">
                            <span>ü§ñ</span> Criar com IA
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div style="text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #3B82F6;" id="totalCoursesCount">1</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Cursos Ativos</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #8B5CF6;" id="totalLessonsCount">48</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Planos de Aula</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #10B981;" id="totalTechniquesCount">42</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">T√©cnicas</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #F59E0B;" id="courseProgressCount">31%</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Progresso</div>
                    </div>
                </div>
            </div>

            <!-- Course List Table -->
            <div class="data-table" style="margin-bottom: 2rem;">
                <div class="table-header">
                    <div class="table-title">üìö Lista de Cursos</div>
                    <div class="table-actions">
                        <input type="text" id="courseSearch" placeholder="Buscar cursos..." style="background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem 1rem; border-radius: 8px; min-width: 250px; margin-right: 1rem;" oninput="filterCourses()">
                        <button class="btn btn-secondary" onclick="refreshCourses()" style="margin-right: 0.5rem;">
                            <span>üîÑ</span> Atualizar
                        </button>
                        <button class="btn btn-success" onclick="exportCourses()" style="background: linear-gradient(135deg, #059669, #10B981);">
                            <span>üìä</span> Exportar
                        </button>
                    </div>
                </div>
                <div class="table-container" style="overflow-x: auto;">
                    <table class="data-table-content">
                        <thead>
                            <tr>
                                <th>Nome do Curso</th>
                                <th>Categoria</th>
                                <th>N√≠vel</th>
                                <th>Total de Aulas</th>
                                <th>Alunos</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="courses-table-body">
                            <!-- Course rows will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

        <!-- Classes (Turmas) -->
        <div id="classes" class="content-section">
            <!-- Modern Page Header -->
            <div class="page-header" style="background: linear-gradient(135deg, #059669 0%, #10B981 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 style="margin: 0; font-size: 2rem; background: linear-gradient(135deg, #FFFFFF, #F0FDF4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üè´ Gest√£o de Turmas</h1>
                        <p style="margin: 0.5rem 0 0 0; color: #D1FAE5; font-size: 1.1rem;">Arte marcial com m√∫ltiplos cursos/faixas em execu√ß√£o simult√¢nea</p>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" onclick="createNewClass()" style="background: linear-gradient(135deg, #3B82F6, #1D4ED8); border: none; padding: 0.75rem 1.5rem;">
                            <span>‚ûï</span> Nova Turma
                        </button>
                        <button class="btn btn-secondary" onclick="viewClassSchedule()" style="padding: 0.75rem 1.5rem;">
                            <span>üìÖ</span> Cronograma
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #FFFFFF;" id="totalClassesCount">2</div>
                        <div style="font-size: 0.875rem; color: #D1FAE5;">Turmas Ativas</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #FFFFFF;" id="totalEnrolledStudents">6</div>
                        <div style="font-size: 0.875rem; color: #D1FAE5;">Alunos Total</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #FFFFFF;" id="activeBelts">3</div>
                        <div style="font-size: 0.875rem; color: #D1FAE5;">Cursos Ativos</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #FFFFFF;" id="attendanceRate">85%</div>
                        <div style="font-size: 0.875rem; color: #D1FAE5;">Taxa Presen√ßa</div>
                    </div>
                </div>
            </div>

            <!-- Classes List -->
            <div class="data-table" style="margin-bottom: 2rem;">
                <div class="table-header">
                    <div class="table-title">üè´ Turmas em Andamento</div>
                    <div class="table-actions">
                        <select id="classStatusFilter" onchange="filterClasses()" style="background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem; border-radius: 8px; margin-right: 1rem;">
                            <option value="all">Todas as Turmas</option>
                            <option value="active">Ativas</option>
                            <option value="finished">Finalizadas</option>
                            <option value="paused">Pausadas</option>
                        </select>
                        <button class="btn btn-primary" onclick="createNewClass()">
                            <span>‚ûï</span> Nova Turma
                        </button>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #1E293B; border-bottom: 1px solid #374151;">
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Turma</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Arte Marcial</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Hor√°rio</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Cursos Ativos</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Total Alunos</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">Status</th>
                                <th style="padding: 1rem; text-align: left; color: #F8FAFC; font-weight: 600;">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="classesTableBody">
                            <tr style="border-bottom: 1px solid #374151;">
                                <td style="padding: 1rem; color: #F8FAFC; font-weight: 600;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="background: #059669; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;">T1</span>
                                        Turma 1
                                    </div>
                                </td>
                                <td style="padding: 1rem; color: #CBD5E1;">Krav Maga</td>
                                <td style="padding: 1rem; color: #CBD5E1;">
                                    <div>Ter/Qui - 18:00h</div>
                                    <div style="font-size: 0.75rem; color: #94A3B8;">In√≠cio: 01/06/2025</div>
                                </td>
                                <td style="padding: 1rem; color: #CBD5E1;">
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                        <span style="background: #FFFFFF; color: #000; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">ü•ã Branca</span>
                                        <span style="background: #FDE047; color: #000; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">ü•ã Amarela</span>
                                    </div>
                                </td>
                                <td style="padding: 1rem; color: #CBD5E1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="background: #3B82F6; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem;">4/20</span>
                                        alunos
                                    </div>
                                </td>
                                <td style="padding: 1rem;">
                                    <span style="background: #059669; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">üü¢ Ativa</span>
                                </td>
                                <td style="padding: 1rem;">
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button onclick="viewClassDetails(1)" class="btn btn-small btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">üëÅÔ∏è Ver</button>
                                        <button onclick="manageClassSchedule(1)" class="btn btn-small btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">üìÖ Agenda</button>
                                    </div>
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #374151;">
                                <td style="padding: 1rem; color: #F8FAFC; font-weight: 600;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="background: #8B5CF6; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;">T2</span>
                                        Turma 2
                                    </div>
                                </td>
                                <td style="padding: 1rem; color: #CBD5E1;">Krav Maga</td>
                                <td style="padding: 1rem; color: #CBD5E1;">
                                    <div>Seg/Qua - 19:00h</div>
                                    <div style="font-size: 0.75rem; color: #94A3B8;">In√≠cio: 01/06/2025</div>
                                </td>
                                <td style="padding: 1rem; color: #CBD5E1;">
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                        <span style="background: #FFFFFF; color: #000; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">ü•ã Branca</span>
                                    </div>
                                </td>
                                <td style="padding: 1rem; color: #CBD5E1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="background: #3B82F6; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem;">2/20</span>
                                        alunos
                                    </div>
                                </td>
                                <td style="padding: 1rem;">
                                    <span style="background: #059669; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">üü¢ Ativa</span>
                                </td>
                                <td style="padding: 1rem;">
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button onclick="viewClassDetails(2)" class="btn btn-small btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">üëÅÔ∏è Ver</button>
                                        <button onclick="manageClassSchedule(2)" class="btn btn-small btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">üìÖ Agenda</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Today's Schedule -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">üìÖ Aulas de Hoje</div>
                        <div class="table-actions">
                            <span style="color: #CBD5E1; font-size: 0.875rem;">03/07/2025</span>
                        </div>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #3B82F6;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <div style="color: #F8FAFC; font-weight: 600;">Turma 1 - Krav Maga</div>
                                    <span style="background: #3B82F6; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">18:00</span>
                                </div>
                                <div style="color: #CBD5E1; font-size: 0.875rem; margin-bottom: 0.75rem;">
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                        <div style="background: rgba(255, 255, 255, 0.1); padding: 0.5rem; border-radius: 6px; flex: 1; min-width: 120px;">
                                            <div style="color: #FFFFFF; font-weight: 600; font-size: 0.75rem;">ü§ç Faixa Branca</div>
                                            <div style="color: #D1FAE5; font-size: 0.7rem;">Aula 16: Defesas vs Estrangulamento</div>
                                        </div>
                                        <div style="background: rgba(253, 224, 71, 0.2); padding: 0.5rem; border-radius: 6px; flex: 1; min-width: 120px;">
                                            <div style="color: #FDE047; font-weight: 600; font-size: 0.75rem;">üíõ Faixa Amarela</div>
                                            <div style="color: #D1FAE5; font-size: 0.7rem;">Aula 8: Combina√ß√µes de Golpes</div>
                                        </div>
                                    </div>
                                </div>
                                <div style="color: #94A3B8; font-size: 0.75rem;">4 alunos confirmados (2 Branca + 2 Amarela)</div>
                            </div>
                            <div style="text-align: center; color: #6B7280; padding: 2rem;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üìÖ</div>
                                <p>Apenas 1 aula agendada para hoje</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">üìä Estat√≠sticas Semanais</div>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.25rem; color: #10B981; margin-bottom: 0.5rem;">87%</div>
                                <div style="color: #CBD5E1; font-size: 0.875rem;">Frequ√™ncia Turma 1</div>
                            </div>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.25rem; color: #8B5CF6; margin-bottom: 0.5rem;">83%</div>
                                <div style="color: #CBD5E1; font-size: 0.875rem;">Frequ√™ncia Turma 2</div>
                            </div>
                        </div>

                        <div style="margin-bottom: 1rem;">
                            <h4 style="color: #F8FAFC; margin-bottom: 0.5rem; font-size: 0.875rem;">Pr√≥ximas Avalia√ß√µes por Faixa</h4>
                            <div style="color: #CBD5E1; font-size: 0.875rem; line-height: 1.6;">
                                <div>‚Ä¢ Faixa Branca: M√≥dulo 2 (Semana 20)</div>
                                <div>‚Ä¢ Faixa Amarela: M√≥dulo 1 (Semana 10)</div>
                                <div>‚Ä¢ Faixa Laranja: M√≥dulo 3 (Semana 30)</div>
                            </div>
                        </div>

                        <div>
                            <h4 style="color: #F8FAFC; margin-bottom: 0.5rem; font-size: 0.875rem;">Foco Semanal por Faixa</h4>
                            <div style="color: #CBD5E1; font-size: 0.875rem;">
                                <div style="background: rgba(255, 255, 255, 0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem;">ü§ç Branca: Defesas vs Estrangulamento</div>
                                <div style="background: rgba(253, 224, 71, 0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem;">üíõ Amarela: Combina√ß√µes de Golpes</div>
                                <div style="background: rgba(251, 146, 60, 0.1); padding: 0.5rem; border-radius: 4px;">üß° Laranja: Defesas vs Armas</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="classCapacity" style="display: block; margin-bottom: 0.5rem; color: #CBD5E1; font-weight: 600;">Capacidade M√°xima</label>
                                <input type="number" id="classCapacity" value="20" min="5" max="50" style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC;">
                            </div>
                            <div class="form-group">
                                <label for="classInstructor" style="display: block; margin-bottom: 0.5rem; color: #CBD5E1; font-weight: 600;">Instrutor Principal</label>
                                <input type="text" id="classInstructor" style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC;" placeholder="Nome do instrutor">
                            </div>
                        </div>
                    </div>

                    <!-- Schedule Configuration -->
                    <div class="form-section" style="margin-bottom: 2rem;">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span>‚è∞</span> Configura√ß√£o de Hor√°rios
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #3B82F6;">
                                <h4 style="color: #3B82F6; margin: 0 0 0.5rem 0; font-size: 0.875rem;">Dias da Semana</h4>
                                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;">
                                        <input type="checkbox" id="classMon" style="margin: 0;">
                                        Segunda
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;">
                                        <input type="checkbox" id="classTue" style="margin: 0;">
                                        Ter√ßa
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;">
                                        <input type="checkbox" id="classWed" style="margin: 0;">
                                        Quarta
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;">
                                        <input type="checkbox" id="classThu" style="margin: 0;">
                                        Quinta
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;">
                                        <input type="checkbox" id="classFri" style="margin: 0;">
                                        Sexta
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; font-size: 0.875rem;">
                                        <input type="checkbox" id="classSat" style="margin: 0;">
                                        S√°bado
                                    </label>
                                </div>
                            </div>
                            <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #F59E0B;">
                                <h4 style="color: #F59E0B; margin: 0 0 0.5rem 0; font-size: 0.875rem;">Hor√°rio</h4>
                                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="color: #CBD5E1; font-size: 0.875rem;">In√≠cio:</label>
                                    <input type="time" id="classStartTime" value="18:00" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 6px; color: #F8FAFC;">
                                    <label style="color: #CBD5E1; font-size: 0.875rem;">Fim:</label>
                                    <input type="time" id="classEndTime" value="19:00" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 6px; color: #F8FAFC;">
                                </div>
                            </div>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #8B5CF6;">
                                <h4 style="color: #8B5CF6; margin: 0 0 0.5rem 0; font-size: 0.875rem;">Data de In√≠cio</h4>
                                <input type="date" id="classStartDate" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 6px; color: #F8FAFC; margin-bottom: 0.5rem;">
                                <label style="color: #CBD5E1; font-size: 0.875rem;">Dura√ß√£o (semanas):</label>
                                <input type="number" id="classDuration" value="24" min="4" max="52" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 6px; color: #F8FAFC;">
                            </div>
                        </div>
                    </div>

                    <!-- Courses and Belts Included -->
                    <div class="form-section" style="margin-bottom: 2rem;">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span>ü•ã</span> Cursos/Faixas Inclusos na Turma
                        </h3>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #10B981; margin-bottom: 1rem;">
                            <h4 style="color: #10B981; margin: 0 0 0.5rem 0;">üí° Conceito de Turma Multi-Faixa</h4>
                            <p style="color: #D1FAE5; font-size: 0.875rem; margin: 0; line-height: 1.5;">
                                Uma turma pode ter alunos de diferentes faixas treinando simultaneamente. Cada faixa segue seu pr√≥prio cronograma de t√©cnicas, mas compartilha o mesmo hor√°rio e instrutor.
                            </p>
                        </div>
                        <div id="includedCoursesContainer" style="display: grid; gap: 1rem;">
                            <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #3B82F6;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; margin-bottom: 0.5rem;">
                                    <input type="checkbox" id="includeBranca" checked>
                                    <span style="font-weight: 600;">ü§ç Faixa Branca - Defesa Pessoal 1</span>
                                </label>
                                <div style="color: #94A3B8; font-size: 0.875rem; margin-left: 1.5rem;">
                                    48 aulas ‚Ä¢ T√©cnicas b√°sicas de autodefesa ‚Ä¢ Dura√ß√£o: 24 semanas
                                </div>
                            </div>
                            <div style="background: rgba(253, 224, 71, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #FDE047;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; margin-bottom: 0.5rem;">
                                    <input type="checkbox" id="includeAmarela">
                                    <span style="font-weight: 600;">üíõ Faixa Amarela - Combina√ß√µes</span>
                                </label>
                                <div style="color: #94A3B8; font-size: 0.875rem; margin-left: 1.5rem;">
                                    36 aulas ‚Ä¢ Combina√ß√µes de golpes ‚Ä¢ Dura√ß√£o: 18 semanas
                                </div>
                            </div>
                            <div style="background: rgba(251, 146, 60, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #FB923C;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; margin-bottom: 0.5rem;">
                                    <input type="checkbox" id="includeLaranja">
                                    <span style="font-weight: 600;">üß° Faixa Laranja - Defesas Avan√ßadas</span>
                                </label>
                                <div style="color: #94A3B8; font-size: 0.875rem; margin-left: 1.5rem;">
                                    40 aulas ‚Ä¢ Defesas contra armas ‚Ä¢ Dura√ß√£o: 20 semanas
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #374151;">
                        <button type="button" onclick="deleteClass()" id="deleteClassBtn" style="background: #DC2626; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; display: none;">
                            <span>üóëÔ∏è</span> Deletar Turma
                        </button>
                        <div style="display: flex; gap: 1rem;">
                            <button type="button"  style="background: #6B7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                                Cancelar
                            </button>
                            <button type="submit" style="background: linear-gradient(135deg, #059669, #10B981); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                                <span>üíæ</span> Salvar Turma
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

                            <div style="margin-top: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: #CBD5E1; font-weight: 600;">Descri√ß√£o</label>
                                <textarea id="planDescription" rows="3" style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC; resize: vertical;" placeholder="Acesso ilimitado a m√∫ltiplas turmas e faixas..."></textarea>
                            </div>
                        </div>

                        <!-- Included Classes Selection -->
                        <div style="margin-bottom: 2rem;">
                            <h3 style="color: #F8FAFC; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span>üè´</span> Turmas Inclu√≠das no Plano
                            </h3>
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #10B981; margin-bottom: 1rem;">
                                <h4 style="color: #10B981; margin: 0 0 0.5rem 0;">üí° Auto-Atribui√ß√£o de Turmas</h4>
                                <p style="color: #D1FAE5; font-size: 0.875rem; margin: 0; line-height: 1.5;">
                                    Quando um aluno receber este plano, ser√° automaticamente inscrito nas turmas selecionadas abaixo. Turmas adicionais poder√£o ser inclu√≠das manualmente depois.
                                </p>
                            </div>

                            <div id="availableClassesForPlan" style="display: grid; gap: 1rem;">
                                <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #3B82F6;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; margin-bottom: 0.5rem;">
                                        <input type="checkbox" id="planIncludeClass1" value="class1">
                                        <span style="font-weight: 600;">üè´ Turma 1 - Krav Maga (Ter/Qui 18h)</span>
                                    </label>
                                    <div style="color: #94A3B8; font-size: 0.875rem; margin-left: 1.5rem;">
                                        Faixas: Branca, Amarela ‚Ä¢ 4 alunos ativos ‚Ä¢ Capacidade: 20
                                    </div>
                                </div>
                                <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #8B5CF6;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1; margin-bottom: 0.5rem;">
                                        <input type="checkbox" id="planIncludeClass2" value="class2">
                                        <span style="font-weight: 600;">üè´ Turma 2 - Krav Maga (Seg/Qua 19h)</span>
                                    </label>
                                    <div style="color: #94A3B8; font-size: 0.875rem; margin-left: 1.5rem;">
                                        Faixas: Branca, Laranja ‚Ä¢ 2 alunos ativos ‚Ä¢ Capacidade: 20
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #374151;">
                            <div style="display: flex; gap: 1rem;">
                                <button type="button"  style="background: #6B7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                                    Cancelar
                                </button>
                                <button type="submit" style="background: linear-gradient(135deg, #7C3AED, #8B5CF6); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                                    <span>üíé</span> Criar Plano Premium
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Evaluations -->
        <div id="evaluations" class="content-section">
            <div class="page-header">
                <h1>Sistema de Avalia√ß√µes</h1>
                <p>Avalia√ß√µes e desempenho dos alunos</p>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <div class="table-title">Avalia√ß√µes Registradas</div>
                </div>
                <div style="color: #CBD5E1;">
                    <p><strong>Maria Silva</strong></p>
                    <p>‚Ä¢ Aula 10: 85.5% de precis√£o</p>
                    <p>‚Ä¢ Status: AUTONOMIA</p>
                    <p>‚Ä¢ T√©cnicas avaliadas: 8</p>
                    <br>
                    <p><em>Outras avalia√ß√µes ser√£o exibidas aqui conforme forem registradas.</em></p>
                </div>
            </div>
        </div>

        <!-- Progress -->
        <div id="progress" class="content-section">
            <div class="page-header">
                <h1>Progresso dos Alunos</h1>
                <p>Acompanhamento de evolu√ß√£o individual</p>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <div class="table-title">Progresso Individual</div>
                </div>
                <div style="color: #CBD5E1;">
                    <p><strong>Ana Oliveira</strong></p>
                    <p>‚Ä¢ T√©cnicas dominadas: 5</p>
                    <p>‚Ä¢ Pontos acumulados: 65</p>
                    <p>‚Ä¢ Desafios completados: 2</p>
                    <br>
                    <p><em>Outros progressos ser√£o exibidos conforme registrados.</em></p>
                </div>
            </div>
        </div>

        <!-- Financial Module -->
        <div id="financial" class="content-section">
            <div class="page-header">
                <h1>üí∞ Gest√£o Financeira</h1>
                <p>Controle de recebimentos, gastos, fluxo de caixa e relat√≥rios financeiros</p>
            </div>

            <!-- Financial Overview Cards -->
            <div class="metric-grid" style="margin-bottom: 2rem;">
                <div class="metric-card">
                    <div class="metric-value" id="total-revenue">R$ 0</div>
                    <div class="metric-label">Receita Total</div>
                    <div class="metric-trend positive">
                        <span>‚Üó</span> +0% este m√™s
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="active-subscriptions">0</div>
                    <div class="metric-label">Assinaturas Ativas</div>
                    <div class="metric-trend positive">
                        <span>‚Üó</span> 100% pagamento
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="pending-payments">0</div>
                    <div class="metric-label">Pendentes</div>
                    <div class="metric-trend neutral">
                        <span>‚Üí</span> 0 em atraso
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="total-plans">0</div>
                    <div class="metric-label">Planos Ativos</div>
                    <div class="metric-trend positive">
                        <span>‚Üó</span> Dispon√≠veis
                    </div>
                </div>
            </div>

            <!-- Financial Tabs -->
            <div class="financial-tabs" style="margin-bottom: 2rem;">
                <button class="financial-tab active" onclick="switchFinancialTab('revenues')">
                    üí∞ Recebimentos
                </button>
                <button class="financial-tab" onclick="switchFinancialTab('expenses')">
                    üí∏ Gastos
                </button>
                <button class="financial-tab" onclick="switchFinancialTab('payments')">
                    üí≥ Pagamentos
                </button>
                <button class="financial-tab" onclick="switchFinancialTab('settings')">
                    ‚öôÔ∏è Configura√ß√µes
                </button>
            </div>

            <!-- Revenues Management -->
            <div id="financial-revenues" class="financial-tab-content active">
                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">üí∞ Controle de Recebimentos</div>
                        <div class="table-actions">
                            <button class="btn btn-primary" >
                                <span>‚ûï</span>
                                Novo Recebimento
                            </button>
                        </div>
                    </div>

                    <table class="students-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Descri√ß√£o</th>
                                <th>Categoria</th>
                                <th>Aluno/Cliente</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="revenuesTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; color: #CBD5E1; padding: 2rem;">
                                    üí∞ M√≥dulo de Recebimentos em desenvolvimento
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Expenses Management -->
            <div id="financial-expenses" class="financial-tab-content" style="display: none;">
                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">üí∏ Controle de Gastos</div>
                        <div class="table-actions">
                            <button class="btn btn-primary" >
                                <span>‚ûï</span>
                                Novo Gasto
                            </button>
                        </div>
                    </div>

                    <table class="students-table">
                        <thead>
                            <tr>
                                <th>Categoria</th>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                                <th>Pr√≥ximo Vencimento</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="expensesTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; color: #CBD5E1; padding: 2rem;">
                                    Nenhum gasto registrado
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Payments Management -->
            <div id="financial-payments" class="financial-tab-content" style="display: none;">
                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">üí≥ Controle de Pagamentos</div>
                    </div>

                    <table class="students-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Aluno</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>M√©todo</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; color: #CBD5E1; padding: 2rem;">
                                    Carregando pagamentos...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Financial Settings -->
            <div id="financial-settings" class="financial-tab-content" style="display: none;">
                <div class="settings-section">
                    <h3>‚öôÔ∏è Configura√ß√µes Financeiras</h3>

                    <div class="form-group">
                        <label>Integra√ß√£o de Pagamento</label>
                        <select class="form-input">
                            <option value="asaas">Asaas</option>
                            <option value="stripe">Stripe</option>
                            <option value="pagseguro">PagSeguro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Dias para Vencimento</label>
                        <input type="number" class="form-input" value="5" min="1" max="30">
                    </div>

                    <div class="form-group">
                        <label>Multa por Atraso (%)</label>
                        <input type="number" class="form-input" value="2" min="0" max="10" step="0.1">
                    </div>

                    <div class="form-group">
                        <label>Juros por Dia (%)</label>
                        <input type="number" class="form-input" value="0.033" min="0" max="1" step="0.001">
                    </div>

                    <button class="btn btn-primary">Salvar Configura√ß√µes</button>
                </div>
            </div>
        </div>

        <!-- Challenges -->
        <div id="challenges" class="content-section">
            <div class="page-header">
                <h1>Desafios Semanais</h1>
                <p>Sistema de desafios e gamifica√ß√£o</p>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <div class="table-title">Desafios Dispon√≠veis</div>
                </div>
                <div style="color: #CBD5E1;">
                    <p>‚Ä¢ 24 desafios catalogados</p>
                    <p>‚Ä¢ Adaptados por categoria e g√™nero</p>
                    <p>‚Ä¢ Sistema de pontos integrado</p>
                    <br>
                    <p><em>Interface de desafios em desenvolvimento.</em></p>
                </div>
            </div>
        </div>

        <!-- Knowledge Base -->
        <div id="knowledge-base" class="content-section">
            <div class="page-header">
                <h1>üß† Base de Conhecimento</h1>
                <p>Mem√≥ria central dos agentes IA - Upload de documentos, textos, links e v√≠deos</p>
            </div>

            <div style="display: grid; gap: 1.5rem;">
                <!-- Knowledge Base Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #8B5CF6;">
                        <div style="color: #8B5CF6; font-weight: bold; margin-bottom: 0.5rem;">üìö Documentos</div>
                        <div style="color: #F8FAFC; font-size: 1.5rem; font-weight: bold;" id="knowledgeStatsDocuments">0</div>
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #10B981;">
                        <div style="color: #10B981; font-weight: bold; margin-bottom: 0.5rem;">üï∞Ô∏è Chunks RAG</div>
                        <div style="color: #F8FAFC; font-size: 1.5rem; font-weight: bold;" id="knowledgeStatsChunks">0</div>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #3B82F6;">
                        <div style="color: #3B82F6; font-weight: bold; margin-bottom: 0.5rem;">‚è±Ô∏è √öltima Indexa√ß√£o</div>
                        <div style="color: #F8FAFC; font-size: 0.875rem;" id="knowledgeStatsLastUpdate">Nunca</div>
                    </div>
                    <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #F59E0B;">
                        <div style="color: #F59E0B; font-weight: bold; margin-bottom: 0.5rem;">‚öôÔ∏è Status RAG</div>
                        <div style="color: #F8FAFC; font-size: 0.875rem;" id="knowledgeStatsStatus">Vazio</div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="openKnowledgeUploader()">
                        <span>‚ûï</span> Adicionar Conte√∫do
                    </button>
                    <button class="btn btn-success" onclick="reindexKnowledgeBase()">
                        <span>‚ö°</span> Reindexar Base
                    </button>
                    <button class="btn btn-secondary" onclick="searchKnowledgeBase()">
                        <span>üîç</span> Buscar
                    </button>
                </div>

                <!-- Knowledge Base Content -->
                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">Conte√∫do da Base de Conhecimento</div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="text" id="knowledgeSearchInput" placeholder="Buscar na base..." style="padding: 0.5rem; border-radius: 4px; border: 1px solid #374151; background: #1F2937; color: #F8FAFC; width: 200px;" onkeyup="if(event.key==='Enter') searchKnowledgeBase()">
                            <button class="btn btn-sm btn-primary" onclick="searchKnowledgeBase()">üîç</button>
                        </div>
                    </div>
                    <div id="knowledgeContentDisplay" style="min-height: 300px;">
                        <div style="text-align: center; color: #9CA3AF; padding: 3rem;">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">üìö</div>
                            <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">Base de Conhecimento Vazia</div>
                            <div style="font-size: 0.9rem;">Adicione documentos, textos, links ou v√≠deos para come√ßar</div>
                            <div style="margin-top: 1rem;">
                                <button class="btn btn-primary" onclick="openKnowledgeUploader()">
                                    ‚ûï Adicionar Primeiro Conte√∫do
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Responsibles -->
        <div id="financial-responsibles" class="content-section">
            <div class="page-header">
                <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Respons√°veis Financeiros</h1>
                <p>Gest√£o de respons√°veis financeiros dos alunos</p>
            </div>

            <!-- Quick Stats -->
            <div class="stats-grid" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-value" id="totalResponsibles">0</div>
                    <div class="stat-label">Total de Respons√°veis</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeResponsibles">0</div>
                    <div class="stat-label">Ativos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="studentsWithResponsibles">0</div>
                    <div class="stat-label">Alunos com Respons√°vel</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgStudentsPerResponsible">0</div>
                    <div class="stat-label">M√©dia p/ Respons√°vel</div>
                </div>
            </div>

            <!-- Search and Actions -->
            <div class="simple-search">
                <input type="text" 
                       id="responsibleSearch" 
                       class="search-input"
                       placeholder="üîç Buscar por nome, CPF, email..." 
                       onkeyup="filterResponsibles()"
                       autocomplete="off">

                <button class="btn btn-primary" >
                    <span>‚ûï</span>
                    Novo Respons√°vel
                </button>
            </div>

            <!-- Responsibles Table -->
            <div class="data-table">
                <div class="table-header">
                    <div class="table-title">Lista de Respons√°veis Financeiros</div>
                </div>
                <div class="responsibles-table-container">
                    <table class="students-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CPF/CNPJ</th>
                                <th>Email</th>
                                <th>Telefone</th>
                                <th>Rela√ß√£o</th>
                                <th>Alunos</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="responsiblesTableBody">
                            <!-- Responsibles will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div id="responsiblesLoadingState" class="loading-state">
                    <div style="text-align: center; color: #CBD5E1; padding: 3rem;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                        <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">Carregando respons√°veis...</div>
                        <div style="font-size: 0.9rem; opacity: 0.7;">Conectando com a base de dados</div>
                    </div>
                </div>
                <div id="responsiblesEmptyState" class="empty-state" style="display: none;">
                    <div style="text-align: center; color: #CBD5E1; padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                        <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">Nenhum respons√°vel encontrado</div>
                        <div style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;">Comece adicionando o primeiro respons√°vel financeiro</div>
                        <button class="btn btn-primary" >
                            <span>‚ûï</span>
                            Adicionar Primeiro Respons√°vel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Plan Edit Page removed -->

        <!-- Subscriptions Management -->
        <div id="subscriptions" class="content-section">
            <!-- Modern Page Header -->
            <div class="page-header" style="background: linear-gradient(135deg, #059669 0%, #10B981 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 style="margin: 0; font-size: 2rem; background: linear-gradient(135deg, #FFFFFF, #D1FAE5); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üí≥ Gest√£o de Assinaturas</h1>
                        <p style="margin: 0.5rem 0 0 0; color: #D1FAE5; font-size: 1.1rem;">Gerencie assinaturas ativas dos alunos, planos contratados e status de pagamento</p>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary"  style="background: linear-gradient(135deg, #3B82F6, #1D4ED8); border: none; padding: 0.75rem 1.5rem;">
                            <span>‚ûï</span> Nova Assinatura
                        </button>
                        <button class="btn btn-secondary" onclick="loadSubscriptionsList()" style="padding: 0.75rem 1.5rem;">
                            <span>üîÑ</span> Atualizar
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #FFFFFF;" id="totalSubscriptionsCount">0</div>
                        <div style="font-size: 0.875rem; color: #D1FAE5;">Total Assinaturas</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #FFFFFF;" id="activeSubscriptionsCount">0</div>
                        <div style="font-size: 0.875rem; color: #D1FAE5;">Ativas</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #FFFFFF;" id="pendingSubscriptionsCount">0</div>
                        <div style="font-size: 0.875rem; color: #D1FAE5;">Pendentes</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #FFFFFF;" id="totalSubscriptionRevenue">R$ 0</div>
                        <div style="font-size: 0.875rem; color: #D1FAE5;">Receita Total</div>
                    </div>
                </div>
            </div>

            <!-- Search and Filters -->
            <div class="data-controls" style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center;">
                <div style="flex: 1; position: relative;">
                    <input type="text" id="subscriptionSearchInput" placeholder="üîç Buscar por aluno, e-mail ou plano..." 
                           style="width: 100%; padding: 0.75rem 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 12px; color: #F8FAFC; font-size: 0.875rem;"
                           onkeyup="filterSubscriptions()">
                </div>
                <select id="subscriptionStatusFilter" onchange="filterSubscriptions()" 
                        style="padding: 0.75rem 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC; font-size: 0.875rem;">
                    <option value="">Todos Status</option>
                    <option value="ACTIVE">Ativa</option>
                    <option value="PENDING">Pendente</option>
                    <option value="SUSPENDED">Suspensa</option>
                    <option value="CANCELLED">Cancelada</option>
                    <option value="EXPIRED">Expirada</option>
                </select>
                <select id="subscriptionPlanFilter" onchange="filterSubscriptions()" 
                        style="padding: 0.75rem 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC; font-size: 0.875rem;">
                    <option value="">Todos Planos</option>
                </select>
            </div>

            <!-- Data Table -->
            <div class="table-container">
                <table class="data-table-content">
                    <thead>
                        <tr>
                            <th>Aluno</th>
                            <th>Plano</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>In√≠cio</th>
                            <th>Pr√≥ximo Pagamento</th>
                            <th>M√©todo</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="subscriptionsTableBody">
                        <!-- Subscriptions will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Loading States -->
            <div id="subscriptionsLoadingState" class="loading-state">
                <div style="text-align: center; color: #CBD5E1; padding: 3rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üí≥</div>
                    <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">Carregando assinaturas...</div>
                    <div style="font-size: 0.9rem; opacity: 0.7;">Conectando com a base de dados</div>
                </div>
            </div>
            <div id="subscriptionsEmptyState" class="empty-state" style="display: none;">
                <div style="text-align: center; color: #CBD5E1; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üí≥</div>
                    <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">Nenhuma assinatura encontrada</div>
                    <div style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;">Comece criando a primeira assinatura</div>
                    <button class="btn btn-primary" >
                        <span>‚ûï</span>
                        Criar Primeira Assinatura
                    </button>
                </div>
            </div>
        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <!-- Start Date -->
                            <div class="form-group">
                                <label class="form-label">üìÖ Data de In√≠cio *</label>
                                <input type="date" id="subscriptionStartDate" class="form-control" required>
                            </div>

                            <!-- Payment Method -->
                            <div class="form-group">
                                <label class="form-label">üí≥ M√©todo de Pagamento *</label>
                                <select id="subscriptionPaymentMethod" class="form-control" required>
                                    <option value="">Selecione</option>
                                    <option value="CREDIT_CARD">Cart√£o de Cr√©dito</option>
                                    <option value="DEBIT_CARD">Cart√£o de D√©bito</option>
                                    <option value="PIX">PIX</option>
                                    <option value="BANK_SLIP">Boleto Banc√°rio</option>
                                    <option value="CASH">Dinheiro</option>
                                    <option value="BANK_TRANSFER">Transfer√™ncia</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <!-- Payment Day -->
                            <div class="form-group">
                                <label class="form-label">üìÜ Dia do Pagamento</label>
                                <select id="subscriptionPaymentDay" class="form-control">
                                    <option value="">Auto (data de in√≠cio)</option>
                                    <option value="1">1</option>
                                    <option value="5">5</option>
                                    <option value="10">10</option>
                                    <option value="15">15</option>
                                    <option value="20">20</option>
                                    <option value="25">25</option>
                                    <option value="30">30</option>
                                </select>
                            </div>

                            <!-- Status -->
                            <div class="form-group">
                                <label class="form-label">üìä Status *</label>
                                <select id="subscriptionStatus" class="form-control" required>
                                    <option value="ACTIVE">Ativa</option>
                                    <option value="PENDING">Pendente</option>
                                    <option value="SUSPENDED">Suspensa</option>
                                    <option value="CANCELLED">Cancelada</option>
                                </select>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="form-group">
                            <label class="form-label">üìù Observa√ß√µes</label>
                            <textarea id="subscriptionNotes" class="form-control" rows="3" placeholder="Observa√ß√µes sobre a assinatura..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" >Cancelar</button>
                        <button type="submit" class="btn btn-primary">üíæ Salvar Assinatura</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Units Management -->
        <div id="units" class="content-section">
            <div class="page-header" style="background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 style="margin: 0; font-size: 2rem; background: linear-gradient(135deg, #3B82F6, #8B5CF6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üè¢ Gest√£o de Unidades</h1>
                        <p style="margin: 0.5rem 0 0 0; color: #94A3B8; font-size: 1.1rem;">Administre locais, endere√ßos e capacidades das unidades da academia</p>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary"  style="background: linear-gradient(135deg, #059669, #10B981); border: none; padding: 0.75rem 1.5rem;">
                            <span>‚ûï</span> Nova Unidade
                        </button>
                        <button class="btn btn-secondary" onclick="loadUnits()" style="padding: 0.75rem 1.5rem;">
                            <span>üîÑ</span> Atualizar
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div style="text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #3B82F6;" id="totalUnitsCount">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Unidades</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #8B5CF6;" id="totalMatsCount">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Tatames</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #10B981;" id="totalCapacityCount">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Capacidade Total</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #F59E0B;" id="activeClassesCount">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Turmas Ativas</div>
                    </div>
                </div>
            </div>

            <!-- Units Table -->
            <div class="data-table">
                <div class="table-header">
                    <div class="table-title">üìã Lista de Unidades</div>
                    <div class="table-actions">
                        <input type="text" placeholder="üîç Buscar unidade..." 
                               style="background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem 1rem; border-radius: 8px; margin-right: 1rem;" 
                               id="unitsSearchInput" onkeyup="searchUnits()">
                        <button class="btn btn-secondary" onclick="exportUnitsReport()">
                            üìä Relat√≥rio
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table-content">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Endere√ßo</th>
                                <th>Tatames</th>
                                <th>Capacidade</th>
                                <th>Turmas</th>
                                <th>Respons√°vel</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="unitsTableBody">
                            <!-- Units will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div id="unitsLoadingState" class="loading-state">
                    <div style="text-align: center; color: #CBD5E1; padding: 3rem;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üè¢</div>
                        <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">Carregando unidades...</div>
                        <div style="font-size: 0.9rem; opacity: 0.7;">Conectando com a base de dados</div>
                    </div>
                </div>
                <div id="unitsEmptyState" class="empty-state" style="display: none;">
                    <div style="text-align: center; color: #CBD5E1; padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üè¢</div>
                        <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">Nenhuma unidade encontrada</div>
                        <div style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;">Comece cadastrando a primeira unidade da academia</div>
                        <button class="btn btn-primary" >
                            <span>‚ûï</span>
                            Criar Primeira Unidade
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mats Management -->
        <div id="mats" class="content-section">
            <div class="page-header" style="background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 style="margin: 0; font-size: 2rem; background: linear-gradient(135deg, #8B5CF6, #EC4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ü•ã Gest√£o de Tatames</h1>
                        <p style="margin: 0.5rem 0 0 0; color: #94A3B8; font-size: 1.1rem;">Administre espa√ßos de treinamento, equipamentos e capacidades</p>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary"  style="background: linear-gradient(135deg, #7C3AED, #8B5CF6); border: none; padding: 0.75rem 1.5rem;">
                            <span>‚ûï</span> Novo Tatame
                        </button>
                        <button class="btn btn-secondary" onclick="loadMats()" style="padding: 0.75rem 1.5rem;">
                            <span>üîÑ</span> Atualizar
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div style="text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #8B5CF6;" id="matsCount">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Total Tatames</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #10B981;" id="matsCapacity">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Capacidade Total</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #3B82F6;" id="matsInUse">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Em Uso</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #F59E0B;" id="matsAvailable">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Dispon√≠veis</div>
                    </div>
                </div>
            </div>

            <!-- Filter by Unit -->
            <div style="background: #1E293B; border-radius: 12px; padding: 1rem; margin-bottom: 2rem; border: 1px solid #334155;">
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <label style="color: #CBD5E1; font-weight: 600;">Filtrar por Unidade:</label>
                    <select id="unitFilter" onchange="filterMatsByUnit()" style="background: #0F172A; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem 1rem; border-radius: 8px; min-width: 200px;">
                        <option value="">Todas as Unidades</option>
                        <!-- Options will be loaded dynamically -->
                    </select>
                    <button class="btn btn-secondary" onclick="clearMatFilters()" style="padding: 0.5rem 1rem;">
                        <span>üßπ</span> Limpar Filtros
                    </button>
                </div>
            </div>

            <!-- Mats Table -->
            <div class="data-table">
                <div class="table-header">
                    <div class="table-title">üìã Lista de Tatames</div>
                    <div class="table-actions">
                        <input type="text" placeholder="üîç Buscar tatame..." 
                               style="background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem 1rem; border-radius: 8px; margin-right: 1rem;" 
                               id="matsSearchInput" onkeyup="searchMats()">
                        <button class="btn btn-secondary" onclick="exportMatsReport()">
                            üìä Relat√≥rio
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table-content">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Unidade</th>
                                <th>Capacidade</th>
                                <th>Dimens√µes</th>
                                <th>Equipamentos</th>
                                <th>Turmas</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="matsTableBody">
                            <!-- Mats will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div id="matsLoadingState" class="loading-state">
                    <div style="text-align: center; color: #CBD5E1; padding: 3rem;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">ü•ã</div>
                        <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">Carregando tatames...</div>
                        <div style="font-size: 0.9rem; opacity: 0.7;">Conectando com a base de dados</div>
                    </div>
                </div>
                <div id="matsEmptyState" class="empty-state" style="display: none;">
                    <div style="text-align: center; color: #CBD5E1; padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ü•ã</div>
                        <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">Nenhum tatame encontrado</div>
                        <div style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;">Comece cadastrando o primeiro tatame</div>
                        <button class="btn btn-primary" >
                            <span>‚ûï</span>
                            Criar Primeiro Tatame
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructors Management -->
        <div id="instructors" class="content-section">
            <div class="page-header" style="background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 style="margin: 0; font-size: 2rem; background: linear-gradient(135deg, #F59E0B, #EF4444); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üë®‚Äçüè´ Gest√£o de Professores</h1>
                        <p style="margin: 0.5rem 0 0 0; color: #94A3B8; font-size: 1.1rem;">Administre instrutores, especializa√ß√µes e hor√°rios dispon√≠veis</p>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary"  style="background: linear-gradient(135deg, #F59E0B, #EF4444); border: none; padding: 0.75rem 1.5rem;">
                            <span>‚ûï</span> Novo Professor
                        </button>
                        <button class="btn btn-secondary" onclick="loadInstructors()" style="padding: 0.75rem 1.5rem;">
                            <span>üîÑ</span> Atualizar
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div style="text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #F59E0B;" id="instructorsCount">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Professores</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #10B981;" id="instructorsActive">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Ativos</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #3B82F6;" id="instructorsWithClasses">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Com Turmas</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #8B5CF6;" id="avgExperience">0</div>
                        <div style="font-size: 0.875rem; color: #CBD5E1;">Anos Experi√™ncia</div>
                    </div>
                </div>
            </div>

            <!-- Instructors Table -->
            <div class="data-table">
                <div class="table-header">
                    <div class="table-title">üìã Lista de Professores</div>
                    <div class="table-actions">
                        <input type="text" placeholder="üîç Buscar professor..." 
                               style="background: #1E293B; border: 1px solid #374151; color: #F8FAFC; padding: 0.5rem 1rem; border-radius: 8px; margin-right: 1rem;" 
                               id="instructorsSearchInput" onkeyup="searchInstructors()">
                        <button class="btn btn-secondary" onclick="exportInstructorsReport()">
                            üìä Relat√≥rio
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table-content">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Especializa√ß√µes</th>
                                <th>Artes Marciais</th>
                                <th>Experi√™ncia</th>
                                <th>Turmas</th>
                                <th>Valor/Hora</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="instructorsTableBody">
                            <!-- Instructors will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div id="instructorsLoadingState" class="loading-state">
                    <div style="text-align: center; color: #CBD5E1; padding: 3rem;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üë®‚Äçüè´</div>
                        <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">Carregando professores...</div>
                        <div style="font-size: 0.9rem; opacity: 0.7;">Conectando com a base de dados</div>
                    </div>
                </div>
                <div id="instructorsEmptyState" class="empty-state" style="display: none;">
                    <div style="text-align: center; color: #CBD5E1; padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üë®‚Äçüè´</div>
                        <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">Nenhum professor encontrado</div>
                        <div style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 1.5rem;">Comece cadastrando o primeiro professor</div>
                        <button class="btn btn-primary" >
                            <span>‚ûï</span>
                            Cadastrar Primeiro Professor
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings -->
        <div id="settings" class="content-section">
            <div class="page-header">
                <h1>Configura√ß√µes</h1>
                <p>Configura√ß√µes gerais do sistema</p>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <div class="table-title">Status do Sistema</div>
                </div>
                <div style="color: #CBD5E1;">
                    <p>‚Ä¢ Banco de dados: ‚úÖ Conectado</p>
                    <p>‚Ä¢ APIs: ‚úÖ 27 endpoints funcionais</p>
                    <p>‚Ä¢ Frontend: ‚úÖ Interface responsiva</p>
                    <p>‚Ä¢ Dados: ‚úÖ 4 alunos, 42 t√©cnicas, 48 aulas</p>
                </div>
            </div>
        </div>
    </main>

                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" >Cancelar</button>
                    <button type="submit" class="btn btn-primary">Adicionar Aluno</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Student Modal - Complete Version -->

                        </div>
                        <div style="text-align: right;">
                            <div style="background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.875rem;">
                                üíæ Modificado h√° <span id="editStudentLastModified">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Tabs Navigation -->
                <div style="padding: 0 2rem; background: #1E293B; border-bottom: 1px solid #334155;">
                    <div style="display: flex; gap: 0;">
                        <!-- Primary Tab (Edit) -->
                        <button class="edit-tab-btn active primary" onclick="switchEditTab('edit')" data-tab="edit" 
                                style="padding: 1rem 2rem; background: linear-gradient(135deg, #3B82F6, #1D4ED8); border: none; color: white; border-radius: 8px 8px 0 0; font-weight: 700; cursor: pointer; position: relative; z-index: 2; margin-right: 1rem;">
                            ‚úèÔ∏è Editar Dados
                        </button>
                        <!-- Secondary Tabs (View) -->
                        <div style="display: flex; gap: 0.25rem; align-items: end;">
                            <button class="edit-tab-btn secondary" onclick="switchEditTab('overview')" data-tab="overview" 
                                    style="padding: 0.75rem 1.25rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 500; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">
                                üìã Vis√£o Geral
                            </button>
                            <button class="edit-tab-btn secondary" onclick="switchEditTab('academic')" data-tab="academic" 
                                    style="padding: 0.75rem 1.25rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 500; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">
                                üéì Acad√™mico
                            </button>
                            <button class="edit-tab-btn secondary" onclick="switchEditTab('financial')" data-tab="financial" 
                                    style="padding: 0.75rem 1.25rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 500; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">
                                üí∞ Financeiro
                            </button>
                            <button class="edit-tab-btn secondary" onclick="switchEditTab('progress')" data-tab="progress" 
                                    style="padding: 0.75rem 1.25rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 500; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">
                                üìà Progresso
                            </button>
                            <button class="edit-tab-btn secondary" onclick="switchEditTab('activity')" data-tab="activity" 
                                    style="padding: 0.75rem 1.25rem; background: transparent; border: none; color: #94A3B8; border-bottom: 2px solid transparent; font-weight: 500; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">
                                üìä Atividades
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tab Contents -->
                <div style="padding: 2rem;">
                    <!-- Edit Tab -->
                    <div id="edit-tab-edit" class="edit-tab-content">
                        <!-- Progress Indicator -->
                        <div style="background: #0F172A; padding: 1rem 2rem; margin: -2rem -2rem 2rem -2rem; border-bottom: 1px solid #334155;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <h3 style="color: #F8FAFC; margin: 0; font-size: 1.1rem;">üìù Editando Perfil</h3>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                                        <div style="width: 8px; height: 8px; background: #10B981; border-radius: 50%;"></div>
                                        <span style="color: #10B981; font-size: 0.875rem;">Dados salvos automaticamente</span>
                                    </div>
                                    <button type="button" onclick="autoFillDemo()" style="background: rgba(139, 92, 246, 0.1); border: 1px solid #8B5CF6; color: #8B5CF6; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; cursor: pointer;">
                                        üéØ Preencher Demo
                                    </button>
                                </div>
                            </div>
                            <div style="background: #1E293B; border-radius: 6px; height: 4px; overflow: hidden;">
                                <div id="editFormProgress" style="background: linear-gradient(90deg, #3B82F6, #10B981); height: 100%; width: 20%; transition: width 0.3s ease;"></div>
                            </div>
                        </div>

                        <form id="editStudentForm" onchange="updateFormProgress()">
                            <input type="hidden" id="editStudentId" name="editStudentId">
                            <input type="hidden" id="editUserId" name="editUserId">

                            <!-- Step 1: Informa√ß√µes Pessoais -->
                            <div class="form-section" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05)); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #3B82F6, #1D4ED8); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;">1</div>
                                    <h3 style="color: #F8FAFC; margin: 0; font-size: 1.1rem;">üë§ Dados Pessoais</h3>
                                    <div style="flex: 1; height: 1px; background: linear-gradient(90deg, #3B82F6, transparent);"></div>
                                </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editFirstName">Nome *</label>
                                <input type="text" id="editFirstName" name="editFirstName" required>
                            </div>
                            <div class="form-group">
                                <label for="editLastName">Sobrenome *</label>
                                <input type="text" id="editLastName" name="editLastName" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editEmail">Email *</label>
                                <input type="email" id="editEmail" name="editEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="editPhone">Telefone</label>
                                <input type="tel" id="editPhone" name="editPhone">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editCpf">CPF</label>
                                <input type="text" id="editCpf" name="editCpf" placeholder="000.000.000-00">
                            </div>
                            <div class="form-group">
                                <label for="editBirthDate">Data de Nascimento</label>
                                <input type="date" id="editBirthDate" name="editBirthDate">
                            </div>
                        </div>
                    </div>

                            </div>

                            <!-- Step 2: Informa√ß√µes da Academia -->
                            <div class="form-section" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(139, 92, 246, 0.05)); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(16, 185, 129, 0.2);">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #10B981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;">2</div>
                                    <h3 style="color: #F8FAFC; margin: 0; font-size: 1.1rem;">ü•ã Academia</h3>
                                    <div style="flex: 1; height: 1px; background: linear-gradient(90deg, #10B981, transparent);"></div>
                                </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editCategory">Categoria *</label>
                                <select id="editCategory" name="editCategory" required>
                                    <option value="ADULT">Adulto</option>
                                    <option value="INICIANTE1">Iniciante 1</option>
                                    <option value="INICIANTE2">Iniciante 2</option>
                                    <option value="MASTER1">Master 1</option>
                                    <option value="MASTER2">Master 2</option>
                                    <option value="MASTER3">Master 3</option>
                                    <option value="HEROI1">Her√≥i 1</option>
                                    <option value="HEROI2">Her√≥i 2</option>
                                    <option value="HEROI3">Her√≥i 3</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editGender">G√™nero *</label>
                                <select id="editGender" name="editGender" required>
                                    <option value="MASCULINO">Masculino</option>
                                    <option value="FEMININO">Feminino</option>
                                    <option value="OUTRO">Outro</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editPhysicalCondition">Condi√ß√£o F√≠sica</label>
                                <select id="editPhysicalCondition" name="editPhysicalCondition">
                                    <option value="INICIANTE">Iniciante</option>
                                    <option value="BASICO">B√°sico</option>
                                    <option value="INTERMEDIARIO">Intermedi√°rio</option>
                                    <option value="AVANCADO">Avan√ßado</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editEnrollmentDate">Data de Matr√≠cula</label>
                                <input type="date" id="editEnrollmentDate" name="editEnrollmentDate">
                            </div>
                        </div>
                    </div>

                            </div>

                            <!-- Step 3: Informa√ß√µes M√©dicas -->
                            <div class="form-section" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(245, 158, 11, 0.05)); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(239, 68, 68, 0.2);">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #EF4444, #DC2626); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;">3</div>
                                    <h3 style="color: #F8FAFC; margin: 0; font-size: 1.1rem;">üè• Sa√∫de & Emerg√™ncia</h3>
                                    <div style="flex: 1; height: 1px; background: linear-gradient(90deg, #EF4444, transparent);"></div>
                                </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="editMedicalConditions">Condi√ß√µes M√©dicas</label>
                                <textarea id="editMedicalConditions" name="editMedicalConditions" rows="3" 
                                          placeholder="Alergias, medicamentos, limita√ß√µes f√≠sicas, etc."></textarea>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editEmergencyContact">Contato de Emerg√™ncia</label>
                                <input type="text" id="editEmergencyContact" name="editEmergencyContact" 
                                       placeholder="Nome e telefone">
                            </div>
                            <div class="form-group">
                                <label for="editSpecialNeeds">Necessidades Especiais</label>
                                <select id="editSpecialNeeds" name="editSpecialNeeds" multiple>
                                    <option value="TEA">TEA (Autismo)</option>
                                    <option value="TDAH">TDAH</option>
                                    <option value="MobilidadeReduzida">Mobilidade Reduzida</option>
                                    <option value="DeficienciaVisual">Defici√™ncia Visual</option>
                                    <option value="DeficienciaAuditiva">Defici√™ncia Auditiva</option>
                                </select>
                            </div>
                        </div>
                    </div>

                            </div>

                            <!-- Step 4: Status e Progresso (Read-only) -->
                            <div class="form-section" id="editProgressSection" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(99, 102, 241, 0.05)); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(139, 92, 246, 0.2);">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #8B5CF6, #7C3AED); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;">4</div>
                                    <h3 style="color: #F8FAFC; margin: 0; font-size: 1.1rem;">üìä Estat√≠sticas (Somente Leitura)</h3>
                                    <div style="flex: 1; height: 1px; background: linear-gradient(90deg, #8B5CF6, transparent);"></div>
                                </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editTotalXP">XP Total</label>
                                <input type="number" id="editTotalXP" name="editTotalXP" readonly>
                            </div>
                            <div class="form-group">
                                <label for="editGlobalLevel">N√≠vel Global</label>
                                <input type="number" id="editGlobalLevel" name="editGlobalLevel" readonly>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editCurrentStreak">Sequ√™ncia Atual</label>
                                <input type="number" id="editCurrentStreak" name="editCurrentStreak" readonly>
                            </div>
                            <div class="form-group">
                                <label for="editLastCheckinDate">√öltima Presen√ßa</label>
                                <input type="datetime-local" id="editLastCheckinDate" name="editLastCheckinDate" readonly>
                            </div>
                        </div>
                        </form>
                    </div>

                        </form>
                    </div>

                    <!-- Overview Tab -->
                    <div id="edit-tab-overview" class="edit-tab-content" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <!-- Personal Summary -->
                            <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);">
                                <h4 style="color: #3B82F6; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    <span>üë§</span> Informa√ß√µes Pessoais
                                </h4>
                                <div style="display: grid; gap: 0.75rem; color: #CBD5E1;">
                                    <div><strong>Nome:</strong> <span id="overviewFullName">-</span></div>
                                    <div><strong>Email:</strong> <span id="overviewEmail">-</span></div>
                                    <div><strong>Telefone:</strong> <span id="overviewPhone">-</span></div>
                                    <div><strong>CPF:</strong> <span id="overviewCpf">-</span></div>
                                </div>
                            </div>

                            <!-- Academy Summary -->
                            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(139, 92, 246, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(16, 185, 129, 0.2);">
                                <h4 style="color: #10B981; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    <span>ü•ã</span> Status Academia
                                </h4>
                                <div style="display: grid; gap: 0.75rem; color: #CBD5E1;">
                                    <div><strong>Categoria:</strong> <span id="overviewCategory">-</span></div>
                                    <div><strong>Status:</strong> <span id="overviewStatus">-</span></div>
                                    <div><strong>Matr√≠cula:</strong> <span id="overviewEnrollment">-</span></div>
                                    <div><strong>Condi√ß√£o F√≠sica:</strong> <span id="overviewPhysical">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Academic Tab -->
                    <div id="edit-tab-academic" class="edit-tab-content" style="display: none;">
                        <div style="text-align: center; padding: 3rem; color: #6B7280;">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">üéì</div>
                            <p>Carregando informa√ß√µes acad√™micas...</p>
                        </div>
                    </div>

                    <div id="edit-tab-classes" class="edit-tab-content" style="display: none;">
                        <div style="text-align: center; padding: 3rem; color: #6B7280;">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">üè´</div>
                            <p>Carregando informa√ß√µes de turmas...</p>
                        </div>
                    </div>

                    <!-- Progress Tab -->
                    <div id="edit-tab-progress" class="edit-tab-content" style="display: none;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                            <!-- XP Stats -->
                            <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(99, 102, 241, 0.1)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(139, 92, 246, 0.3); text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚≠ê</div>
                                <div style="color: #8B5CF6; font-size: 1.5rem; font-weight: bold;" id="progressXP">1,250</div>
                                <div style="color: #CBD5E1; font-size: 0.875rem;">XP Total</div>
                            </div>
                            <!-- Level -->
                            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(16, 185, 129, 0.3); text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üèÜ</div>
                                <div style="color: #10B981; font-size: 1.5rem; font-weight: bold;" id="progressLevel">N√≠vel 5</div>
                                <div style="color: #CBD5E1; font-size: 0.875rem;">Gradua√ß√£o</div>
                            </div>
                            <!-- Streak -->
                            <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(245, 158, 11, 0.3); text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üî•</div>
                                <div style="color: #F59E0B; font-size: 1.5rem; font-weight: bold;" id="progressStreak">7 dias</div>
                                <div style="color: #CBD5E1; font-size: 0.875rem;">Sequ√™ncia</div>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Tab -->
                    <div id="edit-tab-financial" class="edit-tab-content" style="display: none;">
                        <!-- Current Plan Section -->
                        <div style="margin-bottom: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h3 style="color: #F8FAFC; margin: 0; font-size: 1.25rem;">üìã Plano Atual</h3>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="btn btn-secondary btn-sm" onclick="loadStudentFinancialTab()" style="padding: 0.5rem 1rem; background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; color: #3B82F6; font-size: 0.875rem;">
                                        üîÑ Atualizar
                                    </button>
                                    <!-- Edit Student Plan button removed -->
                                </div>
                            </div>

                            <div id="currentPlanContainer" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(29, 78, 216, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);">
                                <div class="loading-state">
                                    <div style="text-align: center; color: #94A3B8;">
                                        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üìÑ</div>
                                        <p>Carregando informa√ß√µes do plano...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <!-- Payment Status -->
                            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(5, 150, 105, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(16, 185, 129, 0.2);">
                                <h4 style="color: #10B981; margin: 0 0 1rem 0;">üí≥ Status Pagamento</h4>
                                <div id="paymentStatusContainer" style="color: #CBD5E1;">
                                    <div class="loading-state">
                                        <div style="text-align: center; color: #94A3B8;">
                                            <p>Carregando status...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment History -->
                            <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(124, 58, 237, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(139, 92, 246, 0.2);">
                                <h4 style="color: #8B5CF6; margin: 0 0 1rem 0;">üìä Hist√≥rico de Pagamentos</h4>
                                <div id="paymentHistoryContainer" style="color: #CBD5E1; font-size: 0.875rem;">
                                    <div class="loading-state">
                                        <div style="text-align: center; color: #94A3B8;">
                                            <p>Carregando hist√≥rico...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Available Plans for Upgrade -->
                        <div style="margin-top: 2rem;">
                            <h3 style="color: #F8FAFC; margin: 0 0 1rem 0; font-size: 1.25rem;">üöÄ Planos Dispon√≠veis para Upgrade</h3>
                            <div id="availablePlansContainer" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(217, 119, 6, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(245, 158, 11, 0.2);">
                                <div class="loading-state">
                                    <div style="text-align: center; color: #94A3B8;">
                                        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚¨ÜÔ∏è</div>
                                        <p>Carregando planos dispon√≠veis...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Tab -->
                    <div id="edit-tab-activity" class="edit-tab-content" style="display: none;">
                        <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(29, 78, 216, 0.05)); border-radius: 12px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);">
                            <h4 style="color: #3B82F6; margin: 0 0 1rem 0;">üìä Frequ√™ncia Recente</h4>
                            <div style="color: #CBD5E1;">
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #374151;">
                                    <span>02/07/2025 - Aula 15</span>
                                    <span style="color: #10B981;">‚úÖ Presente</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #374151;">
                                    <span>27/06/2025 - Aula 14</span>
                                    <span style="color: #10B981;">‚úÖ Presente</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #374151;">
                                    <span>25/06/2025 - Aula 13</span>
                                    <span style="color: #EF4444;">‚ùå Ausente</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" >
                    Cancelar
                </button>
                <button type="button" id="saveEditStudentBtn" class="btn btn-primary" onclick="saveEditStudent()">
                    üíæ Salvar Altera√ß√µes
                </button>
            </div>
        </div>
    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-input" id="responsibleEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="tel" class="form-input" id="responsiblePhone" placeholder="(11) 99999-9999">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Data de Nascimento</label>
                            <input type="date" class="form-input" id="responsibleBirthDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tipo de Rela√ß√£o</label>
                            <select class="form-select" id="responsibleRelationType">
                                <option value="">Selecione...</option>
                                <option value="PARENT">Pai/M√£e</option>
                                <option value="GUARDIAN">Respons√°vel Legal</option>
                                <option value="SPOUSE">C√¥njuge</option>
                                <option value="RELATIVE">Familiar</option>
                                <option value="OTHER">Outro</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Endere√ßo</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Endere√ßo</label>
                            <input type="text" class="form-input" id="responsibleAddress" placeholder="Rua, Avenida, etc.">
                        </div>
                        <div class="form-group">
                            <label class="form-label">N√∫mero</label>
                            <input type="text" class="form-input" id="responsibleAddressNumber" placeholder="123">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Complemento</label>
                            <input type="text" class="form-input" id="responsibleComplement" placeholder="Apto, Bloco, etc.">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Bairro</label>
                            <input type="text" class="form-input" id="responsibleNeighborhood">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Cidade</label>
                            <input type="text" class="form-input" id="responsibleCity">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Estado</label>
                            <select class="form-select" id="responsibleState">
                                <option value="">Selecione...</option>
                                <option value="SP">S√£o Paulo</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="ES">Esp√≠rito Santo</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="PR">Paran√°</option>
                                <option value="RS">Rio Grande do Sul</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">CEP</label>
                            <input type="text" class="form-input" id="responsibleZipCode" placeholder="00000-000">
                        </div>
                        <div class="form-group"></div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" >Cancelar</button>
                    <button type="submit" class="btn btn-primary">Adicionar Respons√°vel</button>
                </div>
            </form>
        </div>
    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-input" id="editResponsibleEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="tel" class="form-input" id="editResponsiblePhone">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Data de Nascimento</label>
                            <input type="date" class="form-input" id="editResponsibleBirthDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tipo de Rela√ß√£o</label>
                            <select class="form-select" id="editResponsibleRelationType">
                                <option value="">Selecione...</option>
                                <option value="PARENT">Pai/M√£e</option>
                                <option value="GUARDIAN">Respons√°vel Legal</option>
                                <option value="SPOUSE">C√¥njuge</option>
                                <option value="RELATIVE">Familiar</option>
                                <option value="OTHER">Outro</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" >Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

            </form>
        </div>
    </div>

                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea class="form-input" id="courseDescription" rows="3"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">N√≠vel</label>
                        <select class="form-select" id="courseLevel" required>
                            <option value="BEGINNER">Iniciante</option>
                            <option value="INTERMEDIATE">Intermedi√°rio</option>
                            <option value="ADVANCED">Avan√ßado</option>
                            <option value="EXPERT">Especialista</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total de Aulas</label>
                        <input type="number" class="form-input" id="courseTotalClasses" min="1" max="100" value="48" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Aulas por Semana</label>
                        <input type="number" class="form-input" id="courseClassesPerWeek" min="1" max="7" value="2" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Dura√ß√£o (semanas)</label>
                        <input type="number" class="form-input" id="courseDuration" min="1" max="52" value="24" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Idade M√≠nima</label>
                        <input type="number" class="form-input" id="courseMinAge" min="5" max="100" value="16" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Idade M√°xima</label>
                        <input type="number" class="form-input" id="courseMaxAge" min="5" max="100">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Objetivos do Curso (um por linha)</label>
                    <textarea class="form-input" id="courseObjectives" rows="4" 
                        placeholder="Ex: Desenvolver t√©cnicas b√°sicas de defesa pessoal&#10;Melhorar condicionamento f√≠sico&#10;Aumentar autoconfian√ßa"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Requisitos (um por linha)</label>
                    <textarea class="form-input" id="courseRequirements" rows="3" 
                        placeholder="Ex: Atestado m√©dico&#10;Termo de responsabilidade&#10;Uniforme adequado"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" >Cancelar</button>
                    <button type="submit" class="btn btn-primary">Criar Curso</button>
                </div>
            </form>
        </div>
    </div>

                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea class="form-input" id="editCourseDescription" rows="3"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">N√≠vel</label>
                        <select class="form-select" id="editCourseLevel" required>
                            <option value="BEGINNER">Iniciante</option>
                            <option value="INTERMEDIATE">Intermedi√°rio</option>
                            <option value="ADVANCED">Avan√ßado</option>
                            <option value="EXPERT">Especialista</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total de Aulas</label>
                        <input type="number" class="form-input" id="editCourseTotalClasses" min="1" max="100" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Aulas por Semana</label>
                        <input type="number" class="form-input" id="editCourseClassesPerWeek" min="1" max="7" required>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" >Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" >Cancelar</button>
                    <button type="submit" class="btn btn-primary">Criar Assinatura</button>
                </div>
            </form>
        </div>
    </div>

                <div class="form-group">
                    <label class="form-label">Objetivos da Aula</label>
                    <textarea class="form-input" id="lessonObjectives" rows="2" 
                        placeholder="Ex: Aprender t√©cnica de soco direto, Praticar defesa contra estrangulamento"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Aquecimento (10-15 min)</label>
                    <textarea class="form-input" id="lessonWarmUp" rows="3" 
                        placeholder="Ex: Corrida leve, alongamento din√¢mico, exerc√≠cios articulares"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Conte√∫do Principal (30-40 min)</label>
                    <textarea class="form-input" id="lessonMainContent" rows="4" 
                        placeholder="Ex: Demonstra√ß√£o da t√©cnica, pr√°tica em pares, aplica√ß√£o em situa√ß√µes simuladas"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Desaquecimento (5-10 min)</label>
                    <textarea class="form-input" id="lessonCoolDown" rows="2" 
                        placeholder="Ex: Alongamento est√°tico, respira√ß√£o, relaxamento"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Equipamentos Necess√°rios</label>
                    <input type="text" class="form-input" id="lessonEquipment" 
                        placeholder="Ex: Paos, luvas, colchonetes (separar por v√≠rgula)">
                </div>

                <div class="form-group">
                    <label class="form-label">Adapta√ß√µes para Necessidades Especiais</label>
                    <textarea class="form-input" id="lessonAdaptations" rows="2" 
                        placeholder="Ex: Exerc√≠cios modificados para pessoas com mobilidade reduzida"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Observa√ß√µes e Notas</label>
                    <textarea class="form-input" id="lessonNotes" rows="2" 
                        placeholder="Ex: Enfatizar seguran√ßa, aten√ß√£o especial ao alinhamento corporal"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" >Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Plano</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { showToast } from './js/ui.js';
        window.showToast = showToast;
    </script>
    <script>
        // ... existing code ...
        // Functions will be assigned to window later when they are defined
    </script>
    <script>
        // Attendance functions (inline)
        function loadAttendance() {

            // Load attendance data from API
            fetchAttendanceData();
        }

        function renderAttendance(attendance) {

            const container = document.getElementById('attendance-container');
            if (!container) {

                return;
            }
            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Aluno</th>
                            <th>Data</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${attendance.map(record => `
                            <tr>
                                <td>${record.studentName}</td>
                                <td>${record.date}</td>
                                <td>${record.status}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <button onclick="checkIn()">Registrar Presen√ßa</button>
            `;
        }

        function checkIn() {
            const studentId = document.getElementById('studentId')?.value;
            if (studentId) {
                // TODO: Implement check-in functionality
            }
        }

        // Attach to window for global access
        window.loadAttendance = loadAttendance;
        window.renderAttendance = renderAttendance;
        window.checkIn = checkIn;
    </script>
    <script type="module" src="./js/main.js"></script>
    <script>
        // Settings functions (inline)
        function loadSettings() {

            // Load settings data from API
            fetchSettingsData();
        }

        function renderSettings(settings) {

            const container = document.getElementById('settings-container');
            if (!container) {

                return;
            }
            container.innerHTML = `
                <div class="settings-form">
                    <label for="academy-name">Nome da Academia</label>
                    <input type="text" id="academy-name" value="${settings.academyName}">
                    <label for="notifications">Habilitar Notifica√ß√µes</label>
                    <input type="checkbox" id="notifications" ${settings.notifications ? 'checked' : ''}>
                    <button onclick="saveSettings()">Salvar Configura√ß√µes</button>
                </div>
            `;
        }

        function saveSettings() {
            const academyName = document.getElementById('academy-name').value;
            const notifications = document.getElementById('notifications').checked;

        }

        // Attach to window for global access
        window.loadSettings = loadSettings;
        window.renderSettings = renderSettings;
        window.saveSettings = saveSettings;
    </script>
    <script>
        // ==========================================
        // GLOBAL VARIABLES
        // ==========================================

        // Knowledge Base System
        let knowledgeBase = [];
        let ragChunks = [];
        let uploadedDocuments = [];

        // Make variables globally accessible
        window.knowledgeBase = knowledgeBase;
        window.ragChunks = ragChunks;
        window.uploadedDocuments = uploadedDocuments;
        window.ragChunks = ragChunks;
        let currentUploadTab = 'documents';

        // ==========================================
        // KNOWLEDGE BASE PERSISTENCE FUNCTIONS
        // ==========================================

        // Save knowledge base to localStorage
        function saveKnowledgeBaseToStorage() {
            try {
                localStorage.setItem('academiaKnowledgeBase', JSON.stringify(knowledgeBase));
                localStorage.setItem('academiaRAGChunks', JSON.stringify(ragChunks));

            } catch (error) {

            }
        }

        // Load knowledge base from localStorage
        function loadKnowledgeBaseFromStorage() {
            try {
                const storedKnowledgeBase = localStorage.getItem('academiaKnowledgeBase');
                const storedRAGChunks = localStorage.getItem('academiaRAGChunks');

                if (storedKnowledgeBase) {
                    knowledgeBase = JSON.parse(storedKnowledgeBase);

                }

                if (storedRAGChunks) {
                    ragChunks = JSON.parse(storedRAGChunks);

                } else if (knowledgeBase.length > 0) {
                    // Regenerate chunks if knowledge base exists but chunks don't
                    generateRAGChunks();
                }

                return knowledgeBase.length > 0;
            } catch (error) {

                return false;
            }
        }

        // Make function globally accessible
        window.loadKnowledgeBaseFromStorage = loadKnowledgeBaseFromStorage;

        // Clear knowledge base from localStorage
        function clearKnowledgeBaseStorage() {
            try {
                localStorage.removeItem('academiaKnowledgeBase');
                localStorage.removeItem('academiaRAGChunks');
                knowledgeBase = [];
                ragChunks = [];

            } catch (error) {

            }
        }

        // Make functions globally accessible
        window.clearKnowledgeBaseStorage = clearKnowledgeBaseStorage;

        // Define essential functions immediately
        window.openKnowledgeUploader = function() {

            try {
                openDocumentUploader();
            } catch (error) {

            }
        };

        window.reindexKnowledgeBase = function() {

            try {
                if (typeof generateRAGChunks === 'function') {
                    generateRAGChunks();
                }
                if (typeof updateKnowledgeBaseStats === 'function') {
                    updateKnowledgeBaseStats();
                }
                if (typeof showToast === 'function') {
                    showToast('Base reindexada!', 'success');
                }
            } catch (error) {

            }
        };

        window.searchKnowledgeBase = function() {

            try {
                const query = document.getElementById('knowledgeSearchInput')?.value.trim();
                if (query && typeof searchKnowledgeContentInMain === 'function') {
                    searchKnowledgeContentInMain(query);
                } else if (typeof displayKnowledgeContentInMain === 'function') {
                    displayKnowledgeContentInMain();
                }
            } catch (error) {

            }
        };

        // Global variables for student editing
        let currentEditingStudentId = null;
        let currentEditingStudent = null;

        // Dedicated student edit page function (uses full page) - MOVED TO TOP
        async function openStudentEditPage(studentId) {
            try {

                if (!studentId) {
                    throw new Error('ID do estudante n√£o fornecido');
                }

                currentEditingStudentId = studentId;

                // Find student in existing data first
                let student = null;

                if (typeof window.allStudents !== 'undefined' && window.allStudents) {
                    student = window.allStudents.find(s => s.id === studentId);

                }

                if (!student) {

                    // Fallback: fetch from API
                    const response = await fetch(`/api/students`);
                    const data = await response.json();

                    if (!data.success) {
                        throw new Error(data.message || 'Erro ao carregar dados do estudante');
                    }

                    student = data.data.find(s => s.id === studentId);

                }

                if (!student) {
                    throw new Error('Estudante n√£o encontrado com ID: ' + studentId);
                }

                currentEditingStudent = student;

                // Check if elements exist before manipulating them
                const studentsSection = document.getElementById('students');
                const editPageSection = document.getElementById('student-edit-page');

                if (!studentsSection || !editPageSection) {
                    throw new Error('Elementos da p√°gina n√£o encontrados');
                }

                // Hide students list and show edit page
                studentsSection.style.display = 'none';
                editPageSection.style.display = 'block';

                // Update page header with student info
                try {
                    updateEditPageHeader(student);

                } catch (headerError) {

                }

                // Load the edit form
                try {
                    loadEditPageForm(student);

                } catch (formError) {

                }

                // Update sidebar with student stats
                try {
                    updateEditPageSidebar(student);

                } catch (sidebarError) {

                }

                // Set active tab to edit
                try {
                    switchPageTab('edit');

                } catch (tabError) {

                }

            } catch (error) {

                 // Usando alert para garantir que vemos o erro
            }
        }

        // Update edit page header with student information
        function updateEditPageHeader(student) {
            const user = student.user || {};
            const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim() || 'Aluno sem nome';
            const studentId = student.id;
            const category = student.category || 'N/A';

            document.getElementById('editPageStudentName').textContent = fullName;
            document.getElementById('editPageStudentId').textContent = `ID: ${studentId}`;
            document.getElementById('editPageStudentCategory').textContent = `Categoria: ${category}`;
        }

        // Load form in the edit page
        function loadEditPageForm(student) {
            const formContainer = document.getElementById('pageFormContainer');

            // Create form HTML with all student fields
            formContainer.innerHTML = `
                <form id="editPageStudentForm" style="display: grid; gap: 2rem;">
                    <!-- Personal Information Section -->
                    <div style="background: rgba(15, 23, 42, 0.5); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;">
                        <h4 style="color: #F8FAFC; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                            üë§ Informa√ß√µes Pessoais
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="pageFirstName" style="color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;">Nome</label>
                                <input type="text" id="pageFirstName" value="${student.user?.firstName || ''}" 
                                       style="width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;" required>
                            </div>
                            <div class="form-group">
                                <label for="pageLastName" style="color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;">Sobrenome</label>
                                <input type="text" id="pageLastName" value="${student.user?.lastName || ''}" 
                                       style="width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;" required>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                            <div class="form-group">
                                <label for="pageEmail" style="color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;">Email</label>
                                <input type="email" id="pageEmail" value="${student.user?.email || ''}" 
                                       style="width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;" required>
                            </div>
                            <div class="form-group">
                                <label for="pagePhone" style="color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;">Telefone</label>
                                <input type="tel" id="pagePhone" value="${student.user?.phone || ''}" 
                                       style="width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;">
                            </div>
                        </div>
                    </div>

                    <!-- Academic Information Section -->
                    <div style="background: rgba(15, 23, 42, 0.5); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;">
                        <h4 style="color: #F8FAFC; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                            ü•ã Informa√ß√µes Acad√™micas
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="pageCategory" style="color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;">Categoria</label>
                                <select id="pageCategory" style="width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;">
                                    <option value="ADULT" ${student.category === 'ADULT' ? 'selected' : ''}>Adulto</option>
                                    <option value="CHILD" ${student.category === 'CHILD' ? 'selected' : ''}>Crian√ßa</option>
                                    <option value="INICIANTE1" ${student.category === 'INICIANTE1' ? 'selected' : ''}>Iniciante 1</option>
                                    <option value="INICIANTE2" ${student.category === 'INICIANTE2' ? 'selected' : ''}>Iniciante 2</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="pageGender" style="color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;">G√™nero</label>
                                <select id="pageGender" style="width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;">
                                    <option value="MASCULINO" ${student.gender === 'MASCULINO' ? 'selected' : ''}>Masculino</option>
                                    <option value="FEMININO" ${student.gender === 'FEMININO' ? 'selected' : ''}>Feminino</option>
                                    <option value="OUTRO" ${student.gender === 'OUTRO' ? 'selected' : ''}>Outro</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top: 1rem;">
                            <label for="pagePhysicalCondition" style="color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;">Condi√ß√£o F√≠sica</label>
                            <select id="pagePhysicalCondition" style="width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;">
                                <option value="INICIANTE" ${student.physicalCondition === 'INICIANTE' ? 'selected' : ''}>Iniciante</option>
                                <option value="INTERMEDIARIO" ${student.physicalCondition === 'INTERMEDIARIO' ? 'selected' : ''}>Intermedi√°rio</option>
                                <option value="AVANCADO" ${student.physicalCondition === 'AVANCADO' ? 'selected' : ''}>Avan√ßado</option>
                            </select>
                        </div>
                    </div>

                    <!-- Additional Information Section -->
                    <div style="background: rgba(15, 23, 42, 0.5); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155;">
                        <h4 style="color: #F8FAFC; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                            üìã Informa√ß√µes Adicionais
                        </h4>
                        <div style="display: grid; gap: 1rem;">
                            <div class="form-group">
                                <label for="pageEmergencyContact" style="color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;">Contato de Emerg√™ncia</label>
                                <input type="text" id="pageEmergencyContact" value="${student.emergencyContact || ''}" 
                                       style="width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC;">
                            </div>
                            <div class="form-group">
                                <label for="pageMedicalConditions" style="color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.5rem; display: block;">Condi√ß√µes M√©dicas</label>
                                <textarea id="pageMedicalConditions" rows="3" 
                                          style="width: 100%; padding: 0.75rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 8px; color: #F8FAFC; resize: vertical;">${student.medicalConditions || ''}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden fields -->
                    <input type="hidden" id="pageStudentId" value="${student.id}">
                    <input type="hidden" id="pageUserId" value="${student.userId}">
                </form>
            `;

            // Add real-time form validation
            const inputs = formContainer.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', updatePageFormProgress);
            });

            updatePageFormProgress();

            // Pre-load financial tab content to ensure plan information is available
            setTimeout(() => {

                loadStudentFinancialTab();
            }, 1000);
        }

        // Update sidebar with student stats
        function updateEditPageSidebar(student) {
            document.getElementById('sidebarXP').textContent = student.totalXP || '0';
            document.getElementById('sidebarLevel').textContent = `Nv. ${student.globalLevel || '1'}`;
            document.getElementById('sidebarStreak').textContent = `${student.currentStreak || '0'} dias`;
        }

        // Switch between page tabs
        function switchPageTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.page-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Remove active class from all tab buttons
            document.querySelectorAll('.page-tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'transparent';
                btn.style.color = '#94A3B8';
            });

            // Show selected tab content
            const selectedTab = document.getElementById(`page-tab-${tabName}`);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }

            // Add active class to selected tab button
            const selectedBtn = document.querySelector(`[data-page-tab="${tabName}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('active');
                selectedBtn.style.background = 'linear-gradient(135deg, #3B82F6, #1D4ED8)';
                selectedBtn.style.color = 'white';
            }

            // Load specific tab content
            loadPageTabContent(tabName);
        }

        // Load content for specific tab
        function loadPageTabContent(tabName) {
            // Use centralized functions from students.js module
            switch (tabName) {
                case 'ai-dashboard':
                    if (window.loadAIDashboardContent) {
                        window.loadAIDashboardContent();
                    }
                    break;
                case 'plans':
                    if (window.loadPlansTabContent) {
                        window.loadPlansTabContent();
                    }
                    break;
                case 'classes':

                    if (window.loadStudentClassesTab) {
                        window.loadStudentClassesTab();
                    }
                    break;
                case 'courses':

                    if (window.loadStudentSubscriptionTab) {
                        window.loadStudentSubscriptionTab();
                    }
                    break;
                case 'progress':
                    if (window.loadProgressTabContent) {
                        window.loadProgressTabContent();
                    }
                    break;
                default:
                    // Edit tab is already loaded
                    break;
            }
        }

        // Update form progress
        function updatePageFormProgress() {
            const form = document.getElementById('editPageStudentForm');
            if (!form) return;

            const inputs = form.querySelectorAll('input[required], select[required]');
            let completed = 0;

            inputs.forEach(input => {
                if (input.value && input.value.trim() !== '') {
                    completed++;
                }
            });

            const progress = Math.round((completed / inputs.length) * 100);
            const progressBar = document.getElementById('pageFormProgress');
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
            }
        }

        // Tab content loading functions - placeholder implementations
        function loadAIDashboardContent() {
            const content = document.getElementById('page-tab-ai-dashboard');
            if (content) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #94A3B8;">
                        ü§ñ Dashboard IA em desenvolvimento
                    </div>
                `;
            }
        }

        // Edit Responsible function
        async function editResponsible() {
            const form = document.getElementById('editResponsibleForm');
            const formData = new FormData(form);

            const responsibleId = document.getElementById('editResponsibleId').value;
            const responsibleData = {
                name: document.getElementById('editResponsibleName').value.trim(),
                email: document.getElementById('editResponsibleEmail').value.trim(),
                phone: document.getElementById('editResponsiblePhone').value.trim(),
                birthDate: document.getElementById('editResponsibleBirthDate').value || null,
                relationshipType: document.getElementById('editResponsibleRelationType').value || null
            };

            // Validation
            if (!responsibleData.name || !responsibleData.email) {
                showToast('Por favor, preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            try {
                showToast('‚è≥ Atualizando respons√°vel...', 'info');

                const response = await fetch(`/api/financial-responsibles/${responsibleId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(responsibleData)
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    showToast('‚úÖ Respons√°vel atualizado com sucesso!', 'success');

                    loadFinancialResponsiblesList(); // Refresh the list
                } else {
                    throw new Error(data.message || data.error || 'Erro ao atualizar respons√°vel');
                }
            } catch (error) {

                showToast(`Erro ao atualizar respons√°vel: ${error.message}`, 'error');
            }
        }

        // Add form submission handler for edit responsible form
        document.addEventListener('DOMContentLoaded', function() {
            const editResponsibleForm = document.getElementById('editResponsibleForm');
            if (editResponsibleForm) {
                editResponsibleForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    editResponsible();
                });
            }
        });

        function loadClassesTabContent() {
            const content = document.getElementById('page-tab-classes');
            if (content) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #94A3B8;">
                        ü•ã Turmas e hor√°rios em desenvolvimento
                    </div>
                `;
            }
        }

        function loadCoursesTabContent() {
            const content = document.getElementById('page-tab-courses');
            if (content) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #94A3B8;">
                        üìö Cursos e progresso em desenvolvimento
                    </div>
                `;
            }
        }

        function loadProgressTabContent() {
            const content = document.getElementById('page-tab-progress');
            if (content) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #94A3B8;">
                        üìà Progresso e conquistas em desenvolvimento
                    </div>
                `;
            }
        }

        // Functions for plan management
        async function createNewSubscription() {
            if (!currentEditingStudentId) {

                return;
            }

            // Simple implementation - could be expanded to show plan selection modal
            const planId = prompt('Digite o ID do plano:');
            if (!planId) return;

            try {
                const response = await fetch('/api/financial/subscriptions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        studentId: currentEditingStudentId,
                        planId: planId,
                        status: 'ACTIVE',
                        isActive: true
                    })
                });

                const result = await response.json();

                if (result.success) {

                    // Reload the plans tab to show updated data
                    loadPlansTabContent();
                } else {

                }
            } catch (error) {

            }
        }

        // Navigation system with enhanced debugging
        document.addEventListener('DOMContentLoaded', function() {

            // Setup navigation
            const navButtons = document.querySelectorAll('.nav-link');

            navButtons.forEach(button => {
                const page = button.getAttribute('data-page');

                button.addEventListener('click', function() {
                    const targetPage = this.getAttribute('data-page');

                    showSection(targetPage);

                    // Load the appropriate data for the section
                    switch (targetPage) {
                        case 'dashboard':
                            loadData();
                            break;
                        case 'students':
                            if (window.loadAndRenderStudents) {
                                window.loadAndRenderStudents();
                            }
                            break;
                        case 'courses':
                            if (window.loadAndRenderCourses) {
                                window.loadAndRenderCourses();
                            }
                            break;
                        case 'classes':
                            if (window.loadAndRenderClasses) {
                                window.loadAndRenderClasses();
                            }
                            break;
                        case 'financial':
                            if (window.loadAndRenderPlans) {
                                window.loadAndRenderPlans();
                            }
                            break;
                        default:

                    }
                });
            });

            // Load initial data
            loadData();

        });

        function showSection(pageName) {

            // Hide all sections with explicit display none
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';

            });

            // Remove active from all buttons
            document.querySelectorAll('.nav-link').forEach(button => {
                button.classList.remove('active');
            });

            // Show target section with explicit display block
            const targetSection = document.getElementById(pageName);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
            } else {
                console.log('Section not found:', pageName);
            }

            // Activate current button
            const activeButton = document.querySelector(`[data-page="${pageName}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
                );
            } else {

            }

            // Load data for specific sections

            if (pageName === 'course-management') {
                loadCourses();
            } else if (pageName === 'attendance') {
                loadAttendanceList();
            } else if (pageName === 'students') {

                loadStudentsList();
            } else if (pageName === 'classes') {

                loadClassesList();
            } else if (pageName === 'student-portal') {
                // Reset student portal to login screen
                document.getElementById('studentLoginSection').style.display = 'block';
                document.getElementById('studentDashboard').style.display = 'none';
                currentStudent = null;
            } else if (pageName === 'public-checkin') {
                loadPublicCheckin();
            } else if (pageName === 'financial-responsibles') {

                loadFinancialResponsiblesList();
            }
        }

        // Make showSection globally accessible
        window.showSection = showSection;

        function loadData() {

            // Students count will be updated by real API data

            // Try to load real data from API
            fetch('/api/students')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.data.length > 0) {
                        const total = data.data.length;
                        const active = data.data.filter(s => s.user && s.user.isActive).length;

                        document.getElementById('total-students').textContent = total;
                        document.getElementById('active-students').textContent = active;
                        document.getElementById('students-count').textContent = total;

                    }
                })
                .catch(error => {

                });
        }

        // Students management functions
        function loadStudentsList() {

            fetch('/api/students')
                .then(response => response.json())
                .then(data => {
                    if (data.success && Array.isArray(data.data)) {
                        updateStudentsTable(data.data);
                    } else {

                        updateStudentsTable([]); // Show empty table
                    }
                })
                .catch(error => {

                    updateStudentsTable([]); // Show empty table
                });
        }

        function updateStudentsTable(students) {
            const tbody = document.getElementById('studentsTableBody');
            if (!tbody) {

                return;
            }

            if (students.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="padding: 2rem; text-align: center; color: #94A3B8;">
                            Nenhum aluno encontrado
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = students.map(student => `
                <tr style="border-bottom: 1px solid #374151;">
                    <td style="padding: 1rem; color: #F8FAFC;">${student.name || 'N/A'}</td>
                    <td style="padding: 1rem; color: #CBD5E1;">${student.email || 'N/A'}</td>
                    <td style="padding: 1rem; color: #CBD5E1;">${student.phone || 'N/A'}</td>
                    <td style="padding: 1rem; color: #CBD5E1;">${student.className || 'N√£o vinculado'}</td>
                    <td style="padding: 1rem;">
                        <span style="background: ${student.user?.isActive ? '#059669' : '#6B7280'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem;">
                            ${student.user?.isActive ? 'Ativo' : 'Inativo'}
                        </span>
                    </td>
                    <td style="padding: 1rem;">
                        <button onclick="editStudent('${student.id}')" class="btn btn-secondary" style="margin-right: 0.5rem; font-size: 0.75rem; padding: 0.5rem 1rem;">
                            Editar
                        </button>
                        <button onclick="deleteStudent('${student.id}')" class="btn btn-danger" style="font-size: 0.75rem; padding: 0.5rem 1rem;">
                            Excluir
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Student table event delegation
        function setupStudentTableEventDelegation() {

            const studentsTable = document.getElementById('studentsTableBody');
            if (!studentsTable) {

                return;
            }

            // Remove existing listeners to prevent duplicates
            studentsTable.removeEventListener('click', handleStudentTableClick);

            // Add event delegation for student table actions
            studentsTable.addEventListener('click', handleStudentTableClick);

        }

        function handleStudentTableClick(event) {
            const target = event.target;

            if (target.tagName === 'BUTTON') {
                const studentId = target.getAttribute('data-student-id') || 
                                 target.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];

                if (target.textContent.includes('Editar')) {
                    editStudent(studentId);
                } else if (target.textContent.includes('Excluir')) {
                    deleteStudent(studentId);
                }
            }
        }

        // Student actions
        function editStudent(studentId) {

            // Implementation for edit student
            `);
        }

        function deleteStudent(studentId) {

            if (confirm('Tem certeza que deseja excluir este aluno?')) {
                // Implementation for delete student
                `);
            }
        }

        // Classes management functions  
        function loadClassesList() {

            fetch('/api/classes')
                .then(response => response.json())
                .then(data => {
                    if (data.success && Array.isArray(data.data)) {
                        updateClassesTable(data.data);
                    } else {

                        updateClassesTable([]); // Show empty table
                    }
                })
                .catch(error => {

                    updateClassesTable([]); // Show empty table
                });
        }

        function updateClassesTable(classes) {
            const tbody = document.getElementById('classesTableBody');
            if (!tbody) {

                return;
            }

            if (classes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="padding: 2rem; text-align: center; color: #94A3B8;">
                            Nenhuma turma encontrada
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = classes.map(cls => `
                <tr style="border-bottom: 1px solid #374151;">
                    <td style="padding: 1rem; color: #F8FAFC;">${cls.name || 'N/A'}</td>
                    <td style="padding: 1rem; color: #CBD5E1;">${cls.schedule || 'N/A'}</td>
                    <td style="padding: 1rem; color: #CBD5E1;">${cls.instructor || 'N/A'}</td>
                    <td style="padding: 1rem; color: #CBD5E1;">${cls.studentsCount || 0}/${cls.maxStudents || 'Ilimitado'}</td>
                    <td style="padding: 1rem;">
                        <button onclick="editClass('${cls.id}')" class="btn btn-secondary" style="margin-right: 0.5rem; font-size: 0.75rem; padding: 0.5rem 1rem;">
                            Editar
                        </button>
                        <button onclick="deleteClass('${cls.id}')" class="btn btn-danger" style="font-size: 0.75rem; padding: 0.5rem 1rem;">
                            Excluir
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Make functions globally accessible
        window.loadStudentsList = loadStudentsList;
        window.loadClassesList = loadClassesList;
        window.setupStudentTableEventDelegation = setupStudentTableEventDelegation;

        // Test functions
        window.testNavigation = function(page) {
            showSection(page || 'students');
        };

        ');

        // Apply showSection enhancement for knowledge base (check if function exists)
        if (typeof enhanceShowSection === 'function') {
            enhanceShowSection();
        }

        // Modal functions
        // Global variable to store financial responsibles
        let financialResponsibles = [];

        // Load financial responsibles
        async function loadFinancialResponsibles() {
            try {
                const response = await fetch('/api/financial-responsibles');
                const data = await response.json();

                if (data.success) {
                    financialResponsibles = data.data;
                    updateFinancialResponsiblesOptions();
                } else {

                }
            } catch (error) {

            }
        }

        // Update both select elements with financial responsibles
        function updateFinancialResponsiblesOptions() {
            const addSelect = document.getElementById('studentFinancialResponsible');
            const editSelect = document.getElementById('editStudentFinancialResponsible');

            const optionsHTML = '<option value="">Selecione um respons√°vel (opcional)</option>' +
                financialResponsibles.map(responsible => 
                    `<option value="${responsible.id}">${responsible.name} - ${responsible.relationshipType || 'N√£o informado'}</option>`
                ).join('');

            if (addSelect) addSelect.innerHTML = optionsHTML;
            if (editSelect) editSelect.innerHTML = optionsHTML;
        }

        // Separate function to load data without blocking modal
        async function loadDataForStudentModal() {

            // Load courses second (cursos reais)  
            loadCoursesForModal().catch(error => {

            });

            // Load classes third (turmas reais)
            loadClassesForModal().catch(error => {

            });

            // Load responsibles last
            loadFinancialResponsibles().catch(error => {

            });

        }

        // Load classes dynamically for the modal
        async function loadClassesForModal() {
            try {
                const response = await fetch('/api/classes');
                const data = await response.json();

                const classSelect = document.getElementById('studentClass');
                if (data.success && data.data && data.data.length > 0) {
                    let optionsHTML = '<option value="">Selecione uma turma...</option>';
                    data.data.forEach(classItem => {
                        const instructor = classItem.instructor ? 
                            `${classItem.instructor.user.firstName} ${classItem.instructor.user.lastName}` : 
                            'Professor n√£o definido';
                        const schedule = classItem.schedule || 
                            (classItem.startTime ? `${classItem.startTime}` : 'Hor√°rio n√£o definido');
                        const capacity = classItem.mat?.capacity || classItem.maxStudents || 'N/A';
                        const currentStudents = classItem._count?.studentCourses || 0;

                        optionsHTML += `<option value="${classItem.id}">${classItem.name} - ${schedule} (${instructor}) - ${currentStudents}/${capacity} alunos</option>`;
                    });
                    classSelect.innerHTML = optionsHTML;
                } else {
                    classSelect.innerHTML = '<option value="">Nenhuma turma dispon√≠vel</option>';
                }
            } catch (error) {

                const classSelect = document.getElementById('studentClass');
                classSelect.innerHTML = '<option value="">Erro ao carregar turmas</option>';
            }
        }

        // Load courses dynamically for the modal
        async function loadCoursesForModal() {
            try {
                const response = await fetch('/api/courses');
                const data = await response.json();

                const courseSelect = document.getElementById('studentCourse');
                if (data.success && data.data && data.data.length > 0) {
                    let optionsHTML = '<option value="">Selecione um curso (opcional)</option>';
                    data.data.forEach(course => {
                        const martialArt = course.martialArt?.name || 'Arte marcial n√£o definida';
                        const classCount = course._count?.classes || 0;
                        const studentCount = course._count?.studentCourses || 0;
                        const planCount = course.billingPlans?.length || 0;

                        optionsHTML += `<option value="${course.id}">${course.name} (${martialArt}) - ${classCount} turmas, ${studentCount} alunos, ${planCount} planos</option>`;
                    });
                    courseSelect.innerHTML = optionsHTML;
                } else {
                    courseSelect.innerHTML = '<option value="">Nenhum curso dispon√≠vel</option>';
                }
            } catch (error) {

                const courseSelect = document.getElementById('studentCourse');
                courseSelect.innerHTML = '<option value="">Erro ao carregar cursos</option>';
            }
        }

        // Function called by edit button in table
        async function openEditStudentModal(studentId) {
            // Redirect to dedicated page instead of modal

            await openStudentEditPage(studentId);
        }

        async function saveEditStudent() {
            const studentId = currentEditingStudentId;

            if (!studentId) {

                showToast('‚ùå Erro: ID do aluno n√£o encontrado', 'error');
                return;
            }

            const formData = {
                firstName: document.getElementById('editFirstName').value,
                lastName: document.getElementById('editLastName').value,
                email: document.getElementById('editEmail').value,
                phone: document.getElementById('editPhone').value,
                cpf: document.getElementById('editCpf').value,
                birthDate: document.getElementById('editBirthDate').value,
                category: document.getElementById('editCategory').value,
                gender: document.getElementById('editGender').value,
                physicalCondition: document.getElementById('editPhysicalCondition').value,
                enrollmentDate: document.getElementById('editEnrollmentDate').value,
                medicalConditions: document.getElementById('editMedicalConditions').value,
                emergencyContact: document.getElementById('editEmergencyContact').value,
                specialNeeds: Array.from(document.getElementById('editSpecialNeeds').selectedOptions).map(option => option.value)
            };

            try {
                const response = await fetch(`/api/students/${studentId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Aluno atualizado com sucesso!', 'success');

                    loadData(); // Reload students data
                } else {
                    throw new Error(result.message || 'Erro ao atualizar aluno');
                }
            } catch (error) {

                showToast('Erro ao atualizar aluno: ' + error.message, 'error');
            }
        }

        function editStudent(studentId) {
            // Redirect to dedicated page instead of modal

            openStudentEditPage(studentId);
        }

        }

        // Form submissions
        const addStudentForm = document.getElementById('addStudentForm');
        if (addStudentForm) {
            addStudentForm.addEventListener('submit', function(e) {
                e.preventDefault();

            const formData = {
                firstName: document.getElementById('studentName').value.split(' ')[0],
                lastName: document.getElementById('studentName').value.split(' ').slice(1).join(' '),
                email: document.getElementById('studentEmail').value,
                phone: document.getElementById('studentPhone').value,
                birthDate: document.getElementById('studentBirthDate').value,
                gender: document.getElementById('studentGender').value,
                category: document.getElementById('studentCategory').value,
                billingPlanId: document.getElementById('studentBillingPlan').value || null, // Billing plan selection
                courseId: document.getElementById('studentCourse').value || null, // For intelligent enrollment
                classId: document.getElementById('studentClass').value,
                financialResponsibleId: document.getElementById('studentFinancialResponsible').value || null,
                // Sistema de vincula√ß√£o autom√°tica - turmas e cursos baseados no plano
                selectedClasses: selectedClasses || [], // Turmas selecionadas (inclu√≠das + avulsas)
                selectedCourses: selectedCourses || [], // Cursos selecionados (inclu√≠dos + avulsos)
                planBasedSelection: currentPlanData ? {
                    planId: document.getElementById('studentBillingPlan').value,
                    includedClasses: currentPlanData.availableClasses.map(cls => cls.id),
                    includedCourses: currentPlanData.availableCourses.map(course => course.id),
                    additionalClasses: selectedClasses.filter(id => 
                        !currentPlanData.availableClasses.some(cls => cls.id === id)
                    ),
                    additionalCourses: selectedCourses.filter(id => 
                        !currentPlanData.availableCourses.some(course => course.id === id)
                    )
                } : null
            };

            // In a real app, make API call here
            fetch('/api/students', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    let message = 'Aluno adicionado com sucesso!';

                    // Incluir informa√ß√µes sobre turmas e cursos selecionados
                    if (formData.selectedClasses.length > 0 || formData.selectedCourses.length > 0) {
                        message += `\n\nüéØ Vincula√ß√£o Autom√°tica:`;

                        if (formData.selectedClasses.length > 0) {
                            message += `\n‚Ä¢ ${formData.selectedClasses.length} turma(s) vinculada(s)`;
                        }

                        if (formData.selectedCourses.length > 0) {
                            message += `\n‚Ä¢ ${formData.selectedCourses.length} curso(s) vinculado(s)`;
                        }

                        if (formData.planBasedSelection) {
                            const { additionalClasses, additionalCourses } = formData.planBasedSelection;
                            if (additionalClasses.length > 0 || additionalCourses.length > 0) {
                                message += `\n‚Ä¢ ${additionalClasses.length + additionalCourses.length} item(ns) avulso(s) adicionado(s)`;
                            }
                        }
                    }

                    // Check if intelligent enrollment was used
                    if (data.data && data.data.automaticEnrollment && data.data.automaticEnrollment.courseId) {
                        if (data.data.automaticEnrollment.subscriptionCreated) {
                            message += '\n\n‚úÖ Matr√≠cula Inteligente:\n‚Ä¢ Curso selecionado automaticamente\n‚Ä¢ Plano de pagamento criado\n‚Ä¢ Assinatura ativada';
                        } else {
                            message += '\n\n‚ö†Ô∏è Matr√≠cula Inteligente:\n‚Ä¢ Curso selecionado\n‚Ä¢ Plano criado (verificar assinatura)';
                        }
                    }

                    showToast(message.replace(/\n/g, ' '), 'success');

                    // Limpar sele√ß√µes ap√≥s sucesso
                    selectedClasses = [];
                    selectedCourses = [];
                    currentPlanData = null;

                    // Reload students data
                    if (typeof loadStudents === 'function') {
                        loadStudents();
                    }
                } else {
                    showToast('Erro ao adicionar aluno: ' + (data.message || 'Erro desconhecido'), 'error');
                }
            })
            .catch(error => {

            });
            }); // Close addEventListener
        }

        // Edit Student Form
        const editStudentForm = document.getElementById('editStudentForm');
        if (editStudentForm) {
            editStudentForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const studentId = currentEditingStudentId;

            if (!studentId) {

                showToast('‚ùå Erro: ID do aluno n√£o encontrado', 'error');
                return;
            }

            const formData = {
                name: document.getElementById('editStudentName').value,
                email: document.getElementById('editStudentEmail').value,
                phone: document.getElementById('editStudentPhone').value,
                birthDate: document.getElementById('editStudentBirthDate').value,
                gender: document.getElementById('editStudentGender').value,
                category: document.getElementById('editStudentCategory').value,
                classId: document.getElementById('editStudentClass').value,
                financialResponsibleId: document.getElementById('editStudentFinancialResponsible').value || null
            };

            // In a real app, make API call here
            fetch(`/api/students/${studentId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {

                    // Reload students data
                    loadData();
                } else {
                    );
                }
            })
            .catch(error => {

            });
            }); // Close addEventListener
        }

        // ========================================
        // COURSE MANAGEMENT FUNCTIONS
        // ========================================

        // Load courses data when navigating to course management
        function loadCourses() {

            fetch('/api/courses')
                .then(response => response.json())
                .then(data => {
                    if (data.success && Array.isArray(data.data)) {
                        updateCoursesTable(data.data);
                    } else {
                        // Show empty state
                        updateCoursesTable([]);
                    }
                })
                .catch(error => {

                    // Show empty state on error
                    updateCoursesTable([]);
                });
        }

        function updateCoursesTable(courses) {
            const tbody = document.getElementById('courses-table-body');

            if (courses.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; color: #CBD5E1; padding: 2rem;">
                            Nenhum curso cadastrado. Clique em "Novo Curso" para come√ßar.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = courses.map(course => `
                <tr class="course-row" data-course-id="${course.id}" ondblclick="openCourseDetail('${course.id}')" style="cursor: pointer; transition: background-color 0.2s;">
                    <td>${course.name}</td>
                    <td>${course.category || 'N√£o informado'}</td>
                    <td>${course.level || 'B√°sico'}</td>
                    <td>${course.totalClasses || 48}</td>
                    <td>${course.stats?.totalEnrollments || 0}</td>
                    <td>
                        <span class="status-badge ${course.isActive ? 'status-active' : 'status-inactive'}">
                            ${course.isActive ? 'Ativo' : 'Inativo'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="event.stopPropagation(); editCourse('${course.id}')">
                                ‚úèÔ∏è Editar
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="event.stopPropagation(); deleteCourse('${course.id}')">
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            // Add hover effect to course rows
            document.querySelectorAll('.course-row').forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = 'rgba(59, 130, 246, 0.1)';
                });
                row.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '';
                });
            });
        }

        // Course detail modal functions
        let currentCourseId = null;

        function openCourseDetail(courseId) {
            currentCourseId = courseId;
            document.getElementById('courseDetailModal').style.display = 'block';

            // Load course data
            fetch(`/api/courses/${courseId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayCourseDetail(data.data);
                    } else {

                        showToast('Erro ao carregar dados do curso', 'error');
                    }
                })
                .catch(error => {

                    showToast('Erro ao carregar dados do curso', 'error');
                });
        }

        function closeCourseDetail() {
            document.getElementById('courseDetailModal').style.display = 'none';
            currentCourseId = null;
        }

        function displayCourseDetail(course) {
            // Update modal title
            document.getElementById('courseDetailTitle').textContent = course.name || 'Detalhes do Curso';

            // Show overview tab by default
            switchCourseDetailTab('overview');
            loadCourseOverview(course);
        }

        function switchCourseDetailTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.modal-tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'transparent';
                btn.style.color = '#CBD5E1';
            });

            const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
                activeTab.style.background = 'linear-gradient(135deg, #3B82F6, #1D4ED8)';
                activeTab.style.color = 'white';
            }

            // Load tab content
            const contentDiv = document.getElementById('courseDetailContent');
            switch(tabName) {
                case 'overview':
                    loadCourseOverview(null);
                    break;
                case 'plans':
                    loadCoursePlans();
                    break;
                case 'classes':
                    loadCourseClasses();
                    break;
                case 'lessons':
                    loadCourseLessons();
                    break;
                case 'techniques':
                    loadCourseTechniques();
                    break;
                case 'students':
                    loadCourseStudents();
                    break;
                default:
                    contentDiv.innerHTML = '<p>Conte√∫do n√£o encontrado</p>';
            }
        }

        function loadCourseOverview(course) {
            const contentDiv = document.getElementById('courseDetailContent');
            contentDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
                    <div>
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üìö Informa√ß√µes do Curso</h3>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem;">
                            <p><strong>Nome:</strong> ${course?.name || 'Krav Maga Faixa Branca - Defesa Pessoal 1'}</p>
                            <p><strong>Categoria:</strong> ${course?.category || 'Adulto'}</p>
                            <p><strong>N√≠vel:</strong> ${course?.level || 'B√°sico'}</p>
                            <p><strong>Total de Aulas:</strong> ${course?.totalClasses || 48}</p>
                            <p><strong>Status:</strong> ${course?.isActive ? 'Ativo' : 'Inativo'}</p>
                        </div>

                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üìä Estat√≠sticas</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; color: #10B981; margin-bottom: 0.5rem;">${course?.stats?.totalEnrollments || 0}</div>
                                <div style="color: #CBD5E1; font-size: 0.875rem;">Alunos Matriculados</div>
                            </div>
                            <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; color: #F59E0B; margin-bottom: 0.5rem;">${course?.stats?.totalClasses || 2}</div>
                                <div style="color: #CBD5E1; font-size: 0.875rem;">Turmas Ativas</div>
                            </div>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; color: #8B5CF6; margin-bottom: 0.5rem;">${course?.stats?.avgAttendance || 85}%</div>
                                <div style="color: #CBD5E1; font-size: 0.875rem;">Frequ√™ncia M√©dia</div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">‚ö° A√ß√µes R√°pidas</h3>
                        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <button class="btn btn-primary" onclick="editCourse(currentCourseId)" style="width: 100%; justify-content: flex-start;">
                                <span>‚úèÔ∏è</span> Editar Curso
                            </button>
                            <button class="btn btn-secondary" onclick="duplicateCourse(currentCourseId)" style="width: 100%; justify-content: flex-start;">
                                <span>üìã</span> Duplicar Curso
                            </button>
                            <button class="btn btn-success" onclick="exportCourse(currentCourseId)" style="width: 100%; justify-content: flex-start;">
                                <span>üì§</span> Exportar Dados
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadCoursePlans() {
            const contentDiv = document.getElementById('courseDetailContent');
            contentDiv.innerHTML = `
                <div>
                    <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üí≥ Planos de Pagamento Associados</h3>
                    <div id="coursePlansContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">
                            <h4 style="color: #3B82F6; margin-bottom: 1rem;">Plano Mensal - Adulto</h4>
                            <p style="color: #CBD5E1; margin-bottom: 0.5rem;"><strong>Valor:</strong> R$ 180,00</p>
                            <p style="color: #CBD5E1; margin-bottom: 0.5rem;"><strong>Categoria:</strong> ADULT</p>
                            <p style="color: #CBD5E1; margin-bottom: 1rem;"><strong>Alunos:</strong> 4 matriculados</p>
                            <!-- Edit plan button removed -->
                        </div>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.3);">
                            <h4 style="color: #10B981; margin-bottom: 1rem;">Plano Mensal - Iniciante</h4>
                            <p style="color: #CBD5E1; margin-bottom: 0.5rem;"><strong>Valor:</strong> R$ 120,00</p>
                            <p style="color: #CBD5E1; margin-bottom: 0.5rem;"><strong>Categoria:</strong> INICIANTE1</p>
                            <p style="color: #CBD5E1; margin-bottom: 1rem;"><strong>Alunos:</strong> 2 matriculados</p>
                            <!-- Edit plan button removed -->
                        </div>
                    </div>

                    <div style="margin-top: 2rem;">
                        <!-- Create new plan button removed -->
                    </div>
                </div>
            `;
        }

        function loadCourseClasses() {
            const contentDiv = document.getElementById('courseDetailContent');
            contentDiv.innerHTML = `
                <div>
                    <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üè´ Turmas do Curso</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1rem;">
                        <div style="background: rgba(139, 92, 246, 0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(139, 92, 246, 0.3);">
                            <h4 style="color: #8B5CF6; margin-bottom: 1rem;">Turma 1 - Ter√ßas e Quintas</h4>
                            <p style="color: #CBD5E1; margin-bottom: 0.5rem;"><strong>Hor√°rio:</strong> 18:00 - 19:00</p>
                            <p style="color: #CBD5E1; margin-bottom: 0.5rem;"><strong>Capacidade:</strong> 8/20 alunos</p>
                            <p style="color: #CBD5E1; margin-bottom: 0.5rem;"><strong>Instrutor:</strong> Jo√£o Silva</p>
                            <p style="color: #CBD5E1; margin-bottom: 1rem;"><strong>Status:</strong> <span style="color: #10B981;">Ativa</span></p>
                            <button class="btn btn-secondary btn-small" onclick="viewClassDetails('class-1')">
                                üëÅÔ∏è Ver Detalhes
                            </button>
                        </div>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.3);">
                            <h4 style="color: #10B981; margin-bottom: 1rem;">Turma 2 - Segundas e Quartas</h4>
                            <p style="color: #CBD5E1; margin-bottom: 0.5rem;"><strong>Hor√°rio:</strong> 19:00 - 20:00</p>
                            <p style="color: #CBD5E1; margin-bottom: 0.5rem;"><strong>Capacidade:</strong> 5/20 alunos</p>
                            <p style="color: #CBD5E1; margin-bottom: 0.5rem;"><strong>Instrutor:</strong> Maria Santos</p>
                            <p style="color: #CBD5E1; margin-bottom: 1rem;"><strong>Status:</strong> <span style="color: #10B981;">Ativa</span></p>
                            <button class="btn btn-secondary btn-small" onclick="viewClassDetails('class-2')">
                                üëÅÔ∏è Ver Detalhes
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="createNewClass(currentCourseId)">
                            <span>‚ûï</span> Criar Nova Turma
                        </button>
                    </div>
                </div>
            `;
        }

        function loadCourseLessons() {
            const contentDiv = document.getElementById('courseDetailContent');
            contentDiv.innerHTML = `
                <div>
                    <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üìã Planos de Aula</h3>
                    <div style="background: rgba(59, 130, 246, 0.05); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
                        <p style="color: #CBD5E1; margin-bottom: 1rem;">Total: 48 aulas organizadas em 5 unidades pedag√≥gicas</p>
                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; text-align: center;">
                            <div style="background: #10B981; padding: 0.5rem; border-radius: 6px; color: white; cursor: pointer; transition: all 0.2s; border: 2px solid transparent;" 
                                 onclick="showLessonsByUnit('fundamentos')" 
                                 onmouseover="this.style.borderColor='#059669'; this.style.transform='scale(1.05)';" 
                                 onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)';">
                                <div>üìö Fundamentos</div>
                                <div style="font-size: 0.75rem;">Aulas 1-10</div>
                            </div>
                            <div style="background: #3B82F6; padding: 0.5rem; border-radius: 6px; color: white; cursor: pointer; transition: all 0.2s; border: 2px solid transparent;" 
                                 onclick="showLessonsByUnit('golpes')" 
                                 onmouseover="this.style.borderColor='#1D4ED8'; this.style.transform='scale(1.05)';" 
                                 onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)';">
                                <div>üëä Golpes B√°sicos</div>
                                <div style="font-size: 0.75rem;">Aulas 11-20</div>
                            </div>
                            <div style="background: #8B5CF6; padding: 0.5rem; border-radius: 6px; color: white; cursor: pointer; transition: all 0.2s; border: 2px solid transparent;" 
                                 onclick="showLessonsByUnit('defesas')" 
                                 onmouseover="this.style.borderColor='#7C3AED'; this.style.transform='scale(1.05)';" 
                                 onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)';">
                                <div>üõ°Ô∏è Defesas B√°sicas</div>
                                <div style="font-size: 0.75rem;">Aulas 21-30</div>
                            </div>
                            <div style="background: #F59E0B; padding: 0.5rem; border-radius: 6px; color: white; cursor: pointer; transition: all 0.2s; border: 2px solid transparent;" 
                                 onclick="showLessonsByUnit('avancadas')" 
                                 onmouseover="this.style.borderColor='#D97706'; this.style.transform='scale(1.05)';" 
                                 onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)';">
                                <div>‚öîÔ∏è Defesas Avan√ßadas</div>
                                <div style="font-size: 0.75rem;">Aulas 31-40</div>
                            </div>
                            <div style="background: #EF4444; padding: 0.5rem; border-radius: 6px; color: white; cursor: pointer; transition: all 0.2s; border: 2px solid transparent;" 
                                 onclick="showLessonsByUnit('integracao')" 
                                 onmouseover="this.style.borderColor='#DC2626'; this.style.transform='scale(1.05)';" 
                                 onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)';">
                                <div>üîÑ Integra√ß√£o</div>
                                <div style="font-size: 0.75rem;">Aulas 41-48</div>
                            </div>
                        </div>
                    </div>

                    <!-- NEW: Enhanced Unit Navigation Bar -->
                    <div style="background: rgba(15, 23, 42, 0.8); padding: 1rem; border-radius: 12px; margin-bottom: 1rem; border: 1px solid #334155;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                            <h4 style="color: #F8FAFC; margin: 0; font-size: 1rem; font-weight: 600;">üéØ Navega√ß√£o por Unidade</h4>
                            <div style="flex: 1; height: 1px; background: linear-gradient(90deg, #3B82F6, transparent);"></div>
                            <span id="current-unit-name" style="color: #10B981; font-weight: 600; font-size: 0.875rem;">Todas as Unidades</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center;">
                            <button class="btn" onclick="showAllLessons()" 
                                    style="background: linear-gradient(135deg, #6B7280, #4B5563); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; font-size: 0.875rem;" 
                                    onmouseover="this.style.background='linear-gradient(135deg, #4B5563, #374151)'; this.style.transform='translateY(-2px)';" 
                                    onmouseout="this.style.background='linear-gradient(135deg, #6B7280, #4B5563)'; this.style.transform='translateY(0)';">
                                üìã Todas as Aulas
                            </button>
                            <button class="btn" onclick="showLessonsByUnit('fundamentos')" 
                                    style="background: linear-gradient(135deg, #10B981, #059669); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; font-size: 0.875rem;" 
                                    onmouseover="this.style.background='linear-gradient(135deg, #059669, #047857)'; this.style.transform='translateY(-2px)';" 
                                    onmouseout="this.style.background='linear-gradient(135deg, #10B981, #059669)'; this.style.transform='translateY(0)';">
                                üìö Fundamentos
                            </button>
                            <button class="btn" onclick="showLessonsByUnit('golpes')" 
                                    style="background: linear-gradient(135deg, #3B82F6, #1D4ED8); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; font-size: 0.875rem;" 
                                    onmouseover="this.style.background='linear-gradient(135deg, #1D4ED8, #1E40AF)'; this.style.transform='translateY(-2px)';" 
                                    onmouseout="this.style.background='linear-gradient(135deg, #3B82F6, #1D4ED8)'; this.style.transform='translateY(0)';">
                                üëä Golpes B√°sicos
                            </button>
                            <button class="btn" onclick="showLessonsByUnit('defesas')" 
                                    style="background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; font-size: 0.875rem;" 
                                    onmouseover="this.style.background='linear-gradient(135deg, #7C3AED, #6D28D9)'; this.style.transform='translateY(-2px)';" 
                                    onmouseout="this.style.background='linear-gradient(135deg, #8B5CF6, #7C3AED)'; this.style.transform='translateY(0)';">
                                üõ°Ô∏è Defesas B√°sicas
                            </button>
                            <button class="btn" onclick="showLessonsByUnit('avancadas')" 
                                    style="background: linear-gradient(135deg, #F59E0B, #D97706); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; font-size: 0.875rem;" 
                                    onmouseover="this.style.background='linear-gradient(135deg, #D97706, #B45309)'; this.style.transform='translateY(-2px)';" 
                                    onmouseout="this.style.background='linear-gradient(135deg, #F59E0B, #D97706)'; this.style.transform='translateY(0)';">
                                ‚öîÔ∏è Defesas Avan√ßadas
                            </button>
                            <button class="btn" onclick="showLessonsByUnit('integracao')" 
                                    style="background: linear-gradient(135deg, #EF4444, #DC2626); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; font-size: 0.875rem;" 
                                    onmouseover="this.style.background='linear-gradient(135deg, #DC2626, #B91C1C)'; this.style.transform='translateY(-2px)';" 
                                    onmouseout="this.style.background='linear-gradient(135deg, #EF4444, #DC2626)'; this.style.transform='translateY(0)';">
                                üîÑ Integra√ß√£o
                            </button>
                        </div>
                    </div>

                    <!-- Lesson Plans Table Container -->
                    <div id="lesson-plans-container" style="background: rgba(15, 23, 42, 0.5); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; border: 1px solid #334155;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4 style="color: #F8FAFC; margin: 0; font-size: 1.125rem; font-weight: 600;">üìã Planos de Aula</h4>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <span style="color: #10B981; font-size: 0.875rem; font-weight: 500;">‚úÖ Sistema habilitado</span>
                                <button class="btn btn-primary" onclick="manageLessonPlans(currentCourseId)" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                                    <span>‚öôÔ∏è</span> Gerenciar
                                </button>
                                <button class="btn btn-secondary" onclick="exportLessonPlans(currentCourseId)" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                                    <span>üì§</span> Exportar
                                </button>
                            </div>
                        </div>

                        <!-- Lesson Plans Table -->
                        <div style="background: rgba(30, 41, 59, 0.5); border-radius: 8px; overflow: hidden; border: 1px solid #475569;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: rgba(59, 130, 246, 0.1); border-bottom: 1px solid #475569;">
                                        <th style="color: #F8FAFC; padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.875rem;">Aula</th>
                                        <th style="color: #F8FAFC; padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.875rem;">Semana</th>
                                        <th style="color: #F8FAFC; padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.875rem;">T√≠tulo</th>
                                        <th style="color: #F8FAFC; padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.875rem;">Unidade</th>
                                        <th style="color: #F8FAFC; padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.875rem;">T√©cnicas</th>
                                        <th style="color: #F8FAFC; padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.875rem;">Dura√ß√£o</th>
                                        <th style="color: #F8FAFC; padding: 0.75rem; text-align: center; font-weight: 600; font-size: 0.875rem;">N√≠vel</th>
                                        <th style="color: #F8FAFC; padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.875rem;">Status</th>
                                        <th style="color: #F8FAFC; padding: 0.75rem; text-align: center; font-weight: 600; font-size: 0.875rem;">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="lesson-plans-table-body">
                                    <tr>
                                        <td colspan="9" style="text-align: center; color: #CBD5E1; padding: 2rem;">
                                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üéØ</div>
                                            Clique em uma unidade acima para ver os planos de aula
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div style="margin-top: 2rem;">
                        <div style="display: flex; gap: 1rem; align-items: center; justify-content: center;">
                            <button class="btn btn-primary" onclick="manageLessonPlans(currentCourseId)">
                                <span>‚öôÔ∏è</span> Gerenciar Planos de Aula
                            </button>
                            <button class="btn btn-secondary" onclick="exportLessonPlans(currentCourseId)">
                                <span>üì§</span> Exportar Planos
                            </button>
                            <button class="btn btn-secondary" onclick="showLessonPlanManager()">
                                <span>üîß</span> Modo Avan√ßado
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadCourseTechniques() {
            const contentDiv = document.getElementById('courseDetailContent');
            contentDiv.innerHTML = `
                <div>
                    <h3 style="color: #F8FAFC; margin-bottom: 1rem;">ü•ä T√©cnicas do Curso</h3>
                    <div style="background: rgba(139, 92, 246, 0.05); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
                        <p style="color: #CBD5E1; margin-bottom: 1rem;">Total: 42 t√©cnicas catalogadas</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px;">
                                <h4 style="color: #10B981; margin-bottom: 0.5rem;">Fundamentos</h4>
                                <p style="color: #CBD5E1; font-size: 0.875rem;">Posturas, movimenta√ß√£o b√°sica, dist√¢ncia</p>
                            </div>
                            <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px;">
                                <h4 style="color: #3B82F6; margin-bottom: 0.5rem;">Golpes B√°sicos</h4>
                                <p style="color: #CBD5E1; font-size: 0.875rem;">Socos, chutes, joelhadas</p>
                            </div>
                            <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px;">
                                <h4 style="color: #F59E0B; margin-bottom: 0.5rem;">Defesas</h4>
                                <p style="color: #CBD5E1; font-size: 0.875rem;">Bloqueios, esquivas, contra-ataques</p>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="manageTechniques(currentCourseId)">
                            <span>‚öôÔ∏è</span> Gerenciar T√©cnicas
                        </button>
                        <button class="btn btn-secondary" onclick="viewTechniquesLibrary(currentCourseId)">
                            <span>üìö</span> Biblioteca de T√©cnicas
                        </button>
                    </div>
                </div>
            `;
        }

        function loadCourseStudents() {
            const contentDiv = document.getElementById('courseDetailContent');
            contentDiv.innerHTML = `
                <div>
                    <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üë• Alunos Matriculados</h3>
                    <div style="background: rgba(59, 130, 246, 0.05); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
                        <p style="color: #CBD5E1; margin-bottom: 1rem;">Total: 4 alunos matriculados</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px;">
                                <h4 style="color: #10B981; margin-bottom: 0.5rem;">Maria Silva</h4>
                                <p style="color: #CBD5E1; font-size: 0.875rem;">Matr√≠cula: KMA0001 ‚Ä¢ Turma 1 ‚Ä¢ 85% frequ√™ncia</p>
                            </div>
                            <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px;">
                                <h4 style="color: #3B82F6; margin-bottom: 0.5rem;">Pedro Costa</h4>
                                <p style="color: #CBD5E1; font-size: 0.875rem;">Matr√≠cula: KMA0002 ‚Ä¢ Turma 2 ‚Ä¢ 90% frequ√™ncia</p>
                            </div>
                            <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px;">
                                <h4 style="color: #F59E0B; margin-bottom: 0.5rem;">Ana Oliveira</h4>
                                <p style="color: #CBD5E1; font-size: 0.875rem;">Matr√≠cula: KMA0003 ‚Ä¢ Turma 1 ‚Ä¢ 75% frequ√™ncia</p>
                            </div>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 8px;">
                                <h4 style="color: #8B5CF6; margin-bottom: 0.5rem;">Carlos Rodrigues</h4>
                                <p style="color: #CBD5E1; font-size: 0.875rem;">Matr√≠cula: KMA0004 ‚Ä¢ Turma 2 ‚Ä¢ 80% frequ√™ncia</p>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="enrollNewStudent(currentCourseId)">
                            <span>‚ûï</span> Matricular Aluno
                        </button>
                        <button class="btn btn-secondary" onclick="viewStudentProgress(currentCourseId)">
                            <span>üìä</span> Ver Progresso
                        </button>
                    </div>
                </div>
            `;
        }

        // Helper functions for course management
        function editCourse(courseId) {

            showToast('Fun√ß√£o de edi√ß√£o em desenvolvimento', 'info');
        }

        function deleteCourse(courseId) {
            if (confirm('Tem certeza que deseja excluir este curso?')) {

                showToast('Fun√ß√£o de exclus√£o em desenvolvimento', 'info');
            }
        }

        function filterCourses() {
            const searchTerm = document.getElementById('courseSearch').value.toLowerCase();
            const rows = document.querySelectorAll('.course-row');

            rows.forEach(row => {
                const courseName = row.querySelector('td:first-child').textContent.toLowerCase();
                const courseCategory = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                const courseLevel = row.querySelector('td:nth-child(3)').textContent.toLowerCase();

                if (courseName.includes(searchTerm) || courseCategory.includes(searchTerm) || courseLevel.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function refreshCourses() {
            loadCourses();
            showToast('Lista de cursos atualizada', 'success');
        }

        function exportCourses() {

            showToast('Fun√ß√£o de exporta√ß√£o em desenvolvimento', 'info');
        }

        // Course modal functions
        function openAddCourseModal() {
            document.getElementById('').classList.add('active');
        }

        function editCourse(courseId) {
            // Load course data and open edit modal
            fetch(`/api/courses/${courseId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const course = data.data;
                        document.getElementById('editCourseId').value = course.id;
                        document.getElementById('editCourseName').value = course.name;
                        document.getElementById('editCourseDescription').value = course.description || '';
                        document.getElementById('editCourseCategory').value = course.category;
                        document.getElementById('editCourseLevel').value = course.level;
                        document.getElementById('editCourseTotalClasses').value = course.totalClasses;
                        document.getElementById('editCourseClassesPerWeek').value = course.classesPerWeek;

                        document.getElementById('').classList.add('active');
                    }
                })
                .catch(error => {

                });
        }

        // Lesson plans functions
        function showLessonPlans(courseId, courseName) {
            document.getElementById('current-course-name').textContent = courseName;
            document.getElementById('lesson-plans-section').style.display = 'block';

            // Load lesson plans
            fetch(`/api/courses-management/${courseId}/lesson-plans`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateLessonPlansTable(data.data, courseId);
                    }
                })
                .catch(error => {

                });
        }

        function hideLessonPlans() {
            document.getElementById('lesson-plans-section').style.display = 'none';
        }

        function updateLessonPlansTable(lessonPlans, courseId) {
            const tbody = document.getElementById('lesson-plans-table-body');

            if (lessonPlans.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: #CBD5E1; padding: 2rem;">
                            Nenhum plano de aula criado. 
                            <button class="btn btn-primary btn-small" >
                                Criar Primeira Aula
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = lessonPlans.map(plan => `
                <tr>
                    <td>${plan.lessonNumber}</td>
                    <td>${plan.title}</td>
                    <td>${plan.duration} min</td>
                    <td>${plan.difficulty}</td>
                    <td>
                        <button class="btn btn-secondary btn-small" >
                            üí¨ Feedback
                        </button>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary btn-small" >
                                ‚úèÔ∏è Editar
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function openLessonPlanModal(courseId, lessonNumber) {
            document.getElementById('lessonCourseId').value = courseId;
            document.getElementById('lessonNumber').value = lessonNumber;

            // If editing existing lesson plan, load data
            if (lessonNumber > 1) {
                // Load existing lesson plan data (simplified for demo)
                document.getElementById('lessonTitle').value = `Aula ${lessonNumber}`;
            } else {
                // Clear form for new lesson
                document.getElementById('lessonPlanForm').reset();
                document.getElementById('lessonCourseId').value = courseId;
                document.getElementById('lessonNumber').value = lessonNumber;
            }

            document.getElementById('').classList.add('active');
        }

        function openFeedbackModal(courseId, lessonNumber) {
            document.getElementById('feedbackCourseId').value = courseId;
            document.getElementById('feedbackLessonNumber').value = lessonNumber;
            document.getElementById('').classList.add('active');
        }

        // Form submissions
        document.getElementById('addCourseForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = {
                name: document.getElementById('courseName').value,
                description: document.getElementById('courseDescription').value,
                category: document.getElementById('courseCategory').value,
                level: document.getElementById('courseLevel').value,
                totalClasses: document.getElementById('courseTotalClasses').value,
                classesPerWeek: document.getElementById('courseClassesPerWeek').value,
                duration: document.getElementById('courseDuration').value,
                minAge: document.getElementById('courseMinAge').value,
                maxAge: document.getElementById('courseMaxAge').value,
                objectives: document.getElementById('courseObjectives').value.split('\\n').filter(obj => obj.trim()),
                requirements: document.getElementById('courseRequirements').value.split('\\n').filter(req => req.trim())
            };

            fetch('/api/courses-management', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {

                    loadCourses();
                } else {
                    );
                }
            })
            .catch(error => {

            });
        });

        document.getElementById('editCourseForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const courseId = document.getElementById('editCourseId').value;
            const formData = {
                name: document.getElementById('editCourseName').value,
                description: document.getElementById('editCourseDescription').value,
                category: document.getElementById('editCourseCategory').value,
                level: document.getElementById('editCourseLevel').value,
                totalClasses: document.getElementById('editCourseTotalClasses').value,
                classesPerWeek: document.getElementById('editCourseClassesPerWeek').value
            };

            fetch(`/api/courses-management/${courseId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {

                    loadCourses();
                } else {
                    );
                }
            })
            .catch(error => {

            });
        });

        document.getElementById('lessonPlanForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const courseId = document.getElementById('lessonCourseId').value;
            const formData = {
                lessonNumber: document.getElementById('lessonNumber').value,
                title: document.getElementById('lessonTitle').value,
                objectives: document.getElementById('lessonObjectives').value.split('\\n').filter(obj => obj.trim()),
                warmUp: document.getElementById('lessonWarmUp').value,
                mainContent: document.getElementById('lessonMainContent').value,
                coolDown: document.getElementById('lessonCoolDown').value,
                equipment: document.getElementById('lessonEquipment').value.split(',').map(eq => eq.trim()).filter(eq => eq),
                duration: document.getElementById('lessonDuration').value,
                difficulty: document.getElementById('lessonDifficulty').value,
                adaptations: document.getElementById('lessonAdaptations').value,
                notes: document.getElementById('lessonNotes').value
            };

            fetch(`/api/courses-management/${courseId}/lesson-plans`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {

                    // Reload lesson plans
                    showLessonPlans(courseId, document.getElementById('current-course-name').textContent);
                } else {
                    );
                }
            })
            .catch(error => {

            });
        });

        document.getElementById('lessonFeedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = {
                courseId: document.getElementById('feedbackCourseId').value,
                lessonNumber: document.getElementById('feedbackLessonNumber').value,
                feedback: document.getElementById('feedbackGeneral').value,
                studentsPresent: document.getElementById('feedbackStudentsPresent').value,
                improvements: document.getElementById('feedbackImprovements').value,
                nextClassAdjustments: document.getElementById('feedbackImprovements').value
            };

            fetch('/api/lesson-feedback', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {

                } else {
                    );
                }
            })
            .catch(error => {

            });
        });

        // ==========================================
        // STUDENTS MANAGEMENT FUNCTIONS
        // ==========================================

        // ==========================================
        // SISTEMA DE ASSOCIA√á√ïES HIER√ÅRQUICAS
        // ==========================================

        async function loadStudentWithAssociations(studentId) {

            try {
                // Buscar dados do aluno, matr√≠culas e assinaturas em paralelo
                const [studentResponse, enrollmentsResponse, subscriptionsResponse] = await Promise.all([
                    fetch(`/api/students/${studentId}`),
                    fetch(`/api/students/${studentId}/enrollments`),
                    fetch(`/api/students/${studentId}/subscriptions`)
                ]);

                const studentData = await studentResponse.json();
                const enrollmentsData = await enrollmentsResponse.json();
                const subscriptionsData = await subscriptionsResponse.json();

                if (!studentData.success) {
                    throw new Error(studentData.message || 'Erro ao carregar dados do aluno');
                }

                // Buscar dados complementares
                const [classesResponse, coursesResponse, plansResponse] = await Promise.all([
                    fetch('/api/classes'),
                    fetch('/api/courses'),
                    fetch('/api/billing-plans')
                ]);

                const classesData = await classesResponse.json();
                const coursesData = await coursesResponse.json();
                const plansData = await plansResponse.json();

                // Processar associa√ß√µes
                const associations = processStudentAssociations(
                    studentData.data,
                    enrollmentsData.success ? enrollmentsData.data : [],
                    subscriptionsData.success ? subscriptionsData.data : [],
                    classesData.success ? classesData.data : [],
                    coursesData.success ? coursesData.data : [],
                    plansData.success ? plansData.data : []
                );

                return {
                    student: studentData.data,
                    associations: associations
                };

            } catch (error) {

                return null;
            }
        }

        function processStudentAssociations(student, enrollments, subscriptions, allClasses, allCourses, allPlans) {

            const associations = {
                plans: [],
                courses: [],
                classes: [],
                hierarchy: []
            };

            // Processar assinaturas de planos
            subscriptions.forEach(subscription => {
                if (subscription.plan || subscription.billingPlan) {
                    const plan = subscription.plan || subscription.billingPlan;
                    associations.plans.push({
                        subscription: subscription,
                        plan: plan
                    });
                }
            });

            // Processar matr√≠culas
            enrollments.forEach(enrollment => {
                if (enrollment.course) {
                    associations.courses.push({
                        enrollment: enrollment,
                        course: enrollment.course
                    });
                }

                if (enrollment.class) {
                    associations.classes.push({
                        enrollment: enrollment,
                        class: enrollment.class
                    });
                }
            });

            // Criar hierarquia
            associations.plans.forEach(planAssoc => {
                const planHierarchy = {
                    plan: planAssoc.plan,
                    subscription: planAssoc.subscription,
                    courses: [],
                    directClasses: []
                };

                // Encontrar cursos relacionados ao plano
                associations.courses.forEach(courseAssoc => {
                    const course = courseAssoc.course;
                    if (course.category === planAssoc.plan.category || 
                        course.level === planAssoc.plan.level ||
                        course.planId === planAssoc.plan.id ||
                        course.id === planAssoc.plan.courseId) {

                        const courseInPlan = {
                            course: course,
                            enrollment: courseAssoc.enrollment,
                            classes: []
                        };

                        // Encontrar turmas do curso
                        associations.classes.forEach(classAssoc => {
                            if (classAssoc.class.courseId === course.id) {
                                courseInPlan.classes.push({
                                    class: classAssoc.class,
                                    enrollment: classAssoc.enrollment
                                });
                            }
                        });

                        planHierarchy.courses.push(courseInPlan);
                    }
                });

                // Verificar se o plano tem um courseId direto que ainda n√£o foi adicionado
                if (planAssoc.plan.courseId && allCourses && allCourses.length > 0) {
                    const planCourse = allCourses.find(course => course.id === planAssoc.plan.courseId);
                    if (planCourse) {
                        // Verificar se o curso j√° foi adicionado
                        const courseAlreadyAdded = planHierarchy.courses.some(courseInPlan => 
                            courseInPlan.course.id === planCourse.id
                        );

                        if (!courseAlreadyAdded) {

                            const courseInPlan = {
                                course: planCourse,
                                enrollment: null, // Sem matr√≠cula ainda
                                classes: []
                            };

                            // Encontrar turmas do curso
                            associations.classes.forEach(classAssoc => {
                                if (classAssoc.class.courseId === planCourse.id) {
                                    courseInPlan.classes.push({
                                        class: classAssoc.class,
                                        enrollment: classAssoc.enrollment
                                    });
                                }
                            });

                            planHierarchy.courses.push(courseInPlan);
                        }
                    }
                }

                // Encontrar turmas diretas do plano (sem curso)
                associations.classes.forEach(classAssoc => {
                    const isInCourse = planHierarchy.courses.some(courseInPlan => 
                        courseInPlan.classes.some(c => c.class.id === classAssoc.class.id)
                    );

                    if (!isInCourse && (
                        classAssoc.class.category === planAssoc.plan.category || 
                        classAssoc.class.level === planAssoc.plan.level ||
                        classAssoc.class.planId === planAssoc.plan.id
                    )) {
                        planHierarchy.directClasses.push({
                            class: classAssoc.class,
                            enrollment: classAssoc.enrollment
                        });
                    }
                });

                associations.hierarchy.push(planHierarchy);
            });

            // Se n√£o h√° planos, criar uma estrutura b√°sica
            if (associations.hierarchy.length === 0 && (associations.courses.length > 0 || associations.classes.length > 0)) {
                associations.hierarchy.push({
                    plan: { name: 'Sem Plano Definido', category: 'Geral' },
                    subscription: null,
                    courses: associations.courses.map(courseAssoc => ({
                        course: courseAssoc.course,
                        enrollment: courseAssoc.enrollment,
                        classes: associations.classes.filter(classAssoc => 
                            classAssoc.class.courseId === courseAssoc.course.id
                        )
                    })),
                    directClasses: associations.classes.filter(classAssoc => 
                        !associations.courses.some(courseAssoc => 
                            courseAssoc.course.id === classAssoc.class.courseId
                        )
                    )
                });
            }

            return associations;
        }

        function renderStudentClassesWithHierarchy(associations) {

            const classesTab = document.getElementById('student-classes-content');
            if (!classesTab) {

                return;
            }

            if (!associations || associations.hierarchy.length === 0) {
                classesTab.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #6B7280;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üìã</div>
                        <p>Nenhuma turma encontrada para este aluno</p>
                        <button onclick="loadStudentClassesTab()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            üîÑ Recarregar
                        </button>
                    </div>
                `;
                return;
            }

            let html = '<div style="display: grid; gap: 1.5rem; padding: 1rem;">';

            associations.hierarchy.forEach((planHierarchy, planIndex) => {
                const plan = planHierarchy.plan;
                const subscription = planHierarchy.subscription;

                // Contar total de turmas neste plano
                const totalClasses = planHierarchy.courses.reduce((total, course) => 
                    total + course.classes.length, 0
                ) + planHierarchy.directClasses.length;

                html += `
                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05)); border: 1px solid #10B981; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(16, 185, 129, 0.3);">
                            <div>
                                <h4 style="color: #10B981; margin: 0; font-size: 1.2rem; display: flex; align-items: center; gap: 0.5rem;">
                                    üíé ${plan.name}
                                </h4>
                                <p style="color: #94A3B8; margin: 0.25rem 0; font-size: 0.9rem;">
                                    ${plan.price ? `R$ ${parseFloat(plan.price).toFixed(2)}/m√™s` : 'Pre√ßo n√£o definido'} ‚Ä¢ 
                                    ${plan.category || 'Categoria n√£o definida'} ‚Ä¢ 
                                    ${subscription ? subscription.status : 'Status n√£o definido'}
                                </p>
                            </div>
                            <div style="text-align: right; color: #10B981; font-size: 0.8rem;">
                                <div>${planHierarchy.courses.length} curso(s)</div>
                                <div>${totalClasses} turma(s)</div>
                            </div>
                        </div>
                `;

                // Renderizar cursos e suas turmas
                planHierarchy.courses.forEach(courseInPlan => {
                    const course = courseInPlan.course;
                    html += `
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid #3B82F6; border-radius: 8px; padding: 1rem; margin: 0.5rem 0;">
                            <h5 style="color: #3B82F6; margin: 0 0 0.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                üìö ${course.name}
                            </h5>
                            <p style="color: #E5E7EB; margin: 0 0 1rem 0; font-size: 0.9rem;">${course.description || ''}</p>
                    `;

                    // Renderizar turmas do curso
                    courseInPlan.classes.forEach(classInCourse => {
                        const classData = classInCourse.class;
                        html += `
                            <div style="background: rgba(15, 23, 42, 0.5); border: 1px solid #475569; border-radius: 6px; padding: 0.75rem; margin: 0.25rem 0; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="color: #E5E7EB; font-weight: 500;">üïê ${classData.name}</div>
                                    <div style="color: #9CA3AF; font-size: 0.8rem; margin-top: 0.25rem;">
                                        üìÖ ${classData.schedule || 'Hor√°rio flex√≠vel'}
                                        ${classData.capacity ? ` ‚Ä¢ üë• ${classData.capacity} vagas` : ''}
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button onclick="quickCheckinToClass('${classData.id}')" style="padding: 0.25rem 0.5rem; background: #10B981; color: white; border: none; border-radius: 4px; font-size: 0.75rem; cursor: pointer;">
                                        ‚úÖ Check-in
                                    </button>
                                    <button onclick="viewClassDetails('${classData.id}')" style="padding: 0.25rem 0.5rem; background: #3B82F6; color: white; border: none; border-radius: 4px; font-size: 0.75rem; cursor: pointer;">
                                        üëÅÔ∏è Detalhes
                                    </button>
                                </div>
                            </div>
                        `;
                    });

                    html += `</div>`;
                });

                // Renderizar turmas diretas do plano
                if (planHierarchy.directClasses.length > 0) {
                    html += `
                        <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #F59E0B; border-radius: 8px; padding: 1rem; margin-top: 1rem;">
                            <h5 style="color: #F59E0B; margin: 0 0 0.75rem 0;">üéØ Turmas Diretas do Plano</h5>
                    `;

                    planHierarchy.directClasses.forEach(directClass => {
                        const classData = directClass.class;
                        html += `
                            <div style="background: rgba(15, 23, 42, 0.5); border: 1px solid #475569; border-radius: 6px; padding: 0.75rem; margin: 0.25rem 0; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="color: #E5E7EB; font-weight: 500;">üïê ${classData.name}</div>
                                    <div style="color: #9CA3AF; font-size: 0.8rem; margin-top: 0.25rem;">
                                        üìÖ ${classData.schedule || 'Hor√°rio flex√≠vel'}
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button onclick="quickCheckinToClass('${classData.id}')" style="padding: 0.25rem 0.5rem; background: #10B981; color: white; border: none; border-radius: 4px; font-size: 0.75rem; cursor: pointer;">
                                        ‚úÖ Check-in
                                    </button>
                                    <button onclick="viewClassDetails('${classData.id}')" style="padding: 0.25rem 0.5rem; background: #3B82F6; color: white; border: none; border-radius: 4px; font-size: 0.75rem; cursor: pointer;">
                                        üëÅÔ∏è Detalhes
                                    </button>
                                </div>
                            </div>
                        `;
                    });

                    html += `</div>`;
                }

                html += `</div>`;
            });

            html += '</div>';
            classesTab.innerHTML = html;
        }

        function renderStudentCoursesWithHierarchy_OLD(associations) {

            const coursesTab = document.getElementById('student-courses-content');
            if (!coursesTab) {

                return;
            }

            if (!associations || associations.hierarchy.length === 0) {
                coursesTab.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #6B7280;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üìö</div>
                        <p>Nenhum curso encontrado para este aluno</p>
                        <button onclick="loadStudentCoursesTab()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            üîÑ Recarregar
                        </button>
                    </div>
                `;
                return;
            }

            let html = '<div style="display: grid; gap: 1.5rem; padding: 1rem;">';

            associations.hierarchy.forEach((planHierarchy, planIndex) => {
                const plan = planHierarchy.plan;
                const subscription = planHierarchy.subscription;

                if (planHierarchy.courses.length === 0) return;

                html += `
                    <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(29, 78, 216, 0.05)); border: 1px solid #3B82F6; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(59, 130, 246, 0.3);">
                            <div>
                                <h4 style="color: #3B82F6; margin: 0; font-size: 1.2rem; display: flex; align-items: center; gap: 0.5rem;">
                                    üíé ${plan.name}
                                </h4>
                                <p style="color: #94A3B8; margin: 0.25rem 0; font-size: 0.9rem;">
                                    ${plan.price ? `R$ ${parseFloat(plan.price).toFixed(2)}/m√™s` : 'Pre√ßo n√£o definido'} ‚Ä¢ 
                                    ${plan.category || 'Categoria n√£o definida'}
                                </p>
                            </div>
                            <div style="text-align: right; color: #3B82F6; font-size: 0.8rem;">
                                <div>${planHierarchy.courses.length} curso(s)</div>
                            </div>
                        </div>
                `;

                // Renderizar cursos
                planHierarchy.courses.forEach(courseInPlan => {
                    const course = courseInPlan.course;
                    const enrollment = courseInPlan.enrollment;

                    html += `
                        <div style="background: rgba(15, 23, 42, 0.5); border: 1px solid #475569; border-radius: 8px; padding: 1rem; margin: 0.5rem 0; display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <h5 style="color: #E5E7EB; margin: 0 0 0.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    üìö ${course.name}
                                </h5>
                                <p style="color: #9CA3AF; margin: 0 0 0.5rem 0; font-size: 0.85rem;">${course.description || ''}</p>
                                <div style="color: #94A3B8; font-size: 0.75rem;">
                                    Status: ${enrollment.status} ‚Ä¢ 
                                    Matr√≠cula: ${new Date(enrollment.enrollmentDate).toLocaleDateString('pt-BR')} ‚Ä¢
                                    ${courseInPlan.classes.length} turma(s)
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-left: 1rem;">
                                <button onclick="viewCourseProgress('${course.id}')" style="padding: 0.25rem 0.5rem; background: #10B981; color: white; border: none; border-radius: 4px; font-size: 0.75rem; cursor: pointer; white-space: nowrap;">
                                    üìä Progresso
                                </button>
                                <button onclick="viewCourseDetails('${course.id}')" style="padding: 0.25rem 0.5rem; background: #3B82F6; color: white; border: none; border-radius: 4px; font-size: 0.75rem; cursor: pointer; white-space: nowrap;">
                                    üëÅÔ∏è Detalhes
                                </button>
                            </div>
                        </div>
                    `;
                });

                html += `</div>`;
            });

            html += '</div>';
            coursesTab.innerHTML = html;
        }

        // Fun√ß√µes auxiliares para os bot√µes de a√ß√£o

        // ==========================================

        // Global students data storage
        let allStudents = [];
        let filteredStudents = [];
        let currentView = 'table'; // 'table' or 'grid'

        // Make allStudents globally accessible
        window.allStudents = allStudents;

        // Generate simple matricula
        function generateMatricula(studentId, index) {
            // Simple format: just the index number (1, 2, 3, etc.)
            return index ? index.toString() : '1';
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 2rem;
                right: 2rem;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 400px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                ${type === 'success' ? 'background: linear-gradient(135deg, #10B981, #059669);' : ''}
                ${type === 'error' ? 'background: linear-gradient(135deg, #EF4444, #DC2626);' : ''}
                ${type === 'info' ? 'background: linear-gradient(135deg, #3B82F6, #2563EB);' : ''}
            `;
            toast.textContent = message;

            document.body.appendChild(toast);

            // Animate in
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);

            // Auto remove
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 4000);
        }

        function filterStudents() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredStudents = allStudents.filter(student => {
                const user = student.user || {};
                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase();
                const email = (user.email || '').toLowerCase();
                const matricula = (student.matricula || `KMA${String(student.id).padStart(4, '0')}`).toLowerCase();

                // Search filter
                const matchesSearch = !searchTerm || 
                    fullName.includes(searchTerm) || 
                    email.includes(searchTerm) || 
                    matricula.includes(searchTerm);

                // Category filter
                const matchesCategory = !categoryFilter || student.category === categoryFilter;

                // Status filter
                const matchesStatus = !statusFilter || String(student.isActive) === statusFilter;

                return matchesSearch && matchesCategory && matchesStatus;
            });

            updateStudentsGrid();
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 2rem;
                right: 2rem;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                ${type === 'success' ? 'background: #10B981;' : ''}
                ${type === 'error' ? 'background: #EF4444;' : ''}
                ${type === 'info' ? 'background: #3B82F6;' : ''}
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);

            // Auto remove
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Function consolidation: All section loading is now handled in the main showSection function above

        // Students data will be loaded when navigating to the students section

        // ==========================================
        // ATTENDANCE CAPTURE FUNCTIONALITY
        // ==========================================

        // Global variables for attendance
        const currentClassId = '2e47c8b1-5d4c-4a9b-8f3e-1b2c3d4e5f60'; // Turma 1
        const currentLessonNumber = 15;
        let selectedStudentId = null;

        // Load attendance list with interactive checkboxes
        async function loadAttendanceList() {
            try {
                document.getElementById('attendanceList').innerHTML = `
                    <div class="loading-message" style="text-align: center; color: #CBD5E1; padding: 2rem;">
                        <span style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block;">üìã</span>
                        Carregando lista de presen√ßa...
                    </div>
                `;

                const studentsResponse = await fetch(`/api/students`);
                const studentsResult = await studentsResponse.json();

                const attendanceResponse = await fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance`);
                const attendanceResult = await attendanceResponse.json();

                if (studentsResult.success && attendanceResult.success) {
                    displayAttendanceList(studentsResult.data, attendanceResult.data);
                    updateAttendanceStats(studentsResult.data, attendanceResult.data);
                } else {
                    throw new Error('Failed to load attendance data');
                }
            } catch (error) {

                document.getElementById('attendanceList').innerHTML = `
                    <div style="text-align: center; color: #EF4444; padding: 2rem;">
                        <span style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block;">‚ö†Ô∏è</span>
                        Erro ao carregar lista de presen√ßa
                    </div>
                `;
            }
        }

        // Display attendance list with interactive cards
        function displayAttendanceList(students, attendanceRecords) {
            const attendanceMap = {};
            attendanceRecords.forEach(record => {
                attendanceMap[record.studentId] = record;
            });

            const html = `
                <div class="attendance-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    ${students.map(enrollment => {
                        const student = enrollment?.student;
                        if (!student || !student.id) {

                            return '';
                        }
                        const attendance = attendanceMap[student.id];
                        const isPresent = attendance ? attendance.present : false;
                        const isLate = attendance ? attendance.arrived_late : false;
                        const leftEarly = attendance ? attendance.left_early : false;

                        // Safe access to user data
                        const user = student.user || {};
                        const firstName = user.firstName || 'N';
                        const lastName = user.lastName || 'A';
                        const email = user.email || 'sem-email@exemplo.com';
                        const initials = firstName.charAt(0) + lastName.charAt(0);

                        return `
                            <div class="attendance-card" style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1);">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #3B82F6, #10B981); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                        ${initials}
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; color: white;">${firstName} ${lastName}</div>
                                        <div style="font-size: 0.875rem; color: #CBD5E1;">${email}</div>
                                    </div>
                                </div>

                                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                        <input type="checkbox" ${isPresent ? 'checked' : ''} 
                                               onchange="toggleAttendance('${student.id}', 'present', this.checked)"
                                               style="width: 18px; height: 18px;">
                                        <span style="color: white;">Presente</span>
                                        ${isPresent ? '<span style="color: #10B981; margin-left: auto;">‚úÖ</span>' : ''}
                                    </label>

                                    ${isPresent ? `
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-left: 1rem;">
                                            <input type="checkbox" ${isLate ? 'checked' : ''} 
                                                   onchange="toggleAttendance('${student.id}', 'arrived_late', this.checked)"
                                                   style="width: 16px; height: 16px;">
                                            <span style="color: #CBD5E1; font-size: 0.875rem;">Chegou atrasado</span>
                                        </label>

                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-left: 1rem;">
                                            <input type="checkbox" ${leftEarly ? 'checked' : ''} 
                                                   onchange="toggleAttendance('${student.id}', 'left_early', this.checked)"
                                                   style="width: 16px; height: 16px;">
                                            <span style="color: #CBD5E1; font-size: 0.875rem;">Saiu mais cedo</span>
                                        </label>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            document.getElementById('attendanceList').innerHTML = html;
        }

        // Toggle individual attendance
        async function toggleAttendance(studentId, field, value) {
            try {
                const attendanceData = {
                    studentId: studentId,
                    classId: currentClassId,
                    courseId: '750273f9-7508-4fbf-affb-8efe189f2875', // Krav Maga course ID
                    lessonNumber: currentLessonNumber,
                    date: new Date().toISOString()
                };

                if (field === 'present') {
                    attendanceData.present = value;
                    attendanceData.arrived_late = false;
                    attendanceData.left_early = false;
                } else {
                    // Get current attendance status first
                    const currentAttendance = await fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance`);
                    const currentResult = await currentAttendance.json();
                    const studentAttendance = currentResult.data.find(a => a.studentId === studentId);

                    attendanceData.present = studentAttendance ? studentAttendance.present : true;
                    attendanceData[field] = value;
                }

                const response = await fetch('/api/attendance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(attendanceData)
                });

                const result = await response.json();

                if (result.success) {

                    showToast('Presen√ßa atualizada com sucesso!');
                    // Reload attendance list after short delay
                    setTimeout(loadAttendanceList, 500);
                } else {
                    throw new Error(result.message || 'Failed to update attendance');
                }
            } catch (error) {

                showToast('Erro ao atualizar presen√ßa', 'error');
            }
        }

        // Mark all students present
        async function markAllPresent() {
            try {
                const studentsResponse = await fetch(`/api/students`);
                const studentsResult = await studentsResponse.json();

                if (!studentsResult.success) {
                    throw new Error('Failed to load students');
                }

                const studentsData = studentsResult.data.map(enrollment => ({
                    studentId: enrollment.student.id,
                    present: true,
                    arrived_late: false,
                    left_early: false
                }));

                const response = await fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance/bulk`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        students: studentsData,
                        courseId: '750273f9-7508-4fbf-affb-8efe189f2875',
                        date: new Date().toISOString()
                    })
                });

                const result = await response.json();

                if (result.success) {

                    showToast('Todos os alunos marcados como presentes!');
                    loadAttendanceList();
                } else {
                    throw new Error(result.message || 'Failed to mark all present');
                }
            } catch (error) {

                showToast('Erro ao marcar todos presentes', 'error');
            }
        }

        // Update attendance statistics
        function updateAttendanceStats(students, attendanceRecords) {
            const totalStudents = students.length;
            const presentStudents = attendanceRecords.filter(record => record.present).length;
            const absentStudents = totalStudents - presentStudents;
            const attendanceRate = totalStudents > 0 ? Math.round((presentStudents / totalStudents) * 100) : 0;

            document.getElementById('attendanceRate').textContent = attendanceRate + '%';
            document.getElementById('presentCount').textContent = presentStudents;
            document.getElementById('absentCount').textContent = absentStudents;
        }

        // ==========================================
        // QR CODE FUNCTIONALITY
        // ==========================================

        function showQRScanner() {
            const qrCamera = document.getElementById('qrCamera');
            const qrSection = document.getElementById('qrSection');

            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                qrCamera.style.display = 'block';
                qrCamera.innerHTML = `
                    <div style="background: rgba(0,0,0,0.8); padding: 1rem; border-radius: 8px;">
                        <video id="qrVideo" width="300" height="200" style="border-radius: 8px;"></video>
                        <div style="margin-top: 1rem;">
                            <button onclick="stopQRScanner()" style="background: #EF4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
                                Parar Scanner
                            </button>
                        </div>
                        <div id="qrResult" style="margin-top: 1rem; color: #10B981;"></div>
                    </div>
                `;

                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(stream => {
                        const video = document.getElementById('qrVideo');
                        video.srcObject = stream;
                        video.play();
                        showToast('Scanner QR ativado! Aponte para o c√≥digo QR');
                    })
                    .catch(err => {
                        showToast('Erro ao acessar c√¢mera: ' + err.message, 'error');
                    });
            } else {
                showToast('C√¢mera n√£o dispon√≠vel neste dispositivo', 'error');
            }
        }

        function stopQRScanner() {
            const video = document.getElementById('qrVideo');
            if (video && video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }
            document.getElementById('qrCamera').style.display = 'none';
            showToast('Scanner QR desativado');
        }

        function generateClassQR() {
            const qrDisplay = document.getElementById('qrDisplay');
            qrDisplay.style.display = 'block';
            qrDisplay.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 8px; display: inline-block;">
                    <div style="width: 200px; height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border: 2px dashed #ccc; color: #666;">
                        QR Code<br>Aula ${currentLessonNumber}
                    </div>
                    <div style="text-align: center; margin-top: 1rem; color: #333; font-weight: bold;">
                        Aula ${currentLessonNumber} - Turma 1<br>
                        <small>Escaneie para marcar presen√ßa</small>
                    </div>
                </div>
            `;
            showToast('QR Code da aula gerado!');
        }

        // ==========================================
        // GPS LOCATION FUNCTIONALITY
        // ==========================================

        function captureByLocation() {
            const locationResult = document.getElementById('locationResult');

            if (navigator.geolocation) {
                locationResult.innerHTML = '<p style="color: #F59E0B;">üìç Obtendo localiza√ß√£o...</p>';

                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;

                        // Coordenadas fict√≠cias da academia (exemplo)
                        const academyLat = -23.5505;
                        const academyLng = -46.6333;

                        const distance = calculateDistance(lat, lng, academyLat, academyLng);

                        if (distance < 0.1) { // Dentro de 100m
                            locationResult.innerHTML = `
                                <p style="color: #10B981;">‚úÖ Localiza√ß√£o confirmada!</p>
                                <p style="color: #CBD5E1;">Voc√™ est√° na academia (${distance.toFixed(3)}km)</p>
                                <button onclick="markPresentByLocation()" style="background: #10B981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; margin-top: 0.5rem;">
                                    Marcar Presen√ßa
                                </button>
                            `;
                        } else {
                            locationResult.innerHTML = `
                                <p style="color: #EF4444;">‚ùå Localiza√ß√£o inv√°lida</p>
                                <p style="color: #CBD5E1;">Voc√™ est√° a ${distance.toFixed(2)}km da academia</p>
                            `;
                        }
                    },
                    error => {
                        locationResult.innerHTML = `<p style="color: #EF4444;">‚ùå Erro ao obter localiza√ß√£o: ${error.message}</p>`;
                    }
                );
            } else {
                locationResult.innerHTML = '<p style="color: #EF4444;">‚ùå Geolocaliza√ß√£o n√£o suportada</p>';
            }
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Raio da Terra em km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function markPresentByLocation() {
            // Implementar marca√ß√£o por localiza√ß√£o
            showToast('Funcionalidade em desenvolvimento');
        }

        // ==========================================
        // SEARCH FUNCTIONALITY
        // ==========================================

        // Using the global allStudents variable declared above

        async function loadAllStudents() {
            try {
                const response = await fetch(`/api/students`);
                const result = await response.json();
                if (result.success) {
                    allStudents = result.data;
                }
            } catch (error) {

            }
        }

        function searchStudentByName(query) {
            if (!query.trim()) {
                document.getElementById('searchResults').innerHTML = '<p>Digite para buscar alunos por nome</p>';
                selectedStudentId = null;
                return;
            }

            const filtered = allStudents.filter(enrollment => {
                const student = enrollment?.student;
                if (!student || !student.user) return false;
                const user = student.user;
                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase();
                return fullName.includes(query.toLowerCase());
            });

            displaySearchResults(filtered);
        }

        function searchStudentByID(query) {
            if (!query.trim()) {
                document.getElementById('searchResults').innerHTML = '<p>Digite para buscar por matr√≠cula</p>';
                selectedStudentId = null;
                return;
            }

            const filtered = allStudents.filter(enrollment => {
                const student = enrollment?.student;
                if (!student) return false;
                const user = student.user || {};
                return student.id?.includes(query) || 
                       (user.email || '').includes(query);
            });

            displaySearchResults(filtered);
        }

        function displaySearchResults(students) {
            if (students.length === 0) {
                document.getElementById('searchResults').innerHTML = '<p style="color: #EF4444;">Nenhum aluno encontrado</p>';
                selectedStudentId = null;
                return;
            }

            const html = students.map(enrollment => {
                const student = enrollment?.student;
                if (!student || !student.id) return '';

                const user = student.user || {};
                const firstName = user.firstName || 'N';
                const lastName = user.lastName || 'A';
                const email = user.email || 'sem-email@exemplo.com';

                return `
                    <div onclick="selectStudent('${student.id}')" 
                         style="padding: 0.5rem; margin: 0.25rem 0; background: rgba(59, 130, 246, 0.1); border-radius: 4px; cursor: pointer; border: 1px solid rgba(59, 130, 246, 0.3);"
                         onmouseover="this.style.background='rgba(59, 130, 246, 0.2)'"
                         onmouseout="this.style.background='rgba(59, 130, 246, 0.1)'">
                        <strong>${firstName} ${lastName}</strong><br>
                        <small style="color: #CBD5E1;">${email} | ID: ${student.id.slice(0, 8)}...</small>
                    </div>
                `;
            }).join('');

            document.getElementById('searchResults').innerHTML = html;
        }

        function selectStudent(studentId) {
            selectedStudentId = studentId;
            const student = allStudents.find(e => e.student.id === studentId);
            if (student) {
                const user = student.student.user || {};
                const firstName = user.firstName || 'N';
                const lastName = user.lastName || 'A';
                document.getElementById('searchResults').innerHTML = `
                    <p style="color: #10B981;">‚úÖ Selecionado: ${firstName} ${lastName}</p>
                `;
            }
        }

        function markSelectedPresent() {
            if (!selectedStudentId) {
                showToast('Selecione um aluno primeiro', 'error');
                return;
            }
            toggleAttendance(selectedStudentId, 'present', true);
        }

        // Enhanced toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast') || createToast();
            const icon = type === 'error' ? '‚ùå' : '‚úÖ';
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>${icon}</span>
                    <span>${message}</span>
                </div>
            `;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 3000);
        }

        function createToast() {
            const toast = document.createElement('div');
            toast.id = 'toast';
            toast.className = 'toast';
            toast.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 10000;
                background: rgba(16, 185, 129, 0.9); color: white; padding: 1rem;
                border-radius: 8px; display: none; max-width: 300px;
            `;
            document.body.appendChild(toast);
            return toast;
        }

        // Initialize attendance when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadAllStudents();
        });

        // ==========================================
        // STUDENT PORTAL FUNCTIONALITY
        // ==========================================

        let currentStudent = null;

        // Student login function
        async function studentLogin() {
            const name = document.getElementById('studentName').value.trim();
            const matricula = document.getElementById('studentMatricula').value.trim();

            if (!name || !matricula) {
                showToast('Por favor, preencha nome e matr√≠cula', 'error');
                return;
            }

            try {
                // Search for student by name and email/ID
                const response = await fetch(`/api/students`);
                const result = await response.json();

                if (result.success) {
                    const student = result.data.find(enrollment => {
                        const s = enrollment?.student;
                        if (!s || !s.user) return false;
                        const user = s.user;
                        const fullName = `${user.firstName || 'N'} ${user.lastName || 'A'}`.toLowerCase();
                        return fullName.includes(name.toLowerCase()) && 
                               ((user.email || '').includes(matricula) || s.id.includes(matricula));
                    });

                    if (student) {
                        currentStudent = student.student;
                        showStudentDashboard();
                        showToast(`Bem-vindo, ${currentStudent.user.firstName}!`);
                    } else {
                        showToast('Aluno n√£o encontrado. Verifique nome e matr√≠cula', 'error');
                    }
                }
            } catch (error) {

                showToast('Erro ao fazer login', 'error');
            }
        }

        // Show student dashboard after login
        function showStudentDashboard() {
            document.getElementById('studentLoginSection').style.display = 'none';
            document.getElementById('studentDashboard').style.display = 'block';

            // Update welcome message
            document.getElementById('studentWelcome').textContent = 
                `üëã Bem-vindo, ${currentStudent.user.firstName} ${currentStudent.user.lastName}!`;

            // Load student data
            loadStudentData();
        }

        // Student logout
        function studentLogout() {
            currentStudent = null;
            document.getElementById('studentLoginSection').style.display = 'block';
            document.getElementById('studentDashboard').style.display = 'none';
            document.getElementById('studentName').value = '';
            document.getElementById('studentMatricula').value = '';
            showToast('Logout realizado com sucesso');
        }

        // Load student specific data
        async function loadStudentData() {
            try {
                // Load attendance data
                const attendanceResponse = await fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance`);
                const attendanceResult = await attendanceResponse.json();

                if (attendanceResult.success) {
                    const studentAttendance = attendanceResult.data.find(a => a.studentId === currentStudent.id);
                    updateStudentStats(studentAttendance);
                    loadStudentAttendanceHistory();
                }

                // Load progress data
                loadStudentProgress();
                loadStudentChallenges();

            } catch (error) {

            }
        }

        // Update student statistics
        function updateStudentStats(todayAttendance) {
            // No hardcoded data - will be populated by real API calls

            // Update attendance status for today
            if (todayAttendance && todayAttendance.present) {
                document.getElementById('studentManualResult').innerHTML = 
                    '<span style="color: #10B981;">‚úÖ Presen√ßa j√° confirmada!</span>';
            }
        }

        // Load student attendance history
        function loadStudentAttendanceHistory() {
            const historyHtml = `
                <div style="space-y: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 4px; margin-bottom: 0.5rem;">
                        <span>Aula 15 - 27/06</span>
                        <span style="color: #10B981;">‚úÖ Presente</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 4px; margin-bottom: 0.5rem;">
                        <span>Aula 14 - 25/06</span>
                        <span style="color: #10B981;">‚úÖ Presente</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(239, 68, 68, 0.1); border-radius: 4px; margin-bottom: 0.5rem;">
                        <span>Aula 13 - 22/06</span>
                        <span style="color: #EF4444;">‚ùå Ausente</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(245, 158, 11, 0.1); border-radius: 4px; margin-bottom: 0.5rem;">
                        <span>Aula 12 - 20/06</span>
                        <span style="color: #F59E0B;">‚è∞ Atrasado</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 4px; margin-bottom: 0.5rem;">
                        <span>Aula 11 - 18/06</span>
                        <span style="color: #10B981;">‚úÖ Presente</span>
                    </div>
                </div>
            `;
            document.getElementById('studentAttendanceHistory').innerHTML = historyHtml;
        }

        // Load student progress in techniques
        function loadStudentProgress() {
            const progressHtml = `
                <div style="space-y: 0.5rem;">
                    <div style="padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 4px; margin-bottom: 0.5rem;">
                        <div style="font-weight: 600; color: #10B981;">‚úÖ Postura de Guarda</div>
                        <small style="color: #CBD5E1;">Dominada - 95% precis√£o</small>
                    </div>
                    <div style="padding: 0.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 4px; margin-bottom: 0.5rem;">
                        <div style="font-weight: 600; color: #10B981;">‚úÖ Soco Direto</div>
                        <small style="color: #CBD5E1;">Dominada - 88% precis√£o</small>
                    </div>
                    <div style="padding: 0.5rem; background: rgba(245, 158, 11, 0.1); border-radius: 4px; margin-bottom: 0.5rem;">
                        <div style="font-weight: 600; color: #F59E0B;">üîÑ Defesa Contra Soco</div>
                        <small style="color: #CBD5E1;">Em progresso - 65% precis√£o</small>
                    </div>
                    <div style="padding: 0.5rem; background: rgba(75, 85, 99, 0.1); border-radius: 4px; margin-bottom: 0.5rem;">
                        <div style="font-weight: 600; color: #6B7280;">‚è≥ Joelhada</div>
                        <small style="color: #CBD5E1;">Pr√≥xima t√©cnica</small>
                    </div>
                    <div style="padding: 0.5rem; background: rgba(75, 85, 99, 0.1); border-radius: 4px; margin-bottom: 0.5rem;">
                        <div style="font-weight: 600; color: #6B7280;">‚è≥ Esquiva Lateral</div>
                        <small style="color: #CBD5E1;">Pr√≥xima t√©cnica</small>
                    </div>
                </div>
            `;
            document.getElementById('studentTechniquesProgress').innerHTML = progressHtml;
        }

        // Load student challenges
        function loadStudentChallenges() {
            const challengesHtml = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);">
                        <h5 style="color: #3B82F6; margin-bottom: 0.5rem;">üì± Desafio da Semana</h5>
                        <p style="margin-bottom: 1rem;">Pratique 10 socos diretos em casa e filme</p>
                        <button style="width: 100%; padding: 0.5rem; background: #3B82F6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Enviar V√≠deo
                        </button>
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
                        <h5 style="color: #10B981; margin-bottom: 0.5rem;">‚úÖ Desafio Completo</h5>
                        <p style="margin-bottom: 1rem;">Postura de guarda por 2 minutos</p>
                        <div style="color: #10B981; font-weight: 600;">+50 Pontos XP</div>
                    </div>
                    <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(245, 158, 11, 0.3);">
                        <h5 style="color: #F59E0B; margin-bottom: 0.5rem;">‚è∞ Desafio Extra</h5>
                        <p style="margin-bottom: 1rem;">Treine cardio por 15 minutos</p>
                        <button style="width: 100%; padding: 0.5rem; background: #F59E0B; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Marcar Completo
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('studentChallenges').innerHTML = challengesHtml;
        }

        // Student QR scan function
        function studentQRScan() {
            const resultDiv = document.getElementById('studentQRResult');

            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                resultDiv.innerHTML = '<span style="color: #F59E0B;">üì∑ Ativando c√¢mera...</span>';

                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(stream => {
                        resultDiv.innerHTML = `
                            <div style="margin: 1rem 0;">
                                <video id="studentQRVideo" width="200" height="150" style="border-radius: 8px; background: #000;"></video>
                                <div style="margin-top: 0.5rem;">
                                    <button onclick="stopStudentQRScan()" style="background: #EF4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">
                                        Parar
                                    </button>
                                </div>
                            </div>
                        `;
                        const video = document.getElementById('studentQRVideo');
                        video.srcObject = stream;
                        video.play();

                        // Simulate QR detection after 3 seconds
                        setTimeout(() => {
                            studentMarkPresenceQR();
                        }, 3000);
                    })
                    .catch(err => {
                        resultDiv.innerHTML = '<span style="color: #EF4444;">‚ùå Erro ao acessar c√¢mera</span>';
                    });
            } else {
                resultDiv.innerHTML = '<span style="color: #EF4444;">‚ùå C√¢mera n√£o dispon√≠vel</span>';
            }
        }

        function stopStudentQRScan() {
            const video = document.getElementById('studentQRVideo');
            if (video && video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }
            document.getElementById('studentQRResult').innerHTML = 'Escaneie o QR code mostrado pelo instrutor';
        }

        function studentMarkPresenceQR() {
            stopStudentQRScan();
            markStudentPresent('QR_CODE');
            document.getElementById('studentQRResult').innerHTML = '<span style="color: #10B981;">‚úÖ QR Code detectado! Presen√ßa confirmada</span>';
        }

        // Student GPS check
        function studentGPSCheck() {
            const resultDiv = document.getElementById('studentGPSResult');

            if (navigator.geolocation) {
                resultDiv.innerHTML = '<span style="color: #F59E0B;">üìç Verificando localiza√ß√£o...</span>';

                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;

                        // Academy coordinates (mock)
                        const academyLat = -23.5505;
                        const academyLng = -46.6333;

                        const distance = calculateDistance(lat, lng, academyLat, academyLng);

                        if (distance < 0.1) { // Within 100m
                            markStudentPresent('GEOLOCATION');
                            resultDiv.innerHTML = '<span style="color: #10B981;">‚úÖ Localiza√ß√£o confirmada! Presen√ßa marcada</span>';
                        } else {
                            resultDiv.innerHTML = `<span style="color: #EF4444;">‚ùå Voc√™ est√° a ${distance.toFixed(2)}km da academia</span>`;
                        }
                    },
                    error => {
                        resultDiv.innerHTML = '<span style="color: #EF4444;">‚ùå Erro ao obter localiza√ß√£o</span>';
                    }
                );
            } else {
                resultDiv.innerHTML = '<span style="color: #EF4444;">‚ùå GPS n√£o dispon√≠vel</span>';
            }
        }

        // Student manual check-in
        function studentManualCheckIn() {
            markStudentPresent('MANUAL');
            document.getElementById('studentManualResult').innerHTML = '<span style="color: #10B981;">‚úÖ Presen√ßa confirmada manualmente!</span>';
        }

        // Mark student present (unified function)
        async function markStudentPresent(method) {
            if (!currentStudent) {
                showToast('Erro: aluno n√£o identificado', 'error');
                return;
            }

            try {
                const attendanceData = {
                    studentId: currentStudent.id,
                    classId: currentClassId,
                    courseId: '750273f9-7508-4fbf-affb-8efe189f2875',
                    lessonNumber: currentLessonNumber,
                    date: new Date().toISOString(),
                    present: true,
                    arrived_late: false,
                    left_early: false,
                    method: method
                };

                const response = await fetch('/api/attendance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(attendanceData)
                });

                const result = await response.json();

                if (result.success) {
                    showToast(`Presen√ßa confirmada via ${method}!`);
                    // Update stats
                    updateStudentStats({present: true});
                } else {
                    throw new Error(result.message || 'Failed to mark attendance');
                }
            } catch (error) {

                showToast('Erro ao confirmar presen√ßa', 'error');
            }
        }

        // Navigation functionality consolidated in main showSection function above

        // ==========================================
        // PUBLIC CHECK-IN KIOSK FUNCTIONALITY
        // ==========================================

        let publicCheckinStudents = [];
        let checkinCount = 0;
        let selectedStudentForCheckin = null;

        // Load public check-in interface
        async function loadPublicCheckin() {
            await loadStudentsForCheckin();
            loadRecentCheckins();
            updateCheckinCount();
            document.getElementById('quickMatricula').value = '';
            document.getElementById('quickResult').innerHTML = 'Digite sua matr√≠cula e pressione Enter';
        }

        // Load students for visual selection
        async function loadStudentsForCheckin() {
            try {
                const response = await fetch(`/api/students`);
                const result = await response.json();

                if (result.success) {
                    publicCheckinStudents = result.data;
                    displayStudentGrid();
                }
            } catch (error) {

            }
        }

        // Display student grid with photos
        function displayStudentGrid() {
            const grid = document.getElementById('studentGrid');

            if (!grid) {

                return;
            }

            const html = publicCheckinStudents.map(item => {
                // Check if data is in enrollment.student format or direct student format
                const student = item?.student || item;
                if (!student || !student.id) {

                    return '';
                }

                // Safe access to user data
                const user = student.user || {};
                const firstName = user.firstName || 'N';
                const lastName = user.lastName || 'A';
                const initials = firstName.charAt(0) + lastName.charAt(0);

                return `
                    <div onclick="selectStudentForCheckin('${student.id}')" 
                         class="student-card" id="card-${student.id}"
                         style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: all 0.2s;"
                         onmouseover="this.style.background='rgba(59, 130, 246, 0.2)'; this.style.borderColor='#3B82F6'"
                         onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.borderColor='transparent'">

                        <div style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #3B82F6, #10B981); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.5rem; margin: 0 auto 0.5rem;">
                            ${initials}
                        </div>

                        <div style="font-weight: 600; color: white; font-size: 0.875rem; margin-bottom: 0.25rem;">
                            ${firstName}
                        </div>
                        <div style="font-weight: 600; color: white; font-size: 0.875rem; margin-bottom: 0.5rem;">
                            ${lastName}
                        </div>

                        <div style="font-size: 0.75rem; color: #CBD5E1;">
                            ID: ${student.id.slice(0, 6)}...
                        </div>

                        <div id="status-${student.id}" style="margin-top: 0.5rem; font-size: 0.75rem;">
                            <span style="color: #6B7280;">üë§ Ausente</span>
                        </div>
                    </div>
                `;
            }).join('');

            grid.innerHTML = html;
        }

        // Select student for check-in
        function selectStudentForCheckin(studentId) {
            // Reset all cards
            document.querySelectorAll('.student-card').forEach(card => {
                card.style.background = 'rgba(255,255,255,0.1)';
                card.style.borderColor = 'transparent';
            });

            // Highlight selected card
            const selectedCard = document.getElementById(`card-${studentId}`);
            if (selectedCard) {
                selectedCard.style.background = 'rgba(16, 185, 129, 0.2)';
                selectedCard.style.borderColor = '#10B981';
            }

            selectedStudentForCheckin = studentId;

            // Find student info - handle both direct student format and enrollment format
            const studentItem = publicCheckinStudents.find(item => {
                const student = item?.student || item;
                return student && student.id === studentId;
            });

            if (studentItem) {
                const student = studentItem?.student || studentItem;
                const user = student.user || {};
                const firstName = user.firstName || 'N';
                const lastName = user.lastName || 'A';
                document.getElementById('quickResult').innerHTML = 
                    `<span style="color: #10B981;">‚úÖ ${firstName} ${lastName} selecionado</span>`;

                // Auto check-in after 2 seconds
                setTimeout(() => {
                    publicCheckinStudent(studentId);
                }, 2000);
            }
        }

        // Handle quick search by typing
        function handleQuickSearch(event) {
            const query = event.target.value.trim();

            if (event.key === 'Enter' && query) {
                quickCheckin();
                return;
            }

            if (!query) {
                document.getElementById('quickResult').innerHTML = 'Digite sua matr√≠cula e pressione Enter';
                return;
            }

            // Real-time search - handle both direct student format and enrollment format
            const found = publicCheckinStudents.find(item => {
                const student = item?.student || item;
                if (!student || !student.user) return false;
                const user = student.user;
                return student.id.includes(query) || 
                       (user.email || '').includes(query) ||
                       `${user.firstName || 'N'} ${user.lastName || 'A'}`.toLowerCase().includes(query.toLowerCase());
            });

            if (found) {
                const student = found?.student || found;
                selectedStudentForCheckin = student.id;
                const user = student.user || {};
                const firstName = user.firstName || 'N';
                const lastName = user.lastName || 'A';
                document.getElementById('quickResult').innerHTML = 
                    `<span style="color: #10B981;">‚úÖ ${firstName} ${lastName} encontrado - Pressione Enter</span>`;
            } else {
                selectedStudentForCheckin = null;
                document.getElementById('quickResult').innerHTML = 
                    `<span style="color: #F59E0B;">‚ö†Ô∏è Aluno n√£o encontrado</span>`;
            }
        }

        // Quick check-in function
        function quickCheckin() {
            if (!selectedStudentForCheckin) {
                document.getElementById('quickResult').innerHTML = 
                    `<span style="color: #EF4444;">‚ùå Digite uma matr√≠cula v√°lida</span>`;
                return;
            }

            publicCheckinStudent(selectedStudentForCheckin);
        }

        // Public check-in student (unified function)
        async function publicCheckinStudent(studentId) {
            try {
                const attendanceData = {
                    studentId: studentId,
                    classId: currentClassId,
                    courseId: '750273f9-7508-4fbf-affb-8efe189f2875',
                    lessonNumber: currentLessonNumber,
                    date: new Date().toISOString(),
                    present: true,
                    arrived_late: false,
                    left_early: false,
                    method: 'KIOSK'
                };

                const response = await fetch('/api/attendance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(attendanceData)
                });

                const result = await response.json();

                if (result.success) {
                    const studentItem = publicCheckinStudents.find(item => {
                        const student = item?.student || item;
                        return student && student.id === studentId;
                    });

                    if (studentItem) {
                        const student = studentItem?.student || studentItem;
                        const user = student.user || {};
                        const studentName = `${user.firstName || 'N'} ${user.lastName || 'A'}`;

                        // Update UI
                        updateStudentCheckinStatus(studentId, true);
                        showSuccessAnimation(studentName);
                        loadRecentCheckins();
                        updateCheckinCount();

                        // Clear selection
                        selectedStudentForCheckin = null;
                        document.getElementById('quickMatricula').value = '';
                        document.getElementById('quickResult').innerHTML = 'Digite sua matr√≠cula e pressione Enter';
                    }

                } else {
                    throw new Error(result.message || 'Failed to mark attendance');
                }
            } catch (error) {

                document.getElementById('quickResult').innerHTML = 
                    `<span style="color: #EF4444;">‚ùå Erro no check-in</span>`;
            }
        }

        // Update student check-in status in the grid
        function updateStudentCheckinStatus(studentId, present) {
            const statusDiv = document.getElementById(`status-${studentId}`);
            const card = document.getElementById(`card-${studentId}`);

            if (present) {
                statusDiv.innerHTML = '<span style="color: #10B981;">‚úÖ Presente</span>';
                card.style.background = 'rgba(16, 185, 129, 0.1)';
                card.style.borderColor = '#10B981';
                card.onclick = null; // Disable further clicks
                card.style.cursor = 'default';
            }
        }

        // Show success animation
        function showSuccessAnimation(studentName) {
            const animation = document.createElement('div');
            animation.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: rgba(16, 185, 129, 0.95); color: white; padding: 2rem;
                border-radius: 16px; font-size: 1.5rem; font-weight: bold;
                z-index: 10000; text-align: center; min-width: 300px;
                animation: successPulse 0.5s ease-in-out;
            `;
            animation.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 1rem;">‚úÖ</div>
                <div>Check-in Realizado!</div>
                <div style="font-size: 1rem; margin-top: 0.5rem;">${studentName}</div>
            `;

            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes successPulse {
                    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(animation);

            setTimeout(() => {
                document.body.removeChild(animation);
                document.head.removeChild(style);
            }, 3000);
        }

        // Load recent check-ins
        async function loadRecentCheckins() {
            try {
                const response = await fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance`);
                const result = await response.json();

                if (result.success) {
                    displayRecentCheckins(result.data);
                }
            } catch (error) {

            }
        }

        // Display recent check-ins
        function displayRecentCheckins(attendanceRecords) {
            const container = document.getElementById('recentCheckins');

            if (!attendanceRecords || attendanceRecords.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6B7280;">
                        Nenhum check-in hoje ainda
                    </div>
                `;
                return;
            }

            const html = attendanceRecords
                .filter(record => record.present)
                .map(record => {
                    const student = publicCheckinStudents.find(e => e.student.id === record.studentId);
                    if (!student) return '';

                    const time = new Date().toLocaleTimeString('pt-BR', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });

                    return `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #10B981;">
                            <div>
                                <div style="font-weight: 600; color: white;">
                                    ${(student.student?.user?.firstName || 'N/A')} ${(student.student?.user?.lastName || '')}
                                </div>
                                <div style="font-size: 0.875rem; color: #CBD5E1;">
                                    ID: ${(student.student?.id || 'N/A').toString().slice(0, 8)}...
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #10B981; font-weight: 600;">‚úÖ Presente</div>
                                <div style="font-size: 0.875rem; color: #CBD5E1;">${time}</div>
                            </div>
                        </div>
                    `;
                })
                .join('');

            container.innerHTML = html || `
                <div style="text-align: center; padding: 2rem; color: #6B7280;">
                    Nenhum check-in hoje ainda
                </div>
            `;
        }

        // Update check-in count
        function updateCheckinCount() {
            // Count present students
            fetch(`/api/classes/${currentClassId}/lessons/${currentLessonNumber}/attendance`)
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        const presentCount = result.data.filter(record => record.present).length;
                        const totalStudents = publicCheckinStudents.length;
                        document.getElementById('checkinCount').textContent = `${presentCount} Presentes`;
                    }
                })
                .catch(error => );
        }

        // Refresh student grid
        function refreshStudentGrid() {
            loadStudentsForCheckin();
            showToast('Lista de alunos atualizada');
        }

        // Public QR Scanner
        function togglePublicQRScanner() {
            const camera = document.getElementById('publicQRCamera');

            if (camera.style.display === 'none') {
                startPublicQRScanner();
            } else {
                stopPublicQRScanner();
            }
        }

        function startPublicQRScanner() {
            const camera = document.getElementById('publicQRCamera');
            const result = document.getElementById('publicQRResult');

            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                camera.style.display = 'block';
                camera.innerHTML = `
                    <div style="background: rgba(0,0,0,0.8); padding: 1rem; border-radius: 8px; display: inline-block;">
                        <video id="publicQRVideo" width="300" height="200" style="border-radius: 8px;"></video>
                        <div style="margin-top: 1rem;">
                            <button onclick="stopPublicQRScanner()" style="background: #EF4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
                                Parar Scanner
                            </button>
                        </div>
                    </div>
                `;

                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(stream => {
                        const video = document.getElementById('publicQRVideo');
                        video.srcObject = stream;
                        video.play();
                        result.innerHTML = '<span style="color: #10B981;">üì∑ Scanner ativo - Aponte para o QR code</span>';

                        // Simulate QR detection after 5 seconds
                        setTimeout(() => {
                            if (publicCheckinStudents.length > 0) {
                                const randomStudent = publicCheckinStudents[0].student; // Use first student for demo
                                publicCheckinStudent(randomStudent.id);
                                result.innerHTML = '<span style="color: #10B981;">‚úÖ QR Code detectado!</span>';
                                stopPublicQRScanner();
                            }
                        }, 5000);
                    })
                    .catch(err => {
                        result.innerHTML = '<span style="color: #EF4444;">‚ùå Erro ao acessar c√¢mera</span>';
                    });
            } else {
                result.innerHTML = '<span style="color: #EF4444;">‚ùå C√¢mera n√£o dispon√≠vel</span>';
            }
        }

        function stopPublicQRScanner() {
            const video = document.getElementById('publicQRVideo');
            if (video && video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }
            document.getElementById('publicQRCamera').style.display = 'none';
            document.getElementById('publicQRResult').innerHTML = 'Escaneie o QR code do seu cart√£o de aluno';
        }

        // ==========================================
        // STUDENT DETAILS MODAL FUNCTIONS
        // ==========================================

        // Store current students data globally for modal access
        window.currentStudents = [];

        // Update currentStudents when data is loaded
        const originalLoadStudents = loadStudents;
        loadStudents = async function() {
            await originalLoadStudents();
            window.currentStudents = allStudents || [];
        };

        // Open student details modal
        window.openStudentDetails = async function(studentId) {
            try {

                // Find student data from current students list
                const student = window.currentStudents?.find(s => s.id === studentId);

                if (!student) {

                    showToast('Aluno n√£o encontrado', 'error');
                    return;
                }

                // Populate modal with student data
                populateStudentModal(student);

                // Show modal
                document.getElementById('studentDetailsModal').style.display = 'block';
                document.body.style.overflow = 'hidden'; // Prevent background scrolling

            } catch (error) {

                showToast('Erro ao abrir detalhes do aluno', 'error');
            }
        };

        // Close student details modal
        window.closeStudentModal = function() {
            document.getElementById('studentDetailsModal').style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
        };

        // Switch between tabs in student modal
        window.switchStudentTab = function(tabName) {

            // Hide all tab contents
            const tabContents = document.querySelectorAll('.student-tab-content');

            tabContents.forEach(tab => {

                tab.style.display = 'none';
            });

            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.student-tab-btn');
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.style.color = '#94A3B8';
                btn.style.borderBottomColor = 'transparent';
            });

            // Show selected tab content
            const selectedTab = document.getElementById(`student-tab-${tabName}`);

            if (selectedTab) {
                selectedTab.style.display = 'block';

            } else {

            }

            // Add active class to selected tab button
            const selectedBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('active');
                selectedBtn.style.color = '#3B82F6';
                selectedBtn.style.borderBottomColor = '#3B82F6';
            }

            // Load dynamic content based on tab
            loadTabContent(tabName);
        };

        // Populate student modal with data
        function populateStudentModal(student) {
            try {
                // Header information
                const user = student.user || {};
                const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();
                document.getElementById('modalStudentName').textContent = fullName || 'Nome n√£o informado';
                document.getElementById('modalStudentId').textContent = `ID: ${student.id?.substring(0, 8) || 'N/A'}...`;

                // Summary information
                document.getElementById('modalStudentStatus').textContent = student.isActive ? 'Ativo' : 'Inativo';
                document.getElementById('modalStudentCategory').textContent = getCategoryText(student.category);
                document.getElementById('modalStudentClasses').textContent = '1'; // Default for now
                document.getElementById('modalStudentAttendance').textContent = '85%'; // Default for now

                // Basic Information
                document.getElementById('modalFullName').textContent = fullName || 'N√£o informado';
                document.getElementById('modalCpf').textContent = user.cpf ? formatCPF(user.cpf) : 'N√£o informado';
                document.getElementById('modalBirthDate').textContent = user.birthDate ? new Date(user.birthDate).toLocaleDateString('pt-BR') : 'N√£o informado';
                document.getElementById('modalAge').textContent = calculateAge(user.birthDate) || 'N/A';
                document.getElementById('modalGender').textContent = getGenderText(student.gender);
                document.getElementById('modalEmail').textContent = user.email || 'N√£o informado';
                document.getElementById('modalPhone').textContent = user.phone || 'N√£o informado';

                // Address Information
                document.getElementById('modalPostalCode').textContent = student.postalCode || 'N√£o informado';
                document.getElementById('modalAddress').textContent = student.address || 'N√£o informado';
                document.getElementById('modalAddressNumber').textContent = student.addressNumber || 'N√£o informado';
                document.getElementById('modalNeighborhood').textContent = student.neighborhood || 'N√£o informado';
                document.getElementById('modalCity').textContent = student.city || 'N√£o informado';
                document.getElementById('modalState').textContent = student.state || 'N√£o informado';

                // Academic Information
                document.getElementById('modalRegistration').textContent = student.matricula || student.id?.substring(0, 8) || 'N/A';
                document.getElementById('modalEnrollmentDate').textContent = student.createdAt ? new Date(student.createdAt).toLocaleDateString('pt-BR') : 'N√£o informado';
                document.getElementById('modalStudentCategoryDetails').textContent = getCategoryText(student.category);
                document.getElementById('modalStatusDetails').textContent = student.isActive ? 'Ativo' : 'Inativo';
                document.getElementById('modalSpecialNeeds').textContent = student.specialNeeds?.length > 0 ? student.specialNeeds.join(', ') : 'Nenhuma';

                // Emergency Contact (placeholder for now)
                document.getElementById('modalEmergencyName').textContent = student.emergencyContact || 'N√£o informado';
                document.getElementById('modalEmergencyPhone').textContent = 'N√£o informado';
                document.getElementById('modalEmergencyRelation').textContent = 'N√£o informado';

            } catch (error) {

            }
        }

        // Load dynamic tab content
        function loadTabContent(tabName) {
            const tabContent = document.getElementById(`student-tab-${tabName}`);

            switch(tabName) {
                case 'courses':
                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {
                        tabContent.innerHTML = `
                            <div style="background: rgba(59, 130, 246, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);">
                                <h3 style="color: #3B82F6; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    <span>üìö</span> Cursos Matriculados
                                </h3>
                                <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #10B981; margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="color: #10B981; font-weight: bold;">ü•ã Krav Maga Faixa Branca - Defesa Pessoal 1</div>
                                            <div style="color: #CBD5E1; font-size: 0.875rem; margin-top: 0.25rem;">Iniciado em: 01/06/2025 ‚Ä¢ Progresso: 31%</div>
                                        </div>
                                        <div style="background: #10B981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: bold;">
                                            ATIVO
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align: center; padding: 2rem; color: #6B7280;">
                                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üéØ</div>
                                    <p style="margin: 0;">Pronto para novos desafios! Considere matricular em cursos avan√ßados.</p>
                                </div>
                            </div>
                        `;
                    }
                    break;
                case 'classes':
                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {
                        tabContent.innerHTML = `
                            <div style="background: rgba(245, 158, 11, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(245, 158, 11, 0.2);">
                                <h3 style="color: #F59E0B; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    <span>üè´</span> Turmas Participantes
                                </h3>
                                <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #3B82F6; margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <div style="color: #3B82F6; font-weight: bold;">Turma 1 - Ter√ßas e Quintas</div>
                                        <div style="background: #3B82F6; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: bold;">
                                            ATIVO
                                        </div>
                                    </div>
                                    <div style="color: #CBD5E1; font-size: 0.875rem;">
                                        <div>‚è∞ Hor√°rio: 18:00 - 19:00</div>
                                        <div>üë• Capacidade: 15/20 alunos</div>
                                        <div>üìÖ Pr√≥xima aula: Quinta, 05/06/2025</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    break;
                case 'progress':
                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {
                        tabContent.innerHTML = `
                            <div style="display: grid; gap: 2rem;">
                                <div style="background: rgba(139, 92, 246, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(139, 92, 246, 0.2);">
                                    <h3 style="color: #8B5CF6; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                        <span>üìà</span> Progresso Geral
                                    </h3>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                        <div style="text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                                            <div style="color: #10B981; font-size: 2rem; font-weight: bold;">5</div>
                                            <div style="color: #CBD5E1; font-size: 0.875rem;">T√©cnicas Dominadas</div>
                                        </div>
                                        <div style="text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px;">
                                            <div style="color: #3B82F6; font-size: 2rem; font-weight: bold;">65</div>
                                            <div style="color: #CBD5E1; font-size: 0.875rem;">Pontos XP</div>
                                        </div>
                                        <div style="text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px;">
                                            <div style="color: #F59E0B; font-size: 2rem; font-weight: bold;">85%</div>
                                            <div style="color: #CBD5E1; font-size: 0.875rem;">Frequ√™ncia</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    break;
                case 'financial':
                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {
                        tabContent.innerHTML = `
                            <div style="background: rgba(16, 185, 129, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(16, 185, 129, 0.2);">
                                <h3 style="color: #10B981; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    <span>üí∞</span> Situa√ß√£o Financeira
                                </h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                                    <div>
                                        <h4 style="color: #CBD5E1; margin: 0 0 1rem 0;">Plano Atual</h4>
                                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #3B82F6;">
                                            <div style="color: #3B82F6; font-weight: bold; margin-bottom: 0.5rem;">Plano Mensal Premium</div>
                                            <div style="color: #CBD5E1; font-size: 0.875rem;">R$ 150,00/m√™s</div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 style="color: #CBD5E1; margin: 0 0 1rem 0;">Status Pagamento</h4>
                                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #10B981;">
                                            <div style="color: #10B981; font-weight: bold; margin-bottom: 0.5rem;">‚úÖ Em Dia</div>
                                            <div style="color: #CBD5E1; font-size: 0.875rem;">Pr√≥ximo vencimento: 01/07/2025</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    break;
                case 'attendance':
                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {
                        tabContent.innerHTML = `
                            <div style="background: rgba(59, 130, 246, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.2);">
                                <h3 style="color: #3B82F6; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    <span>üìä</span> Hist√≥rico de Frequ√™ncia
                                </h3>
                                <div style="display: grid; gap: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                                        <span style="color: #CBD5E1;">Aula 15 - 27/06/2025</span>
                                        <span style="color: #10B981; font-weight: bold;">‚úÖ Presente</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                                        <span style="color: #CBD5E1;">Aula 14 - 25/06/2025</span>
                                        <span style="color: #10B981; font-weight: bold;">‚úÖ Presente</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                                        <span style="color: #CBD5E1;">Aula 13 - 22/06/2025</span>
                                        <span style="color: #EF4444; font-weight: bold;">‚ùå Ausente</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    break;
                case 'history':
                    if (tabContent && tabContent.innerHTML.includes('Carregando')) {
                        tabContent.innerHTML = `
                            <div style="background: rgba(139, 92, 246, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(139, 92, 246, 0.2);">
                                <h3 style="color: #8B5CF6; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    <span>üìú</span> Hist√≥rico de Atividades
                                </h3>
                                <div style="display: grid; gap: 1rem;">
                                    <div style="padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid #3B82F6;">
                                        <div style="color: #3B82F6; font-weight: bold; margin-bottom: 0.25rem;">Matr√≠cula Realizada</div>
                                        <div style="color: #CBD5E1; font-size: 0.875rem;">01/06/2025 - Curso: Krav Maga Faixa Branca</div>
                                    </div>
                                    <div style="padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 4px solid #10B981;">
                                        <div style="color: #10B981; font-weight: bold; margin-bottom: 0.25rem;">Primeira Avalia√ß√£o</div>
                                        <div style="color: #CBD5E1; font-size: 0.875rem;">15/06/2025 - Nota: 8.5/10</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    break;
            }
        }

        // Helper functions for modal
        function calculateAge(birthDate) {
            if (!birthDate) return null;
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age + ' anos';
        }

        function getGenderText(gender) {
            const genderMap = {
                'MASCULINO': 'Masculino',
                'FEMININO': 'Feminino',
                'MALE': 'Masculino',
                'FEMALE': 'Feminino'
            };
            return genderMap[gender] || gender || 'N√£o informado';
        }

        function getCategoryText(category) {
            const categoryMap = {
                'ADULT': 'Adulto',
                'INICIANTE1': 'Iniciante 1',
                'INICIANTE2': 'Iniciante 2',
                'INTERMEDIARIO1': 'Intermedi√°rio 1',
                'INTERMEDIARIO2': 'Intermedi√°rio 2',
                'AVANCADO1': 'Avan√ßado 1',
                'AVANCADO2': 'Avan√ßado 2'
            };
            return categoryMap[category] || category || 'N√£o informado';
        }

        // Additional modal functions for footer buttons
        window.editStudentInfo = function() {
            const modal = document.getElementById('studentDetailsModal');
            const studentId = modal.dataset.currentStudentId;

            if (studentId) {
                closeStudentModal();
                // Use existing edit function
                openStudentEditPage(studentId);
            } else {
                showToast('Erro: ID do aluno n√£o encontrado', 'error');
            }
        };

        window.addStudentToClass = function() {
            const modal = document.getElementById('studentDetailsModal');
            const studentId = modal.dataset.currentStudentId;

            if (studentId) {
                const student = window.currentStudents?.find(s => s.id === studentId);
                if (student) {
                    const user = student.user || {};
                    const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();

                    showToast(`Funcionalidade em desenvolvimento: Adicionar ${fullName} √† turma`, 'info');
                } else {
                    showToast('Aluno n√£o encontrado', 'error');
                }
            } else {
                showToast('Erro: ID do aluno n√£o encontrado', 'error');
            }
        };

        // Update the populateStudentModal function to store student ID
        const originalPopulateStudentModal = populateStudentModal;
        populateStudentModal = function(student) {
            // Store student ID in modal for footer button functions
            const modal = document.getElementById('studentDetailsModal');
            if (modal) {
                modal.dataset.currentStudentId = student.id;
            }

            // Call original function
            originalPopulateStudentModal(student);
        };

        // Event listeners for modal
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal when clicking outside
            const modal = document.getElementById('studentDetailsModal');
            if (modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target.id === 'studentDetailsModal') {
                        closeStudentModal();
                    }
                });
            }

            // Close modal with Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal && modal.style.display === 'block') {
                    closeStudentModal();
                }
            });
        });

        // ==========================================
        // COURSE MANAGEMENT FUNCTIONS  
        // ==========================================

        // Show course details
        function showCourseDetails() {
            showToast('Funcionalidade em desenvolvimento', 'info');
        }

        // Show lesson plan manager
        function showLessonPlanManager() {
            showSection('course-management');
            loadAllLessonPlans();
        }

        // Show lessons by unit
        function showLessonsByUnit(unit) {
            document.getElementById('current-unit-name').textContent = getUnitName(unit);
            loadLessonPlansByUnit(unit);
        }

        // Show all lessons
        function showAllLessons() {
            document.getElementById('current-unit-name').textContent = 'Todas as Unidades';
            loadAllLessonPlans();
        }

        // Get unit display name
        function getUnitName(unit) {
            const units = {
                'fundamentos': 'Fundamentos (Aulas 1-10)',
                'golpes': 'Golpes B√°sicos (Aulas 4-15)', 
                'defesas': 'Defesas B√°sicas (Aulas 10-25)',
                'avancadas': 'Defesas Avan√ßadas (Aulas 25-35)',
                'integracao': 'Integra√ß√£o (Aulas 35-48)'
            };
            return units[unit] || 'Unidade Desconhecida';
        }

        // Load all lesson plans
        async function loadAllLessonPlans() {

            // Update current unit name indicator
            const unitNameElement = document.getElementById('current-unit-name');
            if (unitNameElement) {
                unitNameElement.textContent = 'Todas as Unidades';
            }

            try {
                // Show loading state
                const tbody = document.getElementById('lesson-plans-table-body');
                if (tbody) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; color: #CBD5E1; padding: 2rem;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üîÑ</div>
                                Carregando todos os planos de aula...
                            </td>
                        </tr>
                    `;
                }

                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Generate sample lesson plans for all units
                const allPlans = [
                    ...generateSampleLessonPlansForUnit('fundamentos'),
                    ...generateSampleLessonPlansForUnit('golpes'),
                    ...generateSampleLessonPlansForUnit('defesas'),
                    ...generateSampleLessonPlansForUnit('avancadas'),
                    ...generateSampleLessonPlansForUnit('integracao')
                ];

                // Display all plans
                displayLessonPlans(allPlans);

                // Show success message
                showToast(`Carregados ${allPlans.length} planos de aula de todas as unidades`, 'success');

            } catch (error) {

                showToast('Erro ao carregar planos de aula', 'error');

                // Show error state
                const tbody = document.getElementById('lesson-plans-table-body');
                if (tbody) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; color: #EF4444; padding: 2rem;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚ùå</div>
                                Erro ao carregar planos de aula
                            </td>
                        </tr>
                    `;
                }
            }
        }

        // Load lessons by unit
        async function loadLessonPlansByUnit(unit) {

            // Update current unit name indicator
            const unitNameElement = document.getElementById('current-unit-name');
            if (unitNameElement) {
                unitNameElement.textContent = getUnitName(unit);
            }

            // Show loading state
            const tbody = document.getElementById('lesson-plans-table-body');
            if (tbody) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; color: #CBD5E1; padding: 2rem;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üîÑ</div>
                            Carregando planos de aula para ${getUnitName(unit)}...
                        </td>
                    </tr>
                `;
            }

            try {
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Generate sample lesson plans for the unit
                const samplePlans = generateSampleLessonPlansForUnit(unit);

                // Display the filtered plans
                displayLessonPlans(samplePlans);

                // Show success message
                showToast(`Carregados ${samplePlans.length} planos de aula para ${getUnitName(unit)}`, 'success');

            } catch (error) {

                showToast('Erro ao carregar planos de aula', 'error');

                // Show error state
                if (tbody) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; color: #EF4444; padding: 2rem;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚ùå</div>
                                Erro ao carregar planos de aula
                            </td>
                        </tr>
                    `;
                }
            }
        }

        // Generate sample lesson plans for specific unit
        function generateSampleLessonPlansForUnit(unit) {
            const unitData = {
                'fundamentos': {
                    name: 'Fundamentos',
                    lessons: [
                        { lesson: 1, title: 'Postura e Movimenta√ß√£o B√°sica', techniques: 'Postura de combate, movimenta√ß√£o lateral' },
                        { lesson: 2, title: 'Posicionamento Defensivo', techniques: 'Dist√¢ncia de seguran√ßa, posicionamento corporal' },
                        { lesson: 3, title: 'Fundamentos de Ataque', techniques: 'Soco direto, cruzado' },
                        { lesson: 4, title: 'Fundamentos de Defesa', techniques: 'Bloqueios b√°sicos, esquivas' },
                        { lesson: 5, title: 'Coordena√ß√£o Motora', techniques: 'Coordena√ß√£o olho-m√£o, reflexos' },
                        { lesson: 6, title: 'Condicionamento F√≠sico', techniques: 'Aquecimento, condicionamento b√°sico' },
                        { lesson: 7, title: 'T√©cnicas de Respira√ß√£o', techniques: 'Respira√ß√£o em combate, controle de ansiedade' },
                        { lesson: 8, title: 'Trabalho de Pernas', techniques: 'Chutes b√°sicos, mobilidade' },
                        { lesson: 9, title: 'Integra√ß√£o de Movimentos', techniques: 'Combina√ß√£o de t√©cnicas b√°sicas' },
                        { lesson: 10, title: 'Avalia√ß√£o de Fundamentos', techniques: 'Teste pr√°tico, avalia√ß√£o de progresso' }
                    ],
                    color: '#10B981'
                },
                'golpes': {
                    name: 'Golpes B√°sicos',
                    lessons: [
                        { lesson: 11, title: 'Socos Diretos', techniques: 'Jab, cross, hook' },
                        { lesson: 12, title: 'Socos Curvos', techniques: 'Uppercut, ganchos laterais' },
                        { lesson: 13, title: 'Chutes Frontais', techniques: 'Chute frontal, chute lateral' },
                        { lesson: 14, title: 'Chutes Circulares', techniques: 'Chute circular, chute ascendente' },
                        { lesson: 15, title: 'Joelhadas', techniques: 'Joelhada frontal, joelhada lateral' },
                        { lesson: 16, title: 'Cotovelos', techniques: 'Cotovelo horizontal, cotovelo vertical' },
                        { lesson: 17, title: 'Combina√ß√µes de Golpes', techniques: 'Sequ√™ncias de socos e chutes' },
                        { lesson: 18, title: 'Trabalho de Foco', techniques: 'Precis√£o, timing, dist√¢ncia' },
                        { lesson: 19, title: 'Sparring Controlado', techniques: 'Aplica√ß√£o em combate controlado' },
                        { lesson: 20, title: 'Avalia√ß√£o de Golpes', techniques: 'Teste de t√©cnicas de ataque' }
                    ],
                    color: '#3B82F6'
                },
                'defesas': {
                    name: 'Defesas B√°sicas',
                    lessons: [
                        { lesson: 21, title: 'Defesas contra Socos', techniques: 'Bloqueios, desvios de socos' },
                        { lesson: 22, title: 'Defesas contra Chutes', techniques: 'Bloqueios de chutes, esquivas' },
                        { lesson: 23, title: 'Defesas contra Agarramentos', techniques: 'Liberta√ß√£o de agarramentos' },
                        { lesson: 24, title: 'Defesas contra Enforcamentos', techniques: 'Defesa contra enforcamento frontal' },
                        { lesson: 25, title: 'Defesas contra Empurr√µes', techniques: 'Recupera√ß√£o de equil√≠brio' },
                        { lesson: 26, title: 'Defesas contra Tapas', techniques: 'Bloqueios e contra-ataques' },
                        { lesson: 27, title: 'Defesas Combinadas', techniques: 'Defesa + contra-ataque' },
                        { lesson: 28, title: 'Mobilidade Defensiva', techniques: 'Movimenta√ß√£o defensiva' },
                        { lesson: 29, title: 'Timing Defensivo', techniques: 'Momento certo para defesa' },
                        { lesson: 30, title: 'Avalia√ß√£o de Defesas', techniques: 'Teste de defesas b√°sicas' }
                    ],
                    color: '#8B5CF6'
                },
                'avancadas': {
                    name: 'Defesas Avan√ßadas',
                    lessons: [
                        { lesson: 31, title: 'Defesas contra Armas Brancas', techniques: 'Defesa contra faca, estilete' },
                        { lesson: 32, title: 'Defesas contra Bast√µes', techniques: 'Defesa contra cassetete, vara' },
                        { lesson: 33, title: 'Defesas contra M√∫ltiplos Atacantes', techniques: 'Estrat√©gias de m√∫ltiplos oponentes' },
                        { lesson: 34, title: 'Defesas no Solo', techniques: 'Defesas ca√≠do, levantamento r√°pido' },
                        { lesson: 35, title: 'Defesas em Espa√ßos Confinados', techniques: 'Combate em elevador, corredor' },
                        { lesson: 36, title: 'Defesas contra Agarramentos Avan√ßados', techniques: 'Mata-le√£o, guilhotina' },
                        { lesson: 37, title: 'T√©cnicas de Finaliza√ß√£o', techniques: 'Imobiliza√ß√µes, pontos de press√£o' },
                        { lesson: 38, title: 'Psicologia de Combate', techniques: 'Controle emocional, tomada de decis√£o' },
                        { lesson: 39, title: 'Cen√°rios Reais', techniques: 'Simula√ß√µes de situa√ß√µes reais' },
                        { lesson: 40, title: 'Avalia√ß√£o Avan√ßada', techniques: 'Teste de t√©cnicas avan√ßadas' }
                    ],
                    color: '#F59E0B'
                },
                'integracao': {
                    name: 'Integra√ß√£o',
                    lessons: [
                        { lesson: 41, title: 'Integra√ß√£o de T√©cnicas', techniques: 'Combina√ß√£o de todas as t√©cnicas' },
                        { lesson: 42, title: 'Sparring Avan√ßado', techniques: 'Combate livre controlado' },
                        { lesson: 43, title: 'Defesa Pessoal Aplicada', techniques: 'Situa√ß√µes reais de autodefesa' },
                        { lesson: 44, title: 'Condicionamento Avan√ßado', techniques: 'Prepara√ß√£o f√≠sica intensa' },
                        { lesson: 45, title: 'T√°ticas de Sobreviv√™ncia', techniques: 'Estrat√©gias de fuga e escape' },
                        { lesson: 46, title: 'Exame Pr√°tico', techniques: 'Avalia√ß√£o pr√°tica completa' },
                        { lesson: 47, title: 'Demonstra√ß√£o de Habilidades', techniques: 'Apresenta√ß√£o de t√©cnicas dominadas' },
                        { lesson: 48, title: 'Cerim√¥nia de Gradua√ß√£o', techniques: 'Avalia√ß√£o final, certifica√ß√£o' }
                    ],
                    color: '#EF4444'
                }
            };

            const unitInfo = unitData[unit];
            if (!unitInfo) {

                return [];
            }

            return unitInfo.lessons.map(lesson => ({
                lessonNumber: lesson.lesson,
                weekNumber: Math.ceil(lesson.lesson / 2),
                title: lesson.title,
                unit: unitInfo.name,
                techniques: lesson.techniques,
                duration: '60 min',
                level: Math.min(Math.ceil(lesson.lesson / 10), 5),
                status: lesson.lesson <= 15 ? 'Conclu√≠da' : 'Pendente',
                statusColor: lesson.lesson <= 15 ? '#10B981' : '#6B7280'
            }));
        }

        // Display lesson plans in table
        function displayLessonPlans(plans) {
            const tbody = document.getElementById('lesson-plans-table-body');

            if (plans.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; color: #CBD5E1; padding: 2rem;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üì≠</div>
                            Nenhum plano de aula encontrado
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = plans.map(plan => `
                <tr style="border-left: 3px solid ${plan.statusColor};">
                    <td style="font-weight: bold; color: #F8FAFC;">${plan.lessonNumber}</td>
                    <td style="color: #CBD5E1;">${plan.weekNumber}</td>
                    <td style="color: #F8FAFC; font-weight: 500;">${plan.title}</td>
                    <td style="color: #CBD5E1;">${plan.unit}</td>
                    <td style="color: #CBD5E1; font-size: 0.85rem;">${plan.techniques}</td>
                    <td style="color: #CBD5E1;">${plan.duration}</td>
                    <td style="text-align: center;">
                        ${'‚≠ê'.repeat(plan.level)}
                    </td>
                    <td style="color: ${plan.statusColor}; font-weight: 500;">${plan.status}</td>
                    <td>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button class="btn" onclick="viewLessonPlan(${plan.lessonNumber})" 
                                    style="background: #3B82F6; padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                üëÅÔ∏è Ver
                            </button>
                            <button class="btn" onclick="editLessonPlan(${plan.lessonNumber})" 
                                    style="background: #F59E0B; padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                ‚úèÔ∏è Editar
                            </button>
                            <button class="btn" onclick="generateAIVariation(${plan.lessonNumber})" 
                                    style="background: #8B5CF6; padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                ü§ñ IA
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // View lesson plan details
        function viewLessonPlan(lessonNumber) {
            showToast(`Visualizando plano da Aula ${lessonNumber}`, 'info');

        }

        // Edit lesson plan
        function editLessonPlan(lessonNumber) {
            showToast(`Editando plano da Aula ${lessonNumber}`, 'info');

        }

        // Generate AI variation
        function generateAIVariation(lessonNumber) {
            showToast(`Gerando varia√ß√£o IA para Aula ${lessonNumber}...`, 'info');

        }

        // Open AI lesson generator
        function openAILessonGenerator() {
            showToast('Gerador IA em desenvolvimento - Em breve!', 'info');

        }

        // Show curriculum builder
        function showCurriculumBuilder() {
            showToast('Curriculum Builder em desenvolvimento', 'info');
        }

        // Show progress analytics
        function showProgressAnalytics() {
            showToast('Analytics em desenvolvimento', 'info');
        }

        // Export lesson plans
        function exportLessonPlans() {
            showToast('Exportando planos de aula...', 'info');

        }

        // Import lesson plans
        function importLessonPlans() {
            showToast('Importa√ß√£o em desenvolvimento', 'info');

        }

        // Initialize course management when section loads
        window.addEventListener('load', () => {
            // Load lesson plans if course-management is the initial section
            if (window.location.hash === '#course-management') {
                setTimeout(() => loadAllLessonPlans(), 500);
            }
        });

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
    </script>

                        <div style="background: rgba(16, 185, 129, 0.2); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #10B981;" id="categoriesCount">8</div>
                            <div style="color: #CBD5E1; font-size: 0.9rem;">Categorias</div>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.2); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #F59E0B;" id="coursesUsingCount">2</div>
                            <div style="color: #CBD5E1; font-size: 0.9rem;">Cursos Usando</div>
                        </div>
                        <div style="background: rgba(139, 92, 246, 0.2); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #8B5CF6;" id="reusedCount">15</div>
                            <div style="color: #CBD5E1; font-size: 0.9rem;">Reutilizadas</div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <input type="text" id="techniqueSearch" placeholder="Buscar t√©cnica..." 
                                   style="padding: 0.5rem; border-radius: 6px; border: 1px solid #374151; background: rgba(55, 65, 81, 0.5); color: #F8FAFC; width: 300px;">
                            <select id="categoryFilter" style="padding: 0.5rem; border-radius: 6px; border: 1px solid #374151; background: rgba(55, 65, 81, 0.5); color: #F8FAFC;">
                                <option value="">Todas Categorias</option>
                                <option value="STANCE">Postura</option>
                                <option value="STRIKE">Golpes</option>
                                <option value="DEFENSE">Defesa</option>
                                <option value="GRAPPLING">Agarramento</option>
                                <option value="COMBO">Combina√ß√£o</option>
                                <option value="MOVEMENT">Movimenta√ß√£o</option>
                                <option value="SCENARIO">Cen√°rio</option>
                                <option value="CONDITIONING">Condicionamento</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" >
                            <span>‚ûï</span> Nova T√©cnica
                        </button>
                    </div>

                    <!-- Techniques Table -->
                    <div style="border: 1px solid #374151; border-radius: 8px; overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: rgba(55, 65, 81, 0.5);">
                                <tr>
                                    <th style="padding: 1rem; text-align: left; color: #F8FAFC; border-bottom: 1px solid #374151;">Nome</th>
                                    <th style="padding: 1rem; text-align: left; color: #F8FAFC; border-bottom: 1px solid #374151;">Categoria</th>
                                    <th style="padding: 1rem; text-align: left; color: #F8FAFC; border-bottom: 1px solid #374151;">N√≠vel</th>
                                    <th style="padding: 1rem; text-align: left; color: #F8FAFC; border-bottom: 1px solid #374151;">Usado em</th>
                                    <th style="padding: 1rem; text-align: left; color: #F8FAFC; border-bottom: 1px solid #374151;">Pr√©-requisitos</th>
                                    <th style="padding: 1rem; text-align: center; color: #F8FAFC; border-bottom: 1px solid #374151;">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="techniquesTableBody" style="color: #CBD5E1;">
                                <tr>
                                    <td colspan="6" style="padding: 2rem; text-align: center;">
                                        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚è≥</div>
                                        Carregando t√©cnicas...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

                    <div class="form-group">
                        <label for="techniqueDescription">Descri√ß√£o</label>
                        <textarea id="techniqueDescription" rows="3" placeholder="Descri√ß√£o detalhada da t√©cnica..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="techniqueInstructions">Instru√ß√µes Passo a Passo</label>
                        <textarea id="techniqueInstructions" rows="4" placeholder="1. Posi√ß√£o inicial...&#10;2. Movimento principal...&#10;3. Finaliza√ß√£o..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="techniquePrerequisites">Pr√©-requisitos (opcional)</label>
                        <input type="text" id="techniquePrerequisites" placeholder="Ex: Guarda de Boxe, Movimenta√ß√£o B√°sica">
                    </div>

                    <div class="form-group">
                        <label for="techniqueKeyPoints">Pontos-Chave</label>
                        <textarea id="techniqueKeyPoints" rows="3" placeholder="Aspectos importantes para execu√ß√£o correta..."></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="techniqueEquipment">Equipamentos</label>
                            <input type="text" id="techniqueEquipment" placeholder="Ex: Tatame, Pads, Luvas">
                        </div>
                        <div class="form-group">
                            <label for="techniqueDuration">Dura√ß√£o (minutos)</label>
                            <input type="number" id="techniqueDuration" min="1" max="60" value="10">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" >Cancelar</button>
                <button class="btn btn-primary" onclick="saveTechnique()">
                    <span>üíæ</span> Salvar T√©cnica
                </button>
            </div>
        </div>
    </div>

                            <div id="beltInfo" style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #3B82F6; display: none;">
                                <div id="beltInfoContent"></div>
                            </div>
                        </div>
                    </div>

                    <!-- RAG Status Indicator -->
                    <div id="ragStatus" style="margin-bottom: 1rem;">
                        <!-- RAG status will be populated dynamically -->
                    </div>

                    <!-- Course Basic Info -->
                    <div class="form-section">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üìö Informa√ß√µes do Curso</h3>
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label for="universalCourseTitle">Nome do Curso *</label>
                                    <input type="text" id="universalCourseTitle" placeholder="Ex: Jiu-Jitsu Faixa Azul - T√©cnicas Avan√ßadas" required>
                                </div>
                                <div class="form-group">
                                    <label for="universalCourseDuration">Dura√ß√£o (semanas) *</label>
                                    <input type="number" id="universalCourseDuration" value="20" min="4" max="52" required>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label for="universalCourseLevel">N√≠vel de Dificuldade</label>
                                    <select id="universalCourseLevel">
                                        <option value="BEGINNER">‚≠ê Iniciante</option>
                                        <option value="INTERMEDIATE">‚≠ê‚≠ê Intermedi√°rio</option>
                                        <option value="ADVANCED">‚≠ê‚≠ê‚≠ê Avan√ßado</option>
                                        <option value="EXPERT">‚≠ê‚≠ê‚≠ê‚≠ê Expert</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="lessonsPerWeekUniversal">Aulas por Semana</label>
                                    <select id="lessonsPerWeekUniversal">
                                        <option value="1">1 aula</option>
                                        <option value="2" selected>2 aulas</option>
                                        <option value="3">3 aulas</option>
                                        <option value="4">4 aulas</option>
                                        <option value="5">5 aulas</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="universalCourseObjectives">Objetivos do Curso</label>
                                <textarea id="universalCourseObjectives" rows="3" placeholder="Descreva os objetivos principais do curso..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Technique Selection -->
                    <div class="form-section">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">ü•ä Sele√ß√£o de T√©cnicas</h3>
                        <div style="display: grid; gap: 1rem;">
                            <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #3B82F6;">
                                <h4 style="color: #3B82F6; margin-bottom: 0.5rem;">üí° Estrat√©gia de Sele√ß√£o</h4>
                                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1;">
                                        <input type="radio" name="selectionStrategy" value="reuse" checked>
                                        <span>üîÑ Reutilizar do Faixa Branca + Novas</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1;">
                                        <input type="radio" name="selectionStrategy" value="fresh">
                                        <span>üÜï Sele√ß√£o Completamente Nova</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: #CBD5E1;">
                                        <input type="radio" name="selectionStrategy" value="custom">
                                        <span>‚öôÔ∏è Sele√ß√£o Manual</span>
                                    </label>
                                </div>
                            </div>

                            <div id="techniqueSelectionArea" style="border: 1px solid #374151; border-radius: 8px; max-height: 300px; overflow-y: auto;">
                                <div style="padding: 2rem; text-align: center; color: #CBD5E1;">
                                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üéØ</div>
                                    Carregando banco de t√©cnicas para sele√ß√£o...
                                </div>
                            </div>

                            <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="color: #F59E0B; font-weight: bold;">T√©cnicas Selecionadas:</span>
                                    <span id="selectedTechniquesCount" style="color: #F8FAFC;">0</span>
                                </div>
                                <div id="selectedTechniquesList" style="color: #CBD5E1; font-size: 0.9rem;">
                                    Nenhuma t√©cnica selecionada ainda
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Document Upload for Yellow Belt -->
                    <div class="form-section">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üìÑ Seu Modelo de Curso</h3>
                        <div style="border: 2px dashed #374151; border-radius: 12px; padding: 2rem; text-align: center; background: rgba(55, 65, 81, 0.3);">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">üìã</div>
                            <input type="file" id="courseModelFile" accept=".pdf,.doc,.docx,.txt,.md" 
                                   style="display: none;" onchange="handleCourseModelUpload(event)">
                            <button type="button" onclick="document.getElementById('yellowBeltModel').click()" 
                                    style="background: #F59E0B; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; margin-bottom: 1rem;">
                                üìé Upload Modelo de Curso
                            </button>
                            <p style="color: #CBD5E1; font-size: 0.9rem;">
                                Fa√ßa upload do seu modelo de curso (opcional)<br>
                                A IA usar√° este documento para estruturar o curso
                            </p>
                            <div id="courseModelFileInfo" style="margin-top: 1rem;"></div>
                        </div>
                    </div>

                    <!-- AI Configuration -->
                    <div class="form-section">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">ü§ñ Configura√ß√£o da IA</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label style="color: #F8FAFC; margin-bottom: 0.5rem; display: block;">üéØ Gerar Planos de Aula</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="universalGeneratePlans" checked>
                                    <span style="color: #CBD5E1;">Gerar automaticamente todos os planos</span>
                                </div>
                            </div>
                            <div>
                                <label style="color: #F8FAFC; margin-bottom: 0.5rem; display: block;">ü§ñ Modelo IA</label>
                                <select id="universalAiModel" style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid #374151; background: rgba(55, 65, 81, 0.5); color: #F8FAFC;">
                                    <option value="claude-3">Claude 3 (Recomendado)</option>
                                    <option value="gpt-4">GPT-4</option>
                                    <option value="gemini">Gemini</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="color: #CBD5E1; font-size: 0.9rem;">
                        ‚è±Ô∏è Tempo estimado: 5-8 minutos
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-secondary" >Cancelar</button>
                        <button class="btn btn-primary" onclick="createUniversalCourse()" id="createUniversalBtn">
                            <span>üé≠</span> Criar Curso
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

            <div class="modal-footer">
                <button class="btn btn-success" onclick="approveTechnique()" id="approveBtn">
                    <span>‚úÖ</span> Aprovar
                </button>
                <button class="btn btn-warning" onclick="editTechnique()" id="editBtn" style="margin-left: 1rem;">
                    <span>‚úèÔ∏è</span> Editar
                </button>
                <button class="btn btn-danger" onclick="rejectTechnique()" id="rejectBtn" style="margin-left: 1rem;">
                    <span>‚ùå</span> Rejeitar
                </button>
                <button class="btn btn-secondary"  style="margin-left: 1rem;">Cancelar</button>
            </div>
        </div>
    </div>

                    <div class="form-group">
                        <label for="videoDescription">Descri√ß√£o do V√≠deo</label>
                        <textarea id="videoDescription" rows="3" placeholder="Descreva o que est√° sendo demonstrado no v√≠deo..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="uploadVideo()" id="uploadVideoBtn">
                    <span>üöÄ</span> Upload V√≠deo
                </button>
                <button class="btn btn-secondary" >Cancelar</button>
            </div>
        </div>
    </div>

                        <div class="form-group" style="margin-top: 1rem;">
                            <label for="documentTags">Tags (separadas por v√≠rgula)</label>
                            <input type="text" id="documentTags" placeholder="krav-maga, defesa-pessoal, iniciante, faixa-branca">
                        </div>
                    </div>

                    <!-- Text Input Section -->
                    <div id="textSection" class="upload-section" style="display: none;">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üìù Adicionar Texto Manual</h3>
                        <div class="form-group">
                            <label for="textTitle">T√≠tulo do Conte√∫do *</label>
                            <input type="text" id="textTitle" placeholder="Ex: Princ√≠pios Fundamentais do Krav Maga" required>
                        </div>
                        <div class="form-group">
                            <label for="textContent">Conte√∫do *</label>
                            <textarea id="textContent" rows="12" placeholder="Cole aqui seu conte√∫do de texto, manuais, instru√ß√µes, metodologias..." required></textarea>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="textCategory">Categoria</label>
                                <select id="textCategory">
                                    <option value="">Selecione</option>
                                    <option value="METHODOLOGY">Metodologia</option>
                                    <option value="TECHNIQUES">T√©cnicas</option>
                                    <option value="THEORY">Teoria</option>
                                    <option value="SAFETY">Seguran√ßa</option>
                                    <option value="PROGRESSION">Progress√£o</option>
                                    <option value="EVALUATION">Avalia√ß√£o</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="textTags">Tags</label>
                                <input type="text" id="textTags" placeholder="defesa, ataque, movimento">
                            </div>
                        </div>
                    </div>

                    <!-- Links Section -->
                    <div id="linksSection" class="upload-section" style="display: none;">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üîó Adicionar Links/URLs</h3>
                        <div class="form-group">
                            <label for="linkUrl">URL *</label>
                            <input type="url" id="linkUrl" placeholder="https://exemplo.com/artigo-sobre-krav-maga" required>
                        </div>
                        <div class="form-group">
                            <label for="linkTitle">T√≠tulo (opcional)</label>
                            <input type="text" id="linkTitle" placeholder="Ser√° extra√≠do automaticamente se n√£o preenchido">
                        </div>
                        <div class="form-group">
                            <label for="linkDescription">Descri√ß√£o</label>
                            <textarea id="linkDescription" rows="3" placeholder="Breve descri√ß√£o sobre o conte√∫do do link"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="linkTags">Tags</label>
                            <input type="text" id="linkTags" placeholder="artigo, externa, refer√™ncia">
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <div style="color: #3B82F6; font-weight: bold; margin-bottom: 0.5rem;">‚ÑπÔ∏è Extra√ß√£o Autom√°tica</div>
                            <div style="color: #CBD5E1; font-size: 0.9rem;">
                                O sistema ir√° extrair automaticamente o texto do site e indexar o conte√∫do.
                            </div>
                        </div>
                    </div>

                    <!-- YouTube Section -->
                    <div id="youtubeSection" class="upload-section" style="display: none;">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üì∫ V√≠deos do YouTube</h3>
                        <div class="form-group">
                            <label for="youtubeUrl">URL do YouTube *</label>
                            <input type="url" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=..." required>
                        </div>
                        <div class="form-group">
                            <label for="youtubeDescription">Descri√ß√£o do Conte√∫do</label>
                            <textarea id="youtubeDescription" rows="3" placeholder="Descreva o que √© abordado no v√≠deo"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="youtubeTags">Tags</label>
                            <input type="text" id="youtubeTags" placeholder="video, demonstra√ß√£o, tutorial">
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <div style="color: #F59E0B; font-weight: bold; margin-bottom: 0.5rem;">üéØ Extra√ß√£o de Transcri√ß√£o</div>
                            <div style="color: #CBD5E1; font-size: 0.9rem;">
                                O sistema ir√° extrair a transcri√ß√£o autom√°tica do v√≠deo (se dispon√≠vel) e indexar o conte√∫do.
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="uploadContent()" id="uploadContentBtn">
                    <span>üöÄ</span> Adicionar √† Base
                </button>
                <button class="btn btn-secondary" onclick="closeDocumentUploader()">Cancelar</button>
            </div>
        </div>
    </div>

                        <input type="hidden" id="creationMode" value="">
                    </div>

                    <!-- Informa√ß√µes B√°sicas do Curso -->
                    <div class="form-section">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üìö Informa√ß√µes B√°sicas</h3>
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label for="courseTitle">Nome do Curso *</label>
                                    <input type="text" id="courseTitle" placeholder="Ex: Krav Maga Faixa Preta - Instrutor" required>
                                </div>
                                <div class="form-group">
                                    <label for="courseDuration">Dura√ß√£o (semanas) *</label>
                                    <input type="number" id="courseDuration" min="1" max="52" value="24" required>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label for="courseLevel">N√≠vel *</label>
                                    <select id="courseLevel" required>
                                        <option value="">Selecione</option>
                                        <option value="INICIANTE">Iniciante</option>
                                        <option value="INTERMEDIARIO">Intermedi√°rio</option>
                                        <option value="AVANCADO">Avan√ßado</option>
                                        <option value="INSTRUTOR">Instrutor</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="courseCategory">Categoria *</label>
                                    <select id="courseCategory" required>
                                        <option value="">Selecione</option>
                                        <option value="ADULT">Adulto</option>
                                        <option value="KIDS">Infantil</option>
                                        <option value="TEEN">Adolescente</option>
                                        <option value="SENIOR">Terceira Idade</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="lessonsPerWeek">Aulas por Semana</label>
                                    <select id="lessonsPerWeek">
                                        <option value="1">1 aula</option>
                                        <option value="2" selected>2 aulas</option>
                                        <option value="3">3 aulas</option>
                                        <option value="4">4 aulas</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="courseObjectives">Objetivos Principais</label>
                                <textarea id="courseObjectives" rows="3" 
                                          placeholder="Ex: Desenvolver habilidades de defesa pessoal, aumentar condicionamento f√≠sico, preparar instrutores..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Upload de Documentos -->
                    <div class="form-section" id="documentSection" style="display: none;">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">üìÅ Documentos e Contexto</h3>
                        <div style="display: grid; gap: 1.5rem;">

                            <!-- Templates Pr√©-definidos -->
                            <div>
                                <label style="color: #F8FAFC; margin-bottom: 0.5rem; display: block;">üéØ Templates Dispon√≠veis</label>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem;">
                                    <button type="button" class="template-btn" onclick="loadTemplate('krav-maga-basic')" 
                                            style="padding: 0.75rem; background: rgba(59, 130, 246, 0.2); border: 1px solid #3B82F6; border-radius: 8px; color: #3B82F6; cursor: pointer;">
                                        ü•ã Krav Maga B√°sico
                                    </button>
                                    <button type="button" class="template-btn" onclick="loadTemplate('self-defense')" 
                                            style="padding: 0.75rem; background: rgba(16, 185, 129, 0.2); border: 1px solid #10B981; border-radius: 8px; color: #10B981; cursor: pointer;">
                                        üõ°Ô∏è Defesa Pessoal
                                    </button>
                                    <button type="button" class="template-btn" onclick="loadTemplate('instructor')" 
                                            style="padding: 0.75rem; background: rgba(245, 158, 11, 0.2); border: 1px solid #F59E0B; border-radius: 8px; color: #F59E0B; cursor: pointer;">
                                        üë®‚Äçüè´ Forma√ß√£o Instrutor
                                    </button>
                                </div>
                            </div>

                            <!-- Upload de Arquivos -->
                            <div>
                                <label style="color: #F8FAFC; margin-bottom: 0.5rem; display: block;">üìé Upload de Documentos</label>
                                <div style="border: 2px dashed #374151; border-radius: 12px; padding: 2rem; text-align: center; background: rgba(55, 65, 81, 0.3);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem;">üìÅ</div>
                                    <input type="file" id="courseDocuments" multiple accept=".pdf,.doc,.docx,.txt,.md" 
                                           style="display: none;" onchange="handleFileUpload(event)">
                                    <button type="button" onclick="document.getElementById('courseDocuments').click()" 
                                            style="background: #3B82F6; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; margin-bottom: 1rem;">
                                        Selecionar Arquivos
                                    </button>
                                    <p style="color: #CBD5E1; font-size: 0.9rem;">
                                        Aceita: PDF, DOC, DOCX, TXT, MD<br>
                                        <strong>Sugest√µes:</strong> Curriculums, planos modelo, regulamentos, metodologias
                                    </p>
                                    <div id="uploadedFiles" style="margin-top: 1rem;"></div>
                                </div>
                            </div>

                            <!-- Contexto Adicional -->
                            <div>
                                <label for="additionalContext" style="color: #F8FAFC; margin-bottom: 0.5rem; display: block;">üí≠ Contexto Adicional</label>
                                <textarea id="additionalContext" rows="4" 
                                          placeholder="Informa√ß√µes espec√≠ficas: metodologia preferida, restri√ß√µes, adapta√ß√µes necess√°rias, experi√™ncias anteriores, cultura da academia, etc."
                                          style="width: 100%; padding: 1rem; background: rgba(55, 65, 81, 0.5); border: 1px solid #374151; border-radius: 8px; color: #F8FAFC;"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Configura√ß√µes Avan√ßadas -->
                    <div class="form-section">
                        <h3 style="color: #F8FAFC; margin-bottom: 1rem;">‚öôÔ∏è Configura√ß√µes Avan√ßadas</h3>
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label style="color: #F8FAFC; margin-bottom: 0.5rem; display: block;">üéØ Gerar Planos de Aula</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" id="generateLessonPlans" checked>
                                        <span style="color: #CBD5E1;">Gerar automaticamente todos os planos de aula</span>
                                    </div>
                                </div>
                                <div>
                                    <label style="color: #F8FAFC; margin-bottom: 0.5rem; display: block;">üèÜ Incluir Avalia√ß√µes</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" id="includeEvaluations" checked>
                                        <span style="color: #CBD5E1;">Criar sistema de avalia√ß√µes e exames</span>
                                    </div>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label style="color: #F8FAFC; margin-bottom: 0.5rem; display: block;">üß© Adapta√ß√µes Especiais</label>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                        <label style="display: flex; align-items: center; gap: 0.25rem; color: #CBD5E1; margin-right: 1rem;">
                                            <input type="checkbox" name="adaptations" value="TEA">
                                            <span>TEA</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.25rem; color: #CBD5E1; margin-right: 1rem;">
                                            <input type="checkbox" name="adaptations" value="TDAH">
                                            <span>TDAH</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.25rem; color: #CBD5E1;">
                                            <input type="checkbox" name="adaptations" value="MOBILIDADE_REDUZIDA">
                                            <span>Mobilidade Reduzida</span>
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label for="aiModel" style="color: #F8FAFC; margin-bottom: 0.5rem; display: block;">ü§ñ Modelo de IA</label>
                                    <select id="aiModel">
                                        <option value="gpt-4">GPT-4 (Mais criativo)</option>
                                        <option value="claude-3">Claude 3 (Mais estruturado)</option>
                                        <option value="gemini">Gemini (Balanceado)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="color: #CBD5E1; font-size: 0.9rem;">
                        ‚è±Ô∏è Tempo estimado: 3-5 minutos
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-secondary" >Cancelar</button>
                        <button class="btn btn-primary" onclick="generateCourseWithAI()" id="generateCourseBtn">
                            <span>üéØ</span> Gerar Curso Completo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

                    <div class="form-group">
                        <label for="aiDifficulty">N√≠vel de Dificuldade</label>
                        <select id="aiDifficulty" required>
                            <option value="1">‚≠ê Iniciante</option>
                            <option value="2">‚≠ê‚≠ê Intermedi√°rio</option>
                            <option value="3">‚≠ê‚≠ê‚≠ê Avan√ßado</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" >Cancelar</button>
                <button class="btn btn-primary" onclick="generateLessonPlanWithAI()">
                    <span>ü§ñ</span> Gerar Plano com IA
                </button>
            </div>
        </div>
    </div>


    <script>
        // Main Dashboard JavaScript - Core functionality only
        
        // Utility function to reduce console noise in production
        function logQuiet(message, ...args) {
            // Only log important messages to reduce noise
            if (message.includes('‚úÖ') || message.includes('‚ùå') || message.includes('‚ö†Ô∏è')) {
                console.log(message, ...args);
            }
        }

        // Sleep utility function
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Main initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize modules
            if (typeof loadAllStudents === 'function') {
                loadAllStudents();
            }
            if (typeof initializeBeltSystems === 'function') {
                initializeBeltSystems();
            }
        });

        // Export utility functions to global scope
        window.logQuiet = logQuiet;
        window.sleep = sleep;
    </script>
</body>
</html>
