<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Packages API</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #f0f0f0; 
        }
        .log { 
            background: white; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid #007acc; 
        }
        .error { 
            border-left-color: #ff6b6b; 
            background: #ffebee; 
        }
        .success { 
            border-left-color: #4caf50; 
            background: #e8f5e8; 
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #005999; }
    </style>
</head>
<body>
    <h1>ğŸ› Debug - Packages API</h1>
    <div id="logs"></div>
    
    <button onclick="testAPI()">ğŸ§ª Testar API Client</button>
    <button onclick="testModuleAPI()">ğŸ“¦ Testar Module API</button>
    <button onclick="testPackagesLoad()">ğŸ“‹ Testar Load Packages</button>
    <button onclick="clearLogs()">ğŸ§¹ Limpar Logs</button>

    <script>
        const logsDiv = document.getElementById('logs');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            logsDiv.appendChild(div);
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(message);
        }

        function clearLogs() {
            logsDiv.innerHTML = '';
        }

        async function testAPI() {
            log('ğŸ” Testando disponibilidade da API...');
            
            if (!window.apiClient) {
                log('âŒ window.apiClient nÃ£o estÃ¡ disponÃ­vel', 'error');
                return;
            }
            
            if (!window.createModuleAPI) {
                log('âŒ window.createModuleAPI nÃ£o estÃ¡ disponÃ­vel', 'error');
                return;
            }
            
            log('âœ… API Client estÃ¡ disponÃ­vel', 'success');
            log(`ğŸ“Š API Client tipo: ${typeof window.apiClient}`);
            log(`ğŸ­ createModuleAPI tipo: ${typeof window.createModuleAPI}`);
        }

        async function testModuleAPI() {
            log('ğŸ§ª Criando ModuleAPIHelper para teste...');
            
            try {
                const moduleAPI = window.createModuleAPI('TestModule');
                log('âœ… ModuleAPIHelper criado com sucesso', 'success');
                
                log(`ğŸ“‹ Propriedades disponÃ­veis: ${Object.getOwnPropertyNames(moduleAPI).join(', ')}`);
                log(`ğŸ”§ MÃ©todo api disponÃ­vel: ${typeof moduleAPI.api}`);
                log(`ğŸ”§ MÃ©todo fetchWithStates: ${typeof moduleAPI.fetchWithStates}`);
                
                // Testar se o api.request estÃ¡ disponÃ­vel
                if (moduleAPI.api && typeof moduleAPI.api.request === 'function') {
                    log('âœ… moduleAPI.api.request estÃ¡ disponÃ­vel', 'success');
                } else {
                    log('âŒ moduleAPI.api.request NÃƒO estÃ¡ disponÃ­vel', 'error');
                }
                
            } catch (error) {
                log(`âŒ Erro ao criar ModuleAPIHelper: ${error.message}`, 'error');
            }
        }

        async function testPackagesLoad() {
            log('ğŸ“¦ Testando carregamento de pacotes...');
            
            try {
                const moduleAPI = window.createModuleAPI('Packages');
                log('âœ… API Helper criado');
                
                // Testar com o mÃ©todo correto
                log('ğŸ”„ Fazendo requisiÃ§Ã£o GET /api/billing-plans...');
                const response = await moduleAPI.api.request('GET', '/api/billing-plans');
                
                log(`âœ… Resposta recebida: ${JSON.stringify(response, null, 2)}`, 'success');
                
                if (response.success) {
                    log(`ğŸ“Š ${response.data?.length || 0} pacotes encontrados`, 'success');
                } else {
                    log(`âš ï¸ API retornou success=false: ${response.message}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ Erro no teste: ${error.message}`, 'error');
                log(`ğŸ“‹ Stack: ${error.stack}`, 'error');
            }
        }

        // Auto-teste inicial
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ğŸš€ Iniciando testes automÃ¡ticos...');
                testAPI();
            }, 1000);
        });
    </script>
    
    <!-- Carregar API Client -->
    <script src="/public/js/shared/api-client.js"></script>
</body>
</html>
