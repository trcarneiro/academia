<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <script>
        // üîí AUTH GUARD
        // Disable dev auto-login to force real authentication
        window.__DISABLE_DEV_AUTO_AUTH__ = true;

        // Check for token
        const token = localStorage.getItem('token');
        if (!token) {
            console.log('üîí No token found, redirecting to login...');
            window.location.href = '/login.html';
        }
    </script>
    <meta charset="UTF-8">
    <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academia Dashboard</title>
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Krav Maga">
    <link rel="apple-touch-icon" href="/images/icon.svg">
    <!-- Supabase SDK (required for Auth Module) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- SweetAlert2 (required for Modals) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Font Awesome 6.x - Professional Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- FOR√áA RESET - Para garantir design minimalista -->
    <link rel="stylesheet" href="/css/force-reset.css">
    <!-- LAYOUT CENTER FIX - Corre√ß√£o de centraliza√ß√£o -->
    <link rel="stylesheet" href="/css/layout-center-fix.css">
    <!-- FORMUL√ÅRIOS UX PROFISSIONAIS -->
    <link rel="stylesheet" href="/css/forms-ux.css">
    <!-- Design System - Guidelines.MD Compliance -->
    <link rel="stylesheet" href="/css/design-system/index.css">
    <link rel="stylesheet" href="/css/dashboard/main.css">
    <!-- Corre√ß√£o de emerg√™ncia para o menu -->
    <link rel="stylesheet" href="/css/menu-fix.css">
    <!-- Global Premium Colors - Academia v2.0 -->
    <link rel="stylesheet" href="/css/global-premium-colors.css">
    <!-- Shared CSS -->
    <link rel="stylesheet" href="/css/shared/permissions.css">
    <!-- Module CSS -->
    <link rel="stylesheet" href="/css/modules/courses.css">
    <link rel="stylesheet" href="/css/modules/turmas.css">
    <link rel="stylesheet" href="/css/modules/turmas-clean.css">
    <link rel="stylesheet" href="/css/modules/turmas-courses.css">
    <link rel="stylesheet" href="/css/modules/turmas-tabs.css">
    <link rel="stylesheet" href="/css/modules/frequency-basic.css">
    <link rel="stylesheet" href="/css/modules/frequency-dashboard.css">
    <link rel="stylesheet" href="/css/modules/frequency-history.css">
    <link rel="stylesheet" href="/css/modules/lesson-execution.css">
    <link rel="stylesheet" href="/css/modules/import.css">
    <link rel="stylesheet" href="/css/modules/import-enhanced.css">
    <link rel="stylesheet" href="/css/modules/asaas-import.css">
    <link rel="stylesheet" href="/css/modules/agenda.css">
    <link rel="stylesheet" href="/css/modules/units.css">
    <link rel="stylesheet" href="/css/modules/students-premium.css">
    <link rel="stylesheet" href="/css/modules/student-progress.css">
    <link rel="stylesheet" href="/css/modules/instructors.css">
    <link rel="stylesheet" href="/css/modules/graduation.css">
    <link rel="stylesheet" href="/css/modules/crm.css">
    <link rel="stylesheet" href="/css/modules/checkin-kiosk.css?v=hotfix-mobile-v3">
    <link rel="stylesheet" href="/css/modules/ai.css">
    <link rel="stylesheet" href="/css/modules/agents.css">
    <link rel="stylesheet" href="/css/modules/agent-dashboard-widget.css">
    <link rel="stylesheet" href="/css/modules/agent-chat.css">
    <link rel="stylesheet" href="/css/modules/agent-chat-widget.css">
    <link rel="stylesheet" href="/css/modules/agent-chat-fullscreen.css">
    <link rel="stylesheet" href="/css/modules/task-approval-widget.css">
    <link rel="stylesheet" href="/css/modules/agent-activity.css">
    <link rel="stylesheet" href="/css/modules/marketing.css">
</head>

<body>
    <!-- Barra Superior Minimalista -->
    <header class="top-bar">
        <div class="menu-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="logo">Academia</div>
        <div class="search-bar">
            <input type="text" placeholder="Buscar alunos, planos...">
        </div>

        <!-- Organization Selector -->
        <div class="organization-selector">
            <button class="org-button" id="orgSelectorBtn" title="Selecionar organiza√ß√£o">
                <span class="org-icon"><i class="fas fa-building"></i></span>
                <span class="org-name" id="currentOrgName">Carregando...</span>
                <span class="org-arrow">‚ñº</span>
            </button>
            <div class="org-dropdown" id="orgDropdown" style="display: none;">
                <div class="org-dropdown-header">
                    <strong>Organiza√ß√£o Atual</strong>
                </div>
                <div class="org-list" id="orgList">
                    <!-- Organizations will be loaded here -->
                    <div class="org-loading">Carregando organiza√ß√µes...</div>
                </div>
            </div>
        </div>

        <div class="user-actions">
            <div class="system-version" id="systemVersion" title="Vers√£o do Sistema"
                style="margin-right: 15px; font-size: 0.8rem; color: #666; display: flex; flex-direction: column; align-items: flex-end; cursor: help;">
                <span class="version-number" style="font-weight: bold;">v...</span>
                <span class="environment-badge" style="font-size: 0.7rem; opacity: 0.8;">...</span>
            </div>
            <div class="notifications" title="Notifica√ß√µes"><i class="fas fa-bell"></i></div>
            <div class="user-profile" title="Perfil"><i class="fas fa-user"></i></div>
            <button id="logoutBtn" class="logout-btn" title="Sair"><i class="fas fa-sign-out-alt"></i> Sair</button>
        </div>
    </header>

    <!-- Menu Lateral Limpo -->
    <aside class="sidebar">
        <nav class="main-menu">
            <ul>
                <li class="active" data-module="dashboard">
                    <i class="fas fa-chart-line"></i> <span>Dashboard</span>
                </li>
                <li data-module="students">
                    <i class="fas fa-users"></i> <span>Alunos</span>
                </li>
                <li data-module="quickEnrollment">
                    <i class="fas fa-bolt"></i> <span>Matr√≠cula R√°pida</span>
                </li>
                <li data-module="crm">
                    <i class="fas fa-bullseye"></i> <span>CRM & Leads</span>
                </li>
                <li data-module="packages">
                    <i class="fas fa-tags"></i> <span>Comercial</span>
                </li>
                <li data-module="activities">
                    <i class="fas fa-running"></i> <span>Atividades</span>
                </li>
                <li data-module="lesson-plans">
                    <i class="fas fa-book"></i> <span>Planos de Aula</span>
                </li>
                <li data-module="courses">
                    <i class="fas fa-graduation-cap"></i> <span>Cursos</span>
                </li>
                <li data-module="turmas">
                    <i class="fas fa-user-friends"></i> <span>Turmas</span>
                </li>
                <li data-module="organizations">
                    <i class="fas fa-building"></i> <span>Organiza√ß√µes</span>
                </li>
                <li data-module="units">
                    <i class="fas fa-map-marker-alt"></i> <span>Unidades</span>
                </li>
                <li data-module="instructors">
                    <i class="fas fa-chalkboard-teacher"></i> <span>Instrutores</span>
                </li>
                <li data-module="instructor-dashboard">
                    <i class="fas fa-user-tie"></i> <span>Minha Aula</span>
                </li>
                <li data-module="classroom-display">
                    <i class="fas fa-tv"></i> <span>Display de Sala</span>
                </li>
                <li data-module="checkin-kiosk">
                    <i class="fas fa-check-circle"></i> <span>Check-in Kiosk</span>
                </li>
                <li data-module="agenda">
                    <i class="fas fa-calendar-alt"></i> <span>Agenda</span>
                </li>
                <li data-module="frequency">
                    <i class="fas fa-chart-bar"></i> <span>Frequ√™ncia</span>
                </li>
                <li data-module="student-progress">
                    <i class="fas fa-chart-area"></i> <span>Progresso</span>
                </li>
                <li data-module="graduation">
                    <i class="fas fa-user-graduate"></i> <span>Gradua√ß√£o</span>
                </li>
                <li data-module="leaderboard">
                    <i class="fas fa-trophy"></i> <span>Ranking</span>
                </li>
                <li data-module="crm">
                    <i class="fas fa-bullseye"></i> <span>CRM</span>
                </li>
                <li data-module="ai">
                    <i class="fas fa-robot"></i> <span>IA & Agentes</span>
                </li>
                <li data-module="agents">
                    <i class="fas fa-robot"></i> <span>Agentes</span>
                </li>
                <li data-module="agent-chat-fullscreen">
                    <i class="fas fa-comments"></i> <span>Chat com Agentes</span>
                </li>
                <li data-module="agent-activity">
                    <i class="fas fa-tasks"></i> <span>Atividade de Agentes</span>
                </li>
                <li data-module="marketing">
                    <i class="fas fa-bullhorn"></i> <span>Marketing</span>
                </li>
                <li data-module="import">
                    <i class="fas fa-file-import"></i> <span>Importa√ß√£o</span>
                </li>
                <li data-module="reports">
                    <i class="fas fa-chart-pie"></i> <span>Relat√≥rios</span>
                </li>
                <li data-module="settings">
                    <i class="fas fa-cog"></i> <span>Configura√ß√µes</span>
                </li>
            </ul>
        </nav>
    </aside>
    <div class="sidebar-overlay"></div>


    <!-- √Årea de Conte√∫do -->
    <main class="content-area">
        <!-- Header removido conforme solicitado -->

        <div class="module-content" id="module-container">
            <!-- Conte√∫do dos m√≥dulos ser√° carregado aqui via SPA -->
            <div class="welcome-message">
                <h2>Dashboard Principal</h2>
                <p>Selecione um m√≥dulo no menu lateral para come√ßar.</p>
            </div>
        </div>
    </main>

    <!-- Auth Container (sobrep√µe tudo quando n√£o h√° session) -->
    <div id="auth-overlay"
        style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#1a1a2e;z-index:9999;overflow:auto">
        <div id="auth-container"></div>
    </div>

    <!-- Chart.js for Dashboard Visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Face API for Biometrics -->
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js"></script>

    <!-- Load core app utilities FIRST (organization context) -->
    <script src="/js/core/app.js"></script>

    <!-- Load shared utilities before SPA router (non-module, globals on window) -->
    <script src="/js/shared/utils/feedback.js"></script>
    <script src="/js/shared/organization-context.js"></script>
    <script src="/js/shared/api-client.js"></script>
    <script src="/js/shared/permissions-context.js"></script>
    <script src="/js/shared/websocket-client.js"></script>
    <!-- Design Tokens (theme/branding) runtime applier -->
    <script src="/js/shared/design-tokens.js"></script>
    <!-- Role-Based Access Control -->
    <script src="/js/shared/role-guard.js"></script>

    <!-- Organization Selector Component -->
    <script src="/js/components/organization-selector.js"></script>

    <!-- SPA Router and UI Controller -->
    <script src="/js/dashboard/spa-router.js"></script>
    <script src="/js/dashboard/ui-controller.js"></script>

    <!-- Auth Module -->
    <script src="/js/modules/auth/index.js"></script>

    <!-- Agent Chat Module -->
    <script src="/js/modules/agent-chat/index.js"></script>
    <script src="/js/modules/dashboard/agent-chat-widget.js"></script>

    <!-- Agent Chat Fullscreen Module -->
    <script type="module" src="/js/modules/agent-chat-fullscreen/index.js"></script>

    <!-- AI Module -->
    <script type="module" src="/js/modules/ai/index.js"></script>

    <!-- Agents Module -->
    <script type="module" src="/js/modules/agents/index.js"></script>
    <script type="module" src="/js/modules/agents/dashboard-widget.js"></script>

    <!-- Agent Activity Module -->
    <script type="module" src="/js/modules/agent-activity/index.js"></script>

    <!-- Students Module -->
    <script type="module" src="/js/modules/students/index.js"></script>

    <!-- Leaderboard Module -->
    <script type="module" src="/js/modules/leaderboard/index.js"></script>

    <!-- Turmas Module -->
    <script type="module" src="/js/modules/turmas/index.js"></script>

    <!-- Frequency Module -->
    <script type="module" src="/js/modules/frequency/index.js"></script>

    <!-- Lesson Execution Module (Activity Tracking) -->
    <script type="module" src="/js/modules/lesson-execution/index.js"></script>

    <!-- Import Module -->
    <script src="/js/modules/import/controllers/importControllerEnhanced.js"></script>
    <script type="module" src="/js/modules/import/index.js"></script>

    <!-- Asaas Import Module -->
    <script type="module" src="/js/modules/asaas-import/index.js"></script>

    <!-- CRM Module -->
    <script type="module" src="/js/modules/crm/index.js"></script>

    <!-- Packages Module (Comercial) -->
    <script type="module" src="/js/modules/packages/index.js"></script>

    <!-- Discounts Module -->
    <script type="module" src="/js/modules/discounts/index.js"></script>

    <!-- Dashboard Widgets -->
    <script src="/js/modules/dashboard/widgets/task-approval-widget.js"></script>

    <!-- Organization Selector Initializer -->
    <script src="/js/components/organization-selector-init.js"></script>

    <!-- Test Guide for Anti-Duplication System - REMOVED: file does not exist -->
    <!-- <script type="module" src="js/modules/students/services/test-guide.js"></script> -->

    <!-- Lesson Plans Module - REMOVIDO: ser√° carregado dinamicamente pelo router -->

    <!-- Quick Enrollment Module -->
    <script type="module" src="/js/modules/quick-enrollment/index.js?v=4"></script>

    <!-- Pre-Enrollment Admin Module -->
    <script type="module" src="/js/modules/pre-enrollment-admin/index.js?v=1"></script>

    <!-- Logout Handler -->
    <script>
        // Configurar logout quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    // Limpar dados de autentica√ß√£o
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    localStorage.removeItem('activeOrganizationId');
                    sessionStorage.clear();

                    // Redirecionar para p√°gina de login
                    window.location.href = '/login.html';
                });
            }
        });
    </script>
    }
    });
    </script>
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>

</html>