<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Editor de Plano</title>
  <link rel="stylesheet" href="../css/style.css" />
  <link rel="stylesheet" href="../css/modules/plan-editor.css" />
  <style>
    /* Minimal tab and list styles (complement existing CSS) */
    .plan-tabs { display:flex; gap:6px; margin:16px 0 8px; border-bottom:1px solid #e5e7eb; }
    .plan-tab { padding:8px 12px; border:1px solid #e5e7eb; border-bottom:none; border-radius:8px 8px 0 0; background:#f3f4f6; cursor:pointer; font-weight:600; color:#374151; position:relative; }
    .plan-tab.active { background:#fff; color:#111827; }
    .plan-tab.badge-dirty::after { content:""; width:8px; height:8px; background:#ef4444; border-radius:999px; position:absolute; top:6px; right:-2px; }
    .plan-tab-panels { background:#fff; border:1px solid #e5e7eb; border-radius:0 8px 8px 8px; padding:16px; }
    /* Force visibility control even if external CSS conflicts */
    .plan-tab-panels .plan-tab-panel { display:none !important; }
    .plan-tab-panels .plan-tab-panel.active { display:block !important; }

    .courses-association { display:flex; gap:16px; flex-wrap:wrap; }
    .courses-col { flex:1 1 360px; min-width:300px; border:1px solid #e5e7eb; border-radius:8px; overflow:hidden; background:#fafafa; display:flex; flex-direction:column; max-height:520px; }
    .courses-col header { padding:10px 12px; background:#fff; border-bottom:1px solid #e5e7eb; display:flex; justify-content:space-between; align-items:center; font-weight:600; }
    .courses-col .toolbar { padding:8px; border-bottom:1px solid #eee; }
    .courses-col input[type="search"] { width:100%; padding:6px 8px; }
    ul.course-list { list-style:none; margin:0; padding:0; overflow:auto; flex:1; background:#fff; }
    ul.course-list li { padding:8px 10px; border-bottom:1px solid #f3f4f6; display:flex; align-items:center; gap:8px; cursor:pointer; }
    ul.course-list li.selected { background:#e0f2fe; }
    ul.course-list li .meta { margin-left:auto; font-size:12px; color:#6b7280; }
    .assoc-actions { display:flex; flex-direction:column; justify-content:center; gap:10px; }
    .save-diff-bar { margin-top:12px; padding:10px; border:1px solid #fde68a; background:#fffbeb; border-radius:8px; display:none; justify-content:space-between; }
    .empty-state { padding:14px; text-align:center; color:#6b7280; }
    .loading-inline { padding:10px; color:#374151; }
  </style>
</head>
<body>
  <div class="plan-editor container plan-editor-isolated">
    <header class="page-header">
      <div class="header-content">
        <div>
          <h1 id="pageTitle">Editar Plano</h1>
          <p class="sub">Gerencie e edite os planos da academia</p>
        </div>
        <div class="header-actions">
          <button id="backBtn" class="btn btn-secondary">← Voltar</button>
        </div>
      </div>
    </header>

    <div id="loadingState" class="loading-inline">Carregando dados do plano...</div>

    <nav id="planTabs" class="plan-tabs" style="display:none;">
      <div class="plan-tab active" data-tab="details">Detalhes</div>
      <div class="plan-tab" data-tab="courses" id="coursesTabBtn">Cursos</div>
      <div class="plan-tab" data-tab="lesson-plans" id="lessonPlansTabBtn">Planos de Aula</div>
    </nav>

    <section id="planTabPanels" class="plan-tab-panels" style="display:none;">
      <!-- Details Tab -->
      <div class="plan-tab-panel active" data-panel="details">
        <main id="mainContent" style="display:none;">
          <form id="plan-form">
            <div class="form-section">
              <h3>Informações Gerais</h3>
              <div class="form-group">
                <label for="planName">Nome do Plano</label>
                <input type="text" id="planName" name="planName" required />
              </div>
              <div class="form-group">
                <label for="planDescription">Descrição</label>
                <textarea id="planDescription" name="planDescription" rows="3"></textarea>
              </div>
            </div>

            <div class="form-section">
              <h3>Detalhes</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="planPrice">Preço (R$)</label>
                  <input type="number" step="0.01" id="planPrice" name="planPrice" required />
                </div>
                <div class="form-group">
                  <label for="planBillingType">Cobrança</label>
                  <select id="planBillingType" name="planBillingType" required>
                    <option value="">Selecione</option>
                    <option value="MONTHLY">Mensal</option>
                    <option value="QUARTERLY">Trimestral</option>
                    <option value="YEARLY">Anual</option>
                    <option value="WEEKLY">Semanal</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="planClassesPerWeek">Aulas/semana</label>
                  <input type="number" id="planClassesPerWeek" name="planClassesPerWeek" min="0" />
                </div>
              </div>
              <div class="form-group">
                <label for="planCategory">Categoria</label>
                <select id="planCategory" name="planCategory">
                  <option value="">Selecione</option>
                  <option value="ADULT">Adulto</option>
                  <option value="FEMALE">Feminino</option>
                  <option value="SENIOR">Senior</option>
                  <option value="CHILD">Infantil</option>
                </select>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" id="deletePlanBtn" class="btn btn-danger">Excluir</button>
              <button type="submit" id="savePlanBtn" class="btn btn-primary">Salvar</button>
            </div>
          </form>
        </main>
      </div>

      <!-- Courses Tab -->
      <div class="plan-tab-panel" data-panel="courses" id="coursesPanel">
        <h3>Cursos do Plano</h3>
        <p class="help">Vincule cursos que os alunos deste plano terão acesso.</p>
        <div id="coursesPanelContent">
          <div id="coursesLoading" class="loading-inline" style="display:none;">Carregando cursos...</div>
          <div id="coursesAssociation" class="courses-association" style="display:none;">
            <div class="courses-col">
              <header>
                <span>Disponíveis</span>
                <span id="availableCount">0</span>
              </header>
              <div class="toolbar"><input type="search" id="searchAvailableCourses" placeholder="Filtrar..." /></div>
              <ul id="availableCoursesList" class="course-list"></ul>
              <div id="availableEmptyState" class="empty-state" style="display:none;">Nenhum curso disponível</div>
            </div>
            <div class="assoc-actions">
              <button id="addCourseBtn" class="btn btn-secondary">Adicionar →</button>
              <button id="removeCourseBtn" class="btn btn-secondary">← Remover</button>
            </div>
            <div class="courses-col">
              <header>
                <span>Associados</span>
                <span id="linkedCount">0</span>
              </header>
              <div class="toolbar"><input type="search" id="searchLinkedCourses" placeholder="Filtrar..." /></div>
              <ul id="linkedCoursesList" class="course-list"></ul>
              <div id="linkedEmptyState" class="empty-state" style="display:none;">Nenhum curso associado</div>
            </div>
          </div>
          <div id="coursesDiffBar" class="save-diff-bar">
            <div><strong>Alterações pendentes:</strong> <span id="diffSummary"></span></div>
            <div style="display:flex; gap:8px;">
              <button id="discardCoursesChangesBtn" class="btn btn-light">Descartar</button>
              <button id="saveCoursesChangesBtn" class="btn btn-primary">Salvar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Lesson Plans Tab -->
      <div class="plan-tab-panel" data-panel="lesson-plans" id="lessonPlansPanel">
        <h3>Planos de Aula</h3>
        <div id="lessonPlansContainer"></div>
      </div>
    </section>
  </div>

  <script src="../js/modules/plan-editor.js"></script>
</body>
</html>
