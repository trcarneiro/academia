<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•ã Krav Maga Academy - Terminal de Check-in Premium</title>
    
    <!-- Base Styles -->
    <link rel="stylesheet" href="/css/premium-base.css">
    
    <!-- App Context -->
    <script src="js/shared/utils.js"></script>
    <script src="js/shared/api-client.js"></script>
    <script src="js/dashboard/app.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f8fafc;
            height: 100vh;
            overflow: hidden;
            font-family: 'Outfit', sans-serif;
        }

        #kiosk-app {
            width: 100%;
            height: 100%;
        }

        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
            color: white;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top: 5px solid #3B82F6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>

<body>
    <div id="kiosk-app">
        <div class="loading-screen">
            <div class="spinner"></div>
            <p>Iniciando terminal de check-in...</p>
        </div>
    </div>

    <!-- face-api.js library -->
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

    <script>
        /**
         * Standalone Kiosk Loader
         * Initializes the modular CheckinKiosk module outside the SPA
         */
        async function initModularKiosk() {
            try {
                const container = document.getElementById('kiosk-app');
                
                // 1. Load shared utilities and API client
                // Already loaded via tags
                
                // 2. Mock AcademyApp if not available (Standalone mode)
                if (!window.app) {
                    window.app = {
                        handleError: (err, context) => console.error(`[${context}]`, err),
                        dispatchEvent: (name, detail) => console.log(`[Event: ${name}]`, detail)
                    };
                }

                // 3. Load CheckinKiosk module assets (in order)
                const scripts = [
                    'js/modules/checkin-kiosk/services/FaceRecognitionService.js',
                    'js/modules/checkin-kiosk/services/CameraService.js',
                    'js/modules/checkin-kiosk/services/BiometricService.js',
                    'js/modules/checkin-kiosk/services/AttendanceService.js',
                    'js/modules/checkin-kiosk/views/CameraView.v2.js',
                    'js/modules/checkin-kiosk/views/ConfirmationView.js',
                    'js/modules/checkin-kiosk/views/SuccessView.js',
                    'js/modules/checkin-kiosk/controllers/CheckinController.v2.js',
                    'js/modules/checkin-kiosk/index.js'
                ];

                for (const src of scripts) {
                    await loadScript(src);
                }

                // 4. Initialize the module
                if (window.CheckinKiosk) {
                    await window.CheckinKiosk.init('kiosk-app');
                    console.log('‚úÖ Kiosk V3 initialized successfully');
                } else {
                    throw new Error('CheckinKiosk module not found after loading scripts');
                }
            } catch (error) {
                console.error('‚ùå Failed to initialize kiosk:', error);
                document.getElementById('kiosk-app').innerHTML = `
                    <div style="padding: 2rem; text-align: center; color: #ef4444;">
                        <h2>Erro ao carregar o terminal</h2>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem;">Tentar novamente</button>
                    </div>
                `;
            }
        }

        /**
         * Simple script loader
         */
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = () => reject(new Error(`Failed to load script: ${src}`));
                document.head.appendChild(script);
            });
        }

        // Start initialization
        document.addEventListener('DOMContentLoaded', initModularKiosk);
    </script>
</body>

</html>