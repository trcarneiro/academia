<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Instructor Fix Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-card { 
            background: rgba(255,255,255,0.1); 
            margin: 20px 0; 
            padding: 20px; 
            border-radius: 12px; 
            backdrop-filter: blur(10px);
        }
        .success { background: rgba(40, 167, 69, 0.2); border-left: 4px solid #28a745; }
        .error { background: rgba(220, 53, 69, 0.2); border-left: 4px solid #dc3545; }
        .warning { background: rgba(255, 193, 7, 0.2); border-left: 4px solid #ffc107; }
        button { 
            padding: 12px 24px; 
            margin: 8px; 
            border: none;
            border-radius: 8px;
            cursor: pointer; 
            font-weight: bold;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        .btn-test { background: linear-gradient(45deg, #007bff, #6f42c1); }
        .btn-navigate { background: linear-gradient(45deg, #fd7e14, #e83e8c); }
        pre { 
            background: rgba(0,0,0,0.3); 
            padding: 15px; 
            border-radius: 8px; 
            overflow-x: auto;
            font-size: 12px;
        }
        .console-log { 
            background: rgba(0,0,0,0.5); 
            padding: 10px; 
            border-radius: 6px; 
            margin: 10px 0;
            font-family: monospace;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîß Instructor Module Fix Test</h1>
    <p><strong>Objetivo:</strong> Testar se as corre√ß√µes resolveram os problemas de dados e navega√ß√£o.</p>

    <div class="test-card">
        <h2>üìä Test 1: Data Display Issue</h2>
        <p>Problema: "No instructors found" mesmo com dados v√°lidos da API</p>
        <button class="btn-test" onclick="testDataDisplay()">Test Data Display</button>
        <div id="data-test-result"></div>
    </div>

    <div class="test-card">
        <h2>üîÑ Test 2: Navigation Issue</h2>
        <p>Problema: Bot√£o "Adicionar Instrutor" n√£o abre tela de edi√ß√£o</p>
        <button class="btn-navigate" onclick="testNavigation()">Test Navigation</button>
        <button class="btn-navigate" onclick="testHashNavigation()">Test Hash Navigation</button>
        <button class="btn-navigate" onclick="testStandaloneEditor()">Test Standalone Editor</button>
        <div id="navigation-test-result"></div>
    </div>

    <div class="test-card">
        <h2>üß™ Test 3: Complete Module Test</h2>
        <p>Teste completo do m√≥dulo com dados reais</p>
        <button class="btn-test" onclick="testCompleteModule()">Test Complete Module</button>
        <div id="complete-test-result"></div>
        <div id="module-container" style="margin-top: 20px;"></div>
    </div>

    <div class="test-card">
        <h2>üìã Console Logs</h2>
        <button onclick="clearConsole()">Clear</button>
        <div id="console-output" class="console-log">
            <div>üîç Console logs will appear here...</div>
        </div>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('console-output');

        function addToConsole(type, message) {
            const div = document.createElement('div');
            div.style.color = type === 'error' ? '#ff6b6b' : '#4ecdc4';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${type.toUpperCase()}: ${message}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole('log', args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('error', args.join(' '));
        };

        function clearConsole() {
            consoleOutput.innerHTML = '<div>üîç Console cleared...</div>';
        }

        async function testDataDisplay() {
            const resultDiv = document.getElementById('data-test-result');
            resultDiv.innerHTML = '<div>üîÑ Testing data display...</div>';

            try {
                // Test API directly
                const response = await fetch('/api/instructors');
                const data = await response.json();
                
                console.log('API Response:', data);
                
                if (data.success && data.data && Array.isArray(data.data)) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ API returning valid data: ${data.data.length} instructors
                            <pre>${JSON.stringify(data.data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            ‚ùå API returning invalid data format
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå API Error: ${error.message}</div>`;
            }
        }

        function testNavigation() {
            const resultDiv = document.getElementById('navigation-test-result');
            resultDiv.innerHTML = '<div>üîÑ Testing navigation methods...</div>';

            const methods = {
                'window.navigateTo': typeof window.navigateTo,
                'window.router': typeof window.router,
                'window.history': typeof window.history,
                'window.location': typeof window.location
            };

            resultDiv.innerHTML += `
                <div class="warning">
                    üîç Available navigation methods:
                    <pre>${JSON.stringify(methods, null, 2)}</pre>
                </div>
            `;

            // Try navigation
            try {
                if (window.navigateTo && typeof window.navigateTo === 'function') {
                    window.navigateTo('/instructors/new');
                    resultDiv.innerHTML += '<div class="success">‚úÖ Using window.navigateTo</div>';
                } else {
                    window.location.hash = '#/instructors/new';
                    resultDiv.innerHTML += '<div class="success">‚úÖ Using hash navigation</div>';
                }
            } catch (error) {
                resultDiv.innerHTML += `<div class="error">‚ùå Navigation failed: ${error.message}</div>`;
            }
        }

        function testHashNavigation() {
            const resultDiv = document.getElementById('navigation-test-result');
            resultDiv.innerHTML += '<div>üîÑ Testing hash navigation...</div>';
            
            try {
                window.location.hash = '#/instructors/new';
                resultDiv.innerHTML += '<div class="success">‚úÖ Hash navigation executed</div>';
                
                setTimeout(() => {
                    resultDiv.innerHTML += `<div class="warning">Current hash: ${window.location.hash}</div>`;
                }, 500);
            } catch (error) {
                resultDiv.innerHTML += `<div class="error">‚ùå Hash navigation failed: ${error.message}</div>`;
            }
        }

        function testStandaloneEditor() {
            const resultDiv = document.getElementById('navigation-test-result');
            resultDiv.innerHTML += '<div class="success">üöÄ Opening standalone editor...</div>';
            
            const standaloneUrl = window.location.origin + '/standalone-instructor-editor.html';
            window.open(standaloneUrl, '_blank');
        }

        async function testCompleteModule() {
            const resultDiv = document.getElementById('complete-test-result');
            const moduleContainer = document.getElementById('module-container');
            
            resultDiv.innerHTML = '<div>üîÑ Loading complete module...</div>';

            try {
                // Load required scripts
                await loadScript('/js/shared/api-client.js');
                await loadScript('/js/modules/instructors/controllers/InstructorsController.js');
                
                console.log('Scripts loaded, initializing controller...');
                
                // Wait for API client
                let attempts = 0;
                while (!window.createModuleAPI && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }

                if (window.createModuleAPI && window.InstructorsController) {
                    const controller = new window.InstructorsController();
                    await controller.initialize(moduleContainer);
                    
                    resultDiv.innerHTML = '<div class="success">‚úÖ Module loaded successfully!</div>';
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå Required dependencies not available</div>';
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Module loading failed: ${error.message}</div>`;
                console.error('Module test error:', error);
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Auto-run data test on load
        window.addEventListener('load', () => {
            setTimeout(testDataDisplay, 1000);
        });
    </script>
</body>
</html>
