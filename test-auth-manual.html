<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Manual - Auth Supabase</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }
        h1 { 
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .test-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-section h2 {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-status {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ccc;
            text-align: center;
            line-height: 20px;
            font-weight: bold;
            color: white;
            font-size: 12px;
        }
        .test-status.pending { background: #ccc; }
        .test-status.loading { background: #ff9800; animation: spin 1s linear infinite; }
        .test-status.success { background: #4caf50; }
        .test-status.error { background: #f44336; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .test-result {
            margin-top: 10px;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }
        .test-result.success { background: #e8f5e9; color: #2e7d32; border-left: 4px solid #4caf50; }
        .test-result.error { background: #ffebee; color: #c62828; border-left: 4px solid #f44336; }
        .test-result.info { background: #e3f2fd; color: #1565c0; border-left: 4px solid #2196f3; }
        
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .button:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .button:disabled { opacity: 0.6; cursor: not-allowed; }
        
        .summary {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #667eea;
        }
        .summary h3 { color: #333; margin-bottom: 10px; }
        .summary-item { 
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .summary-item:last-child { border-bottom: none; }
        .summary-item span:first-child { color: #666; }
        .summary-item span:last-child { font-weight: 600; }
        .summary-item.pass span:last-child { color: #4caf50; }
        .summary-item.fail span:last-child { color: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Teste Manual - Auth Supabase</h1>
        <p class="subtitle">Validando integra√ß√£o do m√≥dulo de autentica√ß√£o</p>

        <!-- Teste 1: Verificar Backend Endpoint -->
        <div class="test-section">
            <h2>
                <span class="test-status pending" id="test1-status">‚óã</span>
                Backend Endpoint (Fetch Organization)
            </h2>
            <button class="button" onclick="runTest1()">Executar Teste 1</button>
            <div id="test1-result"></div>
        </div>

        <!-- Teste 2: Session Recovery (F5) -->
        <div class="test-section">
            <h2>
                <span class="test-status pending" id="test2-status">‚óã</span>
                Session Recovery (Verificar localStorage)
            </h2>
            <button class="button" onclick="runTest2()">Executar Teste 2</button>
            <div id="test2-result"></div>
        </div>

        <!-- Teste 3: Auth Module Check -->
        <div class="test-section">
            <h2>
                <span class="test-status pending" id="test3-status">‚óã</span>
                Auth Module (Verificar Carregamento)
            </h2>
            <button class="button" onclick="runTest3()">Executar Teste 3</button>
            <div id="test3-result"></div>
        </div>

        <!-- Teste 4: API Client Integration -->
        <div class="test-section">
            <h2>
                <span class="test-status pending" id="test4-status">‚óã</span>
                API Client (Verificar Integra√ß√£o)
            </h2>
            <button class="button" onclick="runTest4()">Executar Teste 4</button>
            <div id="test4-result"></div>
        </div>

        <!-- Resumo -->
        <div class="summary">
            <h3>üìä Resumo dos Testes</h3>
            <div class="summary-item">
                <span>Teste 1 - Backend Endpoint:</span>
                <span id="summary1">‚è≥ Pendente</span>
            </div>
            <div class="summary-item">
                <span>Teste 2 - Session Recovery:</span>
                <span id="summary2">‚è≥ Pendente</span>
            </div>
            <div class="summary-item">
                <span>Teste 3 - Auth Module:</span>
                <span id="summary3">‚è≥ Pendente</span>
            </div>
            <div class="summary-item">
                <span>Teste 4 - API Client:</span>
                <span id="summary4">‚è≥ Pendente</span>
            </div>
            <div class="summary-item" style="margin-top: 15px; font-size: 16px;">
                <span><strong>Total:</strong></span>
                <span id="total">0/4</span>
            </div>
        </div>

        <button class="button" style="margin-top: 20px; width: 100%; background: #f44336;" onclick="location.reload()">üîÑ Reiniciar Testes</button>
    </div>

    <script>
        let testsResult = {
            test1: null,
            test2: null,
            test3: null,
            test4: null
        };

        function updateStatus(testId, status) {
            const element = document.getElementById(`${testId}-status`);
            element.className = `test-status ${status}`;
            if (status === 'loading') element.textContent = '‚Üª';
            else if (status === 'success') element.textContent = '‚úì';
            else if (status === 'error') element.textContent = '‚úó';
            else element.textContent = '‚óã';
        }

        function showResult(testId, message, type) {
            const element = document.getElementById(`${testId}-result`);
            element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }

        function updateSummary() {
            let passed = 0;
            ['test1', 'test2', 'test3', 'test4'].forEach((test, idx) => {
                const result = testsResult[test];
                const summary = document.getElementById(`summary${idx + 1}`);
                if (result === true) {
                    summary.textContent = '‚úÖ PASSOU';
                    summary.parentElement.classList.add('pass');
                    passed++;
                } else if (result === false) {
                    summary.textContent = '‚ùå FALHOU';
                    summary.parentElement.classList.add('fail');
                } else {
                    summary.textContent = '‚è≥ Pendente';
                    summary.parentElement.className = 'summary-item';
                }
            });
            document.getElementById('total').textContent = `${passed}/4`;
        }

        async function runTest1() {
            updateStatus('test1', 'loading');
            try {
                const response = await fetch('http://localhost:3000/api/auth/users/by-email?email=trcampos@gmail.com');
                const data = await response.json();
                
                if (response.ok && data.success && data.data.organizationId) {
                    testsResult.test1 = true;
                    updateStatus('test1', 'success');
                    showResult('test1', `‚úÖ OrganizationId: ${data.data.organizationId}<br>Role: ${data.data.role}`, 'success');
                } else {
                    testsResult.test1 = false;
                    updateStatus('test1', 'error');
                    showResult('test1', `‚ùå ${data.message || 'Erro desconhecido'}`, 'error');
                }
            } catch (error) {
                testsResult.test1 = false;
                updateStatus('test1', 'error');
                showResult('test1', `‚ùå Erro: ${error.message}`, 'error');
            }
            updateSummary();
        }

        function runTest2() {
            updateStatus('test2', 'loading');
            try {
                const token = localStorage.getItem('sb-ykwfuymgwukericlhgxh-auth-token');
                const orgId = localStorage.getItem('organizationId');
                const userId = localStorage.getItem('userId');
                const email = localStorage.getItem('userEmail');
                
                if (token && orgId && userId && email) {
                    testsResult.test2 = true;
                    updateStatus('test2', 'success');
                    showResult('test2', `‚úÖ Session Recovery OK<br>OrganizationId: ${orgId}<br>User: ${email}`, 'success');
                } else {
                    testsResult.test2 = false;
                    updateStatus('test2', 'error');
                    showResult('test2', `‚ö†Ô∏è Sem sess√£o ativa (esperado se n√£o logou)`, 'info');
                }
            } catch (error) {
                testsResult.test2 = false;
                updateStatus('test2', 'error');
                showResult('test2', `‚ùå Erro: ${error.message}`, 'error');
            }
            updateSummary();
        }

        function runTest3() {
            updateStatus('test3', 'loading');
            try {
                if (window.auth && typeof window.auth.init === 'function') {
                    testsResult.test3 = true;
                    updateStatus('test3', 'success');
                    showResult('test3', `‚úÖ Auth module carregado<br>M√©todo init dispon√≠vel`, 'success');
                } else {
                    testsResult.test3 = false;
                    updateStatus('test3', 'error');
                    showResult('test3', `‚ùå Auth module n√£o encontrado em window.auth`, 'error');
                }
            } catch (error) {
                testsResult.test3 = false;
                updateStatus('test3', 'error');
                showResult('test3', `‚ùå Erro: ${error.message}`, 'error');
            }
            updateSummary();
        }

        async function runTest4() {
            updateStatus('test4', 'loading');
            try {
                if (typeof window.createModuleAPI === 'function') {
                    const api = window.createModuleAPI('Test');
                    if (api && typeof api.request === 'function') {
                        testsResult.test4 = true;
                        updateStatus('test4', 'success');
                        showResult('test4', `‚úÖ API Client dispon√≠vel<br>M√©todo request funcionando`, 'success');
                    } else {
                        testsResult.test4 = false;
                        updateStatus('test4', 'error');
                        showResult('test4', `‚ùå API Client n√£o tem m√©todo request`, 'error');
                    }
                } else {
                    testsResult.test4 = false;
                    updateStatus('test4', 'error');
                    showResult('test4', `‚ùå createModuleAPI n√£o encontrado em window`, 'error');
                }
            } catch (error) {
                testsResult.test4 = false;
                updateStatus('test4', 'error');
                showResult('test4', `‚ùå Erro: ${error.message}`, 'error');
            }
            updateSummary();
        }

        // Rodar teste 1 automaticamente ao carregar
        window.addEventListener('load', () => {
            runTest1();
        });
    </script>
</body>
</html>
