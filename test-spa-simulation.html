<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simula√ß√£o SPA - Agenda H√≠brida</title>
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/modules/hybrid-agenda.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f5f5f5; }
        .app-container { display: flex; min-height: 100vh; }
        .sidebar { width: 250px; background: #2c3e50; color: white; padding: 20px; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar li { padding: 12px; margin: 4px 0; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
        .sidebar li:hover { background: rgba(255,255,255,0.1); }
        .sidebar li.active { background: #3498db; }
        .main-content { flex: 1; display: flex; flex-direction: column; }
        .module-header { background: white; padding: 20px; border-bottom: 1px solid #ddd; }
        .module-header h1 { margin: 0; color: #2c3e50; }
        .breadcrumb { color: #7f8c8d; margin-top: 4px; }
        #module-container { flex: 1; padding: 20px; background: #ecf0f1; }
        .test-panel { position: fixed; top: 10px; right: 10px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; }
        .test-btn { padding: 8px 16px; margin: 2px; border: none; border-radius: 4px; cursor: pointer; background: #3498db; color: white; font-size: 12px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; font-size: 12px; }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar simulando o sistema principal -->
        <aside class="sidebar">
            <h3>üìã Menu Principal</h3>
            <ul>
                <li data-module="dashboard">üè† Dashboard</li>
                <li data-module="students">üë• Alunos</li>
                <li data-module="agenda">üìÖ Agenda</li>
                <li data-module="hybrid-agenda" class="active">üèõÔ∏è Agenda H√≠brida</li>
                <li data-module="settings">‚öôÔ∏è Configura√ß√µes</li>
            </ul>
        </aside>
        
        <main class="main-content">
            <!-- Header simulando o sistema principal -->
            <div class="module-header">
                <h1 id="page-title">Agenda H√≠brida</h1>
                <div class="breadcrumb" id="breadcrumb">Home / Agenda H√≠brida</div>
            </div>
            
            <!-- Container onde o m√≥dulo ser√° carregado -->
            <div id="module-container">
                <div class="status info">
                    üì± Container pronto para carregar m√≥dulo h√≠brido...
                </div>
            </div>
        </main>
    </div>
    
    <!-- Painel de testes -->
    <div class="test-panel">
        <h4>üß™ Testes</h4>
        <button class="test-btn" onclick="loadDependencies()">üì¶ Carregar Deps</button>
        <button class="test-btn" onclick="loadModule()">üöÄ Carregar M√≥dulo</button>
        <button class="test-btn" onclick="simulateSPA()">üîÑ Simular SPA</button>
        <button class="test-btn" onclick="clearContainer()">üßπ Limpar</button>
        <div id="test-status"></div>
    </div>

    <script>
        let testStep = 0;
        let hybridModuleLoaded = false;
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('test-status');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            status.innerHTML = `<div class="status ${className}">${message}</div>`;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearContainer() {
            document.getElementById('module-container').innerHTML = `
                <div class="status info">
                    üì± Container limpo e pronto para novos testes...
                </div>
            `;
            updateStatus('Container limpo', 'info');
        }
        
        async function loadDependencies() {
            updateStatus('üîÑ Carregando depend√™ncias...', 'info');
            
            try {
                // Load API client
                if (!window.createModuleAPI) {
                    await loadScript('/js/shared/api-client.js');
                    updateStatus('‚úÖ API Client carregado', 'success');
                } else {
                    updateStatus('‚úÖ API Client j√° dispon√≠vel', 'success');
                }
                
                // Load utilities
                if (!window.feedback) {
                    await loadScript('/js/shared/utils/feedback.js');
                    updateStatus('‚úÖ Utilities carregados', 'success');
                }
                
                // Wait for API client to be ready
                let attempts = 0;
                while (!window.createModuleAPI && attempts < 30) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (window.createModuleAPI) {
                    updateStatus('üéâ Depend√™ncias prontas!', 'success');
                } else {
                    updateStatus('‚ùå API Client n√£o inicializou', 'error');
                }
                
            } catch (error) {
                updateStatus(`‚ùå Erro nas depend√™ncias: ${error.message}`, 'error');
            }
        }
        
        async function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        async function loadModule() {
            updateStatus('üöÄ Carregando m√≥dulo h√≠brido...', 'info');
            
            try {
                if (!window.createModuleAPI) {
                    updateStatus('‚ùå Depend√™ncias n√£o carregadas!', 'error');
                    return;
                }
                
                // Load hybrid agenda module
                if (!hybridModuleLoaded) {
                    await loadScript('/js/modules/hybrid-agenda/index.js');
                    hybridModuleLoaded = true;
                    updateStatus('‚úÖ Script do m√≥dulo carregado', 'success');
                }
                
                // Wait for module function to be available
                let attempts = 0;
                while (!window.initHybridAgendaModule && attempts < 20) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (typeof window.initHybridAgendaModule === 'function') {
                    updateStatus('‚úÖ Fun√ß√£o de inicializa√ß√£o encontrada', 'success');
                    
                    // Initialize module
                    const container = document.getElementById('module-container');
                    await window.initHybridAgendaModule(container);
                    
                    updateStatus('üéâ M√≥dulo h√≠brido inicializado!', 'success');
                    
                    // Test interactions
                    setTimeout(() => {
                        testInteractions();
                    }, 1000);
                    
                } else {
                    updateStatus('‚ùå Fun√ß√£o de inicializa√ß√£o n√£o encontrada', 'error');
                }
                
            } catch (error) {
                updateStatus(`‚ùå Erro ao carregar m√≥dulo: ${error.message}`, 'error');
                console.error('Module load error:', error);
            }
        }
        
        function testInteractions() {
            updateStatus('üß™ Testando intera√ß√µes...', 'info');
            
            // Test view switcher
            const listBtn = document.querySelector('[data-view="list"]');
            if (listBtn) {
                updateStatus('‚úÖ Bot√µes de view encontrados', 'success');
                
                // Test list view
                listBtn.click();
                setTimeout(() => {
                    if (listBtn.classList.contains('active')) {
                        updateStatus('‚úÖ Mudan√ßa de view funcionando', 'success');
                    }
                }, 200);
            }
            
            // Test create button
            const createBtn = document.querySelector('.create-agenda-btn');
            if (createBtn) {
                updateStatus('‚úÖ Bot√£o de criar encontrado', 'success');
            } else {
                updateStatus('‚ö†Ô∏è Bot√£o de criar n√£o encontrado', 'error');
            }
        }
        
        async function simulateSPA() {
            updateStatus('üîÑ Simulando navega√ß√£o SPA...', 'info');
            
            try {
                // Simulate SPA router behavior
                const container = document.getElementById('module-container');
                
                // Clear and show loading
                container.innerHTML = `
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>Carregando agenda h√≠brida...</p>
                    </div>
                `;
                
                // Wait as SPA router would
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Load module
                if (typeof window.initHybridAgendaModule === 'function') {
                    await window.initHybridAgendaModule(container);
                    updateStatus('üéâ Navega√ß√£o SPA simulada com sucesso!', 'success');
                } else {
                    updateStatus('‚ùå M√≥dulo n√£o dispon√≠vel para SPA', 'error');
                }
                
            } catch (error) {
                updateStatus(`‚ùå Erro na simula√ß√£o SPA: ${error.message}`, 'error');
            }
        }
        
        // Menu navigation simulation
        document.addEventListener('click', (e) => {
            if (e.target.matches('[data-module]')) {
                const module = e.target.dataset.module;
                
                // Update active state
                document.querySelectorAll('[data-module]').forEach(item => {
                    item.classList.remove('active');
                });
                e.target.classList.add('active');
                
                // Update header
                const titles = {
                    'dashboard': 'Dashboard',
                    'students': 'Alunos',
                    'agenda': 'Agenda',
                    'hybrid-agenda': 'Agenda H√≠brida',
                    'settings': 'Configura√ß√µes'
                };
                
                document.getElementById('page-title').textContent = titles[module] || module;
                document.getElementById('breadcrumb').textContent = `Home / ${titles[module] || module}`;
                
                if (module === 'hybrid-agenda') {
                    simulateSPA();
                } else {
                    document.getElementById('module-container').innerHTML = `
                        <div class="status info">
                            üìÑ M√≥dulo "${module}" seria carregado aqui...
                        </div>
                    `;
                }
            }
        });
        
        // Auto-start
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('üîç Sistema pronto para testes', 'info');
            
            // Auto-load dependencies after a delay
            setTimeout(() => {
                loadDependencies();
            }, 1000);
        });
        
        // Add spinner animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .spinner {
                width: 32px;
                height: 32px;
                border: 3px solid #f3f3f3;
                border-top: 3px solid #3498db;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 0 auto 16px;
            }
            .loading-state {
                text-align: center;
                padding: 40px;
                color: #7f8c8d;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>