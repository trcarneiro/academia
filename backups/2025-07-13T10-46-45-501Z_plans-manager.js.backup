{
  "timestamp": "2025-07-13T10-46-45-501Z",
  "originalPath": "/mnt/h/projetos/academia/public/js/modules/plans-manager.js",
  "description": "Sistema de carregamento de dados refatorado - cursos e planos funcionando",
  "content": "/**\n * üîí M√ìDULO ISOLADO - GEST√ÉO DE PLANOS\n * Vers√£o: 1.0.0 - Est√°vel\n * √öltimo update: 05/07/2025\n * \n * ‚ö†Ô∏è ATEN√á√ÉO: Este m√≥dulo est√° FUNCIONAL e TESTADO\n * N√£o altere sem criar backup e testes\n */\n\nwindow.PlansManager = (function() {\n    'use strict';\n    \n    // üîê Estado privado protegido\n    let _availablePlans = [];\n    let _currentPlan = null;\n    let _currentEditingStudentId = null;\n    \n    // üõ°Ô∏è API p√∫blica est√°vel\n    return {\n        version: '1.0.0',\n        \n        // Inicializa√ß√£o segura\n        init: function(studentId) {\n            console.log(`üîÑ PlansManager v${this.version} inicializado`);\n            _currentEditingStudentId = studentId;\n            return this;\n        },\n        \n        // Carregamento de dados com fallback\n        async loadPlansData() {\n            try {\n                // Tenta APIs na ordem de prioridade\n                const response = await this._tryMultipleAPIs([\n                    '/api/financial/plans',\n                    '/api/billing-plans'\n                ]);\n                \n                _availablePlans = response.data || [];\n                return _availablePlans;\n            } catch (error) {\n                console.warn('üì° APIs indispon√≠veis, retornando array vazio (CLAUDE.md compliance)');\n                _availablePlans = [];\n                return _availablePlans;\n            }\n        },\n        \n        // Renderiza√ß√£o isolada do componente\n        renderPlansInterface(containerId) {\n            const container = document.getElementById(containerId);\n            if (!container) {\n                console.error(`‚ùå Container ${containerId} n√£o encontrado`);\n                return false;\n            }\n            \n            container.innerHTML = this._generatePlansHTML();\n            this._attachEventListeners();\n            return true;\n        },\n        \n        // Filtros funcionais\n        filterByCategory(category) {\n            this._applyFilter('data-category', category);\n        },\n        \n        filterByBillingType(billingType) {\n            this._applyFilter('data-billing', billingType);\n        },\n        \n        // üîí M√©todos privados protegidos\n        async _tryMultipleAPIs(urls) {\n            for (const url of urls) {\n                try {\n                    const response = await fetch(url);\n                    if (response.ok) {\n                        return await response.json();\n                    }\n                } catch (error) {\n                    console.warn(`üì° API ${url} falhou:`, error.message);\n                }\n            }\n            throw new Error('Todas as APIs falharam');\n        },\n        \n        // _getMockPlans() method removed - CLAUDE.md compliance (no hardcoded data)\n        \n        _generatePlansHTML() {\n            return `\n                <div class=\"plans-container-isolated\">\n                    <div class=\"plans-header\">\n                        <h3>üí≥ Gest√£o de Planos</h3>\n                        <div class=\"plans-filters\">\n                            <select id=\"categoryFilter\" onchange=\"PlansManager.filterByCategory(this.value)\">\n                                <option value=\"\">Todas as categorias</option>\n                                <option value=\"ADULT\">Adulto</option>\n                                <option value=\"CHILD\">Infantil</option>\n                                <option value=\"SENIOR\">Senior</option>\n                            </select>\n                            <select id=\"billingFilter\" onchange=\"PlansManager.filterByBillingType(this.value)\">\n                                <option value=\"\">Todos os tipos</option>\n                                <option value=\"MONTHLY\">Mensal</option>\n                                <option value=\"QUARTERLY\">Trimestral</option>\n                                <option value=\"YEARLY\">Anual</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class=\"plans-grid\" id=\"plansGrid\">\n                        ${_availablePlans.map(plan => this._generatePlanCard(plan)).join('')}\n                    </div>\n                </div>\n            `;\n        },\n        \n        _generatePlanCard(plan) {\n            return `\n                <div class=\"plan-card-isolated\" \n                     data-category=\"${plan.category}\" \n                     data-billing=\"${plan.billingType}\"\n                     data-plan-id=\"${plan.id}\">\n                    <div class=\"plan-header\">\n                        <h4>${plan.name}</h4>\n                        <div class=\"plan-price\">R$ ${parseFloat(plan.price).toFixed(0)}</div>\n                    </div>\n                    <div class=\"plan-description\">${plan.description}</div>\n                    <div class=\"plan-features\">\n                        ${plan.features ? plan.features.map(f => `<div>‚úì ${f}</div>`).join('') : ''}\n                    </div>\n                    <button onclick=\"PlansManager.selectPlan('${plan.id}')\" \n                            class=\"plan-select-btn\">\n                        Selecionar Plano\n                    </button>\n                </div>\n            `;\n        },\n        \n        _applyFilter(attribute, value) {\n            const cards = document.querySelectorAll('.plan-card-isolated');\n            cards.forEach(card => {\n                const cardValue = card.getAttribute(attribute);\n                if (!value || cardValue === value) {\n                    card.style.display = 'block';\n                } else {\n                    card.style.display = 'none';\n                }\n            });\n        },\n        \n        _attachEventListeners() {\n            // Event listeners isolados para o m√≥dulo\n            console.log('üîó Event listeners attachados para PlansManager');\n        },\n        \n        selectPlan(planId) {\n            console.log(`üéØ Plano selecionado: ${planId}`);\n            // Implementar l√≥gica de sele√ß√£o\n            if (window.showToast) {\n                window.showToast(`Plano ${planId} selecionado!`, 'success');\n            }\n        }\n    };\n})();\n\n// üìù Auto-documenta√ß√£o do m√≥dulo\nconsole.log('üì¶ PlansManager v1.0.0 carregado com sucesso');"
}