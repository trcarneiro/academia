<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste Completo - M√≥dulo Instrutores</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/modules/instructors.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .test-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            background: #f8f9fa;
        }
        .test-section h3 {
            margin: 0 0 1rem 0;
            color: #667eea;
        }
        .test-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 1rem 0;
        }
        .test-result {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 8px;
            min-height: 50px;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .log-area {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin: 1rem 0;
        }
        pre {
            background: #f4f4f4;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste Completo - M√≥dulo de Instrutores</h1>
        <p>Esta p√°gina testa todas as funcionalidades do m√≥dulo de instrutores seguindo o padr√£o Activities.</p>

        <!-- Test 1: API Connection -->
        <div class="test-section">
            <h3>1Ô∏è‚É£ Teste de Conex√£o com API</h3>
            <div class="test-buttons">
                <button onclick="testAPI()" class="btn-primary">Testar API</button>
                <button onclick="testAPICreate()" class="btn-secondary">Criar Instrutor Teste</button>
                <button onclick="clearLogs()" class="btn-secondary">Limpar Logs</button>
            </div>
            <div id="api-result" class="test-result info">Clique em "Testar API" para verificar a conex√£o.</div>
        </div>

        <!-- Test 2: Module Loading -->
        <div class="test-section">
            <h3>2Ô∏è‚É£ Teste de Carregamento do M√≥dulo</h3>
            <div class="test-buttons">
                <button onclick="testModuleLoad()" class="btn-primary">Carregar M√≥dulo</button>
                <button onclick="testControllerFunctions()" class="btn-secondary">Testar Controller</button>
            </div>
            <div id="module-container" style="min-height: 400px; border: 2px dashed #dee2e6; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
                <p style="text-align: center; color: #6c757d;">O m√≥dulo ser√° carregado aqui...</p>
            </div>
            <div id="module-result" class="test-result info">Clique em "Carregar M√≥dulo" para testar.</div>
        </div>

        <!-- Test 3: Navigation -->
        <div class="test-section">
            <h3>3Ô∏è‚É£ Teste de Navega√ß√£o</h3>
            <div class="test-buttons">
                <button onclick="testStandaloneEditor()" class="btn-primary">
                    <i class="fas fa-external-link-alt"></i>
                    Editor Standalone
                </button>
                <button onclick="testSPANavigation()" class="btn-secondary">
                    <i class="fas fa-route"></i>
                    Navega√ß√£o SPA
                </button>
                <button onclick="testDirectNavigation()" class="btn-secondary">
                    <i class="fas fa-link"></i>
                    Navega√ß√£o Direta
                </button>
            </div>
            <div id="navigation-result" class="test-result info">Teste as diferentes formas de navega√ß√£o.</div>
        </div>

        <!-- Test 4: Data Display -->
        <div class="test-section">
            <h3>4Ô∏è‚É£ Teste de Exibi√ß√£o de Dados</h3>
            <div class="test-buttons">
                <button onclick="debugInstructorData()" class="btn-primary">Debug Dados</button>
                <button onclick="forceRefresh()" class="btn-secondary">For√ßar Refresh</button>
            </div>
            <div id="data-result" class="test-result info">Analise como os dados est√£o sendo processados.</div>
        </div>

        <!-- Logs -->
        <div class="test-section">
            <h3>üìã Logs do Sistema</h3>
            <div id="logs" class="log-area">
                Sistema pronto para testes...\n
            </div>
        </div>

        <!-- Debug Info -->
        <div class="test-section">
            <h3>üîß Informa√ß√µes de Debug</h3>
            <div id="debug-info">
                <p><strong>API Client:</strong> <span id="api-status">Verificando...</span></p>
                <p><strong>M√≥dulo Carregado:</strong> <span id="module-status">Verificando...</span></p>
                <p><strong>Controller:</strong> <span id="controller-status">Verificando...</span></p>
                <p><strong>Router:</strong> <span id="router-status">Verificando...</span></p>
                <p><strong>√öltimo Erro:</strong> <span id="last-error">Nenhum</span></p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/js/shared/api-client.js"></script>
    <script src="/js/shared/utils.js"></script>
    <script src="/js/modules/instructors/controllers/InstructorsController.js"></script>
    <script src="/js/modules/instructors/index.js"></script>

    <script>
        // Global test functions
        let testAPI = null;
        let testResults = {};

        // Logging function
        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = 'Logs limpos...\n';
        }

        // Test functions
        async function testAPI() {
            const resultDiv = document.getElementById('api-result');
            log('üîç Testando conex√£o com API...');
            
            try {
                resultDiv.className = 'test-result info';
                resultDiv.innerHTML = 'üîÑ Testando conex√£o...';

                // Wait for API client
                await waitForAPIClient();
                testAPI = window.createModuleAPI('Instructors');
                
                const response = await testAPI.request('/api/instructors');
                
                if (response.success) {
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `
                        <h4>‚úÖ API funcionando!</h4>
                        <p>Encontrados: ${response.data.length} instrutores</p>
                        <pre>${JSON.stringify(response.data, null, 2)}</pre>
                    `;
                    log(`‚úÖ API retornou ${response.data.length} instrutores`);
                } else {
                    throw new Error(response.error || 'Resposta inv√°lida');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `<h4>‚ùå Erro na API</h4><p>${error.message}</p>`;
                log(`‚ùå Erro na API: ${error.message}`);
                document.getElementById('last-error').textContent = error.message;
            }
        }

        async function testAPICreate() {
            const resultDiv = document.getElementById('api-result');
            log('üìù Criando instrutor de teste...');
            
            try {
                if (!testAPI) {
                    await waitForAPIClient();
                    testAPI = window.createModuleAPI('Instructors');
                }

                const testData = {
                    name: `Instrutor Teste ${Date.now()}`,
                    email: `teste.${Date.now()}@academia.com`,
                    phone: '(11) 99999-9999',
                    bio: 'Instrutor criado para teste'
                };

                const response = await testAPI.request('/api/instructors', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });

                if (response.success) {
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `
                        <h4>‚úÖ Instrutor criado!</h4>
                        <pre>${JSON.stringify(response.data, null, 2)}</pre>
                    `;
                    log(`‚úÖ Instrutor criado: ${response.data.name}`);
                } else {
                    throw new Error(response.error || 'Erro ao criar instrutor');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `<h4>‚ùå Erro ao criar</h4><p>${error.message}</p>`;
                log(`‚ùå Erro ao criar: ${error.message}`);
            }
        }

        async function testModuleLoad() {
            const container = document.getElementById('module-container');
            const resultDiv = document.getElementById('module-result');
            log('üì¶ Carregando m√≥dulo de instrutores...');
            
            try {
                resultDiv.className = 'test-result info';
                resultDiv.innerHTML = 'üîÑ Inicializando m√≥dulo...';
                container.innerHTML = '';

                if (window.initInstructorsModule) {
                    await window.initInstructorsModule(container);
                    
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = '‚úÖ M√≥dulo carregado com sucesso!';
                    log('‚úÖ M√≥dulo de instrutores carregado');
                } else {
                    throw new Error('initInstructorsModule n√£o encontrado');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `<h4>‚ùå Erro no m√≥dulo</h4><p>${error.message}</p>`;
                log(`‚ùå Erro no m√≥dulo: ${error.message}`);
            }
        }

        function testControllerFunctions() {
            const resultDiv = document.getElementById('module-result');
            log('üîß Testando fun√ß√µes do controller...');
            
            try {
                if (window.instructorsController) {
                    const methods = Object.getOwnPropertyNames(Object.getPrototypeOf(window.instructorsController));
                    
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `
                        <h4>‚úÖ Controller encontrado!</h4>
                        <p>M√©todos dispon√≠veis:</p>
                        <pre>${methods.join(', ')}</pre>
                    `;
                    log(`‚úÖ Controller tem ${methods.length} m√©todos`);
                } else {
                    throw new Error('Controller n√£o encontrado');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `<h4>‚ùå Erro no controller</h4><p>${error.message}</p>`;
                log(`‚ùå Erro no controller: ${error.message}`);
            }
        }

        function testStandaloneEditor() {
            const resultDiv = document.getElementById('navigation-result');
            log('üöÄ Abrindo editor standalone...');
            
            resultDiv.className = 'test-result success';
            resultDiv.innerHTML = 'üöÄ Editor standalone aberto em nova aba';
            
            window.open('/standalone-instructor-editor.html', '_blank');
        }

        function testSPANavigation() {
            const resultDiv = document.getElementById('navigation-result');
            log('üîÑ Testando navega√ß√£o SPA...');
            
            try {
                if (window.navigateTo) {
                    window.navigateTo('/instructors/new');
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = '‚úÖ Navega√ß√£o SPA executada';
                    log('‚úÖ window.navigateTo funcionou');
                } else {
                    window.location.href = '#/instructors/new';
                    resultDiv.className = 'test-result warning';
                    resultDiv.innerHTML = '‚ö†Ô∏è Usando fallback (hash navigation)';
                    log('‚ö†Ô∏è window.navigateTo n√£o encontrado, usando hash');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `‚ùå Erro na navega√ß√£o: ${error.message}`;
                log(`‚ùå Erro na navega√ß√£o: ${error.message}`);
            }
        }

        function testDirectNavigation() {
            const resultDiv = document.getElementById('navigation-result');
            log('üîó Testando navega√ß√£o direta...');
            
            resultDiv.className = 'test-result info';
            resultDiv.innerHTML = 'üîó Redirecionando para #/instructors/new...';
            
            setTimeout(() => {
                window.location.href = '#/instructors/new';
            }, 1000);
        }

        function debugInstructorData() {
            const resultDiv = document.getElementById('data-result');
            log('üîç Analisando dados dos instrutores...');
            
            try {
                if (window.instructorsController && window.instructorsController.instructors) {
                    const data = window.instructorsController.instructors;
                    
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `
                        <h4>üìä Dados encontrados</h4>
                        <p>Quantidade: ${data.length} instrutores</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                    log(`üìä Controller tem ${data.length} instrutores em cache`);
                } else {
                    resultDiv.className = 'test-result warning';
                    resultDiv.innerHTML = '‚ö†Ô∏è Controller n√£o inicializado ou sem dados';
                    log('‚ö†Ô∏è Dados n√£o encontrados no controller');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `‚ùå Erro ao analisar: ${error.message}`;
                log(`‚ùå Erro na an√°lise: ${error.message}`);
            }
        }

        function forceRefresh() {
            const resultDiv = document.getElementById('data-result');
            log('‚ôªÔ∏è For√ßando refresh dos dados...');
            
            try {
                if (window.instructorsController) {
                    window.instructorsController.loadInstructors();
                    resultDiv.className = 'test-result info';
                    resultDiv.innerHTML = '‚ôªÔ∏è Refresh solicitado - verifique os logs';
                    log('‚ôªÔ∏è loadInstructors() chamado');
                } else {
                    throw new Error('Controller n√£o encontrado');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `‚ùå Erro no refresh: ${error.message}`;
                log(`‚ùå Erro no refresh: ${error.message}`);
            }
        }

        // Utility functions
        async function waitForAPIClient() {
            return new Promise((resolve) => {
                if (window.createModuleAPI) {
                    resolve();
                } else {
                    const check = setInterval(() => {
                        if (window.createModuleAPI) {
                            clearInterval(check);
                            resolve();
                        }
                    }, 100);
                }
            });
        }

        // Auto-checks on load
        window.addEventListener('load', () => {
            log('üöÄ Sistema de testes inicializado');
            
            // Check API Client
            setTimeout(() => {
                const apiStatus = document.getElementById('api-status');
                if (window.createModuleAPI) {
                    apiStatus.textContent = 'Dispon√≠vel ‚úÖ';
                    apiStatus.style.color = 'green';
                } else {
                    apiStatus.textContent = 'N√£o encontrado ‚ùå';
                    apiStatus.style.color = 'red';
                }
            }, 500);

            // Check Module
            setTimeout(() => {
                const moduleStatus = document.getElementById('module-status');
                if (window.InstructorsModule) {
                    moduleStatus.textContent = 'Carregado ‚úÖ';
                    moduleStatus.style.color = 'green';
                } else {
                    moduleStatus.textContent = 'N√£o carregado ‚ùå';
                    moduleStatus.style.color = 'red';
                }
            }, 1000);

            // Check Controller
            setTimeout(() => {
                const controllerStatus = document.getElementById('controller-status');
                if (window.InstructorsController) {
                    controllerStatus.textContent = 'Dispon√≠vel ‚úÖ';
                    controllerStatus.style.color = 'green';
                } else {
                    controllerStatus.textContent = 'N√£o encontrado ‚ùå';
                    controllerStatus.style.color = 'red';
                }
            }, 1500);

            // Check Router
            setTimeout(() => {
                const routerStatus = document.getElementById('router-status');
                if (window.navigateTo) {
                    routerStatus.textContent = 'Dispon√≠vel ‚úÖ';
                    routerStatus.style.color = 'green';
                } else {
                    routerStatus.textContent = 'N√£o encontrado ‚ö†Ô∏è';
                    routerStatus.style.color = 'orange';
                }
            }, 2000);

            // Auto-test API after 3 seconds
            setTimeout(() => {
                log('üîÑ Executando teste autom√°tico da API...');
                testAPI();
            }, 3000);
        });
    </script>
</body>
</html>